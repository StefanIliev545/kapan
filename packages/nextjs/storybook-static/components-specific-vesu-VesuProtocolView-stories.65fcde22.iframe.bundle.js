"use strict";(self.webpackChunk_se_2_nextjs=self.webpackChunk_se_2_nextjs||[]).push([[1759],{"./components/specific/vesu/VesuProtocolView.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>VesuProtocolView_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),next_image=__webpack_require__("./node_modules/@storybook/nextjs/dist/images/next-image.mjs"),lib=__webpack_require__("./node_modules/react-icons/lib/index.mjs");function FaGasPump(props){return(0,lib.k5)({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M336 448H16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h320c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm157.2-340.7l-81-81c-6.2-6.2-16.4-6.2-22.6 0l-11.3 11.3c-6.2 6.2-6.2 16.4 0 22.6L416 97.9V160c0 28.1 20.9 51.3 48 55.2V376c0 13.2-10.8 24-24 24s-24-10.8-24-24v-32c0-48.6-39.4-88-88-88h-8V64c0-35.3-28.7-64-64-64H96C60.7 0 32 28.7 32 64v352h288V304h8c22.1 0 40 17.9 40 40v27.8c0 37.7 27 72 64.5 75.9 43 4.3 79.5-29.5 79.5-71.7V152.6c0-17-6.8-33.3-18.8-45.3zM256 192H96V64h160v128z"},child:[]}]})(props)}var formatUnits=__webpack_require__("./node_modules/viem/_esm/utils/unit/formatUnits.js"),parseUnits=__webpack_require__("./node_modules/viem/_esm/utils/unit/parseUnits.js"),dist=__webpack_require__("./node_modules/@starknet-react/core/dist/index.js"),esm_react=__webpack_require__("./node_modules/zustand/esm/react.mjs"),scaffold_config=__webpack_require__("./scaffold.config.ts");const store_useGlobalState=(0,esm_react.v)(set=>({nativeCurrency:{price:0,isFetching:!0},strkCurrencyPrice:0,nativeCurrencyPrice:0,setStrkCurrencyPrice:newValue=>set(()=>({strkCurrencyPrice:newValue})),setNativeCurrencyPrice:newValue=>set(state=>({nativeCurrency:{...state.nativeCurrency,price:newValue},nativeCurrencyPrice:newValue})),setIsNativeCurrencyFetching:newValue=>set(state=>({nativeCurrency:{...state.nativeCurrency,isFetching:newValue}})),targetEVMNetwork:scaffold_config.A.targetEVMNetworks[0],setTargetEVMNetwork:newTargetEVMNetwork=>set(()=>({targetEVMNetwork:newTargetEVMNetwork})),targetSNNetwork:scaffold_config.A.targetSNNetworks[0],setTargetSNNetwork:newTargetSNNetwork=>set(()=>({targetSNNetwork:newTargetSNNetwork})),blockNumber:void 0,setBlockNumber:blockNumber=>set(()=>({blockNumber})),snBlockNumber:void 0,setSnBlockNumber:snBlockNumber=>set(()=>({snBlockNumber}))}));var console=__webpack_require__("./node_modules/console-browserify/index.js");function useGasEstimate(opts){const{enabled,buildCalls,currency="ETH",debounceMs=300}=opts,{account}=(0,dist.F7)(),[loading,setLoading]=(0,react.useState)(!1),[feeWei,setFeeWei]=(0,react.useState)(null),[feeNative,setFeeNative]=(0,react.useState)(null),[feeUsd,setFeeUsd]=(0,react.useState)(null),[error,setError]=(0,react.useState)(null),timer=(0,react.useRef)(null),prevKey=(0,react.useRef)(null),ethPrice=store_useGlobalState(state=>state.nativeCurrencyPrice),strkPrice=store_useGlobalState(state=>state.strkCurrencyPrice),clearTimer=()=>{timer.current&&(window.clearTimeout(timer.current),timer.current=null)},doEstimate=(0,react.useCallback)(async(acct,calls)=>{setLoading(!0),setError(null),setFeeWei(null),setFeeNative(null),setFeeUsd(null);try{const callArray=Array.isArray(calls)?calls:[calls],res=1===callArray.length?await acct.estimateInvokeFee(callArray[0]):await acct.estimateFee(callArray);var _res_suggestedMaxFee,_ref,_ref1;const raw=BigInt(null!==(_ref1=null!==(_ref=null!==(_res_suggestedMaxFee=null==res?void 0:res.suggestedMaxFee)&&void 0!==_res_suggestedMaxFee?_res_suggestedMaxFee:null==res?void 0:res.overall_fee)&&void 0!==_ref?_ref:null==res?void 0:res.gas_price)&&void 0!==_ref1?_ref1:0);setFeeWei(raw);let native=0,usd=null;"ETH"===currency?(native=function weiToEth(wei){return Number(wei)/1e18}(raw),null!=ethPrice&&(usd=native*ethPrice)):(native=function friToStrk(fri){return Number(fri)/1e18}(raw),null!=strkPrice&&(usd=native*strkPrice)),setFeeNative(native),setFeeUsd(usd)}catch(e){console.error("Fee estimation failed:",e),setError("Fee estimation unavailable")}finally{setLoading(!1)}},[currency,ethPrice,strkPrice]),refresh=(0,react.useCallback)(async()=>{if(!account)return;const calls=await buildCalls();if(!calls)return void(prevKey.current=null);const key=`${account.address}:${JSON.stringify(calls,(_,v)=>"bigint"==typeof v?v.toString():v)}`;prevKey.current=key,await doEstimate(account,calls)},[account,buildCalls,doEstimate]);return(0,react.useEffect)(()=>{if(clearTimer(),enabled&&account)return timer.current=window.setTimeout(async()=>{const calls=await buildCalls();if(!calls)return setFeeWei(null),setFeeNative(null),setFeeUsd(null),setError(null),void(prevKey.current=null);const key=`${account.address}:${JSON.stringify(calls,(_,v)=>"bigint"==typeof v?v.toString():v)}`;prevKey.current!==key&&(prevKey.current=key,await doEstimate(account,calls))},debounceMs),clearTimer},[enabled,null==account?void 0:account.address,buildCalls,doEstimate,debounceMs]),{loading,error,feeWei,feeNative,feeUsd,refresh}}const utils_formatPercentage=(value,fractionDigits=2,dropLeadingZero=!0)=>{const formatted=value.toFixed(fractionDigits);return dropLeadingZero&&Math.abs(value)<1&&0!==value?formatted.replace(/^(-?)0/,"$1"):formatted};class PositionManager{static fromPositions(supplied,borrowed){const suppliedTotal=supplied.reduce((acc,p)=>acc+p.balance,0),collateralTotal=borrowed.reduce((acc,p)=>acc+(p.collateralValue||0),0),totalSupplied=suppliedTotal>0?suppliedTotal:collateralTotal,borrowedTotal=borrowed.reduce((acc,p)=>acc+Math.abs(p.balance),0);return new PositionManager(totalSupplied,borrowedTotal)}clone(){return new PositionManager(this.suppliedUsd,this.borrowedUsd)}utilization(snapshot=this){return snapshot.suppliedUsd>0?snapshot.borrowedUsd/snapshot.suppliedUsd*100:0}healthFactor(snapshot=this){return snapshot.borrowedUsd>0?snapshot.suppliedUsd/snapshot.borrowedUsd:10}loanToValue(snapshot=this){return this.utilization(snapshot)}freeBorrowUsd(snapshot=this){return Math.max(0,snapshot.suppliedUsd-snapshot.borrowedUsd)}apply(action,usdChange){const next=this.clone();switch(action){case"Borrow":next.borrowedUsd+=usdChange;break;case"Repay":next.borrowedUsd=Math.max(0,next.borrowedUsd-usdChange);break;case"Deposit":next.suppliedUsd+=usdChange;break;case"Withdraw":next.suppliedUsd=Math.max(0,next.suppliedUsd-usdChange)}return next}constructor(suppliedUsd,borrowedUsd){this.suppliedUsd=suppliedUsd,this.borrowedUsd=borrowedUsd}}var TokenActionModal_console=__webpack_require__("./node_modules/console-browserify/index.js");const format=num=>new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(num),formatApy=apy=>apy<1?apy.toFixed(4):apy.toFixed(2),HealthFactor=({value})=>{const percent=Math.min(100,Math.max(0,(value-1)/3*100)),barColor=value>=4?"progress-success":value>2?"progress-warning":"progress-error",textColor=value>=4?"text-success":value>2?"text-warning":"text-error";return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,jsx_runtime.jsx)("span",{children:"Health Factor"}),(0,jsx_runtime.jsx)("progress",{className:`progress w-20 ${barColor}`,value:percent,max:"100"}),(0,jsx_runtime.jsx)("span",{className:textColor,children:value.toFixed(2)})]})},Utilization=({value})=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,jsx_runtime.jsx)("span",{children:"Utilization"}),(0,jsx_runtime.jsx)("progress",{className:"progress progress-primary w-20",value,max:"100"}),(0,jsx_runtime.jsxs)("span",{children:[utils_formatPercentage(value),"%"]})]}),LoanToValue=({value})=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,jsx_runtime.jsx)("span",{children:"Loan to Value"}),(0,jsx_runtime.jsxs)("span",{children:[utils_formatPercentage(value),"%"]})]}),TokenPill=({value,icon,name})=>(0,jsx_runtime.jsxs)("div",{className:"badge badge-outline gap-1",children:[(0,jsx_runtime.jsx)(next_image.A,{src:icon,alt:name,width:12,height:12}),format(value)]}),PercentInput=({balance,decimals,price=0,onChange,percentBase,max})=>{const[amount,setAmount]=(0,react.useState)(""),[active,setActive]=(0,react.useState)(null),usd=(parseFloat(amount||"0")*price).toFixed(2);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"relative",children:[(0,jsx_runtime.jsx)("input",{type:"number",value:amount,onChange:e=>(val=>{let parsed;try{parsed=(0,parseUnits.X)(val||"0",decimals)}catch(e){parsed=0n}const base=null!=percentBase?percentBase:balance,limit=null!=max?max:base;let isMax=!1;limit>0n&&parsed>=limit?(parsed=limit,val=(0,formatUnits.J)(limit,decimals),isMax=!0):base>0n&&parsed>=base&&(isMax=!0),setAmount(val),setActive(null),onChange(val,isMax)})(e.target.value),placeholder:"0.0",className:"input input-bordered w-full pr-24"}),(0,jsx_runtime.jsx)("div",{className:"absolute inset-y-0 right-3 flex items-center divide-x divide-base-300 text-xs",children:[25,50,100].map(p=>(0,jsx_runtime.jsxs)("button",{type:"button",onClick:()=>(p=>{const val=(null!=percentBase?percentBase:balance)*BigInt(p)/100n,formatted=(0,formatUnits.J)(val,decimals);setAmount(formatted),setActive(p),onChange(formatted,100===p)})(p),className:"px-1 "+(active===p?"underline":""),children:[p,"%"]},p))})]}),(0,jsx_runtime.jsxs)("div",{className:"text-xs opacity-70 mt-1 text-center",children:["≈ $",usd]})]})},LeftMetrics=({hf,utilization,ltv,metricLabel,metricValue,token})=>(0,jsx_runtime.jsxs)("div",{className:"w-full md:w-56 p-6 space-y-3 text-sm bg-base-200 border-b md:border-b-0 md:border-r border-base-300",children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold mb-2",children:"Before"}),(0,jsx_runtime.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,jsx_runtime.jsx)(HealthFactor,{value:hf}),(0,jsx_runtime.jsx)(Utilization,{value:utilization}),(0,jsx_runtime.jsx)(LoanToValue,{value:ltv}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{children:metricLabel}),(0,jsx_runtime.jsx)(TokenPill,{value:metricValue,icon:token.icon,name:token.name})]})]})]}),TokenActionModal=({isOpen,onClose,action,apyLabel,apy,token,protocolName,metricLabel,before,balance,percentBase,max,network,hf=1.9,utilization=65,ltv=75,position,buildCalls,onConfirm})=>{const[amount,setAmount]=(0,react.useState)(""),[isMax,setIsMax]=(0,react.useState)(!1),[txState,setTxState]=(0,react.useState)("idle"),parsed=parseFloat(amount||"0"),price=token.usdPrice||0,beforePosition=(0,react.useMemo)(()=>null!=position?position:new PositionManager(0,0),[position]),afterPosition=(0,react.useMemo)(()=>beforePosition.apply(action,parsed*price),[beforePosition,action,parsed,price]),beforeHf=position?beforePosition.healthFactor():hf,beforeUtil=position?beforePosition.utilization():utilization,beforeLtv=position?beforePosition.loanToValue():ltv,afterHf=position?afterPosition.healthFactor():hf,afterUtil=position?afterPosition.utilization():utilization,afterLtv=position?afterPosition.loanToValue():ltv,effectiveMax=(0,react.useMemo)(()=>{if("Borrow"!==action||!position||!token.usdPrice)return max;const decimals=token.decimals||18,freeUsd=position.freeBorrowUsd();if(freeUsd<=0||0===token.usdPrice)return 0n;const amount=Math.floor(freeUsd/token.usdPrice*10**decimals);return BigInt(amount)},[action,position,token.usdPrice,token.decimals,max]),afterValue=(0,react.useMemo)(()=>{switch(action){case"Borrow":case"Deposit":return before+parsed;case"Withdraw":case"Repay":return Math.max(0,before-parsed);default:return before}},[action,before,parsed]),buildCallsForEstimate=(0,react.useCallback)(()=>buildCalls?buildCalls(amount,isMax):null,[buildCalls,amount,isMax]),{loading:feeLoading,error:feeError,feeNative}=useGasEstimate({enabled:isOpen&&"stark"===network,buildCalls:buildCallsForEstimate,currency:"STRK"}),handleClose=()=>{setAmount(""),setIsMax(!1),setTxState("idle"),onClose()};return(0,jsx_runtime.jsxs)("dialog",{className:"modal "+(isOpen?"modal-open":""),children:[(0,jsx_runtime.jsx)("div",{className:"modal-box max-w-2xl p-0 rounded-none overflow-hidden",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,jsx_runtime.jsx)(LeftMetrics,{hf:beforeHf,utilization:beforeUtil,ltv:beforeLtv,metricLabel,metricValue:before,token}),(0,jsx_runtime.jsxs)("div",{className:"flex-1 p-6 space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(next_image.A,{src:token.icon,alt:token.name,width:32,height:32}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("h3",{className:"font-bold text-xl",children:[action," ",token.name]}),protocolName&&(0,jsx_runtime.jsx)("div",{className:"text-xs opacity-70",children:protocolName})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,jsx_runtime.jsxs)("span",{className:"badge badge-outline",children:[apyLabel," ",formatApy(apy),"%"]}),(0,jsx_runtime.jsxs)("span",{children:["Balance: ",format(Number((0,formatUnits.J)(balance,token.decimals||18)))]})]}),(0,jsx_runtime.jsx)(PercentInput,{balance,decimals:token.decimals||18,price:token.usdPrice,onChange:(val,maxed)=>{setAmount(val),setIsMax(maxed)},percentBase:null!=percentBase?percentBase:"Borrow"===action?effectiveMax:void 0,max:effectiveMax}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs pt-2",children:[(0,jsx_runtime.jsx)(HealthFactor,{value:afterHf}),(0,jsx_runtime.jsx)(Utilization,{value:afterUtil}),(0,jsx_runtime.jsx)(LoanToValue,{value:afterLtv}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{children:metricLabel}),(0,jsx_runtime.jsx)(TokenPill,{value:afterValue,icon:token.icon,name:token.name})]})]}),(0,jsx_runtime.jsx)("div",{className:"modal-action pt-2",children:(0,jsx_runtime.jsxs)("button",{className:"btn w-full flex justify-between "+("success"===txState?"btn-success":"btn-primary"),onClick:async()=>{if("success"!==txState)try{setTxState("pending"),await(null==onConfirm?void 0:onConfirm(amount,isMax)),setTxState("success")}catch(e){TokenActionModal_console.error(e),setTxState("idle")}else handleClose()},disabled:"pending"===txState,children:[(0,jsx_runtime.jsx)("span",{children:"pending"===txState?(0,jsx_runtime.jsx)("span",{className:"loading loading-spinner"}):"success"===txState?"Close":action}),"stark"===network&&(0,jsx_runtime.jsxs)("span",{className:"flex items-center gap-1 text-xs",children:[(0,jsx_runtime.jsx)(FaGasPump,{className:"text-gray-400"}),feeLoading&&null===feeNative?(0,jsx_runtime.jsx)("span",{className:"loading loading-spinner loading-xs"}):feeError?null:null!==feeNative?(0,jsx_runtime.jsxs)("span",{children:[feeNative.toFixed(4)," STRK"]}):null]})]})})]})]})}),(0,jsx_runtime.jsx)("form",{method:"dialog",className:"modal-backdrop",onClick:handleClose,children:(0,jsx_runtime.jsx)("button",{children:"close"})})]})};TokenActionModal.__docgenInfo={description:"",methods:[],displayName:"TokenActionModal",props:{isOpen:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},action:{required:!0,tsType:{name:"union",raw:'"Borrow" | "Deposit" | "Withdraw" | "Repay"',elements:[{name:"literal",value:'"Borrow"'},{name:"literal",value:'"Deposit"'},{name:"literal",value:'"Withdraw"'},{name:"literal",value:'"Repay"'}]},description:""},apyLabel:{required:!0,tsType:{name:"string"},description:""},apy:{required:!0,tsType:{name:"number"},description:""},token:{required:!0,tsType:{name:"TokenInfo"},description:""},protocolName:{required:!1,tsType:{name:"string"},description:""},metricLabel:{required:!0,tsType:{name:"string"},description:""},before:{required:!0,tsType:{name:"number"},description:""},balance:{required:!0,tsType:{name:"unknown"},description:""},percentBase:{required:!1,tsType:{name:"unknown"},description:""},max:{required:!1,tsType:{name:"unknown"},description:""},network:{required:!0,tsType:{name:"union",raw:'"evm" | "stark"',elements:[{name:"literal",value:'"evm"'},{name:"literal",value:'"stark"'}]},description:""},buildTx:{required:!1,tsType:{name:"signature",type:"function",raw:"(amount: string, isMax: boolean) => any",signature:{arguments:[{type:{name:"string"},name:"amount"},{type:{name:"boolean"},name:"isMax"}],return:{name:"any"}}},description:""},buildCalls:{required:!1,tsType:{name:"signature",type:"function",raw:"(\n  amount: string,\n  isMax: boolean,\n) => Promise<Call | Call[] | null | undefined> | Call | Call[] | null | undefined",signature:{arguments:[{type:{name:"string"},name:"amount"},{type:{name:"boolean"},name:"isMax"}],return:{name:"union",raw:"Promise<Call | Call[] | null | undefined> | Call | Call[] | null | undefined",elements:[{name:"Promise",elements:[{name:"union",raw:"Call | Call[] | null | undefined",elements:[{name:"Call"},{name:"Array",elements:[{name:"Call"}],raw:"Call[]"},{name:"null"},{name:"undefined"}]}],raw:"Promise<Call | Call[] | null | undefined>"},{name:"Call"},{name:"Array",elements:[{name:"Call"}],raw:"Call[]"},{name:"null"},{name:"undefined"}]}}},description:""},hf:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"1.9",computed:!1}},utilization:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"65",computed:!1}},ltv:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"75",computed:!1}},position:{required:!1,tsType:{name:"PositionManager"},description:""},onConfirm:{required:!1,tsType:{name:"signature",type:"function",raw:"(amount: string, isMax?: boolean) => Promise<unknown> | void",signature:{arguments:[{type:{name:"string"},name:"amount"},{type:{name:"boolean"},name:"isMax"}],return:{name:"union",raw:"Promise<unknown> | void",elements:[{name:"Promise",elements:[{name:"unknown"}],raw:"Promise<unknown>"},{name:"void"}]}}},description:""}}};var useAccount=__webpack_require__("./node_modules/wagmi/dist/esm/hooks/useAccount.js"),useReadContract=__webpack_require__("./node_modules/wagmi/dist/esm/hooks/useReadContract.js");const externalContracts_tokenNameToLogo=tokenName=>"USD₮0"==tokenName?"/logos/usdt.svg":`/logos/${tokenName.toLowerCase()}.svg`,ERC20ABI=[{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{payable:!0,stateMutability:"payable",type:"fallback"},{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"}],contracts_externalContracts={42161:{USDC:{address:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",abi:[{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"}],logo:"/logos/usdc.svg",richAddress:"0xB38e8c17e38363aF6EbdCb3dAE12e0243582891D"},USDT:{address:"0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9",abi:[{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"}],logo:"/logos/usdt.svg",richAddress:"0xB38e8c17e38363aF6EbdCb3dAE12e0243582891D"},USDCe:{address:"0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8",abi:[{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"}],logo:"/logos/usdc.svg",richAddress:"0xB38e8c17e38363aF6EbdCb3dAE12e0243582891D"},eth:{address:"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1",abi:[{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"}],logo:"/logos/ethereum.svg",richAddress:"0xB38e8c17e38363aF6EbdCb3dAE12e0243582891D"},ETH:{address:"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1",abi:[{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"}],logo:"/logos/ethereum.svg",richAddress:"0xB38e8c17e38363aF6EbdCb3dAE12e0243582891D"}},31337:{USDC:{address:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",abi:[{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"}],logo:"/logos/usdc.svg",richAddress:"0xB38e8c17e38363aF6EbdCb3dAE12e0243582891D"},USDT:{address:"0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9",abi:[{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"}],logo:"/logos/usdt.svg",richAddress:"0xB38e8c17e38363aF6EbdCb3dAE12e0243582891D"},USDCe:{address:"0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8",abi:[{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"}],logo:"/logos/usdc.svg",richAddress:"0xB38e8c17e38363aF6EbdCb3dAE12e0243582891D"},eth:{address:"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1",abi:[{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"}],logo:"/logos/ethereum.svg",richAddress:"0xB38e8c17e38363aF6EbdCb3dAE12e0243582891D"},ETH:{address:"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1",abi:[{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"}],logo:"/logos/ethereum.svg",richAddress:"0xB38e8c17e38363aF6EbdCb3dAE12e0243582891D"}}},universalEthAddress="0x49D36570D4E46F48E99674BD3FCC84644DDD6B96F7C741B1562B82F9E004DC7",universalStrkAddress="0x04718f5a0fc34cc1af16a1cdee98ffb20c31f5cd61d6ab07201858f4287c938d",universalErc20Abi=[{type:"impl",name:"ERC20Impl",interface_name:"openzeppelin::token::erc20::interface::IERC20"},{name:"openzeppelin::token::erc20::interface::IERC20",type:"interface",items:[{name:"name",type:"function",inputs:[],outputs:[{type:"core::felt252"}],state_mutability:"view"},{name:"symbol",type:"function",inputs:[],outputs:[{type:"core::felt252"}],state_mutability:"view"},{name:"decimals",type:"function",inputs:[],outputs:[{type:"core::integer::u8"}],state_mutability:"view"},{name:"total_supply",type:"function",inputs:[],outputs:[{type:"core::integer::u256"}],state_mutability:"view"},{name:"balance_of",type:"function",inputs:[{name:"account",type:"core::starknet::contract_address::ContractAddress"}],outputs:[{type:"core::integer::u256"}],state_mutability:"view"},{name:"allowance",type:"function",inputs:[{name:"owner",type:"core::starknet::contract_address::ContractAddress"},{name:"spender",type:"core::starknet::contract_address::ContractAddress"}],outputs:[{type:"core::integer::u256"}],state_mutability:"view"},{name:"transfer",type:"function",inputs:[{name:"recipient",type:"core::starknet::contract_address::ContractAddress"},{name:"amount",type:"core::integer::u256"}],outputs:[{type:"core::bool"}],state_mutability:"external"},{name:"transfer_from",type:"function",inputs:[{name:"sender",type:"core::starknet::contract_address::ContractAddress"},{name:"recipient",type:"core::starknet::contract_address::ContractAddress"},{name:"amount",type:"core::integer::u256"}],outputs:[{type:"core::bool"}],state_mutability:"external"},{name:"approve",type:"function",inputs:[{name:"spender",type:"core::starknet::contract_address::ContractAddress"},{name:"amount",type:"core::integer::u256"}],outputs:[{type:"core::bool"}],state_mutability:"external"}]},{name:"ERC20CamelOnlyImpl",type:"impl",interface_name:"openzeppelin::token::erc20::interface::IERC20CamelOnly"},{type:"interface",name:"openzeppelin::token::erc20::interface::IERC20CamelOnly",items:[{name:"totalSupply",type:"function",inputs:[],outputs:[{type:"core::integer::u256"}],state_mutability:"view"},{name:"balanceOf",type:"function",inputs:[{name:"account",type:"core::starknet::contract_address::ContractAddress"}],outputs:[{type:"core::integer::u256"}],state_mutability:"view"},{name:"transferFrom",type:"function",inputs:[{name:"sender",type:"core::starknet::contract_address::ContractAddress"},{name:"recipient",type:"core::starknet::contract_address::ContractAddress"},{name:"amount",type:"core::integer::u256"}],outputs:[{type:"core::bool"}],state_mutability:"external"}]},{kind:"struct",name:"openzeppelin::token::erc20_v070::erc20::ERC20::Transfer",type:"event",members:[{kind:"key",name:"from",type:"core::starknet::contract_address::ContractAddress"},{kind:"key",name:"to",type:"core::starknet::contract_address::ContractAddress"},{kind:"data",name:"value",type:"core::integer::u256"}]},{kind:"enum",name:"openzeppelin::token::erc20_v070::erc20::ERC20::Event",type:"event",variants:[{kind:"nested",name:"Transfer",type:"openzeppelin::token::erc20_v070::erc20::ERC20::Transfer"}]}],useTokenBalance=(tokenAddress,network="evm")=>{if(!tokenAddress)return{balance:0n,decimals:void 0};if("stark"===network){const{address}=(0,dist.F7)(),{data:balance}=(0,dist.Qo)({address:tokenAddress,abi:universalErc20Abi,functionName:"balance_of",args:[address],enabled:!!address}),{data:decimals}=(0,dist.Qo)({address:tokenAddress,abi:universalErc20Abi,functionName:"decimals",args:[],enabled:!0});return{balance:null!=balance?balance:0n,decimals:decimals?Number(decimals):void 0}}const{address}=(0,useAccount.F)(),{data:balance}=(0,useReadContract.Q)({address:tokenAddress,abi:ERC20ABI,functionName:"balanceOf",args:[null!=address?address:"0x"],query:{enabled:!!address}}),{data:decimals}=(0,useReadContract.Q)({address:tokenAddress,abi:ERC20ABI,functionName:"decimals",query:{enabled:!0}});return{balance:null!=balance?balance:0n,decimals:decimals?Number(decimals):void 0}};var starknet_dist=__webpack_require__("./node_modules/starknet/dist/index.mjs");var scaffold_eth=__webpack_require__("./utils/scaffold-eth/index.ts");__webpack_require__("./node_modules/console-browserify/index.js");new Map;var usehooks_ts_dist=__webpack_require__("./node_modules/usehooks-ts/dist/index.js"),hooks_usePublicClient=__webpack_require__("./node_modules/wagmi/dist/esm/hooks/usePublicClient.js");const contracts=((local,external)=>{const result={},allKeys=Array.from(new Set([...Object.keys(external),...Object.keys(local)]));for(const key of allKeys){if(!external[key]){result[key]=local[key];continue}const amendedExternal=Object.fromEntries(Object.entries(external[key]).map(([contractName,declaration])=>[contractName,{...declaration,external:!0}]));result[key]={...local[key],...amendedExternal}}return result})(__webpack_require__("./contracts/hardhat/deployedContracts.ts").A,contracts_externalContracts);var ContractCodeStatus=function(ContractCodeStatus){return ContractCodeStatus[ContractCodeStatus.LOADING=0]="LOADING",ContractCodeStatus[ContractCodeStatus.DEPLOYED=1]="DEPLOYED",ContractCodeStatus[ContractCodeStatus.NOT_FOUND=2]="NOT_FOUND",ContractCodeStatus}({}),useDeployedContractInfo_console=__webpack_require__("./node_modules/console-browserify/index.js");const deploymentStatusCache=new Map;function useDeployedContractInfo_useDeployedContractInfo(configOrName){var _contracts_selectedNetwork_id;const isMounted=(0,usehooks_ts_dist.aq)(),finalConfig="string"==typeof configOrName?{contractName:configOrName}:configOrName;(0,react.useEffect)(()=>{"string"==typeof configOrName&&useDeployedContractInfo_console.warn("Using `useDeployedContractInfo` with a string parameter is deprecated. Please use the object parameter version instead.")},[configOrName]);const{contractName,chainId}=finalConfig,selectedNetwork=useSelectedNetwork_useSelectedNetwork(chainId),deployedContract=null==contracts||null===(_contracts_selectedNetwork_id=contracts[selectedNetwork.id])||void 0===_contracts_selectedNetwork_id?void 0:_contracts_selectedNetwork_id[contractName],cacheKey=deployedContract?`${selectedNetwork.id}-${deployedContract.address}`:void 0,cachedStatus=cacheKey?deploymentStatusCache.get(cacheKey):void 0,[status,setStatus]=(0,react.useState)(null!=cachedStatus?cachedStatus:ContractCodeStatus.LOADING),publicClient=(0,hooks_usePublicClient.e)({chainId:selectedNetwork.id});return(0,react.useEffect)(()=>{(async()=>{if(!deployedContract||!cacheKey)return void setStatus(ContractCodeStatus.NOT_FOUND);if(!isMounted()||!publicClient)return;const cached=deploymentStatusCache.get(cacheKey);if(cached)setStatus(cached);else try{const newStatus="0x"===await publicClient.getBytecode({address:deployedContract.address})?ContractCodeStatus.NOT_FOUND:ContractCodeStatus.DEPLOYED;deploymentStatusCache.set(cacheKey,newStatus),setStatus(newStatus)}catch(e){useDeployedContractInfo_console.error(e),deploymentStatusCache.set(cacheKey,ContractCodeStatus.NOT_FOUND),setStatus(ContractCodeStatus.NOT_FOUND)}})()},[isMounted,cacheKey,deployedContract,publicClient]),{data:status===ContractCodeStatus.DEPLOYED?deployedContract:void 0,isLoading:status===ContractCodeStatus.LOADING}}var createTestClient=__webpack_require__("./node_modules/viem/_esm/clients/createTestClient.js"),webSocket=__webpack_require__("./node_modules/viem/_esm/clients/transports/webSocket.js"),decorators_public=__webpack_require__("./node_modules/viem/_esm/clients/decorators/public.js"),wallet=__webpack_require__("./node_modules/viem/_esm/clients/decorators/wallet.js"),hardhat=__webpack_require__("./node_modules/viem/_esm/chains/definitions/hardhat.js");(0,createTestClient.C)({chain:hardhat.H,mode:"hardhat",transport:(0,webSocket.K)("ws://127.0.0.1:8545")}).extend(decorators_public.$).extend(wallet.D);__webpack_require__("./node_modules/next-themes/dist/index.mjs");__webpack_require__("./node_modules/wagmi/dist/esm/hooks/useBlockNumber.js");const common_replacer=(_key,value)=>"bigint"==typeof value?value.toString():value,useScaffoldReadContract=({contractName,functionName,args,chainId,...readConfig})=>{const selectedNetwork=useSelectedNetwork_useSelectedNetwork(chainId),{data:deployedContract}=useDeployedContractInfo_useDeployedContractInfo({contractName,chainId:selectedNetwork.id}),{query:queryOptions,watch,blockNumber:blockNumberConfig,blockTag,...restConfig}=readConfig,defaultWatch=null!=watch&&watch,sanitizedBlockNumber="bigint"==typeof blockNumberConfig?Number(blockNumberConfig):blockNumberConfig,sanitizedBlockTag="bigint"==typeof blockTag?blockTag.toString():blockTag,serializedArgs=args?JSON.parse(JSON.stringify(args,common_replacer)):void 0,readContractHookRes=(0,useReadContract.Q)({chainId:selectedNetwork.id,functionName,address:null==deployedContract?void 0:deployedContract.address,abi:null==deployedContract?void 0:deployedContract.abi,args:serializedArgs,blockNumber:sanitizedBlockNumber,blockTag:sanitizedBlockTag,...restConfig,query:{enabled:!Array.isArray(args)||!args.some(arg=>void 0===arg),...queryOptions}}),blockNumber=store_useGlobalState(state=>state.blockNumber);return(0,react.useEffect)(()=>{defaultWatch&&void 0!==blockNumber&&readContractHookRes.refetch()},[blockNumber,defaultWatch]),readContractHookRes};var useWriteContract=__webpack_require__("./node_modules/wagmi/dist/esm/hooks/useWriteContract.js"),useScaffoldWriteContract_console=__webpack_require__("./node_modules/console-browserify/index.js");var getPublicClient=__webpack_require__("./node_modules/@wagmi/core/dist/esm/actions/getPublicClient.js"),useWalletClient=__webpack_require__("./node_modules/wagmi/dist/esm/hooks/useWalletClient.js"),wagmiConfig=__webpack_require__("./services/web3/wagmiConfig.tsx"),useTransactor_console=__webpack_require__("./node_modules/console-browserify/index.js");const TxnNotification=({message,blockExplorerLink})=>(0,jsx_runtime.jsxs)("div",{className:"flex flex-col ml-1 cursor-default",children:[(0,jsx_runtime.jsx)("p",{className:"my-0",children:message}),blockExplorerLink&&blockExplorerLink.length>0?(0,jsx_runtime.jsx)("a",{href:blockExplorerLink,target:"_blank",rel:"noreferrer",className:"block link text-md",children:"check out transaction"}):null]}),useTransactor=_walletClient=>{let walletClient=_walletClient;const{data}=(0,useWalletClient.G)();void 0===walletClient&&data&&(walletClient=data);return async(tx,options)=>{if(!walletClient)return scaffold_eth.Ew.error("Cannot access account"),void useTransactor_console.error("⚡️ ~ file: useTransactor.tsx ~ error");let transactionHash,transactionReceipt,notificationId=null,blockExplorerTxURL="";try{const network=await walletClient.getChainId(),publicClient=(0,getPublicClient.B)(wagmiConfig.G);if(notificationId=scaffold_eth.Ew.loading((0,jsx_runtime.jsx)(TxnNotification,{message:"Awaiting for user confirmation"})),"function"==typeof tx){transactionHash=await tx()}else{if(null==tx)throw new Error("Incorrect transaction passed to transactor");transactionHash=await walletClient.sendTransaction(tx)}if(scaffold_eth.Ew.remove(notificationId),blockExplorerTxURL=network?(0,scaffold_eth.NP)(network,transactionHash):"",notificationId=scaffold_eth.Ew.loading((0,jsx_runtime.jsx)(TxnNotification,{message:"Waiting for transaction to complete.",blockExplorerLink:blockExplorerTxURL})),transactionReceipt=await publicClient.waitForTransactionReceipt({hash:transactionHash,confirmations:null==options?void 0:options.blockConfirmations}),scaffold_eth.Ew.remove(notificationId),"reverted"===transactionReceipt.status)throw new Error("Transaction reverted");scaffold_eth.Ew.success((0,jsx_runtime.jsx)(TxnNotification,{message:"Transaction completed successfully!",blockExplorerLink:blockExplorerTxURL}),{icon:"🎉"}),window.dispatchEvent(new Event("txCompleted")),(null==options?void 0:options.onBlockConfirmation)&&options.onBlockConfirmation(transactionReceipt)}catch(error){notificationId&&scaffold_eth.Ew.remove(notificationId),useTransactor_console.error("⚡️ ~ file: useTransactor.ts ~ error",error);const message=(0,scaffold_eth.gf)(error);if("reverted"===(null==transactionReceipt?void 0:transactionReceipt.status))throw scaffold_eth.Ew.error((0,jsx_runtime.jsx)(TxnNotification,{message,blockExplorerLink:blockExplorerTxURL})),error;throw scaffold_eth.Ew.error(message),error}return transactionHash}};function useSelectedNetwork_useSelectedNetwork(chainId){const targetNetwork=store_useGlobalState(({targetEVMNetwork})=>targetEVMNetwork);var _scaffoldConfig_targetEVMNetworks_find;return null!==(_scaffoldConfig_targetEVMNetworks_find=scaffold_config.A.targetEVMNetworks.find(targetNetwork=>targetNetwork.id===chainId))&&void 0!==_scaffoldConfig_targetEVMNetworks_find?_scaffoldConfig_targetEVMNetworks_find:targetNetwork}var ContractClassHashCache_console=__webpack_require__("./node_modules/console-browserify/index.js");class ContractClassHashCache{static getInstance(){return ContractClassHashCache.instance||(ContractClassHashCache.instance=new ContractClassHashCache),ContractClassHashCache.instance}async getClassHash(publicClient,address,blockIdentifier="pending"){const cacheKey=`${address}-${blockIdentifier}`;if(this.cache.has(cacheKey))return this.cache.get(cacheKey);if(this.pendingRequests.has(cacheKey))return this.pendingRequests.get(cacheKey);const pendingRequest=this.fetchClassHash(publicClient,address,blockIdentifier,cacheKey);this.pendingRequests.set(cacheKey,pendingRequest);try{return await pendingRequest}finally{this.pendingRequests.delete(cacheKey)}}async fetchClassHash(publicClient,address,blockIdentifier,cacheKey){try{const classHash=await publicClient.getClassHashAt(address,blockIdentifier);return this.cache.set(cacheKey,classHash),classHash}catch(error){return void ContractClassHashCache_console.error("Failed to fetch class hash:",error)}}clear(){this.cache.clear(),this.pendingRequests.clear()}constructor(){this.cache=new Map,this.pendingRequests=new Map}}function useAccount_useAccount(){const starknetAccount=(0,dist.F7)(),{account,address,status}=starknetAccount,correctedStatus=(0,react.useMemo)(()=>"connected"!==status||account?status:"connecting",[status,account]),[accountChainId,setAccountChainId]=(0,react.useState)(0n);(0,react.useEffect)(()=>{if(account){(async()=>{try{var _account_channel;let chainId;chainId="function"==typeof account.getChainId?await account.getChainId():(null===(_account_channel=account.channel)||void 0===_account_channel?void 0:_account_channel.getChainId)?await account.channel.getChainId():starknet_dist.AA.StarknetChainId.SN_MAIN,chainId&&setAccountChainId(BigInt(chainId.toString()))}catch(error){setAccountChainId(BigInt(starknet_dist.AA.StarknetChainId.SN_MAIN))}})()}},[account]);const patchedAccount=(0,react.useMemo)(()=>{if("connected"===status&&address&&!account){return{address,execute:async()=>{throw new Error("Wallet connection issue. Please refresh and reconnect.")},estimateInvokeFee:async()=>{throw new Error("Wallet connection issue. Please refresh and reconnect.")},getChainId:async()=>starknet_dist.AA.StarknetChainId.SN_MAIN,cairoVersion:"1",signer:{}}}return account},[status,address,account]);return{...starknetAccount,account:patchedAccount,status:correctedStatus,chainId:accountChainId}}function scaffold_stark_useTargetNetwork_useTargetNetwork(){const{chainId}=useAccount_useAccount(),targetNetwork=store_useGlobalState(({targetSNNetwork})=>targetSNNetwork),setTargetNetwork=store_useGlobalState(({setTargetSNNetwork})=>setTargetSNNetwork);return(0,react.useEffect)(()=>{const newSelectedNetwork=scaffold_config.A.targetSNNetworks.find(targetNetwork=>targetNetwork.id===chainId);newSelectedNetwork&&newSelectedNetwork.id!==targetNetwork.id&&setTargetNetwork(newSelectedNetwork)},[chainId,setTargetNetwork,targetNetwork.id]),{targetNetwork:{...targetNetwork}}}const contracts_configExternalContracts={};var snfoundry_deployedContracts=__webpack_require__("./contracts/snfoundry/deployedContracts.ts");const predeployedContracts={devnet:{Eth:{address:universalEthAddress,abi:universalErc20Abi,classHash:"0x046ded64ae2dead6448e247234bab192a9c483644395b66f2155f2614e5804b0"},Strk:{address:universalStrkAddress,abi:universalErc20Abi,classHash:"0x046ded64ae2dead6448e247234bab192a9c483644395b66f2155f2614e5804b0"}},sepolia:{Eth:{address:universalEthAddress,abi:universalErc20Abi,classHash:"0x07f3777c99f3700505ea966676aac4a0d692c2a9f5e667f4c606b51ca1dd3420"},Strk:{address:universalStrkAddress,abi:universalErc20Abi,classHash:"0x04ad3c1dc8413453db314497945b6903e1c766495a1e60492d44da9c2a986e4b"}},mainnet:{Eth:{address:universalEthAddress,abi:universalErc20Abi,classHash:"0x07f3777c99f3700505ea966676aac4a0d692c2a9f5e667f4c606b51ca1dd3420"},Strk:{address:universalStrkAddress,abi:universalErc20Abi,classHash:"0x04ad3c1dc8413453db314497945b6903e1c766495a1e60492d44da9c2a986e4b"}}};__webpack_require__("./node_modules/console-browserify/index.js");var contract_ContractCodeStatus=function(ContractCodeStatus){return ContractCodeStatus[ContractCodeStatus.LOADING=0]="LOADING",ContractCodeStatus[ContractCodeStatus.DEPLOYED=1]="DEPLOYED",ContractCodeStatus[ContractCodeStatus.NOT_FOUND=2]="NOT_FOUND",ContractCodeStatus}({});const contract_deepMergeContracts=(local,external)=>{const result={},allKeys=Array.from(new Set([...Object.keys(local),...Object.keys(external)]));for(const key of allKeys){const localValue=local[key],externalValue=external[key];result[key]="object"==typeof localValue&&"object"==typeof externalValue&&null!==localValue&&null!==externalValue?contract_deepMergeContracts(localValue,externalValue):void 0!==externalValue?externalValue:localValue}return result},mergedPredeployedContracts=contract_deepMergeContracts(predeployedContracts,contracts_configExternalContracts),contract_contracts=contract_deepMergeContracts(snfoundry_deployedContracts.A,mergedPredeployedContracts);const scaffold_stark_useDeployedContractInfo_useDeployedContractInfo=contractName=>{var _contracts_targetNetwork_network;const isMounted=(0,usehooks_ts_dist.aq)(),{targetNetwork}=scaffold_stark_useTargetNetwork_useTargetNetwork(),deployedContract=null==contract_contracts||null===(_contracts_targetNetwork_network=contract_contracts[targetNetwork.network])||void 0===_contracts_targetNetwork_network?void 0:_contracts_targetNetwork_network[contractName],[status,setStatus]=(0,react.useState)(contract_ContractCodeStatus.LOADING),{provider:publicClient}=(0,dist.Dz)();return(0,react.useEffect)(()=>{(async()=>{if(!deployedContract)return void setStatus(contract_ContractCodeStatus.NOT_FOUND);const classHashCache=ContractClassHashCache.getInstance(),contractClassHash=await classHashCache.getClassHash(publicClient,deployedContract.address,"latest");isMounted()&&setStatus(null!=contractClassHash?contract_ContractCodeStatus.DEPLOYED:contract_ContractCodeStatus.NOT_FOUND)})()},[isMounted,contractName,deployedContract,publicClient]),{data:status===contract_ContractCodeStatus.DEPLOYED?deployedContract:void 0,isLoading:status===contract_ContractCodeStatus.LOADING,raw:deployedContract,status}};var scaffold_stark=__webpack_require__("./utils/scaffold-stark/index.ts"),scaffold_stark_useTransactor_console=__webpack_require__("./node_modules/console-browserify/index.js");const useTransactor_TxnNotification=({message,blockExplorerLink})=>(0,jsx_runtime.jsxs)("div",{className:"flex flex-col ml-1 cursor-default",children:[(0,jsx_runtime.jsx)("p",{className:"my-0",children:message}),blockExplorerLink&&blockExplorerLink.length>0?(0,jsx_runtime.jsx)("a",{href:blockExplorerLink,target:"_blank",rel:"noreferrer",className:"block link text-md",children:"check out transaction"}):null]});var SelectedGasTokenContext=__webpack_require__("./contexts/SelectedGasTokenContext.tsx"),usePaymasterTransactor_console=__webpack_require__("./node_modules/console-browserify/index.js");const usePaymasterTransactor_TxnNotification=({message,blockExplorerLink})=>(0,jsx_runtime.jsxs)("div",{className:"flex flex-col ml-1 cursor-default",children:[(0,jsx_runtime.jsx)("p",{className:"my-0",children:message}),blockExplorerLink&&blockExplorerLink.length>0?(0,jsx_runtime.jsx)("a",{href:blockExplorerLink,target:"_blank",rel:"noreferrer",className:"block link text-md",children:"check out transaction"}):null]});var useSmartTransactor_console=__webpack_require__("./node_modules/console-browserify/index.js");const useSmartTransactor=_walletClient=>{var _selectedToken_address,_selectedToken_symbol_toUpperCase,_selectedToken_symbol;const{selectedToken}=(0,SelectedGasTokenContext.F)(),{data:paymasterTokens}=(0,dist.F$)(),regularTransactor=(_walletClient=>{let walletClient=_walletClient;const{account}=useAccount_useAccount(),{targetNetwork}=scaffold_stark_useTargetNetwork_useTargetNetwork();return void 0===walletClient&&account&&(walletClient=account),async tx=>{if(!walletClient)return scaffold_stark.Ew.error("Cannot access account"),void scaffold_stark_useTransactor_console.error("⚡️ ~ file: useTransactor.tsx ~ error");let transactionHash,notificationId=null;try{const networkId=await walletClient.getChainId();if(notificationId=scaffold_stark.Ew.loading((0,jsx_runtime.jsx)(useTransactor_TxnNotification,{message:"Awaiting for user confirmation"})),"function"==typeof tx){scaffold_stark_useTransactor_console.log("tx is a function");const result=await tx();transactionHash="string"==typeof result?result:result.transaction_hash}else{if(null==tx)throw new Error("Incorrect transaction passed to transactor");scaffold_stark_useTransactor_console.log("tx",tx),transactionHash=(await walletClient.execute(tx,{version:starknet_dist.AA.TRANSACTION_VERSION.V2})).transaction_hash}scaffold_stark.Ew.remove(notificationId);const blockExplorerTxURL=networkId?(0,scaffold_stark.NP)(targetNetwork.network,transactionHash):"";notificationId=scaffold_stark.Ew.loading((0,jsx_runtime.jsx)(useTransactor_TxnNotification,{message:"Waiting for transaction to complete.",blockExplorerLink:blockExplorerTxURL})),scaffold_stark.Ew.remove(notificationId),scaffold_stark.Ew.success((0,jsx_runtime.jsx)(useTransactor_TxnNotification,{message:"Transaction completed successfully!",blockExplorerLink:blockExplorerTxURL}),{icon:"🎉"}),window.dispatchEvent(new Event("txCompleted"))}catch(error){notificationId&&scaffold_stark.Ew.remove(notificationId);const match=/Contract (.*?)"}/.exec(error.message),message=match?match[1]:error.message;throw scaffold_stark_useTransactor_console.error("⚡️ ~ file: useTransactor.ts ~ error",message),scaffold_stark.Ew.error(message),error}return transactionHash}})(_walletClient),paymasterTransactor=(_walletClient=>{var _selectedToken_address,_selectedToken_symbol_toUpperCase,_selectedToken_symbol;let walletClient=_walletClient;const{account}=useAccount_useAccount(),{targetNetwork}=scaffold_stark_useTargetNetwork_useTargetNetwork(),{selectedToken}=(0,SelectedGasTokenContext.F)();void 0===walletClient&&account&&(walletClient=account);const provider=new starknet_dist.bd({nodeUrl:targetNetwork.rpcUrls.public.http[0]}),selectedAddr=null==selectedToken||null===(_selectedToken_address=selectedToken.address)||void 0===_selectedToken_address?void 0:_selectedToken_address.toLowerCase(),STRK_ADDRESS=universalStrkAddress.toLowerCase(),{data:paymasterTokens}=(0,dist.F$)(),isSelectedStrk=selectedAddr===STRK_ADDRESS||"STRK"===(null==selectedToken||null===(_selectedToken_symbol=selectedToken.symbol)||void 0===_selectedToken_symbol||null===(_selectedToken_symbol_toUpperCase=_selectedToken_symbol.toUpperCase)||void 0===_selectedToken_symbol_toUpperCase?void 0:_selectedToken_symbol_toUpperCase.call(_selectedToken_symbol)),isSupportedPaymasterToken=!!selectedAddr&&!!(null==paymasterTokens?void 0:paymasterTokens.some(t=>{var _this;return(null===(_this=(null==t?void 0:t.token_address)||"")||void 0===_this?void 0:_this.toLowerCase())===selectedAddr})),shouldUsePaymaster=!isSelectedStrk&&isSupportedPaymasterToken,{sendAsync:sendPaymasterTransaction}=(0,dist.oK)({calls:[],options:{feeMode:shouldUsePaymaster?{mode:"default",gasToken:selectedToken.address}:{mode:"sponsored"}}});return async tx=>{if(!walletClient)return scaffold_stark.Ew.error("Cannot access account"),void usePaymasterTransactor_console.error("⚡️ ~ file: usePaymasterTransactor.tsx ~ error");let transactionHash,notificationId=null;try{const networkId=await walletClient.getChainId(),transactionType=shouldUsePaymaster?"gasless":"regular",gasTokenSymbol=shouldUsePaymaster?null==selectedToken?void 0:selectedToken.symbol:"STRK";if(notificationId=scaffold_stark.Ew.loading((0,jsx_runtime.jsx)(usePaymasterTransactor_TxnNotification,{message:`Awaiting ${transactionType} transaction confirmation (gas: ${gasTokenSymbol})`})),"function"==typeof tx){const result=await tx();if("string"==typeof result)transactionHash=result;else if("transaction_hash"in result)transactionHash=result.transaction_hash;else{const calls=Array.isArray(result)?result:[result];shouldUsePaymaster&&(null==selectedToken?void 0:selectedToken.address)?(usePaymasterTransactor_console.log(`Using paymaster with ${selectedToken.symbol} for gas payment`),transactionHash=(await sendPaymasterTransaction(calls)).transaction_hash):(usePaymasterTransactor_console.log("Using regular transaction with STRK for gas payment"),transactionHash=(await walletClient.execute(calls,{version:starknet_dist.AA.TRANSACTION_VERSION.V2})).transaction_hash)}}else{if(null==tx)throw new Error("Incorrect transaction passed to transactor");{const calls=Array.isArray(tx)?tx:[tx];shouldUsePaymaster&&(null==selectedToken?void 0:selectedToken.address)?(usePaymasterTransactor_console.log(`Using paymaster with ${selectedToken.symbol} for gas payment`),transactionHash=(await sendPaymasterTransaction(calls)).transaction_hash):(usePaymasterTransactor_console.log("Using regular transaction with STRK for gas payment"),transactionHash=(await walletClient.execute(calls,{version:starknet_dist.AA.TRANSACTION_VERSION.V2})).transaction_hash)}}scaffold_stark.Ew.remove(notificationId);const blockExplorerTxURL=networkId?(0,scaffold_stark.NP)(targetNetwork.network,transactionHash):"";notificationId=scaffold_stark.Ew.loading((0,jsx_runtime.jsx)(usePaymasterTransactor_TxnNotification,{message:`Waiting for ${transactionType} transaction to complete...`,blockExplorerLink:blockExplorerTxURL}));try{await provider.waitForTransaction(transactionHash),usePaymasterTransactor_console.log("Transaction confirmed:",transactionHash)}catch(waitError){usePaymasterTransactor_console.warn("Error waiting for transaction:",waitError)}scaffold_stark.Ew.remove(notificationId);const successMessage=shouldUsePaymaster?`Gasless transaction completed! (Paid with ${gasTokenSymbol})`:"Transaction completed successfully!";scaffold_stark.Ew.success((0,jsx_runtime.jsx)(usePaymasterTransactor_TxnNotification,{message:successMessage,blockExplorerLink:blockExplorerTxURL}),{icon:shouldUsePaymaster?"⚡":"🎉"}),window.dispatchEvent(new Event("txCompleted"))}catch(error){notificationId&&scaffold_stark.Ew.remove(notificationId);const match=/Contract (.*?)"}/.exec(error.message),message=match?match[1]:error.message;throw usePaymasterTransactor_console.error("⚡️ ~ file: usePaymasterTransactor.tsx ~ error",message),scaffold_stark.Ew.error(message),error}return transactionHash}})(_walletClient),selectedAddr=null==selectedToken||null===(_selectedToken_address=selectedToken.address)||void 0===_selectedToken_address?void 0:_selectedToken_address.toLowerCase(),strkAddr=universalStrkAddress.toLowerCase(),isSelectedStrk=selectedAddr===strkAddr||"STRK"===(null==selectedToken||null===(_selectedToken_symbol=selectedToken.symbol)||void 0===_selectedToken_symbol||null===(_selectedToken_symbol_toUpperCase=_selectedToken_symbol.toUpperCase)||void 0===_selectedToken_symbol_toUpperCase?void 0:_selectedToken_symbol_toUpperCase.call(_selectedToken_symbol)),isSupportedPaymasterToken=!!selectedAddr&&!!(null==paymasterTokens?void 0:paymasterTokens.some(t=>{var _this;return(null===(_this=(null==t?void 0:t.token_address)||"")||void 0===_this?void 0:_this.toLowerCase())===selectedAddr})),shouldUsePaymaster=!isSelectedStrk&&isSupportedPaymasterToken,transactor=shouldUsePaymaster?paymasterTransactor:regularTransactor;return async tx=>(useSmartTransactor_console.log("SmartTransactor executing with tx:",tx),useSmartTransactor_console.log("Using transactor type:",shouldUsePaymaster?"paymaster":"regular"),await transactor(tx))};__webpack_require__("./node_modules/@starknet-react/chains/dist/index.js");const scaffold_stark_common_replacer=(_key,value)=>"bigint"==typeof value?value.toString():value;const useScaffoldReadContract_useScaffoldReadContract=({contractName,functionName,args,...readConfig})=>{const{data:deployedContract}=scaffold_stark_useDeployedContractInfo_useDeployedContractInfo(contractName),blockNumber=store_useGlobalState(state=>state.snBlockNumber),{watch:watchConfig,query:queryOptions,...restConfig}=readConfig,serializedArgs=args?JSON.parse(JSON.stringify(args,scaffold_stark_common_replacer)):[],blockIdentifier=watchConfig&&void 0!==blockNumber?Number(blockNumber):"pending";return(0,dist.Qo)({functionName,address:null==deployedContract?void 0:deployedContract.address,abi:null==deployedContract?void 0:deployedContract.abi,watch:!1,args:serializedArgs,enabled:args&&(!Array.isArray(args)||!args.some(arg=>void 0===arg)),blockIdentifier,...restConfig,query:{keepPreviousData:!0,...queryOptions||{}}})};var useScaffoldMultiWriteContract_console=__webpack_require__("./node_modules/console-browserify/index.js");var Buffer=__webpack_require__("./node_modules/buffer/index.js").Buffer,protocols_console=__webpack_require__("./node_modules/console-browserify/index.js");const SCALE=10n**18n,feltToString=felt=>{const hex=felt.toString(16).replace(/^0+/,"");return Buffer.from(hex,"hex").toString("ascii")},toAnnualRates=(interestPerSecond,total_nominal_debt,last_rate_accumulator,reserve,scale)=>{if(0n===scale)return{borrowAPR:0,supplyAPY:0};const borrowAPR=(interestPerSecond=>31536e3*Number(interestPerSecond)/Number(SCALE))(interestPerSecond),totalBorrowed=Number(total_nominal_debt*last_rate_accumulator/SCALE),reserveScale=Number(reserve*SCALE/scale),supplyAPY=(interestPerSecond=>(1+Number(interestPerSecond)/Number(SCALE))**31536e3-1)(interestPerSecond)*totalBorrowed/(reserveScale+totalBorrowed);return{borrowAPR,supplyAPY}},formatRate=(rate,dropLeadingZero=!0)=>`${utils_formatPercentage(100*rate,rate<.01?3:2,dropLeadingZero)}%`,formatTokenAmount=(amount,decimals)=>{try{const bigIntAmount=BigInt(amount),divisor=BigInt(10)**BigInt(decimals),whole=bigIntAmount/divisor,fractionStr=(bigIntAmount%divisor).toString().padStart(Number(decimals),"0"),parts=`${whole}.${fractionStr}`.split(".");if(1===parts.length)return`${parts[0]}.000`;const decimalPart=parts[1].slice(0,3).padEnd(3,"0");return`${parts[0]}.${decimalPart}`}catch(error){return protocols_console.error("Error formatting token amount:",error),"0.000"}};var useLendingAction_console=__webpack_require__("./node_modules/console-browserify/index.js");const useLendingAction=(network,action,tokenAddress,protocolName,decimals,vesuContext,maxAmount,walletBalanceParam)=>{const{address:starkAddress,account:starkAccount}=useAccount_useAccount(),sendTxn=useSmartTransactor(),{balance:starkWalletBalanceHook=0n}=useTokenBalance(tokenAddress,"stark"),{data:starkRouterGateway}=scaffold_stark_useDeployedContractInfo_useDeployedContractInfo("RouterGateway"),starkWalletBalance=null!=walletBalanceParam?walletBalanceParam:starkWalletBalanceHook,{address:evmAddress}=(0,useAccount.F)(),{balance:evmWalletBalanceHook=0n}=useTokenBalance(tokenAddress,"evm"),{writeContractAsync}=function useScaffoldWriteContract(configOrName,writeContractParams){const finalConfig="string"==typeof configOrName?{contractName:configOrName,writeContractParams,chainId:void 0}:configOrName,{contractName,chainId,writeContractParams:finalWriteContractParams}=finalConfig;(0,react.useEffect)(()=>{"string"==typeof configOrName&&useScaffoldWriteContract_console.warn("Using `useScaffoldWriteContract` with a string parameter is deprecated. Please use the object parameter version instead.")},[configOrName]);const{chain:accountChain}=(0,useAccount.F)(),writeTx=useTransactor(),[isMining,setIsMining]=(0,react.useState)(!1),wagmiContractWrite=(0,useWriteContract.x)(finalWriteContractParams),selectedNetwork=useSelectedNetwork_useSelectedNetwork(chainId),{data:deployedContractData}=useDeployedContractInfo_useDeployedContractInfo({contractName,chainId:selectedNetwork.id});return{...wagmiContractWrite,isMining,writeContractAsync:async(variables,options)=>{if(deployedContractData)if(null==accountChain?void 0:accountChain.id)if((null==accountChain?void 0:accountChain.id)===selectedNetwork.id)try{setIsMining(!0);const{blockConfirmations,onBlockConfirmation,...mutateOptions}=options||{},makeWriteWithParams=()=>wagmiContractWrite.writeContractAsync({abi:deployedContractData.abi,address:deployedContractData.address,...variables},mutateOptions);return await writeTx(makeWriteWithParams,{blockConfirmations,onBlockConfirmation})}catch(e){throw e}finally{setIsMining(!1)}else scaffold_eth.Ew.error(`Wallet is connected to the wrong network. Please switch to ${selectedNetwork.name}`);else scaffold_eth.Ew.error("Please connect your wallet");else scaffold_eth.Ew.error("Target Contract is not deployed, did you forget to run `yarn deploy`?")},writeContract:(variables,options)=>{deployedContractData?(null==accountChain?void 0:accountChain.id)?(null==accountChain?void 0:accountChain.id)===selectedNetwork.id?wagmiContractWrite.writeContract({abi:deployedContractData.abi,address:deployedContractData.address,...variables},options):scaffold_eth.Ew.error(`Wallet is connected to the wrong network. Please switch to ${selectedNetwork.name}`):scaffold_eth.Ew.error("Please connect your wallet"):scaffold_eth.Ew.error("Target Contract is not deployed, did you forget to run `yarn deploy`?")}}}({contractName:"RouterGateway"}),{data:evmRouterGateway}=useDeployedContractInfo_useDeployedContractInfo({contractName:"RouterGateway"}),evmWalletBalance=null!=walletBalanceParam?walletBalanceParam:evmWalletBalanceHook,buildStarkCalls=async(amount,isMax=!1)=>{if(!(starkAddress&&starkAccount&&decimals&&starkRouterGateway))return null;try{let parsedAmount=(0,parseUnits.X)(amount,decimals);if(isMax)if("Repay"===action){const bumped=101n*(null!=maxAmount?maxAmount:parsedAmount)/100n;parsedAmount=bumped>starkWalletBalance?starkWalletBalance:bumped}else if("Withdraw"===action){parsedAmount=101n*(null!=maxAmount?maxAmount:parsedAmount)/100n}const basic={token:tokenAddress,amount:starknet_dist.iN.bnToUint256(parsedAmount),user:starkAddress};let lendingInstruction,context=new starknet_dist.ci(starknet_dist.RV.None);switch(vesuContext&&(context=new starknet_dist.ci(starknet_dist.RV.Some,[vesuContext.poolId,vesuContext.counterpartToken])),action){case"Deposit":lendingInstruction=new starknet_dist.bv({Deposit:{basic,context},Borrow:void 0,Repay:void 0,Withdraw:void 0});break;case"Withdraw":lendingInstruction=new starknet_dist.bv({Deposit:void 0,Borrow:void 0,Repay:void 0,Withdraw:{basic,withdraw_all:isMax,context}});break;case"Borrow":lendingInstruction=new starknet_dist.bv({Deposit:void 0,Borrow:{basic,context},Repay:void 0,Withdraw:void 0});break;case"Repay":lendingInstruction=new starknet_dist.bv({Deposit:void 0,Borrow:void 0,Repay:{basic,repay_all:isMax,context},Withdraw:void 0})}const baseInstruction={protocol_name:protocolName.toLowerCase(),instructions:[lendingInstruction]},fullInstruction=starknet_dist.fP.compile({instructions:[baseInstruction]}),authInstruction=starknet_dist.fP.compile({instructions:[baseInstruction],rawSelectors:!1}),contract=new starknet_dist.NZ(starkRouterGateway.abi,starkRouterGateway.address,starkAccount),protocolInstructions=await contract.call("get_authorizations_for_instructions",authInstruction),authorizations=[];if(Array.isArray(protocolInstructions))for(const inst of protocolInstructions){const addr=starknet_dist.bu.toHexString(inst[0]),entry=feltToString(inst[1]);authorizations.push({contractAddress:addr,entrypoint:entry,calldata:inst[2].map(f=>starknet_dist.bu.toHexString(f))})}return authorizations.push({contractAddress:starkRouterGateway.address,entrypoint:"process_protocol_instructions",calldata:fullInstruction}),authorizations}catch(e){return useLendingAction_console.error(e),null}},fnMap={Borrow:"borrow",Deposit:"supply",Repay:"repay",Withdraw:"withdraw"},buildEvmTx=(amount,isMax=!1)=>{if(!decimals||!evmAddress||!evmRouterGateway)return;let parsed=(0,parseUnits.X)(amount||"0",decimals);if(isMax)if("Repay"===action){const bumped=void 0!==maxAmount?101n*maxAmount/100n:101n*parsed/100n;parsed=bumped>evmWalletBalance?evmWalletBalance:bumped}else"Withdraw"===action&&void 0!==maxAmount&&(parsed=101n*maxAmount/100n);return{address:evmRouterGateway.address,abi:evmRouterGateway.abi,functionName:fnMap[action],args:[protocolName.toLowerCase(),tokenAddress,evmAddress,parsed]}};return"stark"===network?{execute:async(amount,isMax=!1)=>{if(starkAccount)try{const calls=await buildStarkCalls(amount,isMax);if(!calls)return;await sendTxn(calls),scaffold_stark.Ew.success("Instruction sent")}catch(e){useLendingAction_console.error(e),scaffold_stark.Ew.error("Failed to send instruction")}},buildTx:void 0,buildCalls:buildStarkCalls}:{execute:async(amount,isMax=!1)=>{const tx=buildEvmTx(amount,isMax);tx&&await writeContractAsync(tx)},buildTx:buildEvmTx}},DepositModalStark=({isOpen,onClose,token,protocolName,vesuContext,position})=>{const{balance,decimals}=useTokenBalance(token.address,"stark"),{execute,buildCalls}=useLendingAction("stark","Deposit",token.address,protocolName,decimals,vesuContext);return null==token.decimals&&(token.decimals=decimals),(0,jsx_runtime.jsx)(TokenActionModal,{isOpen,onClose,action:"Deposit",token,protocolName,apyLabel:"Supply APY",apy:token.currentRate,metricLabel:"Total supplied",before:0,balance,network:"stark",buildCalls,position,onConfirm:execute})};DepositModalStark.__docgenInfo={description:"",methods:[],displayName:"DepositModalStark",props:{isOpen:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},token:{required:!0,tsType:{name:"TokenInfo"},description:""},protocolName:{required:!0,tsType:{name:"string"},description:""},vesuContext:{required:!1,tsType:{name:"VesuContext"},description:""},position:{required:!1,tsType:{name:"PositionManager"},description:""}}};const useNetworkAwareReadContract=({networkType,contractName,functionName,args,...readConfig})=>{const evmResult=useScaffoldReadContract({contractName,functionName,args,...readConfig,query:{...readConfig.query,enabled:"evm"===networkType}}),starkResult=useScaffoldReadContract_useScaffoldReadContract({contractName,functionName,args,...readConfig,enabled:"starknet"===networkType});return"evm"===networkType?evmResult:starkResult},RatePill=({current,optimal,color,logo,alt,sameProtocol=!1})=>(0,jsx_runtime.jsxs)("div",{className:"flex rounded-lg overflow-hidden shadow text-sm text-white",children:[(0,jsx_runtime.jsx)("span",{className:`px-3 py-1 ${color}`,children:current}),(0,jsx_runtime.jsxs)("span",{className:`px-3 py-1 flex items-center gap-1 ${sameProtocol?color:"bg-gradient-to-r from-fuchsia-500 to-purple-600 animate-pulse"}`,children:[optimal,(0,jsx_runtime.jsx)(next_image.A,{src:logo,alt,width:16,height:16,className:"rounded-md"})]})]}),InterestPillRow=({supplyRate,borrowRate,address,networkType,protocol,className="",labels="between"})=>{const{data:optimalSupplyRateData}=useNetworkAwareReadContract({contractName:"OptimalInterestRateFinder",functionName:"findOptimalSupplyRate",args:[address],networkType,refetchInterval:1e4}),{data:optimalBorrowRateData}=useNetworkAwareReadContract({contractName:"OptimalInterestRateFinder",functionName:"findOptimalBorrowRate",args:[address],networkType,refetchInterval:1e4});let optimalSupplyProtocol="",optimalSupplyRate=0;if(optimalSupplyRateData){let proto,rate;var _optimalSupplyRateData_,_optimalSupplyRateData_1,_optimalSupplyRateData_2,_optimalSupplyRateData_3;if("starknet"===networkType)proto=feltToString(BigInt((null==optimalSupplyRateData||null===(_optimalSupplyRateData_=optimalSupplyRateData[0])||void 0===_optimalSupplyRateData_?void 0:_optimalSupplyRateData_.toString())||"0")),rate=Number((null==optimalSupplyRateData||null===(_optimalSupplyRateData_1=optimalSupplyRateData[1])||void 0===_optimalSupplyRateData_1?void 0:_optimalSupplyRateData_1.toString())||"0");else proto=(null==optimalSupplyRateData||null===(_optimalSupplyRateData_2=optimalSupplyRateData[0])||void 0===_optimalSupplyRateData_2?void 0:_optimalSupplyRateData_2.toString())||"",rate=Number((null==optimalSupplyRateData||null===(_optimalSupplyRateData_3=optimalSupplyRateData[1])||void 0===_optimalSupplyRateData_3?void 0:_optimalSupplyRateData_3.toString())||"0");optimalSupplyProtocol=proto;optimalSupplyRate=rate/("starknet"===networkType?1e16:1e8)/100}let optimalBorrowProtocol="",optimalBorrowRate=0;if(optimalBorrowRateData){let proto,rate;var _optimalBorrowRateData_,_optimalBorrowRateData_1,_optimalBorrowRateData_2,_optimalBorrowRateData_3;if("starknet"===networkType)proto=feltToString(BigInt((null==optimalBorrowRateData||null===(_optimalBorrowRateData_=optimalBorrowRateData[0])||void 0===_optimalBorrowRateData_?void 0:_optimalBorrowRateData_.toString())||"0")),rate=Number((null==optimalBorrowRateData||null===(_optimalBorrowRateData_1=optimalBorrowRateData[1])||void 0===_optimalBorrowRateData_1?void 0:_optimalBorrowRateData_1.toString())||"0");else proto=(null==optimalBorrowRateData||null===(_optimalBorrowRateData_2=optimalBorrowRateData[0])||void 0===_optimalBorrowRateData_2?void 0:_optimalBorrowRateData_2.toString())||"",rate=Number((null==optimalBorrowRateData||null===(_optimalBorrowRateData_3=optimalBorrowRateData[1])||void 0===_optimalBorrowRateData_3?void 0:_optimalBorrowRateData_3.toString())||"0");optimalBorrowProtocol=proto;optimalBorrowRate=rate/("starknet"===networkType?1e16:1e8)/100}const hasOptimalSupply=optimalSupplyRate>0,hasOptimalBorrow=optimalBorrowRate>0,supplyOptimalDisplay=hasOptimalSupply?formatRate(optimalSupplyRate):supplyRate,borrowOptimalDisplay=hasOptimalBorrow?formatRate(optimalBorrowRate):borrowRate,sameSupplyProtocol=!hasOptimalSupply||optimalSupplyProtocol.toLowerCase()===protocol.toLowerCase(),sameBorrowProtocol=!hasOptimalBorrow||optimalBorrowProtocol.toLowerCase()===protocol.toLowerCase(),supplyLogo=externalContracts_tokenNameToLogo(hasOptimalSupply?optimalSupplyProtocol:protocol),borrowLogo=externalContracts_tokenNameToLogo(hasOptimalBorrow?optimalBorrowProtocol:protocol),supplyAlt=hasOptimalSupply?optimalSupplyProtocol:protocol,borrowAlt=hasOptimalBorrow?optimalBorrowProtocol:protocol;return"center"===labels?(0,jsx_runtime.jsxs)("div",{className:`flex justify-between gap-4 ${className}`,children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center space-y-1 flex-1",children:[(0,jsx_runtime.jsx)("span",{className:"text-sm text-base-content/70",children:"Supply rate"}),(0,jsx_runtime.jsx)(RatePill,{current:supplyRate,optimal:supplyOptimalDisplay,color:"bg-lime-500",logo:supplyLogo,alt:supplyAlt,sameProtocol:sameSupplyProtocol})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center space-y-1 flex-1",children:[(0,jsx_runtime.jsx)("span",{className:"text-sm text-base-content/70",children:"Borrow rate"}),(0,jsx_runtime.jsx)(RatePill,{current:borrowRate,optimal:borrowOptimalDisplay,color:"bg-orange-500",logo:borrowLogo,alt:borrowAlt,sameProtocol:sameBorrowProtocol})]})]}):(0,jsx_runtime.jsxs)("div",{className:`space-y-1 ${className}`,children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between text-sm text-base-content/70",children:[(0,jsx_runtime.jsx)("span",{children:"Supply rate"}),(0,jsx_runtime.jsx)("span",{children:"Borrow rate"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,jsx_runtime.jsx)(RatePill,{current:supplyRate,optimal:supplyOptimalDisplay,color:"bg-lime-500",logo:supplyLogo,alt:supplyAlt,sameProtocol:sameSupplyProtocol}),(0,jsx_runtime.jsx)(RatePill,{current:borrowRate,optimal:borrowOptimalDisplay,color:"bg-orange-500",logo:borrowLogo,alt:borrowAlt,sameProtocol:sameBorrowProtocol})]})]})};RatePill.__docgenInfo={description:"",methods:[],displayName:"RatePill",props:{current:{required:!0,tsType:{name:"string"},description:""},optimal:{required:!0,tsType:{name:"string"},description:""},color:{required:!0,tsType:{name:"string"},description:""},logo:{required:!0,tsType:{name:"string"},description:""},alt:{required:!0,tsType:{name:"string"},description:""},sameProtocol:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}},InterestPillRow.__docgenInfo={description:"",methods:[],displayName:"InterestPillRow",props:{supplyRate:{required:!0,tsType:{name:"string"},description:""},borrowRate:{required:!0,tsType:{name:"string"},description:""},address:{required:!0,tsType:{name:"string"},description:""},networkType:{required:!0,tsType:{name:"union",raw:'"evm" | "starknet"',elements:[{name:"literal",value:'"evm"'},{name:"literal",value:'"starknet"'}]},description:""},protocol:{required:!0,tsType:{name:"string"},description:""},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'""',computed:!1}},labels:{required:!1,tsType:{name:"union",raw:'"between" | "center"',elements:[{name:"literal",value:'"between"'},{name:"literal",value:'"center"'}]},description:"",defaultValue:{value:'"between"',computed:!1}}}};const MarketCard=({icon,name,supplyRate,borrowRate,price,utilization,address,networkType,protocol,allowDeposit=!1})=>{const[isDepositModalOpen,setIsDepositModalOpen]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"card bg-base-100 shadow-md hover:shadow-lg transition-shadow relative overflow-hidden",children:(0,jsx_runtime.jsxs)("div",{className:"card-body p-4 space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3",children:[(0,jsx_runtime.jsx)(next_image.A,{src:icon,alt:name,width:32,height:32,className:"rounded-full"}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold",children:name}),(0,jsx_runtime.jsxs)("span",{className:"text-sm text-base-content/70",children:["$",price]})]}),allowDeposit&&"starknet"===networkType&&(0,jsx_runtime.jsx)("button",{className:"btn btn-sm btn-primary ml-auto",onClick:()=>setIsDepositModalOpen(!0),children:"Deposit"})]}),(0,jsx_runtime.jsx)(next_image.A,{src:icon,alt:name,width:120,height:120,className:"absolute -right-8 -bottom-8 opacity-10"}),(0,jsx_runtime.jsx)(InterestPillRow,{supplyRate,borrowRate,address,networkType,protocol,labels:"between"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between text-sm text-base-content/70",children:[(0,jsx_runtime.jsx)("span",{children:"Utilization"}),(0,jsx_runtime.jsxs)("span",{children:[utilization,"%"]})]}),(0,jsx_runtime.jsx)("progress",{className:"progress w-full progress-info",value:parseFloat(utilization),max:100})]})]})}),allowDeposit&&"starknet"===networkType&&(0,jsx_runtime.jsx)(DepositModalStark,{isOpen:isDepositModalOpen,onClose:()=>setIsDepositModalOpen(!1),token:{name,icon,address,currentRate:parseFloat(supplyRate.replace("%",""))},protocolName:protocol})]})};MarketCard.__docgenInfo={description:"",methods:[],displayName:"MarketCard",props:{icon:{required:!0,tsType:{name:"string"},description:""},name:{required:!0,tsType:{name:"string"},description:""},supplyRate:{required:!0,tsType:{name:"string"},description:""},borrowRate:{required:!0,tsType:{name:"string"},description:""},price:{required:!0,tsType:{name:"string"},description:""},utilization:{required:!0,tsType:{name:"string"},description:""},address:{required:!0,tsType:{name:"string"},description:""},networkType:{required:!0,tsType:{name:"union",raw:'"evm" | "starknet"',elements:[{name:"literal",value:'"evm"'},{name:"literal",value:'"starknet"'}]},description:""},protocol:{required:!0,tsType:{name:"string"},description:""},allowDeposit:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const MarketRow=({icon,name,supplyRate,borrowRate,price,utilization,address,networkType,protocol,allowDeposit=!1})=>{const[isDepositModalOpen,setIsDepositModalOpen]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"p-4 bg-base-100 hover:bg-base-200 rounded-lg transition-colors",children:[(0,jsx_runtime.jsxs)("div",{className:"hidden lg:flex items-center justify-between",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3 w-1/5",children:[(0,jsx_runtime.jsx)(next_image.A,{src:icon,alt:name,width:24,height:24,className:"rounded-full"}),(0,jsx_runtime.jsx)("span",{className:"font-medium",children:name})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center flex-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center w-1/5",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm text-base-content/70",children:"Price"}),(0,jsx_runtime.jsxs)("div",{className:"font-medium",children:["$",price]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center w-1/5",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm text-base-content/70 mb-1",children:"Utilization"}),(0,jsx_runtime.jsxs)("span",{className:"font-medium",children:[utilization,"%"]})]}),(0,jsx_runtime.jsx)("div",{className:"w-2/5",children:(0,jsx_runtime.jsx)(InterestPillRow,{supplyRate,borrowRate,address,networkType,protocol,labels:"center"})}),allowDeposit&&"starknet"===networkType&&(0,jsx_runtime.jsx)("button",{className:"btn btn-sm btn-primary ml-auto",onClick:()=>setIsDepositModalOpen(!0),children:"Deposit"})]})]}),(0,jsx_runtime.jsxs)("div",{className:"hidden md:block lg:hidden",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(next_image.A,{src:icon,alt:name,width:24,height:24,className:"rounded-full"}),(0,jsx_runtime.jsx)("span",{className:"font-medium",children:name})]}),allowDeposit&&"starknet"===networkType&&(0,jsx_runtime.jsx)("button",{className:"btn btn-sm btn-primary",onClick:()=>setIsDepositModalOpen(!0),children:"Deposit"})]}),(0,jsx_runtime.jsx)(InterestPillRow,{supplyRate,borrowRate,address,networkType,className:"mb-3",protocol,labels:"center"}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,jsx_runtime.jsxs)("div",{className:"bg-base-200/50 p-2 rounded-md flex-1 min-w-[140px]",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm text-base-content/70",children:"Price"}),(0,jsx_runtime.jsxs)("div",{className:"font-medium",children:["$",price]})]}),(0,jsx_runtime.jsxs)("div",{className:"bg-base-200/50 p-2 rounded-md flex-1 min-w-[140px]",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm text-base-content/70 mb-1",children:"Utilization"}),(0,jsx_runtime.jsxs)("span",{className:"font-medium",children:[utilization,"%"]})]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"md:hidden",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(next_image.A,{src:icon,alt:name,width:24,height:24,className:"rounded-full"}),(0,jsx_runtime.jsx)("span",{className:"font-medium",children:name})]}),allowDeposit&&"starknet"===networkType&&(0,jsx_runtime.jsx)("button",{className:"btn btn-xs btn-primary",onClick:()=>setIsDepositModalOpen(!0),children:"Deposit"})]}),(0,jsx_runtime.jsx)(InterestPillRow,{supplyRate,borrowRate,address,networkType,className:"mb-3",protocol,labels:"center"}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"bg-base-200/50 p-2 rounded-md",children:[(0,jsx_runtime.jsx)("div",{className:"text-xs text-base-content/70",children:"Price"}),(0,jsx_runtime.jsxs)("div",{className:"font-medium text-sm",children:["$",price]})]}),(0,jsx_runtime.jsxs)("div",{className:"bg-base-200/50 p-2 rounded-md",children:[(0,jsx_runtime.jsx)("div",{className:"text-xs text-base-content/70 mb-1",children:"Utilization"}),(0,jsx_runtime.jsxs)("span",{className:"font-medium text-sm",children:[utilization,"%"]})]})]})]})]}),allowDeposit&&"starknet"===networkType&&(0,jsx_runtime.jsx)(DepositModalStark,{isOpen:isDepositModalOpen,onClose:()=>setIsDepositModalOpen(!1),token:{name,icon,address,currentRate:parseFloat(supplyRate.replace("%",""))},protocolName:protocol})]})};MarketRow.__docgenInfo={description:"",methods:[],displayName:"MarketRow",props:{icon:{required:!0,tsType:{name:"string"},description:""},name:{required:!0,tsType:{name:"string"},description:""},supplyRate:{required:!0,tsType:{name:"string"},description:""},borrowRate:{required:!0,tsType:{name:"string"},description:""},price:{required:!0,tsType:{name:"string"},description:""},utilization:{required:!0,tsType:{name:"string"},description:""},address:{required:!0,tsType:{name:"string"},description:""},networkType:{required:!0,tsType:{name:"union",raw:'"evm" | "starknet"',elements:[{name:"literal",value:'"evm"'},{name:"literal",value:'"starknet"'}]},description:""},protocol:{required:!0,tsType:{name:"string"},description:""},allowDeposit:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const MarketsSection=({title,markets,viewMode,search,extra})=>{const filteredMarkets=(0,react.useMemo)(()=>{if(!search)return markets;const lower=search.toLowerCase();return markets.filter(m=>m.name.toLowerCase().includes(lower))},[markets,search]),marketItems=(0,react.useMemo)(()=>filteredMarkets.map(m=>"grid"===viewMode?(0,jsx_runtime.jsx)(MarketCard,{...m},m.address):(0,jsx_runtime.jsx)(MarketRow,{...m},m.address)),[filteredMarkets,viewMode]);return 0===filteredMarkets.length?null:(0,jsx_runtime.jsx)("div",{className:"card bg-base-100 shadow-md",children:(0,jsx_runtime.jsxs)("div",{className:"card-body p-4",children:[(0,jsx_runtime.jsx)("h2",{className:"card-title text-lg mb-4",children:title}),extra,(0,jsx_runtime.jsx)("div",{className:"grid"===viewMode?"grid gap-4 sm:grid-cols-2 lg:grid-cols-3":"space-y-2",children:marketItems})]})})};MarketsSection.__docgenInfo={description:"",methods:[],displayName:"MarketsSection",props:{title:{required:!0,tsType:{name:"string"},description:""},markets:{required:!0,tsType:{name:"Array",elements:[{name:"MarketData"}],raw:"MarketData[]"},description:""},viewMode:{required:!0,tsType:{name:"union",raw:'"list" | "grid"',elements:[{name:"literal",value:'"list"'},{name:"literal",value:'"grid"'}]},description:""},search:{required:!0,tsType:{name:"string"},description:""},extra:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};const POOL_IDS_Genesis=2198503327643286920898110335698706244522220458610657370981979460625005526824n,VesuMarkets=({supportedAssets,viewMode,search,allowDeposit=!1})=>{const markets=(0,react.useMemo)(()=>supportedAssets?supportedAssets.map(asset=>{const address=`0x${BigInt(asset.address).toString(16).padStart(64,"0")}`,symbol=feltToString(asset.symbol),{borrowAPR,supplyAPY}=toAnnualRates(asset.fee_rate,asset.total_nominal_debt,asset.last_rate_accumulator,asset.reserve,asset.scale);return{icon:externalContracts_tokenNameToLogo(symbol.toLowerCase()),name:symbol,supplyRate:formatRate(supplyAPY),borrowRate:formatRate(borrowAPR),price:(price=asset.price.value,(Number(price)/1e18).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})),utilization:(utilization=asset.utilization,(Number(utilization)/1e18*100).toFixed(2)),address,networkType:"starknet",protocol:"vesu",allowDeposit};var utilization,price}):[],[supportedAssets,allowDeposit]);return(0,jsx_runtime.jsx)(MarketsSection,{title:"Vesu Markets",markets,viewMode,search})};VesuMarkets.__docgenInfo={description:"",methods:[],displayName:"VesuMarkets",props:{supportedAssets:{required:!1,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{\n  readonly address: bigint;\n  readonly symbol: bigint;\n  readonly decimals: number;\n  readonly rate_accumulator: bigint;\n  readonly utilization: bigint;\n  readonly fee_rate: bigint;\n  readonly price: { value: bigint; is_valid: boolean };\n  readonly total_nominal_debt: bigint;\n  readonly last_rate_accumulator: bigint;\n  readonly reserve: bigint;\n  readonly scale: bigint;\n}",signature:{properties:[{key:"address",value:{name:"unknown",required:!0}},{key:"symbol",value:{name:"unknown",required:!0}},{key:"decimals",value:{name:"number",required:!0}},{key:"rate_accumulator",value:{name:"unknown",required:!0}},{key:"utilization",value:{name:"unknown",required:!0}},{key:"fee_rate",value:{name:"unknown",required:!0}},{key:"price",value:{name:"signature",type:"object",raw:"{ value: bigint; is_valid: boolean }",signature:{properties:[{key:"value",value:{name:"unknown",required:!0}},{key:"is_valid",value:{name:"boolean",required:!0}}]},required:!0}},{key:"total_nominal_debt",value:{name:"unknown",required:!0}},{key:"last_rate_accumulator",value:{name:"unknown",required:!0}},{key:"reserve",value:{name:"unknown",required:!0}},{key:"scale",value:{name:"unknown",required:!0}}]}}],raw:"{\n  readonly address: bigint;\n  readonly symbol: bigint;\n  readonly decimals: number;\n  readonly rate_accumulator: bigint;\n  readonly utilization: bigint;\n  readonly fee_rate: bigint;\n  readonly price: { value: bigint; is_valid: boolean };\n  readonly total_nominal_debt: bigint;\n  readonly last_rate_accumulator: bigint;\n  readonly reserve: bigint;\n  readonly scale: bigint;\n}[]"},description:""},viewMode:{required:!0,tsType:{name:"union",raw:'"list" | "grid"',elements:[{name:"literal",value:'"list"'},{name:"literal",value:'"grid"'}]},description:""},search:{required:!0,tsType:{name:"string"},description:""},allowDeposit:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const BorrowModalStark=({isOpen,onClose,token,protocolName,vesuContext,currentDebt,position})=>{const{balance,decimals}=useTokenBalance(token.address,"stark"),{execute,buildCalls}=useLendingAction("stark","Borrow",token.address,protocolName,decimals,vesuContext);return null==token.decimals&&(token.decimals=decimals),(0,jsx_runtime.jsx)(TokenActionModal,{isOpen,onClose,action:"Borrow",token:{...token,decimals},protocolName,apyLabel:"Borrow APY",apy:token.currentRate,metricLabel:"Total debt",before:currentDebt,balance,network:"stark",buildCalls,position,onConfirm:execute})};function FiAlertTriangle(props){return(0,lib.k5)({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"},child:[]},{tag:"line",attr:{x1:"12",y1:"9",x2:"12",y2:"13"},child:[]},{tag:"line",attr:{x1:"12",y1:"17",x2:"12.01",y2:"17"},child:[]}]})(props)}function fi_FiCheck(props){return(0,lib.k5)({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"20 6 9 17 4 12"},child:[]}]})(props)}function FiLock(props){return(0,lib.k5)({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"},child:[]},{tag:"path",attr:{d:"M7 11V7a5 5 0 0 1 10 0v4"},child:[]}]})(props)}function FiRefreshCw(props){return(0,lib.k5)({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"23 4 23 10 17 10"},child:[]},{tag:"polyline",attr:{points:"1 20 1 14 7 14"},child:[]},{tag:"path",attr:{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"},child:[]}]})(props)}function fi_FiSearch(props){return(0,lib.k5)({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"},child:[]},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"},child:[]}]})(props)}function FiX(props){return(0,lib.k5)({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"},child:[]},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"},child:[]}]})(props)}BorrowModalStark.__docgenInfo={description:"",methods:[],displayName:"BorrowModalStark",props:{isOpen:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},token:{required:!0,tsType:{name:"TokenInfo"},description:""},protocolName:{required:!0,tsType:{name:"string"},description:""},vesuContext:{required:!1,tsType:{name:"VesuContext"},description:""},currentDebt:{required:!0,tsType:{name:"number"},description:""},position:{required:!1,tsType:{name:"PositionManager"},description:""}}};var useReadContracts=__webpack_require__("./node_modules/wagmi/dist/esm/hooks/useReadContracts.js"),CollateralSwitchButton_console=__webpack_require__("./node_modules/console-browserify/index.js");const TokenSwitcherDropdown=({isOpen,onClose,targetCollateral,availableTokens,onSelectToken,anchorRef,isLoading=!1,error=null})=>{const[search,setSearch]=(0,react.useState)(""),[position,setPosition]=(0,react.useState)("bottom");(0,react.useEffect)(()=>{if(!isOpen||!anchorRef.current)return;const buttonRect=anchorRef.current.getBoundingClientRect(),modalElement=anchorRef.current.closest(".modal-box");if(modalElement){const modalRect=modalElement.getBoundingClientRect(),estimatedDropdownHeight=Math.min(350,70*availableTokens.length+100),spaceBelow=modalRect.bottom-buttonRect.bottom;setPosition(spaceBelow<estimatedDropdownHeight?"top":"bottom")}},[isOpen,anchorRef,availableTokens.length]);const filteredTokens=(0,react.useMemo)(()=>{if(!search.trim())return availableTokens;const searchLower=search.toLowerCase();return availableTokens.filter(token=>token.symbol.toLowerCase().includes(searchLower))},[availableTokens,search]);if((0,react.useEffect)(()=>{if(!isOpen)return;const handleClickOutside=event=>{!anchorRef.current||anchorRef.current.contains(event.target)||event.target.closest(".token-switcher-dropdown")||onClose()};return document.addEventListener("mousedown",handleClickOutside),()=>document.removeEventListener("mousedown",handleClickOutside)},[isOpen,onClose,anchorRef]),!isOpen)return null;const dropdownStyles="top"===position?{position:"absolute",bottom:"100%",left:0,marginBottom:"8px"}:{position:"absolute",top:"100%",left:0,marginTop:"8px"};return(0,jsx_runtime.jsxs)("div",{className:"token-switcher-dropdown absolute z-50 bg-base-100 rounded-lg shadow-xl border border-base-300 w-[280px] max-h-[350px] overflow-hidden flex flex-col",style:dropdownStyles,children:[(0,jsx_runtime.jsxs)("div",{className:"p-3 border-b border-base-200",children:[(0,jsx_runtime.jsx)("h3",{className:"font-medium mb-2",children:"Switch Collateral"}),(0,jsx_runtime.jsxs)("div",{className:"relative",children:[(0,jsx_runtime.jsx)("input",{type:"text",placeholder:"Search tokens...",value:search,onChange:e=>setSearch(e.target.value),className:"input input-sm input-bordered w-full pl-8",autoFocus:!0}),(0,jsx_runtime.jsx)(fi_FiSearch,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-base-content/50"})]})]}),(0,jsx_runtime.jsx)("div",{className:"overflow-y-auto flex-1 p-2",children:isLoading?(0,jsx_runtime.jsxs)("div",{className:"py-8 text-center flex flex-col items-center justify-center",children:[(0,jsx_runtime.jsx)("span",{className:"loading loading-spinner loading-md"}),(0,jsx_runtime.jsx)("span",{className:"text-sm text-base-content/60 mt-2",children:"Loading tokens..."})]}):error?(0,jsx_runtime.jsxs)("div",{className:"py-8 text-center text-error flex flex-col items-center justify-center",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm mb-1",children:error}),(0,jsx_runtime.jsxs)("div",{className:"text-xs text-base-content/50",children:["Protocol: ",targetCollateral?targetCollateral.substring(0,8)+"...":"None"]})]}):0===availableTokens.length?(0,jsx_runtime.jsx)("div",{className:"py-8 text-center text-base-content/50",children:"No supported tokens found for this market"}):filteredTokens.length>0?(0,jsx_runtime.jsx)("div",{className:"space-y-1",children:filteredTokens.map(token=>(0,jsx_runtime.jsxs)("button",{className:"w-full py-2 px-3 rounded-md flex items-center gap-2 hover:bg-base-200 transition-colors "+(token.address===targetCollateral?"bg-primary/10 text-primary":""),onClick:()=>{onSelectToken(token.address,token.symbol),onClose()},children:[(0,jsx_runtime.jsx)("div",{className:"w-6 h-6 relative flex-shrink-0",children:(0,jsx_runtime.jsx)(next_image.A,{src:externalContracts_tokenNameToLogo(token.symbol),alt:token.symbol,fill:!0,className:"rounded-full object-contain"})}),(0,jsx_runtime.jsxs)("div",{className:"flex-1 flex justify-between items-center",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"font-medium",children:token.symbol}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-base-content/60",children:token.balance>0?`Balance: ${token.balance.toFixed(2)}`:"No balance"})]}),token.address===targetCollateral&&(0,jsx_runtime.jsx)(fi_FiCheck,{className:"text-primary"})]})]},token.address))}):(0,jsx_runtime.jsxs)("div",{className:"py-8 text-center text-base-content/50",children:['No tokens found matching "',search,'"']})}),(0,jsx_runtime.jsx)("div",{className:"p-2 border-t border-base-200",children:(0,jsx_runtime.jsx)("button",{className:"btn btn-sm btn-block btn-ghost",onClick:onClose,children:"Cancel"})})]})},CollateralSwitchButton=({currentCollateral,protocol,marketToken,onCollateralSwitch})=>{const[switcherOpen,setSwitcherOpen]=(0,react.useState)(!1),[selectedCollateral,setSelectedCollateral]=(0,react.useState)(null),[error,setError]=(0,react.useState)(null),buttonRef=(0,react.createRef)(),{address:userAddress}=(0,useAccount.F)(),isValidMarketToken=(0,react.useMemo)(()=>!!marketToken&&/^0x[a-fA-F0-9]{40}$/.test(marketToken),[marketToken]);(0,react.useEffect)(()=>{setSelectedCollateral(null)},[currentCollateral.token]),(0,react.useEffect)(()=>{setError(null),switcherOpen&&!isValidMarketToken&&setError(`Invalid market token address: ${marketToken||"undefined"}`)},[switcherOpen,isValidMarketToken,marketToken]);const{data:supportedCollaterals,isLoading:isLoadingCollaterals,error:collatError}=useScaffoldReadContract({contractName:"RouterGateway",functionName:"getSupportedCollaterals",args:[protocol.toLowerCase(),marketToken],query:{enabled:switcherOpen&&isValidMarketToken}});(0,react.useEffect)(()=>{switcherOpen&&(CollateralSwitchButton_console.log("[CollateralSwitchButton] Protocol:",protocol),CollateralSwitchButton_console.log("[CollateralSwitchButton] MarketToken:",marketToken),CollateralSwitchButton_console.log("[CollateralSwitchButton] Is valid market token:",isValidMarketToken),CollateralSwitchButton_console.log("[CollateralSwitchButton] Collaterals fetched:",supportedCollaterals),CollateralSwitchButton_console.log("[CollateralSwitchButton] Collateral error:",collatError))},[switcherOpen,supportedCollaterals,collatError,protocol,marketToken,isValidMarketToken]),(0,react.useEffect)(()=>{!isValidMarketToken&&switcherOpen||(!isLoadingCollaterals&&collatError?setError("Error fetching supported collaterals"):isLoadingCollaterals||supportedCollaterals&&0!==supportedCollaterals.length||setError("No supported collaterals found for this market"))},[isLoadingCollaterals,supportedCollaterals,collatError,isValidMarketToken,switcherOpen]);const{data:tokenData,isLoading:isLoadingTokenData,error:tokenError}=(0,useReadContracts.X)({contracts:(supportedCollaterals||[]).flatMap(address=>[{address,abi:ERC20ABI,functionName:"symbol"},{address,abi:ERC20ABI,functionName:"decimals"},{address,abi:ERC20ABI,functionName:"balanceOf",args:[userAddress]}]),query:{enabled:switcherOpen&&!!supportedCollaterals&&supportedCollaterals.length>0&&!!userAddress}});(0,react.useEffect)(()=>{switcherOpen&&supportedCollaterals&&supportedCollaterals.length>0&&(CollateralSwitchButton_console.log("[CollateralSwitchButton] Token data:",tokenData),CollateralSwitchButton_console.log("[CollateralSwitchButton] Token error:",tokenError))},[switcherOpen,tokenData,tokenError,supportedCollaterals]),(0,react.useEffect)(()=>{!isLoadingTokenData&&tokenError&&supportedCollaterals&&supportedCollaterals.length>0&&setError("Error fetching token information")},[isLoadingTokenData,tokenError,supportedCollaterals]);const formattedCollaterals=(0,react.useMemo)(()=>{if(!supportedCollaterals)return[];const result=[];if(!tokenData)return supportedCollaterals.map(address=>({symbol:"Loading...",balance:0,address,decimals:18,rawBalance:0n,supported:!0}));for(let i=0;i<supportedCollaterals.length;i++){const address=supportedCollaterals[i],dataIndex=3*i;if(dataIndex+2<tokenData.length){const symbol=tokenData[dataIndex].result||"Unknown",decimals=tokenData[dataIndex+1].result||18,rawBalance=tokenData[dataIndex+2].result||0n,balance=rawBalance?Number((0,formatUnits.J)(rawBalance,decimals)):0;result.push({symbol,balance,address,decimals,rawBalance,supported:!0})}else result.push({symbol:"Unknown",balance:0,address,decimals:18,rawBalance:0n,supported:!0})}return CollateralSwitchButton_console.log("[CollateralSwitchButton] Formatted collaterals:",result),result},[supportedCollaterals,tokenData]),isLoading=isLoadingCollaterals||isLoadingTokenData;return(0,jsx_runtime.jsxs)("div",{className:"relative",children:[(0,jsx_runtime.jsx)("button",{ref:buttonRef,className:`btn btn-square btn-sm ${selectedCollateral?"p-0 overflow-hidden":"btn-ghost bg-base-200/80 text-base-content/70 hover:bg-primary/20 hover:text-primary"} transition-all opacity-50 cursor-not-allowed`,title:"Collateral switching coming soon",onClick:()=>{},disabled:!0,children:selectedCollateral?(0,jsx_runtime.jsxs)("div",{className:"relative w-full h-full",children:[(0,jsx_runtime.jsx)(next_image.A,{src:externalContracts_tokenNameToLogo(selectedCollateral.symbol),alt:selectedCollateral.symbol,fill:!0,className:"rounded object-contain"}),(0,jsx_runtime.jsx)("div",{className:"absolute top-0 right-0 bg-base-100 rounded-full p-0.5 shadow-sm",children:(0,jsx_runtime.jsx)(FiRefreshCw,{className:"w-2.5 h-2.5 text-primary"})})]}):(0,jsx_runtime.jsx)(FiRefreshCw,{className:"w-4 h-4"})}),switcherOpen&&(0,jsx_runtime.jsx)(TokenSwitcherDropdown,{isOpen:!0,onClose:()=>setSwitcherOpen(!1),targetCollateral:currentCollateral.token,availableTokens:formattedCollaterals.filter(c=>c.address!==currentCollateral.token),onSelectToken:(tokenAddress,symbol)=>{setSelectedCollateral({token:tokenAddress,symbol}),onCollateralSwitch(tokenAddress,symbol)},anchorRef:buttonRef,isLoading,error})]})};CollateralSwitchButton.__docgenInfo={description:"",methods:[],displayName:"CollateralSwitchButton",props:{currentCollateral:{required:!0,tsType:{name:"signature",type:"object",raw:"{\n  token: string;\n  symbol: string;\n}",signature:{properties:[{key:"token",value:{name:"string",required:!0}},{key:"symbol",value:{name:"string",required:!0}}]}},description:""},protocol:{required:!0,tsType:{name:"string"},description:""},marketToken:{required:!0,tsType:{name:"string"},description:""},onCollateralSwitch:{required:!0,tsType:{name:"signature",type:"function",raw:"(tokenAddress: string, symbol: string) => void",signature:{arguments:[{type:{name:"string"},name:"tokenAddress"},{type:{name:"string"},name:"symbol"}],return:{name:"void"}}},description:""}}};var CollateralSelector_console=__webpack_require__("./node_modules/console-browserify/index.js");const CollateralSelector=({collaterals,isLoading,selectedProtocol,marketToken,onCollateralSelectionChange,onMaxClick,hideAmounts=!1,initialSelectedCollaterals})=>{const[selectedCollaterals,setSelectedCollaterals]=(0,react.useState)([]);(0,react.useEffect)(()=>{initialSelectedCollaterals&&initialSelectedCollaterals.length>0&&0===selectedCollaterals.length&&setSelectedCollaterals(initialSelectedCollaterals)},[initialSelectedCollaterals]);const[switcherOpen,setSwitcherOpen]=(0,react.useState)(!1),[activeTokenForSwitch,setActiveTokenForSwitch]=(0,react.useState)(null),switchButtonRefs=new Map,collateralSupportMap=(0,react.useMemo)(()=>collaterals.reduce((acc,collateral)=>(acc[collateral.address]=collateral.supported,acc),{}),[collaterals]);selectedCollaterals.forEach(collateral=>{switchButtonRefs.has(collateral.token)||switchButtonRefs.set(collateral.token,(0,react.createRef)())});const sortedCollaterals=(0,react.useMemo)(()=>[...collaterals].sort((a,b)=>{const aSelectable=a.supported&&a.rawBalance>0n,bSelectable=b.supported&&b.rawBalance>0n;if(aSelectable&&!bSelectable)return-1;if(!aSelectable&&bSelectable)return 1;if(aSelectable&&bSelectable){if(a.balance>b.balance)return-1;if(a.balance<b.balance)return 1}return a.symbol.localeCompare(b.symbol)}),[collaterals]);(0,react.useEffect)(()=>{selectedProtocol&&setSelectedCollaterals(prev=>{const updated=prev.map(c=>{var _collateralSupportMap_c_token;return{...c,supported:null!==(_collateralSupportMap_c_token=collateralSupportMap[c.token])&&void 0!==_collateralSupportMap_c_token&&_collateralSupportMap_c_token}});return updated.some((collateral,index)=>collateral.supported!==prev[index].supported)?updated:prev})},[collateralSupportMap,selectedProtocol]);(0,react.useEffect)(()=>{onCollateralSelectionChange(selectedCollaterals)},[selectedCollaterals,onCollateralSelectionChange]);return(0,jsx_runtime.jsxs)("div",{className:"space-y-3",children:[(0,jsx_runtime.jsx)("div",{className:"space-y-1",children:(0,jsx_runtime.jsx)("label",{className:"text-sm font-medium text-base-content/80",children:"Select Collateral to Move"})}),isLoading?(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-center py-6 bg-base-200/50 rounded-lg",children:[(0,jsx_runtime.jsx)("span",{className:"loading loading-spinner loading-md"}),(0,jsx_runtime.jsx)("span",{className:"ml-2 text-base-content/70",children:"Checking collateral support..."})]}):sortedCollaterals.length>0?(0,jsx_runtime.jsx)("div",{className:"bg-base-200/30 p-4 rounded-lg",children:(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:sortedCollaterals.map(collateral=>{const hasZeroBalance=collateral.rawBalance<=0n,isDisabled=!collateral.supported||hasZeroBalance;return(0,jsx_runtime.jsxs)("button",{onClick:()=>(collateral=>{!collateral.supported||collateral.rawBalance<=0n||setSelectedCollaterals(prev=>prev.findIndex(c=>c.token===collateral.address)>=0?prev.filter(c=>c.token!==collateral.address):[...prev,{token:collateral.address,amount:0n,symbol:collateral.symbol,decimals:collateral.decimals,maxAmount:collateral.rawBalance,supported:collateral.supported}])})(collateral),className:`\n                    btn btn-block h-auto py-2 px-3 normal-case flex items-center gap-2 justify-start\n                    ${address=collateral.address,selectedCollaterals.some(c=>c.token===address)?"btn-primary":"btn-outline bg-base-100"}\n                    ${isDisabled?"opacity-50 cursor-not-allowed tooltip":""}\n                  `,disabled:isDisabled,"data-tip":isDisabled?hasZeroBalance?"Zero balance":collateral.supported?"":`Not supported in ${selectedProtocol}`:void 0,children:[(0,jsx_runtime.jsx)("div",{className:"w-6 h-6 relative flex-shrink-0",children:(0,jsx_runtime.jsx)(next_image.A,{src:externalContracts_tokenNameToLogo(collateral.symbol),alt:collateral.symbol,fill:!0,className:"rounded-full object-contain"})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-start overflow-hidden",children:[(0,jsx_runtime.jsx)("span",{className:"truncate font-medium w-full",children:collateral.symbol}),(0,jsx_runtime.jsx)("span",{className:"text-xs opacity-70 tabular-nums",children:(balance=collateral.balance,balance>0&&balance<.01?"<0.01":balance.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))})]}),!collateral.supported&&(0,jsx_runtime.jsx)("span",{className:"text-xs px-1 bg-base-300 rounded-full ml-auto",children:"!"}),hasZeroBalance&&(0,jsx_runtime.jsx)("span",{className:"text-xs px-1 bg-base-300 rounded-full ml-auto",children:"0"})]},collateral.address);var balance,address})})}):(0,jsx_runtime.jsx)("div",{className:"text-base-content/70 text-center p-6 bg-base-200/50 rounded-lg",children:"No collateral available to move"}),!hideAmounts&&selectedCollaterals.length>0&&(0,jsx_runtime.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,jsx_runtime.jsx)("label",{className:"block text-lg font-semibold text-center",children:"Collateral"}),(0,jsx_runtime.jsx)("div",{className:"bg-base-200/40 p-4 rounded-lg space-y-3",children:selectedCollaterals.map(collateral=>{const displayAmount=collateral.inputValue?collateral.inputValue:0n===collateral.amount?"":(0,formatUnits.J)(collateral.amount,collateral.decimals),maxAmount=(value=>{const num="string"==typeof value?parseFloat(value):value;return isNaN(num)?"0.00":num>0&&num<.01?"<0.01":new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(num)})((0,formatUnits.J)(collateral.maxAmount,collateral.decimals)),isSupported=collateral.supported;return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3 py-2.5 px-3 rounded-md bg-base-100 border border-base-300/50 shadow-sm "+(isSupported?"":"opacity-60"),children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 w-[160px] flex-shrink-0",children:[(0,jsx_runtime.jsx)("div",{className:"w-7 h-7 relative flex-shrink-0",children:(0,jsx_runtime.jsx)(next_image.A,{src:externalContracts_tokenNameToLogo(collateral.symbol),alt:collateral.symbol,fill:!0,className:"rounded-full object-contain "+(isSupported?"":"grayscale")})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col overflow-hidden",children:[(0,jsx_runtime.jsx)("span",{className:"font-medium truncate",children:collateral.symbol}),(0,jsx_runtime.jsxs)("span",{className:"text-xs text-base-content/60",children:["Available: ",maxAmount]}),!isSupported&&(0,jsx_runtime.jsxs)("span",{className:"text-xs text-error/80",children:["Not supported in ",selectedProtocol]})]})]}),(0,jsx_runtime.jsx)("div",{className:"flex-shrink-0 relative",children:(0,jsx_runtime.jsx)(CollateralSwitchButton,{currentCollateral:{token:collateral.token,symbol:collateral.symbol},protocol:selectedProtocol||"",marketToken,onCollateralSwitch:(newToken,newSymbol)=>{CollateralSelector_console.log(`Switch from ${collateral.symbol} to ${newSymbol}`)}})}),(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center bg-base-200/60 rounded-lg border border-base-300 focus-within:border-primary focus-within:ring-1 focus-within:ring-primary/30 transition-all "+(isSupported?"":"opacity-50"),children:[(0,jsx_runtime.jsx)("input",{type:"text",value:displayAmount,onChange:e=>{return token=collateral.token,amountStr=e.target.value,decimals=collateral.decimals,void setSelectedCollaterals(prev=>prev.map(c=>{if(c.token===token)try{if(""!==amountStr&&"0"!==amountStr&&"."!==amountStr&&"0."!==amountStr&&!/^\d*\.?\d*$/.test(amountStr))return c;if("."===amountStr||"0."===amountStr||/^\d+\.$/.test(amountStr))return{...c,amount:0n,inputValue:amountStr};try{let amount=(0,parseUnits.X)(amountStr,decimals);if(amount>c.maxAmount){amount=c.maxAmount;const maxAmountStr=(0,formatUnits.J)(c.maxAmount,decimals);return{...c,amount,inputValue:maxAmountStr}}return{...c,amount,inputValue:void 0}}catch(e){return{...c,amount:0n,inputValue:amountStr}}}catch(e){return c}return c}));var token,amountStr,decimals},className:"flex-1 bg-transparent border-none focus:outline-none px-3 py-2 h-10 text-base-content",placeholder:"0.00",disabled:!isSupported}),(0,jsx_runtime.jsx)("button",{className:"mr-2 px-2 py-0.5 text-xs font-medium bg-base-300 hover:bg-primary hover:text-white text-base-content/70 rounded transition-colors duration-200 "+(isSupported?"":"opacity-50 cursor-not-allowed"),onClick:e=>{(token=>{const selected=selectedCollaterals.find(c=>c.token===token);if(selected){const maxAmount=selected.maxAmount,formattedMaxAmount=(0,formatUnits.J)(maxAmount,selected.decimals),updated=selectedCollaterals.map(c=>c.token===token?{...c,amount:maxAmount,inputValue:formattedMaxAmount}:c);setSelectedCollaterals(updated),onCollateralSelectionChange(updated),onMaxClick&&onMaxClick(token,maxAmount,formattedMaxAmount)}})(collateral.token)},disabled:!isSupported,children:"MAX"})]})}),(0,jsx_runtime.jsx)("div",{className:"flex-shrink-0",children:(0,jsx_runtime.jsx)("button",{className:"btn btn-ghost btn-sm text-base-content/70 p-1 h-8 w-8 flex items-center justify-center hover:bg-error/10 hover:text-error",onClick:()=>{return token=collateral.token,void setSelectedCollaterals(prev=>prev.filter(c=>c.token!==token));var token},title:"Remove collateral",children:(0,jsx_runtime.jsx)(FiX,{className:"w-4 h-4"})})})]},collateral.token)})})]})]})};CollateralSelector.__docgenInfo={description:"",methods:[],displayName:"CollateralSelector",props:{collaterals:{required:!0,tsType:{name:"Array",elements:[{name:"CollateralToken"}],raw:"CollateralToken[]"},description:""},isLoading:{required:!0,tsType:{name:"boolean"},description:""},selectedProtocol:{required:!1,tsType:{name:"string"},description:""},marketToken:{required:!0,tsType:{name:"string"},description:""},onCollateralSelectionChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(collaterals: CollateralWithAmount[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"CollateralWithAmount"}],raw:"CollateralWithAmount[]"},name:"collaterals"}],return:{name:"void"}}},description:""},onMaxClick:{required:!1,tsType:{name:"signature",type:"function",raw:"(collateralToken: string, maxAmount: bigint, formattedMaxAmount: string) => void",signature:{arguments:[{type:{name:"string"},name:"collateralToken"},{type:{name:"unknown"},name:"maxAmount"},{type:{name:"string"},name:"formattedMaxAmount"}],return:{name:"void"}}},description:""},hideAmounts:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},initialSelectedCollaterals:{required:!1,tsType:{name:"Array",elements:[{name:"CollateralWithAmount"}],raw:"CollateralWithAmount[]"},description:""}}};const CollateralAmounts=({collaterals,onChange,selectedProtocol,onMaxClick})=>0===collaterals.length?null:(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)("label",{className:"block text-lg font-semibold text-center",children:"Collateral"}),(0,jsx_runtime.jsx)("div",{className:"space-y-4 max-h-48 overflow-y-auto pr-1",children:collaterals.map(c=>{var _c_inputValue;const displayAmount=null!==(_c_inputValue=c.inputValue)&&void 0!==_c_inputValue?_c_inputValue:0n===c.amount?"":(0,formatUnits.J)(c.amount,c.decimals),isSupported=c.supported;return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 "+(isSupported?"":"opacity-60"),children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 w-32 shrink-0",children:[(0,jsx_runtime.jsx)("div",{className:"w-6 h-6 relative",children:(0,jsx_runtime.jsx)(next_image.A,{src:externalContracts_tokenNameToLogo(c.symbol),alt:c.symbol,fill:!0,className:"rounded-full object-contain "+(isSupported?"":"grayscale")})}),(0,jsx_runtime.jsx)("span",{className:"truncate font-medium",children:c.symbol})]}),(0,jsx_runtime.jsx)("input",{type:"text",value:displayAmount,onChange:e=>((token,amountStr,decimals)=>{const updated=collaterals.map(c=>{if(c.token!==token)return c;try{const amount=(0,parseUnits.X)(amountStr||"0",decimals);return{...c,amount,inputValue:amountStr}}catch(e){return{...c,amount:0n,inputValue:amountStr}}});onChange(updated),null==onMaxClick||onMaxClick(token,!1)})(c.token,e.target.value,c.decimals),className:"flex-1 border-b-2 border-base-300 focus:border-primary bg-transparent px-2 py-1 text-right",placeholder:"0.00",disabled:!isSupported}),(0,jsx_runtime.jsx)("button",{className:"text-xs font-medium px-2 py-1 "+(isSupported?"":"opacity-50 cursor-not-allowed"),onClick:()=>((token,maxAmount,decimals)=>{const maxStr=(0,formatUnits.J)(maxAmount,decimals),updated=collaterals.map(c=>c.token===token?{...c,amount:maxAmount,inputValue:maxStr}:c);onChange(updated),null==onMaxClick||onMaxClick(token,!0)})(c.token,c.maxAmount,c.decimals),disabled:!isSupported,children:"MAX"})]},c.token)})})]});function useCollateral({protocolName,userAddress,isOpen}){const contractName="Vesu"===protocolName?"VesuGateway":"NostraGateway",{data,isLoading}=useScaffoldReadContract_useScaffoldReadContract({contractName,functionName:"get_supported_assets_info",args:"Vesu"===protocolName?[userAddress,0n]:[userAddress],enabled:isOpen&&!!userAddress,watch:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1}),[hasLoadedOnce,setHasLoadedOnce]=(0,react.useState)(!1);(0,react.useEffect)(()=>{!hasLoadedOnce&&Array.isArray(data)&&setHasLoadedOnce(!0)},[data,hasLoadedOnce]);const previousDataRef=(0,react.useRef)([]);(0,react.useEffect)(()=>{Array.isArray(data)&&data.length>0&&(previousDataRef.current=data)},[data]);const sourceData=Array.isArray(data)?data:previousDataRef.current;return{collaterals:Array.isArray(sourceData)?sourceData.map(item=>{const{0:address,1:symbol,2:decimals,3:rawBalance}=item;let rawBalanceBigInt=0n;rawBalance&&"object"==typeof rawBalance&&"low"in rawBalance&&"high"in rawBalance?rawBalanceBigInt=BigInt(rawBalance.low)+(BigInt(rawBalance.high)<<128n):"bigint"!=typeof rawBalance&&"number"!=typeof rawBalance||(rawBalanceBigInt=BigInt(rawBalance));const decimalsNum=decimals?Number(decimals):18;return{address:`0x${BigInt(address).toString(16).padStart(64,"0")}`,symbol:feltToString("bigint"==typeof symbol?symbol:BigInt(symbol)),decimals:decimalsNum,supported:!0,balance:rawBalanceBigInt&&decimalsNum?Number(rawBalanceBigInt)/10**decimalsNum:0,rawBalance:rawBalanceBigInt}}):[],isLoading:isLoading&&!hasLoadedOnce}}CollateralAmounts.__docgenInfo={description:"",methods:[],displayName:"CollateralAmounts",props:{collaterals:{required:!0,tsType:{name:"Array",elements:[{name:"CollateralWithAmount"}],raw:"CollateralWithAmount[]"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(updated: CollateralWithAmount[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"CollateralWithAmount"}],raw:"CollateralWithAmount[]"},name:"updated"}],return:{name:"void"}}},description:""},selectedProtocol:{required:!1,tsType:{name:"string"},description:""},onMaxClick:{required:!1,tsType:{name:"signature",type:"function",raw:"(token: string, isMax: boolean) => void",signature:{arguments:[{type:{name:"string"},name:"token"},{type:{name:"boolean"},name:"isMax"}],return:{name:"void"}}},description:""}}};const getProtocolLogo=protocolName=>({"Aave V3":"/logos/aave.svg","Compound V3":"/logos/compound.svg",Venus:"/logos/venus.svg"}[protocolName]||externalContracts_tokenNameToLogo(protocolName));var MovePositionModal_console=__webpack_require__("./node_modules/console-browserify/index.js");const formatDisplayNumber=value=>{const num="string"==typeof value?parseFloat(value):value;return isNaN(num)?"0.00":new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:6}).format(num)},MovePositionModal_POOL_IDS={Genesis:0n},getPoolNameFromId=poolId=>{const entry=Object.entries(MovePositionModal_POOL_IDS).find(([_,id])=>id===poolId);return entry?entry[0]:"Unknown Pool"},MovePositionModal=({isOpen,onClose,fromProtocol,position,preSelectedCollaterals,disableCollateralSelection})=>{const{address:userAddress}=useAccount_useAccount(),protocols=(0,react.useMemo)(()=>[{name:"Nostra"},{name:"Vesu"}],[]),{tokenAddress,decimals,type,name,balance,poolId:currentPoolId}=position,[selectedProtocol,setSelectedProtocol]=(0,react.useState)(()=>{var _protocols_find;return(null===(_protocols_find=protocols.find(p=>p.name!==fromProtocol))||void 0===_protocols_find?void 0:_protocols_find.name)||""}),[selectedPoolId,setSelectedPoolId]=(0,react.useState)(MovePositionModal_POOL_IDS.Genesis),[amount,setAmount]=(0,react.useState)(""),[isAmountMaxClicked,setIsAmountMaxClicked]=(0,react.useState)(!1),[selectedCollateralsWithAmounts,setSelectedCollateralsWithAmounts]=(0,react.useState)([]),[maxClickedCollaterals,setMaxClickedCollaterals]=(0,react.useState)({}),[loading,setLoading]=(0,react.useState)(!1),[step,setStep]=(0,react.useState)("idle"),[error,setError]=(0,react.useState)(null),{data:routerGateway}=scaffold_stark_useDeployedContractInfo_useDeployedContractInfo("RouterGateway"),{getAuthorizations,isReady:isAuthReady}=(()=>{const{account}=useAccount_useAccount(),{data:routerGateway}=scaffold_stark_useDeployedContractInfo_useDeployedContractInfo("RouterGateway");return{getAuthorizations:(0,react.useCallback)(async baseInstructions=>{if(!account||!routerGateway)return[];const authInstruction=starknet_dist.fP.compile({instructions:baseInstructions,rawSelectors:!1}),contract=new starknet_dist.NZ(routerGateway.abi,routerGateway.address,account),protocolInstructions=await contract.call("get_authorizations_for_instructions",authInstruction),authorizations=[];if(Array.isArray(protocolInstructions))for(const instruction of protocolInstructions){const contractAddressHex=starknet_dist.bu.toHexString(instruction[0]),entrypointName=feltToString(instruction[1]);authorizations.push({contractAddress:contractAddressHex,entrypoint:entrypointName,calldata:instruction[2].map(value=>starknet_dist.bu.toHexString(value))})}return authorizations},[account,routerGateway]),isReady:!!account&&!!routerGateway}})(),[fetchedAuthorizations,setFetchedAuthorizations]=(0,react.useState)([]),{collaterals:sourceCollaterals,isLoading:isLoadingSourceCollaterals}=useCollateral({protocolName:fromProtocol,userAddress:userAddress||"0x0000000000000000000000000000000000000000",isOpen:isOpen&&!(disableCollateralSelection&&preSelectedCollaterals&&"Vesu"===fromProtocol)}),{collaterals:targetCollaterals,isLoading:isLoadingTargetCollaterals}=useCollateral({protocolName:selectedProtocol,userAddress:userAddress||"0x0000000000000000000000000000000000000000",isOpen:isOpen&&!!selectedProtocol}),firstCollateralsReadyRef=(0,react.useRef)(!1);(0,react.useEffect)(()=>{(disableCollateralSelection&&preSelectedCollaterals&&"Vesu"===fromProtocol||!isLoadingSourceCollaterals&&!isLoadingTargetCollaterals)&&(firstCollateralsReadyRef.current=!0)},[disableCollateralSelection,preSelectedCollaterals,fromProtocol,isLoadingSourceCollaterals,isLoadingTargetCollaterals]);const collateralsForSelector=(0,react.useMemo)(()=>{if(disableCollateralSelection&&preSelectedCollaterals&&"Vesu"===fromProtocol)return preSelectedCollaterals.map(collateral=>({symbol:collateral.symbol,balance:Number(collateral.inputValue||collateral.amount.toString()),address:collateral.token,decimals:collateral.decimals,rawBalance:collateral.amount,supported:!0}));let filtered=sourceCollaterals.filter(c=>c.balance>0);return"Nostra"===fromProtocol&&"Vesu"===selectedProtocol&&"borrow"===type&&(filtered=filtered.filter(c=>c.address.toLowerCase()!==tokenAddress.toLowerCase())),targetCollaterals.length>0?filtered.map(collateral=>({...collateral,supported:targetCollaterals.some(tc=>tc.address.toLowerCase()===collateral.address.toLowerCase())})):filtered},[sourceCollaterals,targetCollaterals,preSelectedCollaterals,disableCollateralSelection,fromProtocol,selectedProtocol,type,tokenAddress]),{data:tokenPrices}=useScaffoldReadContract_useScaffoldReadContract({contractName:"UiHelper",functionName:"get_asset_prices",args:[[...collateralsForSelector.map(c=>c.address),tokenAddress]],refetchInterval:3e4,enabled:!!collateralsForSelector.length&&isOpen}),{tokenToPrices}=(0,react.useMemo)(()=>{if(!tokenPrices)return{tokenToPrices:{}};const prices=tokenPrices,addresses=[...collateralsForSelector.map(c=>c.address),tokenAddress];return{tokenToPrices:prices.reduce((acc,price,index)=>({...acc,[addresses[index]]:price/10n**10n}),{})}},[tokenPrices,collateralsForSelector,tokenAddress]),debtUsdValue=(0,react.useMemo)(()=>{if(!amount)return 0;const price=tokenToPrices[tokenAddress.toLowerCase()],usdPerToken=price?Number((0,formatUnits.J)(price,8)):0;return parseFloat(amount)*usdPerToken},[amount,tokenToPrices,tokenAddress]),totalCollateralUsd=(0,react.useMemo)(()=>selectedCollateralsWithAmounts.reduce((sum,c)=>{const price=tokenToPrices[c.token.toLowerCase()],normalized=Number((0,formatUnits.J)(c.amount,c.decimals));return sum+(price?normalized*Number((0,formatUnits.J)(price,8)):0)},0),[selectedCollateralsWithAmounts,tokenToPrices]),isLoadingCollaterals=!firstCollateralsReadyRef.current&&(isLoadingSourceCollaterals||isLoadingTargetCollaterals),{fullInstruction,authInstruction,authInstructions,authCalldataKey,pairInstructions}=(0,react.useMemo)(()=>{if(!amount||!userAddress||!(null==routerGateway?void 0:routerGateway.address))return{fullInstruction:{instructions:[]},authInstruction:{instructions:[]},authInstructions:[],authCalldataKey:"",pairInstructions:[]};var _position_decimals;const tokenDecimals=null!==(_position_decimals=position.decimals)&&void 0!==_position_decimals?_position_decimals:18,parsedAmount=(0,parseUnits.X)(amount,tokenDecimals),lowerProtocolName=fromProtocol.toLowerCase(),destProtocolName=selectedProtocol.toLowerCase();if(selectedCollateralsWithAmounts.length>1){const collateralUsdValues=selectedCollateralsWithAmounts.map(collateral=>{const tokenDecimals=collateral.decimals||18,normalizedAmount=Number((0,formatUnits.J)(collateral.amount,tokenDecimals)),tokenPrice=tokenToPrices[collateral.token.toLowerCase()];let usdValue=normalizedAmount;return tokenPrice&&(usdValue=normalizedAmount*Number((0,formatUnits.J)(tokenPrice,8))),{token:collateral.token,symbol:collateral.symbol,amount:collateral.amount,decimals:tokenDecimals,price:tokenPrice||0n,usdValue}}),totalUsdValue=collateralUsdValues.reduce((sum,collateral)=>sum+collateral.usdValue,0),totalDebtAmount=parsedAmount,proportions=collateralUsdValues.map(collateral=>{const proportionBps=totalUsdValue>0?Math.floor(collateral.usdValue/totalUsdValue*1e4):0,debtAmountForCollateral=totalUsdValue>0?totalDebtAmount*BigInt(proportionBps)/BigInt(1e4):0n;return{token:collateral.token,symbol:collateral.symbol,proportionBps,proportion:proportionBps/1e4,priceUsd:collateral.price?Number((0,formatUnits.J)(collateral.price,8)):0,usdValue:collateral.usdValue,debtAmount:debtAmountForCollateral,debtAmountFormatted:(0,formatUnits.J)(debtAmountForCollateral,tokenDecimals)}}),allocatedDebtSum=proportions.reduce((sum,p)=>sum+p.debtAmount,0n),remainder=parsedAmount-allocatedDebtSum;remainder>0&&proportions.length>0&&(proportions[0].debtAmount+=remainder,proportions[0].debtAmountFormatted=(0,formatUnits.J)(proportions[0].debtAmount,tokenDecimals))}if("Vesu"===selectedProtocol&&selectedCollateralsWithAmounts.length>1){const result=(()=>{if(selectedCollateralsWithAmounts.length<=1)return null;const collateralUsdValues=selectedCollateralsWithAmounts.map(collateral=>{const tokenDecimals=collateral.decimals||18,normalizedAmount=Number((0,formatUnits.J)(collateral.amount,tokenDecimals)),tokenPrice=tokenToPrices[collateral.token.toLowerCase()];let usdValue=normalizedAmount;return tokenPrice&&(usdValue=normalizedAmount*Number((0,formatUnits.J)(tokenPrice,8))),{token:collateral.token,amount:collateral.amount,decimals:tokenDecimals,usdValue}}),totalUsdValue=collateralUsdValues.reduce((sum,c)=>sum+c.usdValue,0),debtAllocations=collateralUsdValues.map(collateral=>{const proportionBps=totalUsdValue>0?Math.floor(collateral.usdValue/totalUsdValue*1e4):0;return{token:collateral.token,proportionBps,debtAmount:totalUsdValue>0?parsedAmount*BigInt(proportionBps)/BigInt(1e4):0n}}),totalAllocated=debtAllocations.reduce((sum,a)=>sum+a.debtAmount,0n),remainder=parsedAmount-totalAllocated;remainder>0&&debtAllocations.length>0&&(debtAllocations[0].debtAmount+=remainder);const instructions=debtAllocations.map((allocation,index)=>{if(allocation.debtAmount<=0n)return[];const collateral=selectedCollateralsWithAmounts.find(c=>c.token===allocation.token);if(!collateral)return[];const isCollateralMaxClicked=maxClickedCollaterals[collateral.token]||!1,uppedAmount=isCollateralMaxClicked?collateral.amount*BigInt(101)/BigInt(100):collateral.amount,contextRedeposit=new starknet_dist.ci(starknet_dist.RV.Some,[0n,BigInt(position.tokenAddress)]),contextReborrow=new starknet_dist.ci(starknet_dist.RV.Some,[0n,BigInt(collateral.token)]),repayAll=isAmountMaxClicked&&index===debtAllocations.length-1,nostraInstructions=[new starknet_dist.bv({Deposit:void 0,Borrow:void 0,Repay:{basic:{token:position.tokenAddress,amount:starknet_dist.iN.bnToUint256(allocation.debtAmount),user:userAddress},repay_all:repayAll,context:new starknet_dist.ci(starknet_dist.RV.None)},Withdraw:void 0,Redeposit:void 0,Reborrow:void 0}),new starknet_dist.bv({Deposit:void 0,Borrow:void 0,Repay:void 0,Withdraw:{basic:{token:collateral.token,amount:starknet_dist.iN.bnToUint256(uppedAmount),user:userAddress},withdraw_all:isCollateralMaxClicked,context:new starknet_dist.ci(starknet_dist.RV.None)},Redeposit:void 0,Reborrow:void 0})],vesuInstructions=[new starknet_dist.bv({Deposit:void 0,Borrow:void 0,Repay:void 0,Withdraw:void 0,Redeposit:{token:collateral.token,target_instruction_index:1,user:userAddress,context:contextRedeposit},Reborrow:void 0}),new starknet_dist.bv({Deposit:void 0,Borrow:void 0,Repay:void 0,Withdraw:void 0,Redeposit:void 0,Reborrow:{token:position.tokenAddress,target_instruction_index:0,approval_amount:starknet_dist.iN.bnToUint256(allocation.debtAmount*BigInt(101)/BigInt(100)),user:userAddress,context:contextReborrow}})];return[{protocol_name:lowerProtocolName,instructions:nostraInstructions},{protocol_name:destProtocolName,instructions:vesuInstructions}]}),fullInstructionData=starknet_dist.fP.compile({instructions:instructions.flat()}),filteredForAuth=instructions.flat().map(protocolInstruction=>{const filteredInstructions=protocolInstruction.instructions.filter(instruction=>"Withdraw"===instruction.activeVariant()||"Reborrow"===instruction.activeVariant());return{protocol_name:protocolInstruction.protocol_name,instructions:filteredInstructions}}),authInstructionData=starknet_dist.fP.compile({instructions:filteredForAuth,rawSelectors:!1});return{fullInstruction:fullInstructionData,authInstruction:authInstructionData,authInstructions:filteredForAuth,authCalldataKey:JSON.stringify(authInstructionData),pairInstructions:instructions}})()||{fullInstruction:{instructions:[]},authInstruction:{instructions:[]},authInstructions:[],authCalldataKey:"",pairInstructions:[]};return result}let repayInstructionContext=new starknet_dist.ci(starknet_dist.RV.None),withdrawInstructionContext=new starknet_dist.ci(starknet_dist.RV.None);"Vesu"===fromProtocol&&selectedCollateralsWithAmounts.length>0&&(repayInstructionContext=new starknet_dist.ci(starknet_dist.RV.Some,[currentPoolId||0n,BigInt(selectedCollateralsWithAmounts[0].token)]),withdrawInstructionContext=new starknet_dist.ci(starknet_dist.RV.Some,[currentPoolId||0n,BigInt(position.tokenAddress)]));let borrowInstructionContext=new starknet_dist.ci(starknet_dist.RV.None),depositInstructionContext=new starknet_dist.ci(starknet_dist.RV.None);"Vesu"===selectedProtocol&&selectedCollateralsWithAmounts.length>0&&(borrowInstructionContext=new starknet_dist.ci(starknet_dist.RV.Some,[selectedPoolId,BigInt(selectedCollateralsWithAmounts[0].token)]),depositInstructionContext=new starknet_dist.ci(starknet_dist.RV.Some,[selectedPoolId,BigInt(position.tokenAddress)]));const repayInstruction=new starknet_dist.bv({Deposit:void 0,Borrow:void 0,Repay:{basic:{token:position.tokenAddress,amount:starknet_dist.iN.bnToUint256(parsedAmount),user:userAddress},repay_all:isAmountMaxClicked,context:repayInstructionContext},Withdraw:void 0,Redeposit:void 0,Reborrow:void 0}),withdrawInstructions=selectedCollateralsWithAmounts.map(collateral=>{const isCollateralMaxClicked=maxClickedCollaterals[collateral.token]||!1,uppedAmount=isCollateralMaxClicked?collateral.amount*BigInt(101)/BigInt(100):collateral.amount,amount=starknet_dist.iN.bnToUint256(uppedAmount);return new starknet_dist.bv({Deposit:void 0,Borrow:void 0,Repay:void 0,Withdraw:{basic:{token:collateral.token,amount,user:userAddress},withdraw_all:isCollateralMaxClicked,context:withdrawInstructionContext},Redeposit:void 0,Reborrow:void 0})}),depositInstructions=selectedCollateralsWithAmounts.map((collateral,index)=>new starknet_dist.bv({Deposit:void 0,Borrow:void 0,Repay:void 0,Withdraw:void 0,Redeposit:{token:collateral.token,target_instruction_index:1+index,user:userAddress,context:depositInstructionContext},Reborrow:void 0})),borrowInstruction=new starknet_dist.bv({Deposit:void 0,Borrow:void 0,Repay:void 0,Withdraw:void 0,Redeposit:void 0,Reborrow:{token:position.tokenAddress,target_instruction_index:0,approval_amount:starknet_dist.iN.bnToUint256(parsedAmount*BigInt(101)/BigInt(100)),user:userAddress,context:borrowInstructionContext}}),instructions=[{protocol_name:lowerProtocolName,instructions:[repayInstruction,...withdrawInstructions]},{protocol_name:destProtocolName,instructions:[...depositInstructions,borrowInstruction]}],fullInstructionData=starknet_dist.fP.compile({instructions}),authInstructions=[{protocol_name:lowerProtocolName,instructions:[...withdrawInstructions]},{protocol_name:destProtocolName,instructions:[borrowInstruction]}];isOpen&&(MovePositionModal_console.log("authInstructions",authInstructions),MovePositionModal_console.log("fullInstructions",instructions));const authInstructionData=starknet_dist.fP.compile({instructions:authInstructions,rawSelectors:!1});return{fullInstruction:fullInstructionData,authInstruction:authInstructionData,authInstructions,authCalldataKey:JSON.stringify(authInstructionData),pairInstructions:[instructions]}},[amount,userAddress,null==routerGateway?void 0:routerGateway.address,position.decimals,position.tokenAddress,fromProtocol,selectedProtocol,selectedCollateralsWithAmounts,isAmountMaxClicked,tokenToPrices,maxClickedCollaterals,currentPoolId,selectedPoolId,isOpen]),vesuPairings=(0,react.useMemo)(()=>{if("Nostra"!==fromProtocol||"Vesu"!==selectedProtocol||!amount||0===selectedCollateralsWithAmounts.length)return[];try{var _position_decimals;const tokenDecimals=null!==(_position_decimals=position.decimals)&&void 0!==_position_decimals?_position_decimals:18,parsedAmount=(0,parseUnits.X)(amount,tokenDecimals),collateralUsdValues=selectedCollateralsWithAmounts.map(collateral=>{const tokenDecimals=collateral.decimals||18,normalizedAmount=Number((0,formatUnits.J)(collateral.amount,tokenDecimals)),tokenPrice=tokenToPrices[collateral.token.toLowerCase()];let usdValue=normalizedAmount;return tokenPrice&&(usdValue=normalizedAmount*Number((0,formatUnits.J)(tokenPrice,8))),{...collateral,usdValue}}),totalUsdValue=collateralUsdValues.reduce((sum,c)=>sum+c.usdValue,0),allocations=collateralUsdValues.map(collateral=>{const proportionBps=totalUsdValue>0?Math.floor(collateral.usdValue/totalUsdValue*1e4):0,debtAmount=totalUsdValue>0?parsedAmount*BigInt(proportionBps)/BigInt(1e4):0n;return{...collateral,debtAmount}}),allocatedSum=allocations.reduce((sum,a)=>sum+a.debtAmount,0n),remainder=parsedAmount-allocatedSum;return remainder>0n&&allocations.length>0&&(allocations[0].debtAmount+=remainder),allocations}catch(e){return[]}},[fromProtocol,selectedProtocol,amount,selectedCollateralsWithAmounts,tokenToPrices,position.decimals]);(0,react.useEffect)(()=>{let cancelled=!1;return(async()=>{try{if(!isOpen||!isAuthReady||!authInstructions||Array.isArray(authInstructions)&&0===authInstructions.length||!authCalldataKey)return void setFetchedAuthorizations([]);const auths=await getAuthorizations(authInstructions);cancelled||setFetchedAuthorizations(auths)}catch(e){cancelled||setFetchedAuthorizations([]),isOpen&&(MovePositionModal_console.log("authInstructions",authInstructions),MovePositionModal_console.log("error",e))}})(),()=>{cancelled=!0}},[isOpen,isAuthReady,getAuthorizations,authCalldataKey]);const calls=(0,react.useMemo)(()=>{if(!pairInstructions||0===pairInstructions.length)return[];return[...null!=fetchedAuthorizations?fetchedAuthorizations:[],...pairInstructions.map(instructions=>({contractName:"RouterGateway",functionName:"move_debt",args:starknet_dist.fP.compile({instructions})}))]},[fetchedAuthorizations,pairInstructions]),{sendAsync}=(({calls,options})=>{const{targetNetwork}=scaffold_stark_useTargetNetwork_useTargetNetwork(),{chain}=(0,dist.AE)(),sendTxnWrapper=useSmartTransactor();return{...(0,dist.sG)({}),sendAsync:async()=>{if(null==chain?void 0:chain.id)if((null==chain?void 0:chain.id)===targetNetwork.id)try{const parsedCalls=calls?(useScaffoldMultiWriteContract_console.log("calls",calls),calls.map(call=>{var _contracts_targetNetwork_network;if(function isRawCall(value){return"entrypoint"in value}(call))return call;const functionName=call.functionName,contractName=call.contractName,unParsedArgs=call.args,contract=null==contract_contracts||null===(_contracts_targetNetwork_network=contract_contracts[targetNetwork.network])||void 0===_contracts_targetNetwork_network?void 0:_contracts_targetNetwork_network[contractName],contractInstance=new starknet_dist.NZ(contract.abi,contract.address);return useScaffoldMultiWriteContract_console.log("unparsed args",unParsedArgs),contractInstance.populate(functionName,unParsedArgs)})):[];return await sendTxnWrapper(parsedCalls)}catch(e){throw e}else useScaffoldMultiWriteContract_console.error("You are on the wrong network");else useScaffoldMultiWriteContract_console.error("Please connect your wallet")}}})({calls}),estimateCalls=(0,react.useMemo)(()=>{if(!(null==routerGateway?void 0:routerGateway.address)||!pairInstructions||0===pairInstructions.length)return null;return[...null!=fetchedAuthorizations?fetchedAuthorizations:[],...pairInstructions.map(instructions=>({contractAddress:routerGateway.address,entrypoint:"move_debt",calldata:starknet_dist.fP.compile({instructions})}))]},[null==routerGateway?void 0:routerGateway.address,fetchedAuthorizations,pairInstructions]),{loading:feeLoading,error:feeError,feeNative}=useGasEstimate({enabled:isOpen,buildCalls:()=>null!=estimateCalls?estimateCalls:null,currency:"STRK"});(0,react.useEffect)(()=>{isOpen||(setAmount(""),setError(null),setStep("idle"),setLoading(!1),setSelectedCollateralsWithAmounts([]),setMaxClickedCollaterals({}),setIsAmountMaxClicked(!1))},[isOpen]),(0,react.useEffect)(()=>{isOpen&&preSelectedCollaterals&&preSelectedCollaterals.length>0&&setSelectedCollateralsWithAmounts(prev=>{if(0===prev.length)return preSelectedCollaterals.map(c=>({...c,amount:0n,inputValue:""}));const existing=new Map(prev.map(c=>[c.token.toLowerCase(),c]));return[...preSelectedCollaterals.map(c=>{const key=c.token.toLowerCase();return existing.get(key)||{...c,amount:0n,inputValue:""}}),...prev.filter(c=>!preSelectedCollaterals.some(p=>p.token.toLowerCase()===c.token.toLowerCase()))]})},[isOpen,preSelectedCollaterals]);const handleCollateralSelectionChange=(0,react.useCallback)(collaterals=>{setSelectedCollateralsWithAmounts(collaterals),setMaxClickedCollaterals(prevState=>{const updatedMaxClicked={...prevState},newTokens=new Set(collaterals.map(c=>c.token));return Object.keys(updatedMaxClicked).forEach(token=>{newTokens.has(token)||delete updatedMaxClicked[token]}),updatedMaxClicked})},[]),handleCollateralMaxClick=(0,react.useCallback)((collateralToken,maxAmount,formattedMaxAmount)=>{setSelectedCollateralsWithAmounts(prev=>prev.map(c=>c.token===collateralToken?{...c,amount:maxAmount,inputValue:formattedMaxAmount}:c)),setMaxClickedCollaterals(prev=>({...prev,[collateralToken]:!0}))},[]),handleAmountChange=(0,react.useCallback)(e=>{setAmount(e.target.value),setIsAmountMaxClicked(!1)},[]),handleMaxClick=(0,react.useCallback)(()=>{try{if(!position.balance)return void setAmount("0");const formattedMaxValue=(0,formatUnits.J)(position.balance,position.decimals),maxValue=parseFloat(formattedMaxValue);!isNaN(maxValue)&&isFinite(maxValue)?(setAmount(formattedMaxValue),setIsAmountMaxClicked(!0)):(setAmount("0"),MovePositionModal_console.error("Invalid position balance:",position.balance))}catch(error){MovePositionModal_console.error("Error setting max amount:",error),setAmount("0")}},[position.balance,position.decimals]),actionButtonText=(0,react.useMemo)(()=>loading?"executing"===step?"Moving...":"Processing...":"done"===step?"Done!":"Migrate",[loading,step]),actionButtonClass=(0,react.useMemo)(()=>"done"===step?"btn-success":"btn-primary",[step]),getFormattedBalance=(0,react.useMemo)(()=>{try{return balance?formatDisplayNumber(Number((0,formatUnits.J)(balance,decimals))):"0.00"}catch(error){return"0.00"}},[balance,decimals]),isActionDisabled=loading||!selectedProtocol||!amount||!("borrow"!==position.type||0!==selectedCollateralsWithAmounts.length)||"idle"!==step||"Vesu"===fromProtocol&&"Vesu"===selectedProtocol&&selectedPoolId===currentPoolId;return(0,jsx_runtime.jsxs)("dialog",{className:"modal "+(isOpen?"modal-open":""),children:[(0,jsx_runtime.jsxs)("div",{className:"modal-box bg-base-100 max-w-5xl max-h-[90vh] min-h-[360px] p-6 rounded-none flex flex-col",children:[(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-8 flex-grow overflow-y-auto",children:[(0,jsx_runtime.jsxs)("div",{className:"space-y-6 md:col-span-3",children:[(0,jsx_runtime.jsx)("label",{className:"text-sm font-medium text-base-content/80",children:"From"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3 h-12 border-b-2 border-base-300 px-1",children:[(0,jsx_runtime.jsx)(next_image.A,{src:getProtocolLogo(fromProtocol),alt:fromProtocol,width:32,height:32,className:"rounded-full min-w-[32px]"}),(0,jsx_runtime.jsx)("span",{className:"truncate font-semibold text-lg",children:fromProtocol})]}),"borrow"===position.type&&(isLoadingCollaterals?(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center justify-center py-4",children:[(0,jsx_runtime.jsx)("span",{className:"loading loading-spinner loading-md mb-2"}),(0,jsx_runtime.jsx)("span",{className:"text-base-content/70 text-xs",children:"Loading collaterals..."})]}):(0,jsx_runtime.jsx)("div",{className:"mt-6",children:(0,jsx_runtime.jsx)(CollateralSelector,{collaterals:collateralsForSelector,isLoading:!1,selectedProtocol,onCollateralSelectionChange:handleCollateralSelectionChange,marketToken:position.tokenAddress,onMaxClick:handleCollateralMaxClick,hideAmounts:!0,initialSelectedCollaterals:selectedCollateralsWithAmounts})}))]}),(0,jsx_runtime.jsxs)("div",{className:"space-y-6 md:col-span-6",children:[(0,jsx_runtime.jsxs)("div",{className:"text-center mb-2",children:[(0,jsx_runtime.jsxs)("label",{className:"block text-lg font-semibold flex items-center justify-center gap-1",children:["Debt","supply"===position.type&&(0,jsx_runtime.jsx)(FiLock,{className:"text-emerald-500 w-4 h-4",title:"Supplied asset"})]}),(0,jsx_runtime.jsxs)("div",{className:"text-xs text-base-content/60",children:["Available: ",getFormattedBalance," ",position.name]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 w-32 shrink-0",children:[(0,jsx_runtime.jsx)("div",{className:"w-6 h-6 relative",children:(0,jsx_runtime.jsx)(next_image.A,{src:externalContracts_tokenNameToLogo(position.name),alt:position.name,fill:!0,className:"rounded-full object-contain"})}),(0,jsx_runtime.jsx)("span",{className:"truncate font-medium",children:position.name})]}),(0,jsx_runtime.jsx)("input",{type:"text",className:"flex-1 border-b-2 border-base-300 focus:border-primary bg-transparent px-2 h-14 text-lg text-right",placeholder:"0.00",value:amount,onChange:handleAmountChange,disabled:loading||"idle"!==step}),(0,jsx_runtime.jsx)("button",{className:"text-xs font-medium px-2 py-1",onClick:handleMaxClick,disabled:loading||"idle"!==step,children:"MAX"})]}),"borrow"===position.type&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CollateralAmounts,{collaterals:selectedCollateralsWithAmounts,onChange:setSelectedCollateralsWithAmounts,selectedProtocol,onMaxClick:(token,isMax)=>setMaxClickedCollaterals(prev=>({...prev,[token]:isMax}))}),disableCollateralSelection&&preSelectedCollaterals&&preSelectedCollaterals.length>0&&(0,jsx_runtime.jsxs)("div",{className:"text-xs text-base-content/70 mt-2 p-2 bg-info/10 rounded",children:[(0,jsx_runtime.jsx)("strong",{children:"Note:"})," Vesu uses collateral-debt pair isolation. You can adjust the amount, but this collateral cannot be changed."]})]}),error&&(0,jsx_runtime.jsxs)("div",{className:"alert alert-error shadow-lg",children:[(0,jsx_runtime.jsx)(FiAlertTriangle,{className:"w-6 h-6"}),(0,jsx_runtime.jsx)("div",{className:"text-sm flex-1",children:error})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between text-sm text-base-content/70",children:[(0,jsx_runtime.jsxs)("span",{children:["Debt Value: $",formatDisplayNumber(debtUsdValue)]}),"borrow"===position.type&&(0,jsx_runtime.jsxs)("span",{children:["Collateral Value: $",formatDisplayNumber(totalCollateralUsd)]})]})]}),(0,jsx_runtime.jsx)("div",{className:"flex flex-col md:col-span-3 h-full",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-6 flex-1",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"text-sm font-medium text-base-content/80",children:"To"}),(0,jsx_runtime.jsxs)("div",{className:"dropdown w-full",children:[(0,jsx_runtime.jsxs)("div",{tabIndex:0,className:"border-b-2 border-base-300 py-2 px-1 flex items-center justify-between cursor-pointer h-12",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-3 w-[calc(100%-32px)] overflow-hidden",children:selectedProtocol?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(next_image.A,{src:getProtocolLogo(selectedProtocol),alt:selectedProtocol,width:32,height:32,className:"rounded-full min-w-[32px]"}),(0,jsx_runtime.jsx)("span",{className:"truncate font-semibold text-lg",children:selectedProtocol})]}):(0,jsx_runtime.jsx)("span",{className:"text-base-content/50",children:"Select protocol"})}),(0,jsx_runtime.jsx)("svg",{className:"w-4 h-4 shrink-0 opacity-70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,jsx_runtime.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),(0,jsx_runtime.jsx)("ul",{tabIndex:0,className:"dropdown-content menu p-2 shadow-lg bg-base-100 rounded-lg w-full z-50 dropdown-bottom mt-1",children:protocols.filter(p=>p.name!==fromProtocol||"Vesu"===p.name&&"Vesu"===fromProtocol).map(protocol=>(0,jsx_runtime.jsx)("li",{children:(0,jsx_runtime.jsxs)("button",{className:"flex items-center gap-3 py-2",onClick:()=>{return protocolName=protocol.name,setSelectedProtocol(protocolName),void("Vesu"!==protocolName&&setSelectedPoolId(MovePositionModal_POOL_IDS.Genesis));var protocolName},children:[(0,jsx_runtime.jsx)(next_image.A,{src:getProtocolLogo(protocol.name),alt:protocol.name,width:32,height:32,className:"rounded-full min-w-[32px]"}),(0,jsx_runtime.jsx)("span",{className:"truncate text-lg",children:protocol.name})]})},protocol.name))})]})]}),"Vesu"===selectedProtocol&&(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,jsx_runtime.jsx)("label",{className:"text-sm font-medium text-base-content/80",children:"Target Pool"}),"Vesu"===fromProtocol&&(0,jsx_runtime.jsxs)("div",{className:"text-sm bg-base-200/60 py-1 px-3 rounded-lg flex items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-base-content/70",children:"Current Pool:"}),(0,jsx_runtime.jsx)("span",{className:"font-medium ml-1",children:void 0!==currentPoolId?getPoolNameFromId(currentPoolId):"Unknown"})]})]}),(0,jsx_runtime.jsxs)("div",{className:"dropdown w-full",children:[(0,jsx_runtime.jsxs)("div",{tabIndex:0,className:"border-b-2 border-base-300 py-2 px-1 flex items-center justify-between cursor-pointer h-12",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-3 w-[calc(100%-32px)] overflow-hidden",children:Object.entries(MovePositionModal_POOL_IDS).map(([name,id])=>id===selectedPoolId?(0,jsx_runtime.jsx)("span",{className:"truncate font-semibold text-lg",children:name},name):null)}),(0,jsx_runtime.jsx)("svg",{className:"w-4 h-4 shrink-0 opacity-70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,jsx_runtime.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),(0,jsx_runtime.jsx)("ul",{tabIndex:0,className:"dropdown-content menu p-2 shadow-lg bg-base-100 rounded-lg w-full z-50 dropdown-bottom mt-1",children:Object.entries(MovePositionModal_POOL_IDS).filter(([_,id])=>"Vesu"!==fromProtocol||id!==currentPoolId).map(([name,id])=>(0,jsx_runtime.jsx)("li",{children:(0,jsx_runtime.jsxs)("button",{className:"flex items-center gap-3 py-2",onClick:()=>setSelectedPoolId(id),children:[(0,jsx_runtime.jsx)(next_image.A,{src:"/logos/vesu.svg",alt:"Vesu",width:32,height:32,className:"rounded-full min-w-[32px]"}),(0,jsx_runtime.jsx)("span",{className:"truncate text-lg",children:name})]})},name))})]})]}),"Nostra"===fromProtocol&&"Vesu"===selectedProtocol&&vesuPairings.length>0&&(0,jsx_runtime.jsx)("div",{className:"bg-base-200/40 p-2 rounded space-y-1",children:vesuPairings.map(p=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)(next_image.A,{src:externalContracts_tokenNameToLogo(p.symbol),alt:p.symbol,width:16,height:16,className:"rounded-full"}),(0,jsx_runtime.jsx)("span",{children:p.symbol}),(0,jsx_runtime.jsx)("span",{children:Number((0,formatUnits.J)(p.amount,p.decimals)).toLocaleString(void 0,{maximumFractionDigits:2})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)(next_image.A,{src:externalContracts_tokenNameToLogo(position.name),alt:position.name,width:16,height:16,className:"rounded-full"}),(0,jsx_runtime.jsx)("span",{children:position.name}),(0,jsx_runtime.jsx)("span",{children:Number((0,formatUnits.J)(p.debtAmount,position.decimals)).toLocaleString(void 0,{maximumFractionDigits:2})})]})]},p.token))})]})})]}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end pt-5 mt-auto",children:(0,jsx_runtime.jsxs)("button",{className:`btn ${actionButtonClass} btn-lg w-full h-14 flex justify-between shadow-md ${loading?"animate-pulse":""}`,onClick:"done"===step?onClose:async()=>{try{if(!userAddress)throw new Error("Wallet not connected");setLoading(!0),setError(null),setStep("executing");await sendAsync();setStep("done"),setTimeout(()=>onClose(),2e3)}catch(err){MovePositionModal_console.error("Move position failed:",err),setError(err.message||"Move position failed"),setStep("idle")}finally{setLoading(!1)}},disabled:"done"!==step&&isActionDisabled,children:[(0,jsx_runtime.jsxs)("span",{children:[loading&&(0,jsx_runtime.jsx)("span",{className:"loading loading-spinner loading-sm mr-2"}),actionButtonText]}),(0,jsx_runtime.jsxs)("span",{className:"flex items-center gap-1 text-xs",children:[(0,jsx_runtime.jsx)(FaGasPump,{className:"text-gray-400"}),feeLoading&&null===feeNative?(0,jsx_runtime.jsx)("span",{className:"loading loading-spinner loading-xs"}):feeError?null:null!==feeNative?(0,jsx_runtime.jsxs)("span",{children:[feeNative.toFixed(4)," STRK"]}):null]})]})})]}),(0,jsx_runtime.jsx)("form",{method:"dialog",className:"modal-backdrop backdrop-blur-sm bg-black/20",onClick:loading?void 0:onClose,children:(0,jsx_runtime.jsx)("button",{disabled:loading,children:"close"})})]})};MovePositionModal.__docgenInfo={description:"",methods:[],displayName:"MovePositionModal",props:{isOpen:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},fromProtocol:{required:!0,tsType:{name:"string"},description:""},position:{required:!0,tsType:{name:"signature",type:"object",raw:'{\n  name: string;\n  balance: bigint; // USD value (display only)\n  type: "supply" | "borrow";\n  tokenAddress: string;\n  decimals: number; // Add decimals for proper amount parsing\n  poolId?: bigint; // Add current pool ID\n}',signature:{properties:[{key:"name",value:{name:"string",required:!0}},{key:"balance",value:{name:"unknown",required:!0}},{key:"type",value:{name:"union",raw:'"supply" | "borrow"',elements:[{name:"literal",value:'"supply"'},{name:"literal",value:'"borrow"'}],required:!0}},{key:"tokenAddress",value:{name:"string",required:!0}},{key:"decimals",value:{name:"number",required:!0}},{key:"poolId",value:{name:"unknown",required:!1}}]}},description:""},preSelectedCollaterals:{required:!1,tsType:{name:"Array",elements:[{name:"CollateralWithAmount"}],raw:"CollateralWithAmount[]"},description:""},disableCollateralSelection:{required:!1,tsType:{name:"boolean"},description:""}}};const RepayModalStark=({isOpen,onClose,token,protocolName,debtBalance,vesuContext,position})=>{const{balance,decimals}=useTokenBalance(token.address,"stark"),{execute,buildCalls}=useLendingAction("stark","Repay",token.address,protocolName,decimals,vesuContext,debtBalance,balance),before=decimals?Number((0,formatUnits.J)(debtBalance,decimals)):0,bump=101n*debtBalance/100n,maxInput=balance<bump?balance:bump;return(0,jsx_runtime.jsx)(TokenActionModal,{isOpen,onClose,action:"Repay",token,protocolName,apyLabel:"Borrow APY",apy:token.currentRate,metricLabel:"Total debt",before,balance,percentBase:debtBalance,max:maxInput,network:"stark",buildCalls,position,onConfirm:execute})};RepayModalStark.__docgenInfo={description:"",methods:[],displayName:"RepayModalStark",props:{isOpen:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},token:{required:!0,tsType:{name:"TokenInfo"},description:""},protocolName:{required:!0,tsType:{name:"string"},description:""},debtBalance:{required:!0,tsType:{name:"unknown"},description:""},vesuContext:{required:!1,tsType:{name:"VesuContext"},description:""},position:{required:!1,tsType:{name:"PositionManager"},description:""}}};var style=__webpack_require__("./node_modules/styled-jsx/style.js"),style_default=__webpack_require__.n(style);const TokenSelectModalStark=({isOpen,onClose,tokens,protocolName,collateralAsset,isVesu=!1,vesuContext,position})=>{const[selectedToken,setSelectedToken]=(0,react.useState)(null),[isTokenModalOpen,setIsTokenModalOpen]=(0,react.useState)(!1),[hoveredToken,setHoveredToken]=(0,react.useState)(null),availableTokens=tokens.filter(asset=>!collateralAsset||`0x${BigInt(asset.address).toString(16).padStart(64,"0")}`!==collateralAsset),handleTokenHover=tokenAddress=>{setHoveredToken(tokenAddress)},handleDone=()=>{onClose()};var _selectedToken_borrowAPR;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("dialog",{className:"modal "+(isOpen&&!isTokenModalOpen?"modal-open":""),children:[(0,jsx_runtime.jsxs)("div",{className:"jsx-7b991b7bb193173e modal-box max-w-4xl bg-base-100",children:[(0,jsx_runtime.jsxs)("div",{className:"jsx-7b991b7bb193173e flex justify-between items-center mb-6",children:[(0,jsx_runtime.jsx)("h3",{className:"jsx-7b991b7bb193173e font-bold text-xl tracking-tight",children:"Select a Token to Borrow"}),(0,jsx_runtime.jsx)("button",{onClick:handleDone,className:"jsx-7b991b7bb193173e btn btn-sm btn-circle btn-ghost",children:"✕"})]}),(0,jsx_runtime.jsx)("div",{className:"jsx-7b991b7bb193173e max-h-[60vh] overflow-y-auto pr-2",children:availableTokens.length>0?(0,jsx_runtime.jsx)("div",{className:"jsx-7b991b7bb193173e grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:availableTokens.map((token,index)=>{const address=`0x${BigInt(token.address).toString(16).padStart(64,"0")}`,symbol=feltToString(token.symbol);var _token_borrowAPR;return(0,jsx_runtime.jsxs)("div",{onClick:()=>(token=>{setSelectedToken(token),setIsTokenModalOpen(!0)})(token),onMouseEnter:()=>handleTokenHover(address),onMouseLeave:()=>handleTokenHover(null),style:{animationDelay:50*index+"ms",animation:"fadeIn 0.3s ease-in-out forwards",opacity:0},className:`jsx-7b991b7bb193173e bg-base-200 rounded-xl p-4 flex flex-col items-center justify-center cursor-pointer transition-all duration-300 \n                        ${hoveredToken===address?"shadow-lg bg-base-300 scale-105 border-primary":"shadow-md hover:shadow-lg border-transparent"}\n                        border transform hover:scale-105`,children:[(0,jsx_runtime.jsx)("div",{className:"jsx-7b991b7bb193173e avatar mb-3",children:(0,jsx_runtime.jsx)("div",{className:"jsx-7b991b7bb193173e w-16 h-16 rounded-full bg-base-100 p-1 ring-2 \n                          "+(hoveredToken===address?"ring-primary":"ring-base-300 dark:ring-base-content/20"),children:(0,jsx_runtime.jsx)(next_image.A,{src:externalContracts_tokenNameToLogo(symbol.toLowerCase()),alt:symbol,width:64,height:64,className:"object-contain transition-transform duration-300 "+(hoveredToken===address?"scale-110":"")})})}),(0,jsx_runtime.jsx)("span",{className:"jsx-7b991b7bb193173e font-bold text-lg mb-1",children:symbol}),(0,jsx_runtime.jsxs)("div",{className:`jsx-7b991b7bb193173e badge ${hoveredToken===address?"badge-primary":"badge-outline"} p-3 font-medium`,children:[utils_formatPercentage(null!==(_token_borrowAPR=token.borrowAPR)&&void 0!==_token_borrowAPR?_token_borrowAPR:0,2,!1),"% APR"]})]},address)})}):(0,jsx_runtime.jsxs)("div",{className:"jsx-7b991b7bb193173e text-center py-12 text-base-content/70 bg-base-200/50 rounded-xl",children:[(0,jsx_runtime.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"jsx-7b991b7bb193173e w-12 h-12 mx-auto mb-4 opacity-50",children:(0,jsx_runtime.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z",className:"jsx-7b991b7bb193173e"})}),(0,jsx_runtime.jsx)("p",{className:"jsx-7b991b7bb193173e text-lg",children:"No tokens available to borrow"})]})}),(0,jsx_runtime.jsx)(style_default(),{id:"7b991b7bb193173e",children:"@keyframes fadeIn{from{opacity:0;transform:translatey(10px)}to{opacity:1;transform:translatey(0)}}"})]}),(0,jsx_runtime.jsx)("form",{method:"dialog",className:"modal-backdrop",onClick:handleDone,children:(0,jsx_runtime.jsx)("button",{children:"close"})})]}),selectedToken&&(0,jsx_runtime.jsx)(BorrowModalStark,{isOpen:isTokenModalOpen,onClose:()=>{setIsTokenModalOpen(!1)},token:{name:feltToString(selectedToken.symbol),icon:externalContracts_tokenNameToLogo(feltToString(selectedToken.symbol).toLowerCase()),address:`0x${BigInt(selectedToken.address).toString(16).padStart(64,"0")}`,currentRate:null!==(_selectedToken_borrowAPR=selectedToken.borrowAPR)&&void 0!==_selectedToken_borrowAPR?_selectedToken_borrowAPR:0,usdPrice:selectedToken.price&&selectedToken.price.is_valid?Number(selectedToken.price.value)/1e18:0},protocolName,currentDebt:0,vesuContext,position})]})};TokenSelectModalStark.__docgenInfo={description:"",methods:[],displayName:"TokenSelectModalStark",props:{isOpen:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},tokens:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{\n  address: bigint;\n  symbol: bigint;\n  decimals: number;\n  rate_accumulator: bigint;\n  utilization: bigint;\n  fee_rate: bigint;\n  price: {\n    value: bigint;\n    is_valid: boolean;\n  };\n  total_nominal_debt: bigint;\n  last_rate_accumulator: bigint;\n  reserve: bigint;\n  scale: bigint;\n  borrowAPR?: number;\n  supplyAPY?: number;\n}",signature:{properties:[{key:"address",value:{name:"unknown",required:!0}},{key:"symbol",value:{name:"unknown",required:!0}},{key:"decimals",value:{name:"number",required:!0}},{key:"rate_accumulator",value:{name:"unknown",required:!0}},{key:"utilization",value:{name:"unknown",required:!0}},{key:"fee_rate",value:{name:"unknown",required:!0}},{key:"price",value:{name:"signature",type:"object",raw:"{\n  value: bigint;\n  is_valid: boolean;\n}",signature:{properties:[{key:"value",value:{name:"unknown",required:!0}},{key:"is_valid",value:{name:"boolean",required:!0}}]},required:!0}},{key:"total_nominal_debt",value:{name:"unknown",required:!0}},{key:"last_rate_accumulator",value:{name:"unknown",required:!0}},{key:"reserve",value:{name:"unknown",required:!0}},{key:"scale",value:{name:"unknown",required:!0}},{key:"borrowAPR",value:{name:"number",required:!1}},{key:"supplyAPY",value:{name:"number",required:!1}}]}}],raw:"TokenMetadata[]"},description:""},protocolName:{required:!0,tsType:{name:"string"},description:""},collateralAsset:{required:!1,tsType:{name:"string"},description:""},isVesu:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},vesuContext:{required:!1,tsType:{name:"VesuContext"},description:""},position:{required:!1,tsType:{name:"PositionManager"},description:""}}};const WithdrawModalStark=({isOpen,onClose,token,protocolName,supplyBalance,vesuContext,position})=>{const decimals=token.decimals,{execute,buildCalls}=useLendingAction("stark","Withdraw",token.address,protocolName,decimals,vesuContext,supplyBalance),before=decimals?Number((0,formatUnits.J)(supplyBalance,decimals)):0,maxInput=101n*supplyBalance/100n;return(0,jsx_runtime.jsx)(TokenActionModal,{isOpen,onClose,action:"Withdraw",token,protocolName,apyLabel:"Supply APY",apy:token.currentRate,metricLabel:"Total supplied",before,balance:supplyBalance,percentBase:supplyBalance,max:maxInput,network:"stark",buildCalls,position,onConfirm:execute})};WithdrawModalStark.__docgenInfo={description:"",methods:[],displayName:"WithdrawModalStark",props:{isOpen:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},token:{required:!0,tsType:{name:"TokenInfo"},description:""},protocolName:{required:!0,tsType:{name:"string"},description:""},supplyBalance:{required:!0,tsType:{name:"unknown"},description:""},vesuContext:{required:!1,tsType:{name:"VesuContext"},description:""},position:{required:!1,tsType:{name:"PositionManager"},description:""}}};var VesuPosition_console=__webpack_require__("./node_modules/console-browserify/index.js");const calculateRates=(interestPerSecond,total_nominal_debt,last_rate_accumulator,reserve,scale)=>{const borrowAPR=31536e3*Number(interestPerSecond)/Number(1000000000000000000n),totalBorrowed=Number(total_nominal_debt*last_rate_accumulator/1000000000000000000n),reserveScale=0n===scale?0:Number(1000000000000000000n*reserve/scale);return{borrowAPR,supplyAPY:reserveScale+totalBorrowed===0?0:borrowAPR*totalBorrowed/(reserveScale+totalBorrowed)}},VesuPosition=({collateralAsset,debtAsset,collateralShares:_collateralShares,collateralAmount,nominalDebt,isVtoken,supportedAssets,poolId})=>{const[isDepositModalOpen,setIsDepositModalOpen]=(0,react.useState)(!1),[isWithdrawModalOpen,setIsWithdrawModalOpen]=(0,react.useState)(!1),[isTokenSelectModalOpen,setIsTokenSelectModalOpen]=(0,react.useState)(!1),[isBorrowModalOpen,setIsBorrowModalOpen]=(0,react.useState)(!1),[isRepayModalOpen,setIsRepayModalOpen]=(0,react.useState)(!1),[isMoveModalOpen,setIsMoveModalOpen]=(0,react.useState)(!1),collateralMetadata=supportedAssets.find(asset=>`0x${BigInt(asset.address).toString(16).padStart(64,"0")}`===collateralAsset),debtMetadata=supportedAssets.find(asset=>`0x${BigInt(asset.address).toString(16).padStart(64,"0")}`===debtAsset),collateralUsdPrice=collateralMetadata&&collateralMetadata.price&&collateralMetadata.price.is_valid?Number(collateralMetadata.price.value)/1e18:0,debtUsdPrice=debtMetadata&&debtMetadata.price&&debtMetadata.price.is_valid?Number(debtMetadata.price.value)/1e18:0,collateralValue=collateralMetadata?BigInt(collateralAmount)*collateralMetadata.price.value/10n**BigInt(collateralMetadata.decimals):0n,debtValue=debtMetadata?BigInt(nominalDebt)*debtMetadata.price.value/10n**BigInt(debtMetadata.decimals):0n,position=(0,react.useMemo)(()=>new PositionManager(Number(collateralValue)/1e18,Number(debtValue)/1e18),[collateralValue,debtValue]);if(!collateralMetadata)return VesuPosition_console.error("Collateral metadata not found for asset:",collateralAsset),null;const collateralSymbol=feltToString(collateralMetadata.symbol),debtSymbol=debtMetadata?feltToString(debtMetadata.symbol):"N/A",formattedCollateral=formatTokenAmount(collateralAmount,collateralMetadata.decimals),formattedDebt=debtMetadata?formatTokenAmount(nominalDebt,debtMetadata.decimals):"0",debtNum=parseFloat(formattedDebt),collateralRates=calculateRates(collateralMetadata.fee_rate,collateralMetadata.total_nominal_debt,collateralMetadata.last_rate_accumulator,collateralMetadata.reserve,collateralMetadata.scale),debtRates=debtMetadata?calculateRates(debtMetadata.fee_rate,debtMetadata.total_nominal_debt,debtMetadata.last_rate_accumulator,debtMetadata.reserve,debtMetadata.scale):{borrowAPR:0,supplyAPY:0},monthlyCost=debtValue>0n?debtValue*BigInt(Math.floor(1e18*debtRates.borrowAPR))/10n**18n/12n:0n,monthlyYield=collateralValue*BigInt(Math.floor(1e18*collateralRates.supplyAPY))/10n**18n/12n,ltv=collateralValue>0n?100n*debtValue/collateralValue:0n,preSelectedCollateral=[{token:collateralAsset,symbol:collateralSymbol,amount:BigInt(collateralAmount),maxAmount:BigInt(collateralAmount),decimals:Number(collateralMetadata.decimals),supported:!0,inputValue:formattedCollateral}];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"card bg-base-100 shadow-md",children:(0,jsx_runtime.jsxs)("div",{className:"card-body p-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(next_image.A,{src:externalContracts_tokenNameToLogo(collateralSymbol.toLowerCase()),alt:collateralSymbol,width:24,height:24,className:"w-6 h-6"}),(0,jsx_runtime.jsx)("span",{className:"font-medium",children:collateralSymbol}),isVtoken&&(0,jsx_runtime.jsx)("span",{className:"badge badge-sm badge-primary",children:"vToken"})]}),"0"!==nominalDebt&&(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(next_image.A,{src:externalContracts_tokenNameToLogo(debtSymbol.toLowerCase()),alt:debtSymbol,width:24,height:24,className:"w-6 h-6"}),(0,jsx_runtime.jsx)("span",{className:"font-medium",children:debtSymbol})]})]}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"text-2xl font-bold",children:["$",(Number(collateralValue)/1e18).toFixed(3)]}),(0,jsx_runtime.jsxs)("div",{className:"text-lg text-gray-500",children:["ETH"===collateralSymbol?parseFloat(formattedCollateral).toFixed(3):formattedCollateral," ",collateralSymbol]}),(0,jsx_runtime.jsx)("div",{className:"divider my-1"}),(0,jsx_runtime.jsxs)("div",{className:"space-y-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between w-full gap-1",children:[(0,jsx_runtime.jsx)("span",{className:"text-sm text-gray-500",children:"Supply APY"}),(0,jsx_runtime.jsxs)("span",{className:"text-sm font-medium text-success",children:[utils_formatPercentage(100*collateralRates.supplyAPY,3),"%"]})]}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsxs)("span",{className:"text-sm font-medium",children:["$",(Number(monthlyYield)/1e18).toFixed(3)," per month"]})})]})]}),(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:["0"===nominalDebt?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"text-2xl font-bold text-gray-400",children:"$0.000"}),(0,jsx_runtime.jsxs)("div",{className:"text-lg text-gray-400",children:["0 ",debtSymbol]})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"text-2xl font-bold",children:["$",(Number(debtValue)/1e18).toFixed(3)]}),(0,jsx_runtime.jsxs)("div",{className:"text-lg text-gray-500",children:["ETH"===debtSymbol?parseFloat(formattedDebt).toFixed(3):formattedDebt," ",debtSymbol]})]}),(0,jsx_runtime.jsx)("div",{className:"divider my-1"}),(0,jsx_runtime.jsx)("div",{className:"space-y-1",children:"0"===nominalDebt?(0,jsx_runtime.jsxs)("div",{className:"flex justify-between w-full gap-1",children:[(0,jsx_runtime.jsx)("span",{className:"text-sm text-gray-400",children:"No debt"}),(0,jsx_runtime.jsx)("span",{className:"text-sm font-medium text-gray-400",children:"-"})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between w-full gap-1",children:[(0,jsx_runtime.jsx)("span",{className:"text-sm text-gray-500",children:"Borrow APR"}),(0,jsx_runtime.jsxs)("span",{className:"text-sm font-medium text-error",children:[utils_formatPercentage(100*debtRates.borrowAPR,3),"%"]})]}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsxs)("span",{className:"text-sm font-medium",children:["$",(Number(monthlyCost)/1e18).toFixed(3)," per month"]})})]})})]})]}),(0,jsx_runtime.jsx)("div",{className:"divider my-2"}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,jsx_runtime.jsxs)("span",{className:"text-sm text-gray-500",children:["Loan-to-value: ",(0,jsx_runtime.jsxs)("span",{className:"font-medium",children:[utils_formatPercentage(Number(ltv)),"%"]})]}),!isVtoken&&"0"!==nominalDebt&&(0,jsx_runtime.jsx)("button",{className:"btn btn-xs btn-outline btn-primary",onClick:()=>setIsMoveModalOpen(!0),children:"Move Position"})]}),isVtoken?(0,jsx_runtime.jsx)("div",{className:"text-center text-sm text-gray-500",children:"Managing vToken positions is not supported"}):(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)("button",{className:"btn btn-xs btn-primary rounded-r-none px-2 w-16",onClick:()=>setIsDepositModalOpen(!0),children:"Deposit"}),(0,jsx_runtime.jsx)("button",{className:"btn btn-xs btn-secondary rounded-l-none border-l-0 px-2 w-16",onClick:()=>setIsWithdrawModalOpen(!0),children:"Withdraw"})]}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)("button",{className:"btn btn-xs btn-primary rounded-r-none px-2 w-16",onClick:()=>{"0"===nominalDebt?setIsTokenSelectModalOpen(!0):debtMetadata&&setIsBorrowModalOpen(!0)},children:"Borrow"}),(0,jsx_runtime.jsx)("button",{className:"btn btn-xs btn-secondary rounded-l-none border-l-0 px-2 w-16 "+("0"===nominalDebt?"btn-disabled":""),onClick:()=>{"0"!==nominalDebt&&debtMetadata&&setIsRepayModalOpen(!0)},children:"Repay"})]})})]})]})}),!isVtoken&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(DepositModalStark,{isOpen:isDepositModalOpen,onClose:()=>setIsDepositModalOpen(!1),token:{name:collateralSymbol,icon:externalContracts_tokenNameToLogo(collateralSymbol.toLowerCase()),address:collateralAsset,currentRate:100*collateralRates.supplyAPY,usdPrice:collateralUsdPrice,decimals:Number(collateralMetadata.decimals)},protocolName:"Vesu",vesuContext:"0"!==nominalDebt?{poolId,counterpartToken:debtAsset}:void 0,position}),(0,jsx_runtime.jsx)(WithdrawModalStark,{isOpen:isWithdrawModalOpen,onClose:()=>setIsWithdrawModalOpen(!1),token:{name:collateralSymbol,icon:externalContracts_tokenNameToLogo(collateralSymbol.toLowerCase()),address:collateralAsset,currentRate:100*collateralRates.supplyAPY,usdPrice:collateralUsdPrice,decimals:Number(collateralMetadata.decimals)},protocolName:"Vesu",supplyBalance:BigInt(collateralAmount),vesuContext:{poolId,counterpartToken:debtAsset},position}),(0,jsx_runtime.jsx)(TokenSelectModalStark,{isOpen:isTokenSelectModalOpen,onClose:()=>setIsTokenSelectModalOpen(!1),tokens:supportedAssets,protocolName:"Vesu",collateralAsset,isVesu:!0,vesuContext:{poolId,counterpartToken:collateralAsset},position}),debtMetadata&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(BorrowModalStark,{isOpen:isBorrowModalOpen,onClose:()=>setIsBorrowModalOpen(!1),token:{name:debtSymbol,icon:externalContracts_tokenNameToLogo(debtSymbol.toLowerCase()),address:debtAsset,currentRate:100*debtRates.borrowAPR,usdPrice:debtUsdPrice,decimals:debtMetadata?Number(debtMetadata.decimals):18},protocolName:"Vesu",currentDebt:debtNum,vesuContext:{poolId,counterpartToken:collateralAsset},position}),(0,jsx_runtime.jsx)(RepayModalStark,{isOpen:isRepayModalOpen,onClose:()=>setIsRepayModalOpen(!1),token:{name:debtSymbol,icon:externalContracts_tokenNameToLogo(debtSymbol.toLowerCase()),address:debtAsset,currentRate:100*debtRates.borrowAPR,usdPrice:debtUsdPrice,decimals:debtMetadata?Number(debtMetadata.decimals):18},protocolName:"Vesu",debtBalance:BigInt(nominalDebt),vesuContext:{poolId,counterpartToken:collateralAsset},position}),(0,jsx_runtime.jsx)(MovePositionModal,{isOpen:isMoveModalOpen,onClose:()=>setIsMoveModalOpen(!1),fromProtocol:"Vesu",position:{name:debtSymbol,balance:BigInt(nominalDebt),type:"borrow",tokenAddress:debtAsset,decimals:Number(debtMetadata?debtMetadata.decimals:18),poolId},preSelectedCollaterals:preSelectedCollateral,disableCollateralSelection:!0})]})]})]})};VesuPosition.__docgenInfo={description:"",methods:[],displayName:"VesuPosition",props:{collateralAsset:{required:!0,tsType:{name:"string"},description:""},debtAsset:{required:!0,tsType:{name:"string"},description:""},collateralShares:{required:!0,tsType:{name:"string"},description:""},collateralAmount:{required:!0,tsType:{name:"string"},description:""},nominalDebt:{required:!0,tsType:{name:"string"},description:""},isVtoken:{required:!0,tsType:{name:"boolean"},description:""},supportedAssets:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{\n  address: bigint;\n  symbol: bigint;\n  decimals: number;\n  rate_accumulator: bigint;\n  utilization: bigint;\n  fee_rate: bigint;\n  price: {\n    value: bigint;\n    is_valid: boolean;\n  };\n  total_nominal_debt: bigint;\n  last_rate_accumulator: bigint;\n  reserve: bigint;\n  scale: bigint;\n  borrowAPR?: number;\n  supplyAPY?: number;\n}",signature:{properties:[{key:"address",value:{name:"unknown",required:!0}},{key:"symbol",value:{name:"unknown",required:!0}},{key:"decimals",value:{name:"number",required:!0}},{key:"rate_accumulator",value:{name:"unknown",required:!0}},{key:"utilization",value:{name:"unknown",required:!0}},{key:"fee_rate",value:{name:"unknown",required:!0}},{key:"price",value:{name:"signature",type:"object",raw:"{\n  value: bigint;\n  is_valid: boolean;\n}",signature:{properties:[{key:"value",value:{name:"unknown",required:!0}},{key:"is_valid",value:{name:"boolean",required:!0}}]},required:!0}},{key:"total_nominal_debt",value:{name:"unknown",required:!0}},{key:"last_rate_accumulator",value:{name:"unknown",required:!0}},{key:"reserve",value:{name:"unknown",required:!0}},{key:"scale",value:{name:"unknown",required:!0}},{key:"borrowAPR",value:{name:"number",required:!1}},{key:"supplyAPY",value:{name:"number",required:!1}}]}}],raw:"TokenMetadata[]"},description:""},poolId:{required:!0,tsType:{name:"unknown"},description:""}}};var VesuProtocolView_console=__webpack_require__("./node_modules/console-browserify/index.js");const VesuProtocolView=()=>{const{address:userAddress,status}=useAccount_useAccount(),poolId=POOL_IDS_Genesis,[positionsRefetchInterval,setPositionsRefetchInterval]=(0,react.useState)(2e3),refetchCounter=(0,react.useRef)(0),{data:supportedAssets,error:assetsError}=useScaffoldReadContract_useScaffoldReadContract({contractName:"VesuGateway",functionName:"get_supported_assets_ui",args:[poolId],refetchInterval:0});assetsError&&VesuProtocolView_console.error("Error fetching supported assets:",assetsError);const{data:userPositionsPart1,error:positionsError1,isFetching:isFetching1,refetch:refetchPositionsPart1}=useScaffoldReadContract_useScaffoldReadContract({contractName:"VesuGateway",functionName:"get_all_positions_range",args:[userAddress,poolId,0n,3n],watch:!0,refetchInterval:positionsRefetchInterval}),{data:userPositionsPart2,error:positionsError2,isFetching:isFetching2,refetch:refetchPositionsPart2}=useScaffoldReadContract_useScaffoldReadContract({contractName:"VesuGateway",functionName:"get_all_positions_range",args:[userAddress,poolId,3n,10n],watch:!0,refetchInterval:positionsRefetchInterval});positionsError1&&VesuProtocolView_console.error("Error fetching user positions (part 1):",positionsError1),positionsError2&&VesuProtocolView_console.error("Error fetching user positions (part 2):",positionsError2);const mergedUserPositions=(0,react.useMemo)(()=>[...userPositionsPart1||[],...userPositionsPart2||[]],[userPositionsPart1,userPositionsPart2]);(0,react.useEffect)(()=>{userAddress&&(refetchCounter.current+=1,refetchCounter.current>=3&&setPositionsRefetchInterval(5e3))},[mergedUserPositions,userAddress]);const isUpdating=isFetching1||isFetching2,refetchPositions=(0,react.useCallback)(()=>{userAddress&&(refetchPositionsPart1(),refetchPositionsPart2())},[userAddress,refetchPositionsPart1,refetchPositionsPart2]),[cachedPositions,setCachedPositions]=(0,react.useState)([]),[hasLoadedOnce,setHasLoadedOnce]=(0,react.useState)(!1);(0,react.useEffect)(()=>{refetchCounter.current=0,setPositionsRefetchInterval(2e3),setCachedPositions([]),setHasLoadedOnce(!1),userAddress&&refetchPositions()},[userAddress,refetchPositions]),(0,react.useEffect)(()=>{userAddress?isUpdating||(setCachedPositions(mergedUserPositions),setHasLoadedOnce(!0)):setCachedPositions([])},[mergedUserPositions,isUpdating,userAddress]),(0,react.useEffect)(()=>{const handler=()=>refetchPositions();return window.addEventListener("txCompleted",handler),()=>{window.removeEventListener("txCompleted",handler)}},[refetchPositions]);const positionRows=(0,react.useMemo)(()=>{if(!supportedAssets)return null;const positions=cachedPositions;return null==positions?void 0:positions.map((position,index)=>{const collateralAsset=`0x${position[0].toString(16).padStart(64,"0")}`,debtAsset=`0x${position[1].toString(16).padStart(64,"0")}`,positionData=position[2],assetsWithRates=supportedAssets.map(asset=>{if(0n==asset.scale)return{...asset,borrowAPR:0,supplyAPY:0};const{borrowAPR,supplyAPY}=toAnnualRates(asset.fee_rate,asset.total_nominal_debt,asset.last_rate_accumulator,asset.reserve,asset.scale);return{...asset,borrowAPR,supplyAPY}});return(0,jsx_runtime.jsx)(VesuPosition,{collateralAsset,debtAsset,collateralShares:positionData.collateral_shares.toString(),collateralAmount:positionData.collateral_amount.toString(),nominalDebt:positionData.nominal_debt.toString(),isVtoken:positionData.is_vtoken,supportedAssets:assetsWithRates,poolId},`${collateralAsset}-${debtAsset}-${index}`)})},[cachedPositions,supportedAssets,poolId]);return assetsError?(VesuProtocolView_console.error("Error fetching supported assets:",assetsError),(0,jsx_runtime.jsx)("div",{children:"Error loading markets"})):(0,jsx_runtime.jsxs)("div",{className:"w-full flex flex-col p-4 space-y-4",children:[(0,jsx_runtime.jsx)(VesuMarkets,{supportedAssets,viewMode:"grid",search:"",allowDeposit:!0}),(0,jsx_runtime.jsx)("div",{className:"card bg-base-100 shadow-md",children:(0,jsx_runtime.jsxs)("div",{className:"card-body p-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,jsx_runtime.jsx)("h2",{className:"card-title text-lg",children:"Your Positions"}),userAddress&&(null==positionRows?void 0:positionRows.length)?(0,jsx_runtime.jsxs)("div",{className:"text-right",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm text-gray-500",children:"Total Net Balance"}),(0,jsx_runtime.jsxs)("div",{className:"text-xl font-bold",children:["$",positionRows.reduce((total,position)=>{const collateralMetadata=position.props.supportedAssets.find(asset=>`0x${BigInt(asset.address).toString(16).padStart(64,"0")}`===position.props.collateralAsset),debtMetadata=position.props.supportedAssets.find(asset=>`0x${BigInt(asset.address).toString(16).padStart(64,"0")}`===position.props.debtAsset);if(!collateralMetadata)return total;const collateralValue=parseFloat(formatTokenAmount(position.props.collateralAmount,collateralMetadata.decimals))*parseFloat(formatTokenAmount(collateralMetadata.price.value.toString(),18));let debtValue=0;if("0"!==position.props.nominalDebt&&debtMetadata){debtValue=parseFloat(formatTokenAmount(position.props.nominalDebt,18))*parseFloat(formatTokenAmount(debtMetadata.price.value.toString(),18))}return total+(collateralValue-debtValue)},0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}):null]}),(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap gap-4 justify-start ",children:"connecting"===status||userAddress&&!hasLoadedOnce?(0,jsx_runtime.jsx)("div",{className:"text-center py-4 w-full",children:(0,jsx_runtime.jsx)("span",{className:"loading loading-spinner"})}):userAddress?(null==positionRows?void 0:positionRows.length)?positionRows:(0,jsx_runtime.jsx)("div",{className:"text-center py-4 text-gray-500 w-full",children:"No positions found"}):(0,jsx_runtime.jsx)("div",{className:"text-center py-4 text-gray-500 w-full",children:"Connect your Starknet wallet to view"})})]})})]})};VesuProtocolView.__docgenInfo={description:"",methods:[],displayName:"VesuProtocolView"};const VesuProtocolView_stories={title:"Protocols/Vesu",component:VesuProtocolView},Default={},__namedExportsOrder=["Default"]}}]);