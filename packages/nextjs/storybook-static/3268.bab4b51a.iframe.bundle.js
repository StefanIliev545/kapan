"use strict";(self.webpackChunk_se_2_nextjs=self.webpackChunk_se_2_nextjs||[]).push([[3268],{"./node_modules/@safe-global/safe-apps-sdk/dist/esm/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{default:()=>esm});const dec2hex=dec=>dec.toString(16).padStart(2,"0"),generateRequestId=()=>"undefined"!=typeof window?(len=>{const arr=new Uint8Array((len||40)/2);return window.crypto.getRandomValues(arr),Array.from(arr,dec2hex).join("")})(10):(new Date).getTime().toString(36);class MessageFormatter{}var Methods,RestrictedMethods;MessageFormatter.makeRequest=(method,params)=>({id:generateRequestId(),method,params,env:{sdkVersion:"9.1.0"}}),MessageFormatter.makeResponse=(id,data,version)=>({id,success:!0,version,data}),MessageFormatter.makeErrorResponse=(id,error,version)=>({id,success:!1,error,version}),function(Methods){Methods.sendTransactions="sendTransactions",Methods.rpcCall="rpcCall",Methods.getChainInfo="getChainInfo",Methods.getSafeInfo="getSafeInfo",Methods.getTxBySafeTxHash="getTxBySafeTxHash",Methods.getSafeBalances="getSafeBalances",Methods.signMessage="signMessage",Methods.signTypedMessage="signTypedMessage",Methods.getEnvironmentInfo="getEnvironmentInfo",Methods.getOffChainSignature="getOffChainSignature",Methods.requestAddressBook="requestAddressBook",Methods.wallet_getPermissions="wallet_getPermissions",Methods.wallet_requestPermissions="wallet_requestPermissions"}(Methods||(Methods={})),function(RestrictedMethods){RestrictedMethods.requestAddressBook="requestAddressBook"}(RestrictedMethods||(RestrictedMethods={}));var console=__webpack_require__("./node_modules/console-browserify/index.js");const communication=class PostMessageCommunicator{constructor(allowedOrigins=null,debugMode=!1){this.allowedOrigins=null,this.callbacks=new Map,this.debugMode=!1,this.isServer="undefined"==typeof window,this.isValidMessage=({origin,data,source})=>{const emptyOrMalformed=!data,sentFromParentEl=!this.isServer&&source===window.parent,majorVersionNumber=void 0!==data.version&&parseInt(data.version.split(".")[0]),allowedSDKVersion="number"==typeof majorVersionNumber&&majorVersionNumber>=1;let validOrigin=!0;return Array.isArray(this.allowedOrigins)&&(validOrigin=void 0!==this.allowedOrigins.find(regExp=>regExp.test(origin))),!emptyOrMalformed&&sentFromParentEl&&allowedSDKVersion&&validOrigin},this.logIncomingMessage=msg=>{console.info(`Safe Apps SDK v1: A message was received from origin ${msg.origin}. `,msg.data)},this.onParentMessage=msg=>{this.isValidMessage(msg)&&(this.debugMode&&this.logIncomingMessage(msg),this.handleIncomingMessage(msg.data))},this.handleIncomingMessage=payload=>{const{id}=payload,cb=this.callbacks.get(id);cb&&(cb(payload),this.callbacks.delete(id))},this.send=(method,params)=>{const request=MessageFormatter.makeRequest(method,params);if(this.isServer)throw new Error("Window doesn't exist");return window.parent.postMessage(request,"*"),new Promise((resolve,reject)=>{this.callbacks.set(request.id,response=>{response.success?resolve(response):reject(new Error(response.error))})})},this.allowedOrigins=allowedOrigins,this.debugMode=debugMode,this.isServer||window.addEventListener("message",this.onParentMessage)}},isObjectEIP712TypedData=obj=>"object"==typeof obj&&null!=obj&&"domain"in obj&&"types"in obj&&"message"in obj;__webpack_require__("./node_modules/@safe-global/safe-gateway-typescript-sdk/dist/index.js");class TXs{constructor(communicator){this.communicator=communicator}async getBySafeTxHash(safeTxHash){if(!safeTxHash)throw new Error("Invalid safeTxHash");return(await this.communicator.send(Methods.getTxBySafeTxHash,{safeTxHash})).data}async signMessage(message){const messagePayload={message};return(await this.communicator.send(Methods.signMessage,messagePayload)).data}async signTypedMessage(typedData){if(!isObjectEIP712TypedData(typedData))throw new Error("Invalid typed data");return(await this.communicator.send(Methods.signTypedMessage,{typedData})).data}async send({txs,params}){if(!txs||!txs.length)throw new Error("No transactions were passed");const messagePayload={txs,params};return(await this.communicator.send(Methods.sendTransactions,messagePayload)).data}}const RPC_CALLS_eth_call="eth_call",RPC_CALLS_eth_gasPrice="eth_gasPrice",RPC_CALLS_eth_getLogs="eth_getLogs",RPC_CALLS_eth_getBalance="eth_getBalance",RPC_CALLS_eth_getCode="eth_getCode",RPC_CALLS_eth_getBlockByHash="eth_getBlockByHash",RPC_CALLS_eth_getBlockByNumber="eth_getBlockByNumber",RPC_CALLS_eth_getStorageAt="eth_getStorageAt",RPC_CALLS_eth_getTransactionByHash="eth_getTransactionByHash",RPC_CALLS_eth_getTransactionReceipt="eth_getTransactionReceipt",RPC_CALLS_eth_getTransactionCount="eth_getTransactionCount",RPC_CALLS_eth_estimateGas="eth_estimateGas",RPC_CALLS_safe_setSettings="safe_setSettings",inputFormatters={defaultBlockParam:(arg="latest")=>arg,returnFullTxObjectParam:(arg=!1)=>arg,blockNumberToHex:arg=>Number.isInteger(arg)?`0x${arg.toString(16)}`:arg};class Eth{constructor(communicator){this.communicator=communicator,this.call=this.buildRequest({call:RPC_CALLS_eth_call,formatters:[null,inputFormatters.defaultBlockParam]}),this.getBalance=this.buildRequest({call:RPC_CALLS_eth_getBalance,formatters:[null,inputFormatters.defaultBlockParam]}),this.getCode=this.buildRequest({call:RPC_CALLS_eth_getCode,formatters:[null,inputFormatters.defaultBlockParam]}),this.getStorageAt=this.buildRequest({call:RPC_CALLS_eth_getStorageAt,formatters:[null,inputFormatters.blockNumberToHex,inputFormatters.defaultBlockParam]}),this.getPastLogs=this.buildRequest({call:RPC_CALLS_eth_getLogs}),this.getBlockByHash=this.buildRequest({call:RPC_CALLS_eth_getBlockByHash,formatters:[null,inputFormatters.returnFullTxObjectParam]}),this.getBlockByNumber=this.buildRequest({call:RPC_CALLS_eth_getBlockByNumber,formatters:[inputFormatters.blockNumberToHex,inputFormatters.returnFullTxObjectParam]}),this.getTransactionByHash=this.buildRequest({call:RPC_CALLS_eth_getTransactionByHash}),this.getTransactionReceipt=this.buildRequest({call:RPC_CALLS_eth_getTransactionReceipt}),this.getTransactionCount=this.buildRequest({call:RPC_CALLS_eth_getTransactionCount,formatters:[null,inputFormatters.defaultBlockParam]}),this.getGasPrice=this.buildRequest({call:RPC_CALLS_eth_gasPrice}),this.getEstimateGas=transaction=>this.buildRequest({call:RPC_CALLS_eth_estimateGas})([transaction]),this.setSafeSettings=this.buildRequest({call:RPC_CALLS_safe_setSettings})}buildRequest(args){const{call,formatters}=args;return async params=>{formatters&&Array.isArray(params)&&formatters.forEach((formatter,i)=>{formatter&&(params[i]=formatter(params[i]))});const payload={call,params:params||[]};return(await this.communicator.send(Methods.rpcCall,payload)).data}}}var encodeFunctionData=__webpack_require__("./node_modules/viem/_esm/utils/abi/encodeFunctionData.js"),hashMessage=__webpack_require__("./node_modules/viem/_esm/utils/signature/hashMessage.js"),hashTypedData=__webpack_require__("./node_modules/viem/_esm/utils/signature/hashTypedData.js");class PermissionsError extends Error{constructor(message,code,data){super(message),this.code=code,this.data=data,Object.setPrototypeOf(this,PermissionsError.prototype)}}class Wallet{constructor(communicator){this.communicator=communicator}async getPermissions(){return(await this.communicator.send(Methods.wallet_getPermissions,void 0)).data}async requestPermissions(permissions){if(!this.isPermissionRequestValid(permissions))throw new PermissionsError("Permissions request is invalid",4001);try{return(await this.communicator.send(Methods.wallet_requestPermissions,permissions)).data}catch{throw new PermissionsError("Permissions rejected",4001)}}isPermissionRequestValid(permissions){return permissions.every(pr=>"object"==typeof pr&&Object.keys(pr).every(method=>!!Object.values(RestrictedMethods).includes(method)))}}const hasPermission=(required,permissions)=>permissions.some(permission=>permission.parentCapability===required),requirePermissions=()=>(_,propertyKey,descriptor)=>{const originalMethod=descriptor.value;return descriptor.value=async function(){const wallet=new Wallet(this.communicator);let currentPermissions=await wallet.getPermissions();if(hasPermission(propertyKey,currentPermissions)||(currentPermissions=await wallet.requestPermissions([{[propertyKey]:{}}])),!hasPermission(propertyKey,currentPermissions))throw new PermissionsError("Permissions rejected",4001);return originalMethod.apply(this)},descriptor};var __decorate=function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r};class Safe{constructor(communicator){this.communicator=communicator}async getChainInfo(){return(await this.communicator.send(Methods.getChainInfo,void 0)).data}async getInfo(){return(await this.communicator.send(Methods.getSafeInfo,void 0)).data}async experimental_getBalances({currency="usd"}={}){return(await this.communicator.send(Methods.getSafeBalances,{currency})).data}async check1271Signature(messageHash,signature="0x"){const safeInfo=await this.getInfo(),encodedIsValidSignatureCall=(0,encodeFunctionData.p)({abi:[{constant:!1,inputs:[{name:"_dataHash",type:"bytes32"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[messageHash,signature]}),payload={call:RPC_CALLS_eth_call,params:[{to:safeInfo.safeAddress,data:encodedIsValidSignatureCall},"latest"]};try{return"0x1626ba7e"===(await this.communicator.send(Methods.rpcCall,payload)).data.slice(0,10).toLowerCase()}catch(err){return!1}}async check1271SignatureBytes(messageHash,signature="0x"){const safeInfo=await this.getInfo(),encodedIsValidSignatureCall=(0,encodeFunctionData.p)({abi:[{constant:!1,inputs:[{name:"_data",type:"bytes"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[messageHash,signature]}),payload={call:RPC_CALLS_eth_call,params:[{to:safeInfo.safeAddress,data:encodedIsValidSignatureCall},"latest"]};try{return"0x20c13b0b"===(await this.communicator.send(Methods.rpcCall,payload)).data.slice(0,10).toLowerCase()}catch(err){return!1}}calculateMessageHash(message){return(0,hashMessage.A)(message)}calculateTypedMessageHash(typedMessage){const chainId="object"==typeof typedMessage.domain.chainId?typedMessage.domain.chainId.toNumber():Number(typedMessage.domain.chainId);let primaryType=typedMessage.primaryType;if(!primaryType){const fields=Object.values(typedMessage.types),primaryTypes=Object.keys(typedMessage.types).filter(typeName=>fields.every(dataTypes=>dataTypes.every(({type})=>type.replace("[","").replace("]","")!==typeName)));if(0===primaryTypes.length||primaryTypes.length>1)throw new Error("Please specify primaryType");primaryType=primaryTypes[0]}return(0,hashTypedData.Zh)({message:typedMessage.message,domain:{...typedMessage.domain,chainId,verifyingContract:typedMessage.domain.verifyingContract,salt:typedMessage.domain.salt},types:typedMessage.types,primaryType})}async getOffChainSignature(messageHash){return(await this.communicator.send(Methods.getOffChainSignature,messageHash)).data}async isMessageSigned(message,signature="0x"){let check;if("string"==typeof message&&(check=async()=>{const messageHash=this.calculateMessageHash(message);return await this.isMessageHashSigned(messageHash,signature)}),isObjectEIP712TypedData(message)&&(check=async()=>{const messageHash=this.calculateTypedMessageHash(message);return await this.isMessageHashSigned(messageHash,signature)}),check){return await check()}throw new Error("Invalid message type")}async isMessageHashSigned(messageHash,signature="0x"){const checks=[this.check1271Signature.bind(this),this.check1271SignatureBytes.bind(this)];for(const check of checks){if(await check(messageHash,signature))return!0}return!1}async getEnvironmentInfo(){return(await this.communicator.send(Methods.getEnvironmentInfo,void 0)).data}async requestAddressBook(){return(await this.communicator.send(Methods.requestAddressBook,void 0)).data}}__decorate([requirePermissions()],Safe.prototype,"requestAddressBook",null);const esm=class SafeAppsSDK{constructor(opts={}){const{allowedDomains=null,debug=!1}=opts;this.communicator=new communication(allowedDomains,debug),this.eth=new Eth(this.communicator),this.txs=new TXs(this.communicator),this.safe=new Safe(this.communicator),this.wallet=new Wallet(this.communicator)}}}}]);