import{j as t}from"./jsx-runtime-CcWEvojh.js";import{a as is,i as Na,B as ds,F as Ba,n as _t,b as dr,e as cr,D as cs,W as ur}from"./vesu-BXi_Whr0.js";import{r as o}from"./index-Bk_d_yAU.js";import{a as St,L as mr}from"./TokenActionModal-DgAAeYOn.js";import{u as It,i as pr,a as fr,b as hr,c as br,F as Oe,g as gr,d as yr,e as fn,f as hn,M as xr,B as us,A as vr,h as wr,j as kr,s as Cr,k as Nr,l as jr,w as ms,m as ps,n as fs,o as Lt,p as bn,q as Fa,r as Sr,t as Vr,v as Ar,x as _r,y as Nt,z as qr,C as Lr,D as _n,E as hs,G as bs,H as gs,I as ys,J as xs,K as ia,L as gn,N as da,O as vs,P as ca,Q as Ot,R as ws,S as ja,T as Pr,U as Ir}from"./useScaffoldMultiWriteContract-BRZiB8p-.js";import{J as Mt,l as F,u as Sa,K as ks,M as Cs}from"./createSafeContext-Dp97sAkz.js";import{t as he}from"./index-CXgENQ1a.js";import{u as Ns,b as Mr,a as Tr}from"./useNetworkAwareReadContract-Ec4-o16J.js";import{f as Br,e as Pt,a as Da,b as Fr,l as yt,g as yn}from"./protocols-CRHRSpKz.js";import{g as at}from"./protocol-B00D1UZQ.js";import{t as Rt}from"./externalContracts-_f_8pMJw.js";import{I as Be}from"./next-image-DV_ejeD4.js";import{S as xn,u as vn}from"./Constants-BRuV1-4o.js";import{E as js,W as qt}from"./ErrorDisplay-1gvgOhys.js";import{B as Ss,L as Dr}from"./Loading-Bz06Coe0.js";import{F as Vs}from"./XMarkIcon-BMRVPuHu.js";import{p as Va,a as jt}from"./validation-DM-NIpAK.js";import{G as Et,C as Ut,u as As,n as zt,z as Ce,T as Xe}from"./en_US-YBXRRIY6-ByhZuFgc.js";import{q as Ge,r as Ye,k as Ht,j as Ia,l as qn}from"./SelectedGasTokenContext-BLwdQCB-.js";import{f as Rr}from"./formatPercentage-BDNxS5DB.js";import{A as Or,m as Ln}from"./proxy-6mTkzaM5.js";import"./store-CUKCto7f.js";import{g as wn,a as _s}from"./contract-CleVho0y.js";import{F as Aa}from"./InformationCircleIcon-uxtQsYC6.js";import"./networks-DgHYYcb8.js";import"./index-kA4PVysc.js";import"./_commonjsHelpers-CE1G-McA.js";import"./clsx-B-dksMZM.js";import"./prepareAuthorization-7YKPcvtF.js";import"./_interop_require_default-BLfEiHrE.js";import"./ExclamationTriangleIcon-CGJHvwPy.js";import"./iframe-BtPwi0O8.js";import"./index-DWCZ5U4L.js";import"./index-C0udIITE.js";function Er({title:e,titleId:a,...n},s){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":a},n),e?o.createElement("title",{id:a},e):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3"}))}const Ur=o.forwardRef(Er);function $r({title:e,titleId:a,...n},s){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":a},n),e?o.createElement("title",{id:a},e):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const qs=o.forwardRef($r);function Wr({title:e,titleId:a,...n},s){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":a},n),e?o.createElement("title",{id:a},e):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const Ls=o.forwardRef(Wr),zr=15e3,Hr=6e4,Ra={all:["tokenPrice"],single:e=>[...Ra.all,"single",e.toLowerCase()],batch:e=>[...Ra.all,"batch",e.map(a=>a.toLowerCase()).sort().join(",")]};async function Qr(e){if(!e?.trim())return 0;const a=new URLSearchParams;a.set("symbol",e.trim());const n=await fetch(`/api/tokenPrice?${a.toString()}`);if(!n.ok)throw new Error(`HTTP ${n.status}`);const s=await n.json();return typeof s?.price=="number"?s.price:0}function Kr(e,a){const n=!!e?.trim(),s=Mt({queryKey:Ra.single(e),queryFn:()=>Qr(e),enabled:n,staleTime:zr,gcTime:Hr,retry:2,retryDelay:1e3}),r=s.data??0;return{price:r,priceRaw:Gr(r),isLoading:s.isLoading,isError:s.isError,isSuccess:s.isSuccess,error:s.error?.message??null,refetch:()=>{s.refetch()}}}function Gr(e){return!e||!isFinite(e)||e<=0?BigInt(0):BigInt(Math.round(e*1e8))}function Yr(e){const a=Kr(e);return{status:a.isLoading?"loading":a.isSuccess?"success":a.isError?"error":"idle",price:a.price,error:a.error??void 0,isLoading:a.isLoading,isError:a.isError,isSuccess:a.isSuccess,refetch:a.refetch}}const Oa="kapan_order_notes",Pn=100,Xr="kapan:order-created";function Jr(){typeof window>"u"||window.dispatchEvent(new CustomEvent(Xr))}function Zr(){if(typeof window>"u")return{};try{const e=localStorage.getItem(Oa);return e?JSON.parse(e):{}}catch(e){return console.warn("[orderNotes] Failed to read from localStorage:",e),{}}}function Ps(e){if(!(typeof window>"u"))try{const a=Zr(),n=e.orderHash||e.salt;if(!n){console.warn("[orderNotes] Note has no orderHash or salt, skipping save");return}a[n]=e;const s=Object.entries(a);if(s.length>Pn){s.sort((l,i)=>i[1].createdAt-l[1].createdAt);const r=Object.fromEntries(s.slice(0,Pn));localStorage.setItem(Oa,JSON.stringify(r))}else localStorage.setItem(Oa,JSON.stringify(a));Jr()}catch(a){console.warn("[orderNotes] Failed to save to localStorage:",a)}}function eo(e,a,n,s,r){return{orderHash:"",salt:e,operationType:"debt_swap",description:`Debt swap: ${n} → ${s}`,protocol:a,sellToken:s,buyToken:n,chainId:r,createdAt:Date.now()}}function to(e,a,n,s,r){return{orderHash:"",salt:e,operationType:"collateral_swap",description:`Collateral swap: ${n} → ${s}`,protocol:a,sellToken:n,buyToken:s,chainId:r,createdAt:Date.now()}}const ao=1200;function no(e){return Math.floor(Date.now()/1e3)+e}function so(){return no(ao)}const ua=({isOpen:e,onClose:a,token:n,protocolName:s,currentDebt:r,position:l,chainId:i,context:d})=>{const{buildBorrowFlow:c}=It(),{balance:u,decimals:f}=is(n.address,"evm",i,n.decimals),b=s.toLowerCase();n.decimals==null&&(n.decimals=f);const m=o.useCallback(P=>c(b,n.address,P,n.decimals||f||18,d),[c,d,f,b,n.address,n.decimals]),{handleConfirm:h,batchingPreference:g}=Na({isOpen:e,chainId:i,onClose:a,buildFlow:m,successMessage:"Borrow transaction sent",emptyFlowErrorMessage:"Failed to build borrow instructions"}),{enabled:x,setEnabled:y,isLoaded:N}=g,w=o.useCallback(()=>t.jsx(ds,{enabled:x,setEnabled:y,isLoaded:N}),[x,y,N]);return t.jsx(St,{isOpen:e,onClose:a,action:"Borrow",token:n,protocolName:s,apyLabel:"Borrow APY",apy:n.currentRate,metricLabel:"Total debt",before:r,balance:u,network:"evm",chainId:i,position:l,onConfirm:h,renderExtraContent:w})};try{ua.displayName="BorrowModal",ua.__docgenInfo={description:"",displayName:"BorrowModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},token:{defaultValue:null,description:"",name:"token",required:!0,type:{name:"TokenInfo"}},protocolName:{defaultValue:null,description:"",name:"protocolName",required:!0,type:{name:"string"}},currentDebt:{defaultValue:null,description:"",name:"currentDebt",required:!0,type:{name:"number"}},position:{defaultValue:null,description:"",name:"position",required:!1,type:{name:"PositionManager"}},chainId:{defaultValue:null,description:"",name:"chainId",required:!1,type:{name:"number"}},context:{defaultValue:null,description:"Pre-encoded protocol context (e.g., Morpho MarketParams, Compound market address)",name:"context",required:!1,type:{name:"string"}}}}}catch{}const Ma={action:"Repay",apyLabel:"Borrow APY",metricLabel:"Total debt"},ro=({token:e,debtBalance:a,walletBalance:n,decimals:s})=>{const r=s??e.decimals??18,l=o.useMemo(()=>r?Number(F(a,r)):0,[a,r]),i=o.useMemo(()=>a*101n/100n,[a]),d=o.useMemo(()=>n<i?n:i,[n,i]);return{before:l,maxInput:d,bumpedDebt:i,effectiveDecimals:r}},oo=(e,a)=>{e.decimals==null&&a!=null&&(e.decimals=a)},Ea=({isOpen:e,onClose:a,token:n,protocolName:s,debtBalance:r,position:l,chainId:i,context:d})=>{const{balance:c,decimals:u}=is(n.address,"evm",i,n.decimals),{buildRepayFlowAsync:f}=It(),b=s.toLowerCase();oo(n,u);const{before:m,maxInput:h,effectiveDecimals:g}=ro({token:n,debtBalance:r,walletBalance:c,decimals:u}),x=o.useCallback((O,B)=>f(b,n.address,O,g,B,h,d),[f,d,g,h,b,n.address]),{handleConfirm:y,batchingPreference:N}=Na({isOpen:e,chainId:i,onClose:a,buildFlow:x,successMessage:"Repay transaction sent",emptyFlowErrorMessage:"Failed to build repay instructions or no balance to repay",chainSwitchErrorMessage:"Please switch to the selected network to proceed"}),{enabled:w,setEnabled:P,isLoaded:I}=N,D=o.useCallback(()=>t.jsx(ds,{enabled:w,setEnabled:P,isLoaded:I}),[w,P,I]);return t.jsx(St,{isOpen:e,onClose:a,action:Ma.action,token:n,protocolName:s,apyLabel:Ma.apyLabel,apy:n.currentRate,metricLabel:Ma.metricLabel,before:m,balance:c,percentBase:r,max:h,network:"evm",chainId:i,position:l,onConfirm:y,renderExtraContent:D})};try{Ea.displayName="RepayModal",Ea.__docgenInfo={description:"",displayName:"RepayModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},token:{defaultValue:null,description:"",name:"token",required:!0,type:{name:"TokenInfo"}},protocolName:{defaultValue:null,description:"",name:"protocolName",required:!0,type:{name:"string"}},debtBalance:{defaultValue:null,description:"",name:"debtBalance",required:!0,type:{name:"bigint"}},position:{defaultValue:null,description:"",name:"position",required:!1,type:{name:"PositionManager"}},chainId:{defaultValue:null,description:"",name:"chainId",required:!1,type:{name:"number"}},context:{defaultValue:null,description:"Pre-encoded protocol context (e.g., Morpho MarketParams, Compound market address)",name:"context",required:!1,type:{name:"string"}}}}}catch{}const lo={aave:"AaveGatewayView",compound:"CompoundGatewayView",venus:"VenusGatewayView",zerolend:"ZeroLendGatewayView",spark:"SparkGatewayView"};function io(e){return e.toLowerCase().replace(/\s+v\d+$/i,"").replace(/\s+/g,"")}function Is(e,a="AaveGatewayView"){const n=io(e);return lo[n]||a}const co=(e,a,n,s,r)=>{const l=Is(a),{data:i,isLoading:d}=Ns({contractName:l,functionName:"getPossibleCollaterals",args:[e,n],chainId:r,query:{enabled:s}});if(!i)return{collaterals:[],isLoading:d};const[c,u,f,b]=i;return{collaterals:c.map((h,g)=>{const x=BigInt(u[g]);return{symbol:f[g],rawBalance:x,balance:Number(F(x,b[g])),address:h,decimals:Number(b[g])}}),isLoading:d}},Ms=(e,a,n,s,r)=>{const[l,i]=o.useState({}),d=Is(e),{data:c,isLoading:u}=Ns({contractName:d,functionName:"getSupportedCollaterals",args:[a],chainId:r,query:{enabled:s}});return o.useEffect(()=>{if(!c||n.length===0)return;const f=new Set(c.map(h=>h.toLowerCase())),b={};for(const h of n){const g=h.toLowerCase();b[h]=f.has(g)}(Object.keys(b).some(h=>b[h]!==l[h])||Object.keys(b).length!==Object.keys(l).length)&&i(b)},[c,n,l]),{isLoading:u,supportedCollaterals:l}};function kn({protocolName:e,userAddress:a,isOpen:n,vesuV1PoolId:s,vesuV2PoolAddress:r}){const l=e==="Vesu"?"VesuGateway":e==="VesuV2"?"VesuGatewayV2":"NostraGateway",{data:i,isLoading:d}=Mr({contractName:l,functionName:"get_supported_assets_info",args:e==="Vesu"?[a,s??0n]:e==="VesuV2"?[a,r??0n]:[a],enabled:n&&!!a,watch:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1}),[c,u]=o.useState(!1);o.useEffect(()=>{!c&&Array.isArray(i)&&u(!0)},[i,c]);const f=o.useRef([]);o.useEffect(()=>{Array.isArray(i)&&i.length>0&&(f.current=i)},[i]);const b=Array.isArray(i)?i:f.current;return{collaterals:Array.isArray(b)?b.map(h=>{const{0:g,1:x,2:y,3:N}=h;let w=0n;N&&typeof N=="object"&&"low"in N&&"high"in N?w=BigInt(N.low)+(BigInt(N.high)<<128n):(typeof N=="bigint"||typeof N=="number")&&(w=BigInt(N));const P=y?Number(y):18;return{address:`0x${BigInt(g).toString(16).padStart(64,"0")}`,symbol:Br(typeof x=="bigint"?x:BigInt(x)),decimals:P,supported:!0,balance:w&&P?Number(w)/10**P:0,rawBalance:w}}):[],isLoading:d&&!c}}const ma={Genesis:2198503327643286920898110335698706244522220458610657370981979460625005526824n,CarmineRunes:0x05ed7f4a51687a544b1a596dc5b30743dbd0b633197e5de9f6281cdf64f8a44bn,Re7StarknetEcosystem:0x06febb313566c48e30614ddab092856a9ab35b80f359868ca69b2649ca5d148dn,Re7xSTRK:0x052fb52363939c3aa848f8f4ac28f0a51379f8d1b971d8444de25fbd77d8f161n},pa={Prime:"0x0451fe483d5921a2919ddd81d0de6696669bccdacd859f72a4fba7656b97c3b5",Re7xBTC:"0x03a8416bf20d036df5b1cf3447630a2e1cb04685f6b0c3a70ed7fb1473548ecf",Re7USDCCore:"0x03976cac265a12609934089004df458ea29c776d77da423c96dc761d09d24124",Re7USDCPrime:"0x02eef0c13b10b487ea5916b54c0a7f98ec43fb3048f60fdeedaf5b08f6f88aaf",Re7USDCStableCore:"0x073702fce24aba36da1eac539bd4bae62d4d6a76747b7cdd3e016da754d7a135"},uo=e=>Object.entries(ma).find(([,n])=>n===e)?.[0]??"Unknown",mo=e=>{const a=e.toLowerCase();return Object.entries(pa).find(([,s])=>s.toLowerCase()===a)?.[0]??"Unknown"},Qt=e=>JSON.stringify(e,(a,n)=>typeof n=="bigint"?n.toString():n);function _a(e){const{isOpen:a,networkType:n,fromProtocol:s,chainId:r,position:l}=e,{address:i}=Sa(),d="0x0000000000000000000000000000000000000000",c=o.useMemo(()=>({name:s,logo:at(s)}),[s]),u=l.name,f=Rt(l.name.toLowerCase()),{debtMaxRaw:b,debtMaxLabel:m}=o.useMemo(()=>{try{if(typeof l.balance=="bigint"){const j=F(l.balance,l.decimals),Y=j.startsWith("-")?j.slice(1):j,[C,M=""]=Y.split("."),A=M?`${C}.${M.slice(0,6).replace(/0+$/,"")}`:C;return{debtMaxRaw:Y,debtMaxLabel:A}}else if(typeof l.balance=="number"){const Y=Math.abs(l.balance).toString(),[C,M=""]=Y.split("."),A=M?`${C}.${M.slice(0,6).replace(/0+$/,"")}`:C;return{debtMaxRaw:Y,debtMaxLabel:A}}}catch{}return{debtMaxRaw:void 0,debtMaxLabel:void 0}},[l.balance,l.decimals]),h=o.useMemo(()=>{if(n==="evm"){const j=[{name:"Aave V3",logo:at("Aave V3")},{name:"Compound V3",logo:at("Compound V3")}];return pr(r)&&j.push({name:"Spark",logo:at("Spark")}),fr(r)&&j.push({name:"Morpho Blue",logo:at("Morpho Blue")}),hr(r)&&j.push({name:"ZeroLend",logo:at("ZeroLend")}),br(r)&&j.push({name:"Venus",logo:at("Venus")}),j.filter(Y=>Y.name.toLowerCase()!==s.toLowerCase())}return[{name:"Vesu",logo:at("Vesu")},{name:"VesuV2",logo:at("VesuV2")},{name:"Nostra",logo:at("Nostra")}].filter(j=>!(j.name.toLowerCase()==="nostra"&&s.toLowerCase()==="nostra"))},[s,n,r]),[g,x]=o.useState([]),[y,N]=o.useState(!1),[w,P]=o.useState(void 0),{collaterals:I,isLoading:D}=co(l.tokenAddress,s,i||d,a&&n==="evm",r),{isLoading:O,supportedCollaterals:B}=Ms(h[0]?.name||"",l.tokenAddress,o.useMemo(()=>I.map(j=>j.address),[I]),a&&n==="evm"&&I.length>0,r),{data:v}=Tr({networkType:"evm",contractName:"UiHelper",functionName:"get_asset_prices",args:[o.useMemo(()=>[...I.map(j=>j.address),l.tokenAddress],[I,l.tokenAddress])],query:{enabled:a&&n==="evm"&&I.length>0}}),H=o.useMemo(()=>{if(!v||n!=="evm")return;const j=v,Y=[...I.map(C=>C.address),l.tokenAddress];return j.reduce((C,M,A)=>(C[Y[A]?.toLowerCase()]=M,C),{})},[v,I,l.tokenAddress,n]),S=o.useRef({evmCollaterals:"",supportedCollaterals:"",tokenToPrices:""});o.useEffect(()=>{if(n!=="evm")return;const j=Qt(I),Y=Qt(B),C=Qt(H);if(S.current.evmCollaterals===j&&S.current.supportedCollaterals===Y&&S.current.tokenToPrices===C)return;N(D||O);const M=I.map(A=>({address:A.address,symbol:A.symbol,icon:Rt(A.symbol.toLowerCase()),decimals:A.decimals,rawBalance:A.rawBalance,balance:A.balance,usdPrice:H?.[A.address.toLowerCase()]}));x(M),P(B),S.current={evmCollaterals:j,supportedCollaterals:Y,tokenToPrices:C}},[n,I,D,O,B,H]);const ce=kn({protocolName:n==="starknet"?s:"Vesu",userAddress:"",isOpen:n==="starknet"&&a}),{collaterals:J,isLoading:E}=n==="starknet"?ce:{collaterals:[],isLoading:!1},_=o.useRef({starkCollaterals:""});o.useEffect(()=>{if(n!=="starknet")return;const j=Qt(J);if(_.current.starkCollaterals===j)return;N(E);const Y=J.map(C=>({address:C.address,symbol:C.symbol,icon:Rt(C.symbol.toLowerCase()),decimals:C.decimals,rawBalance:C.rawBalance,balance:C.balance}));x(Y),P(void 0),_.current.starkCollaterals=j},[J,E,n]);const R=o.useMemo(()=>n!=="evm"?[{name:"Vesu",version:"v1",icon:"/logos/vesu.svg",providerEnum:Oe.BalancerV2,feeBps:0}]:gr(r),[n,r]),k=o.useMemo(()=>R[0],[R]),X=o.useMemo(()=>{if(n!=="starknet")return;const j=Object.entries(ma).map(([C,M])=>({name:C,id:M})),Y=Object.entries(pa).map(([C,M])=>({name:C,address:M}));return{v1Pools:j,v2Pools:Y}},[n]);return{debtSymbol:u,debtIcon:f,debtMaxRaw:b,debtMaxLabel:m,sourceProtocol:c,collaterals:g,isLoadingCollaterals:y,supportedCollateralMap:w,tokenToPrices:H,destinationProtocols:h,flashLoanProviders:R,defaultFlashLoanProvider:k,vesuPools:X}}const Ta=e=>(e??"").toLowerCase(),Ts=e=>{const[a,n]=o.useState(""),[s,r]=o.useState(!1),[l,i]=o.useState(!1),[d,c]=o.useState("protocol"),[u,f]=o.useState(""),[b,m]=o.useState(void 0),[h,g]=o.useState("v1"),[x,y]=o.useState(null),[N,w]=o.useState(""),[P,I]=o.useState(!1),[D,O]=o.useState({}),[B,v]=o.useState({}),[H,S]=o.useState(!1),[ce,J]=o.useState(!1),[E,_]=o.useState(!1),[R,k]=o.useState(null),[X,j]=o.useState(null);o.useEffect(()=>{u!=="Morpho Blue"&&(k(null),j(null))},[u]),o.useEffect(()=>{if(u==="Morpho Blue"&&R){const M=R.collateralAsset?.address?.toLowerCase(),A=Object.keys(D).map(ee=>ee.toLowerCase());M&&!A.includes(M)&&(k(null),j(null))}},[u,R,D]);const Y=o.useCallback(()=>{e||(n(""),r(!1),i(!1),c("protocol"),y(null),w(""),I(!1),O({}),v({}),_(!1),S(!1),k(null),j(null))},[e]),C=o.useCallback((M,A)=>{k(M),j(A)},[]);return{debtAmount:a,setDebtAmount:n,isDebtMaxClicked:s,setIsDebtMaxClicked:r,debtConfirmed:l,setDebtConfirmed:i,activeTab:d,setActiveTab:c,selectedProtocol:u,setSelectedProtocol:f,selectedProvider:b,setSelectedProvider:m,selectedVersion:h,setSelectedVersion:g,expandedCollateral:x,setExpandedCollateral:y,tempAmount:N,setTempAmount:w,tempIsMax:P,setTempIsMax:o.useCallback(M=>{I(M),x&&v(A=>A[x]===M?A:{...A,[x]:M})},[x]),addedCollaterals:D,setAddedCollaterals:O,collateralIsMaxMap:B,setCollateralIsMaxMap:v,isSubmitting:H,setIsSubmitting:S,preferBatching:ce,setPreferBatching:J,autoSelectedDest:E,setAutoSelectedDest:_,selectedMorphoMarket:R,setSelectedMorphoMarket:k,morphoContext:X,setMorphoContext:j,onMorphoMarketSelect:C,resetState:Y,onCollateralTileClick:o.useCallback(M=>{const A=Ta(M);y(ee=>ee===A?null:A),w(""),I(!1)},[]),onAddCollateral:o.useCallback((M,A)=>{const ee=Ta(M),Z=(N||"").trim(),oe=Number(Z);if(!Z||!Number.isFinite(oe)||oe<=0)return;const L=Math.max(1e-12,Math.abs(A)*1e-9),U=Math.abs(oe-A)<=L;O(Q=>Q[ee]===Z?Q:{...Q,[ee]:Z});const $=P||U;v(Q=>Q[ee]===$?Q:{...Q,[ee]:$}),y(null),w(""),I(!1)},[N,P]),onRemoveCollateral:o.useCallback(M=>{const A=Ta(M);O(ee=>{const Z={...ee};return delete Z[A],Z}),v(ee=>{const Z={...ee};return delete Z[A],Z})},[])}},po=(e,a=!1)=>{const n=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.abs(e));return a?e>=0?n:`-${n}`:e>=0?n:`-${n}`},lt=po,Ua=({sellToken:e,buyToken:a,sellAmount:n,buyAmount:s,sellAmountUsd:r,buyAmountUsd:l})=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Be,{src:e.icon,alt:e.name,width:24,height:24,className:"size-6"}),t.jsxs("div",{children:[t.jsxs("div",{className:"text-base font-medium",children:[Pt(n.toString(),e.decimals)," ",e.name]}),r!==void 0&&t.jsx("div",{className:"text-[11px] text-gray-500",children:lt(r)})]})]}),t.jsx("div",{className:"text-gray-400",children:"→"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Be,{src:a.icon,alt:a.name,width:24,height:24,className:"size-6"}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"text-base font-medium",children:[Pt(s.toString(),a.decimals)," ",a.name]}),l!==void 0&&t.jsx("div",{className:"text-[11px] text-gray-500",children:lt(l)})]})]})]}),$a=({fees:e,showFeesInToken:a=!0})=>{const n=(e.aggregatorFeeUsd??0)+(e.integratorFeeUsd??0)+(e.gasFeeUsd??0);return t.jsxs("div",{className:"space-y-1 border-t border-gray-100 pt-2",children:[t.jsxs("div",{className:"flex justify-between text-[12px]",children:[t.jsx("span",{className:"text-gray-600",children:"Aggregator fee"}),t.jsxs("span",{children:[a&&t.jsxs(t.Fragment,{children:[Pt(e.aggregatorFee.toString(),e.feeToken.decimals)," ",e.feeToken.name,t.jsx("span",{className:"text-gray-500",children:" · "})]}),t.jsx("span",{className:"text-gray-500",children:e.aggregatorFeeUsd!==void 0?lt(e.aggregatorFeeUsd):"-"})]})]}),e.integratorFee!==void 0&&e.integratorFee>0n&&t.jsxs("div",{className:"flex justify-between text-[12px]",children:[t.jsx("span",{className:"text-gray-600",children:"Integrator fee"}),t.jsxs("span",{children:[a&&t.jsxs(t.Fragment,{children:[Pt(e.integratorFee.toString(),e.feeToken.decimals)," ",e.feeToken.name,t.jsx("span",{className:"text-gray-500",children:" · "})]}),t.jsx("span",{className:"text-gray-500",children:e.integratorFeeUsd!==void 0?lt(e.integratorFeeUsd):"-"})]})]}),t.jsxs("div",{className:"flex justify-between text-[12px]",children:[t.jsx("span",{className:"text-gray-600",children:"Network fee"}),t.jsx("span",{className:"text-gray-700",children:e.gasFeeUsd!==void 0?lt(e.gasFeeUsd):"-"})]}),t.jsxs("div",{className:"flex justify-between text-[12px]",children:[t.jsx("span",{className:"text-gray-600",children:"Total fees (USD)"}),t.jsx("span",{className:"text-gray-700",children:lt(n)})]})]})},Wa=({token:e,remainderInfo:a,action:n})=>t.jsxs("div",{className:"border-t border-gray-100 pt-2",children:[t.jsx("div",{className:"mb-1 text-[12px] text-gray-600",children:"Withdraw"}),t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Be,{src:e.icon,alt:e.name,width:20,height:20,className:"size-5"}),t.jsxs("div",{children:[t.jsxs("div",{className:"text-base font-medium",children:[a.remainderFormatted," ",e.name]}),a.remainderUsd!==void 0&&t.jsx("div",{className:"text-[11px] text-gray-500",children:lt(a.remainderUsd)})]})]}),n]})]}),In=({collateral:e,debt:a,sellAmount:n,buyAmount:s,sellAmountUsd:r,buyAmountUsd:l,fees:i,remainderInfo:d,withdrawAction:c,additionalContent:u})=>t.jsxs("div",{className:"space-y-3",children:[t.jsx(Ua,{sellToken:e,buyToken:a,sellAmount:n,buyAmount:s,sellAmountUsd:r,buyAmountUsd:l}),t.jsx($a,{fees:i}),u,d&&t.jsx(Wa,{token:e,remainderInfo:d,action:c})]});try{Ua.displayName="SwapExchangeDisplay",Ua.__docgenInfo={description:"Displays the swap exchange: sell token -> buy token",displayName:"SwapExchangeDisplay",props:{sellToken:{defaultValue:null,description:"Token being sold (collateral)",name:"sellToken",required:!0,type:{name:"ClosePositionToken"}},buyToken:{defaultValue:null,description:"Token being bought (debt token)",name:"buyToken",required:!0,type:{name:"ClosePositionToken"}},sellAmount:{defaultValue:null,description:"Amount being sold",name:"sellAmount",required:!0,type:{name:"bigint"}},buyAmount:{defaultValue:null,description:"Amount being bought",name:"buyAmount",required:!0,type:{name:"bigint"}},sellAmountUsd:{defaultValue:null,description:"USD value of sell amount",name:"sellAmountUsd",required:!1,type:{name:"number"}},buyAmountUsd:{defaultValue:null,description:"USD value of buy amount",name:"buyAmountUsd",required:!1,type:{name:"number"}}}}}catch{}try{$a.displayName="FeeBreakdownDisplay",$a.__docgenInfo={description:"Displays the fee breakdown for a swap",displayName:"FeeBreakdownDisplay",props:{fees:{defaultValue:null,description:"",name:"fees",required:!0,type:{name:"SwapFeeBreakdown"}},showFeesInToken:{defaultValue:{value:"true"},description:"Optional: show fees in debt token (for reswap scenarios)",name:"showFeesInToken",required:!1,type:{name:"boolean"}}}}}catch{}try{Wa.displayName="WithdrawRemainderDisplay",Wa.__docgenInfo={description:"Displays the remainder amount to be withdrawn after swap",displayName:"WithdrawRemainderDisplay",props:{token:{defaultValue:null,description:"Token being withdrawn (collateral)",name:"token",required:!0,type:{name:"ClosePositionToken"}},remainderInfo:{defaultValue:null,description:"Remainder info from useClosePositionQuote",name:"remainderInfo",required:!0,type:{name:"RemainderInfo"}},action:{defaultValue:null,description:"Action button or content to render on the right",name:"action",required:!1,type:{name:"ReactNode"}}}}}catch{}try{In.displayName="ClosePositionSummary",In.__docgenInfo={description:`Complete close position summary component
Combines swap exchange, fees, and withdraw remainder displays`,displayName:"ClosePositionSummary",props:{collateral:{defaultValue:null,description:"Token being sold (collateral)",name:"collateral",required:!0,type:{name:"ClosePositionToken"}},debt:{defaultValue:null,description:"Token being bought (debt)",name:"debt",required:!0,type:{name:"ClosePositionToken"}},sellAmount:{defaultValue:null,description:"Amount being sold",name:"sellAmount",required:!0,type:{name:"bigint"}},buyAmount:{defaultValue:null,description:"Amount being bought",name:"buyAmount",required:!0,type:{name:"bigint"}},sellAmountUsd:{defaultValue:null,description:"USD values",name:"sellAmountUsd",required:!1,type:{name:"number"}},buyAmountUsd:{defaultValue:null,description:"",name:"buyAmountUsd",required:!1,type:{name:"number"}},fees:{defaultValue:null,description:"Fee breakdown",name:"fees",required:!0,type:{name:"SwapFeeBreakdown"}},remainderInfo:{defaultValue:null,description:"Remainder info (optional - show withdraw section if provided)",name:"remainderInfo",required:!1,type:{name:"RemainderInfo | null"}},withdrawAction:{defaultValue:null,description:"Action button for the withdraw section",name:"withdrawAction",required:!1,type:{name:"ReactNode"}},additionalContent:{defaultValue:null,description:"Additional content after fees",name:"additionalContent",required:!1,type:{name:"ReactNode"}}}}}catch{}const fo=e=>"avnu"in e,ho=({swap:e})=>t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Swap"}),t.jsxs("span",{className:"flex items-center gap-2 font-medium",children:[t.jsx(Be,{src:e.sellToken.icon,alt:e.sellToken.name,width:20,height:20,className:"rounded-full"}),Pt(e.sellAmount.toString(),e.sellToken.decimals)," ",e.sellToken.name]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Receive"}),t.jsxs("span",{className:"flex items-center gap-2 font-medium",children:[t.jsx(Be,{src:e.buyToken.icon,alt:e.buyToken.name,width:20,height:20,className:"rounded-full"}),Pt(e.buyAmount.toString(),e.buyToken.decimals)," ",e.buyToken.name]})]})]}),za=({fees:e,className:a=""})=>{const n=fo(e),s=n?e.avnu:e.avnuFeesInUsd??0,r=n?e.integrator:e.integratorFeesInUsd??0,l=n?e.gas:e.gasFeesInUsd??0;return t.jsxs("div",{className:`border-base-300 text-base-content/70 space-y-1 border-t pt-2 text-xs ${a}`,children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:n?"Total AVNU fees":"AVNU fee"}),t.jsx("span",{children:lt(s)})]}),r>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:n?"Total integrator fees":"Integrator fee"}),t.jsx("span",{children:lt(r)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:n?"Total network fees":"Network fee"}),t.jsx("span",{children:lt(l)})]})]})},Mn=({swaps:e,fees:a,className:n="",showSwaps:s=!0})=>{const r=Array.isArray(e)?e:[e];return t.jsxs("div",{className:`bg-base-200/60 space-y-3 rounded-md p-3 text-sm ${n}`,children:[s&&r.map((l,i)=>t.jsx(ho,{swap:l},`${l.sellToken.name}-${l.buyToken.name}-${i}`)),t.jsx(za,{fees:a,className:s?"":"border-t-0 pt-0"})]})};try{za.displayName="SwapFeeSummary",za.__docgenInfo={description:`Standalone fee summary component for displaying swap fees.
Use this when you have custom swap display but want consistent fee formatting.`,displayName:"SwapFeeSummary",props:{fees:{defaultValue:null,description:"Fees can be provided directly or aggregated from multiple swaps",name:"fees",required:!0,type:{name:"SwapFees | AggregatedFees"}},className:{defaultValue:{value:""},description:"Optional className for the container",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{Mn.displayName="SwapQuoteSummary",Mn.__docgenInfo={description:"",displayName:"SwapQuoteSummary",props:{swaps:{defaultValue:null,description:"Single swap or array of swaps to display",name:"swaps",required:!0,type:{name:"SwapQuoteItem | SwapQuoteItem[]"}},fees:{defaultValue:null,description:"Fees can be provided directly or aggregated from multiple swaps",name:"fees",required:!0,type:{name:"SwapFees | AggregatedFees"}},className:{defaultValue:{value:""},description:"Optional className for the container",name:"className",required:!1,type:{name:"string"}},showSwaps:{defaultValue:{value:"true"},description:"Whether to show swap details (default: true)",name:"showSwaps",required:!1,type:{name:"boolean"}}}}}catch{}const Tn=({title:e,onClose:a,subtitle:n,centerContent:s,className:r="",showCloseButton:l=!0})=>t.jsxs("div",{className:`border-base-200 mb-4 flex items-center justify-between border-b pb-3 ${r}`,children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-base-content text-lg font-semibold",children:e}),n&&t.jsx("span",{className:"text-base-content/50 text-xs uppercase tracking-wider",children:n})]}),s]}),l&&t.jsx("button",{onClick:a,className:"text-base-content/40 hover:text-base-content hover:bg-base-200 rounded-lg p-1.5 transition-colors","aria-label":"Close modal",children:t.jsx(Vs,{className:"size-5"})})]}),Bn=({title:e,onClose:a,subtitle:n,className:s="",showCloseButton:r=!0})=>t.jsxs("div",{className:`mb-3 flex items-center justify-between ${s}`,children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-base-content text-lg font-semibold",children:e}),n&&t.jsx("span",{className:"text-base-content/50 text-xs",children:n})]}),r&&t.jsx("button",{className:"text-base-content/40 hover:text-base-content hover:bg-base-200 rounded-lg p-1.5 transition-colors",onClick:a,"aria-label":"Close modal",children:t.jsx(Vs,{className:"size-5"})})]});try{Tn.displayName="ModalHeader",Tn.__docgenInfo={description:`Shared modal header component with title and close button.

Usage:
\`\`\`tsx
<ModalHeader title="Select Token" onClose={handleClose} />
<ModalHeader title="Swap" subtitle="Aave V3" onClose={handleClose} />
<ModalHeader
  title="Settings"
  centerContent={<TabButtons />}
  onClose={handleClose}
/>
\`\`\``,displayName:"ModalHeader",props:{title:{defaultValue:null,description:"Modal title displayed on the left",name:"title",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"Close handler for the X button",name:"onClose",required:!0,type:{name:"() => void"}},subtitle:{defaultValue:null,description:"Optional subtitle or protocol name displayed below or beside the title",name:"subtitle",required:!1,type:{name:"string"}},centerContent:{defaultValue:null,description:"Optional custom content to render between title and close button (e.g., tabs)",name:"centerContent",required:!1,type:{name:"ReactNode"}},className:{defaultValue:{value:""},description:"Optional class name for the header container",name:"className",required:!1,type:{name:"string"}},showCloseButton:{defaultValue:{value:"true"},description:"Whether to show the close button (default: true)",name:"showCloseButton",required:!1,type:{name:"boolean"}}}}}catch{}try{Bn.displayName="ModalHeaderMinimal",Bn.__docgenInfo={description:`Minimal modal header without border - just title and close button inline.
Useful for simpler modals like token selectors.`,displayName:"ModalHeaderMinimal",props:{className:{defaultValue:{value:""},description:"Optional class name for the header container",name:"className",required:!1,type:{name:"string"}},subtitle:{defaultValue:null,description:"Optional subtitle or protocol name displayed below or beside the title",name:"subtitle",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"Modal title displayed on the left",name:"title",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"Close handler for the X button",name:"onClose",required:!0,type:{name:"() => void"}},showCloseButton:{defaultValue:{value:"true"},description:"Whether to show the close button (default: true)",name:"showCloseButton",required:!1,type:{name:"boolean"}}}}}catch{}const Fn=({actionLabel:e,onAction:a,isActionDisabled:n=!1,isLoading:s=!1,cancelLabel:r,onCancel:l,actionIcon:i,className:d="",leftContent:c,useSegmentedBar:u=!0})=>{const f=o.useMemo(()=>[{key:"action",label:e,icon:s?t.jsx("span",{className:"loading loading-spinner loading-xs"}):i,onClick:a,disabled:n||s,variant:"ghost"}],[e,s,i,a,n]);return u?t.jsxs("div",{className:`modal-action pt-2 ${d}`,children:[c&&t.jsx("div",{className:"flex-1",children:c}),t.jsx(xn,{className:c?"flex-1":"w-full",autoCompact:!0,actions:f})]}):t.jsxs("div",{className:`flex justify-end gap-3 pt-4 ${d}`,children:[c&&t.jsx("div",{className:"flex-1",children:c}),r&&l&&t.jsx("button",{className:"text-base-content/60 hover:text-base-content px-4 py-2 text-sm font-medium transition-colors",onClick:l,disabled:s,children:r}),t.jsxs("button",{className:"bg-base-content text-base-100 hover:bg-base-content/90 flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-colors disabled:cursor-not-allowed disabled:opacity-50",onClick:a,disabled:n||s,children:[s&&t.jsx("span",{className:"loading loading-spinner loading-xs"}),i&&!s&&i,e]})]})},Dn=({confirmLabel:e="Confirm",cancelLabel:a="Cancel",onConfirm:n,onCancel:s,isConfirmDisabled:r=!1,isLoading:l=!1,className:i=""})=>t.jsxs("div",{className:`mt-6 flex justify-end gap-3 ${i}`,children:[t.jsx("button",{className:"text-base-content/60 hover:text-base-content px-4 py-2 text-sm font-medium transition-colors",onClick:s,disabled:l,children:a}),t.jsxs("button",{className:"bg-base-content text-base-100 hover:bg-base-content/90 flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-colors disabled:cursor-not-allowed disabled:opacity-50",onClick:n,disabled:r||l,children:[l&&t.jsx("span",{className:"loading loading-spinner loading-xs"}),e]})]});try{Fn.displayName="ModalFooter",Fn.__docgenInfo={description:`Shared modal footer component with action buttons.

Usage:
\`\`\`tsx
// Simple action button
<ModalFooter actionLabel="Submit" onAction={handleSubmit} />

// With cancel button
<ModalFooter
  actionLabel="Confirm"
  onAction={handleConfirm}
  cancelLabel="Cancel"
  onCancel={handleClose}
/>

// With loading state and left content
<ModalFooter
  actionLabel="Processing..."
  onAction={handleSubmit}
  isLoading={true}
  leftContent={<BatchingPreference {...} />}
/>
\`\`\``,displayName:"ModalFooter",props:{actionLabel:{defaultValue:null,description:"Primary action button label",name:"actionLabel",required:!0,type:{name:"string"}},onAction:{defaultValue:null,description:"Primary action click handler",name:"onAction",required:!0,type:{name:"() => void"}},isActionDisabled:{defaultValue:{value:"false"},description:"Whether the action button is disabled",name:"isActionDisabled",required:!1,type:{name:"boolean"}},isLoading:{defaultValue:{value:"false"},description:"Whether the action is currently in progress (shows loading state)",name:"isLoading",required:!1,type:{name:"boolean"}},cancelLabel:{defaultValue:{value:"Cancel"},description:"Optional cancel button label (if provided, cancel button is shown)",name:"cancelLabel",required:!1,type:{name:"string"}},onCancel:{defaultValue:null,description:"Cancel button click handler",name:"onCancel",required:!1,type:{name:"(() => void)"}},actionIcon:{defaultValue:null,description:"Optional icon to show in the action button",name:"actionIcon",required:!1,type:{name:"ReactNode"}},className:{defaultValue:{value:""},description:"Optional class name for the footer container",name:"className",required:!1,type:{name:"string"}},leftContent:{defaultValue:null,description:"Optional content to render before the buttons (e.g., batching preferences)",name:"leftContent",required:!1,type:{name:"ReactNode"}},useSegmentedBar:{defaultValue:{value:"true"},description:"Use SegmentedActionBar style (default: true)",name:"useSegmentedBar",required:!1,type:{name:"boolean"}}}}}catch{}try{Dn.displayName="ModalFooterConfirm",Dn.__docgenInfo={description:`Simple cancel/confirm footer with two buttons side by side.
Common pattern for confirmation dialogs.`,displayName:"ModalFooterConfirm",props:{confirmLabel:{defaultValue:{value:"Confirm"},description:"",name:"confirmLabel",required:!1,type:{name:"string"}},cancelLabel:{defaultValue:{value:"Cancel"},description:"",name:"cancelLabel",required:!1,type:{name:"string"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"() => void"}},onCancel:{defaultValue:null,description:"",name:"onCancel",required:!0,type:{name:"() => void"}},isConfirmDisabled:{defaultValue:{value:"false"},description:"",name:"isConfirmDisabled",required:!1,type:{name:"boolean"}},isLoading:{defaultValue:{value:"false"},description:"",name:"isLoading",required:!1,type:{name:"boolean"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}const Rn=({value:e,onChange:a,decimals:n,balance:s,percentBase:r,max:l,usdPrice:i=0,disabled:d=!1,placeholder:c="0.0",showPercentButtons:u=!0,showMaxButton:f=!0,className:b="",inputClassName:m="",resetTrigger:h,insufficientFunds:g=!1,tokenSymbol:x})=>{const[y,N]=o.useState(null);o.useEffect(()=>{N(null),a("",!1)},[h]);const w=o.useCallback(H=>{const ce=(r??s)*BigInt(H)/100n,J=F(ce,n);N(H),a(J,H===100)},[s,n,a,r]),P=o.useCallback(()=>{const S=F(l??r??s,n);N(100),a(S,!0)},[s,n,l,a,r]),I=o.useCallback(H=>{let ce=Va(H||"0",n).value??0n;const E=l??(r??s);let _=H;E>0n&&ce>=E&&(ce=E,_=F(E,n)),N(null),a(_,!1)},[s,n,l,a,r]),D=o.useMemo(()=>(parseFloat(e||"0")*i).toFixed(2),[e,i]),O=u?[25,50,100]:f?[100]:[],B=o.useCallback(H=>I(H.target.value),[I]),v=o.useCallback(H=>()=>{H===100&&f&&!u?P():w(H)},[P,w,f,u]);return t.jsxs("div",{className:b,children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"number",value:e,onChange:B,placeholder:c,disabled:d,className:`bg-base-200/50 border-base-300/50 text-base-content placeholder:text-base-content/30 focus:border-base-content/30 w-full rounded-lg border px-4 py-3 focus:outline-none ${O.length>0?"pr-24":""} ${m}`}),g&&t.jsx("div",{className:"absolute -top-4 right-1 z-10",children:t.jsx("span",{className:"badge badge-error badge-sm whitespace-nowrap",children:"Insufficient funds"})}),O.length>0&&t.jsx("div",{className:"divide-base-300 absolute inset-y-0 right-3 flex items-center divide-x text-xs",children:O.map(H=>t.jsx("button",{type:"button",onClick:v(H),disabled:d,className:`px-1 ${y===H?"underline":""} ${d?"opacity-50":""}`,children:H===100&&f&&!u?"MAX":`${H}%`},H))})]}),i>0&&t.jsxs("div",{className:"mt-1 text-center text-xs opacity-70",children:["≈ $",D]})]})},On=({value:e,onChange:a,onMax:n,balance:s,decimals:r,usdPrice:l,disabled:i=!1,placeholder:d="0.00",className:c="",showMaxButton:u=!0})=>{const f=o.useMemo(()=>l?(parseFloat(e||"0")*l).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):null,[e,l]),b=o.useCallback(m=>a(m.target.value),[a]);return t.jsxs("div",{className:c,children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("input",{type:"number",value:e,onChange:b,placeholder:d,disabled:i,className:"border-base-300 w-full border-0 border-b-2 bg-transparent px-2 py-1 pr-16 text-right font-medium outline-none"}),u&&t.jsx("button",{onClick:n,disabled:i,className:`text-primary hover:text-primary-focus absolute right-0 top-1/2 -translate-y-1/2 text-xs font-bold ${i?"cursor-not-allowed opacity-50":""}`,children:"MAX"})]}),f&&t.jsx("div",{className:"mt-1 flex justify-end",children:t.jsxs("span",{className:"text-base-content/60 text-xs",children:["≈ $",f]})})]})};try{Rn.displayName="AmountInput",Rn.__docgenInfo={description:`Shared amount input component with max button and optional percentage buttons.

Features:
- Input field with number validation
- MAX button to set maximum amount
- Optional percentage buttons (25%, 50%, 100%)
- USD value display
- Automatic value limiting to max
- Insufficient funds warning
- Reset on trigger change`,displayName:"AmountInput",props:{value:{defaultValue:null,description:'Current value in human-readable format (e.g., "1.5")',name:"value",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"Called when the value changes",name:"onChange",required:!0,type:{name:"(value: string, isMax: boolean) => void"}},decimals:{defaultValue:null,description:"Token/balance decimals for parsing/formatting",name:"decimals",required:!0,type:{name:"number"}},balance:{defaultValue:null,description:"Raw balance in bigint for percentage calculations",name:"balance",required:!0,type:{name:"bigint"}},percentBase:{defaultValue:null,description:"Optional base for percentage calculations (defaults to balance)",name:"percentBase",required:!1,type:{name:"bigint"}},max:{defaultValue:null,description:"Optional maximum value (limits input)",name:"max",required:!1,type:{name:"bigint"}},usdPrice:{defaultValue:{value:"0"},description:"Optional USD price for value display",name:"usdPrice",required:!1,type:{name:"number"}},disabled:{defaultValue:{value:"false"},description:"Whether the input is disabled",name:"disabled",required:!1,type:{name:"boolean"}},placeholder:{defaultValue:{value:"0.00"},description:"Placeholder text",name:"placeholder",required:!1,type:{name:"string"}},showPercentButtons:{defaultValue:{value:"true"},description:"Show percentage buttons (25%, 50%, 100%)",name:"showPercentButtons",required:!1,type:{name:"boolean"}},showMaxButton:{defaultValue:{value:"true"},description:"Show MAX button only (no percentage buttons)",name:"showMaxButton",required:!1,type:{name:"boolean"}},className:{defaultValue:{value:""},description:"Custom class name for the container",name:"className",required:!1,type:{name:"string"}},inputClassName:{defaultValue:{value:""},description:"Custom class name for the input",name:"inputClassName",required:!1,type:{name:"string"}},resetTrigger:{defaultValue:null,description:"Optional trigger to reset the input (e.g., modal open state)",name:"resetTrigger",required:!1,type:{name:"string | number | boolean"}},insufficientFunds:{defaultValue:{value:"false"},description:"Show insufficient funds warning",name:"insufficientFunds",required:!1,type:{name:"boolean"}},tokenSymbol:{defaultValue:null,description:"Token symbol for display next to MAX button",name:"tokenSymbol",required:!1,type:{name:"string"}}}}}catch{}try{On.displayName="SimpleAmountInput",On.__docgenInfo={description:"Simplified amount input with just MAX button (for swap modals, etc.)",displayName:"SimpleAmountInput",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(value: string) => void"}},onMax:{defaultValue:null,description:"",name:"onMax",required:!0,type:{name:"() => void"}},balance:{defaultValue:null,description:"",name:"balance",required:!0,type:{name:"bigint"}},decimals:{defaultValue:null,description:"",name:"decimals",required:!0,type:{name:"number"}},usdPrice:{defaultValue:{value:"0"},description:"",name:"usdPrice",required:!1,type:{name:"number"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},placeholder:{defaultValue:{value:"0.00"},description:"",name:"placeholder",required:!1,type:{name:"string"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}},showMaxButton:{defaultValue:{value:"true"},description:"",name:"showMaxButton",required:!1,type:{name:"boolean"}}}}}catch{}const En=({label:e,selectedToken:a,availableTokens:n,onTokenChange:s,readOnly:r=!1,amount:l,onAmountChange:i,isOutput:d=!1,isLoading:c=!1,usdValue:u,showMax:f=!1,onMaxClick:b,showBalance:m=!0})=>{const h=o.useCallback(x=>{i&&i(x.target.value)},[i]),g=o.useCallback(x=>{const y=n.find(N=>N.symbol===x.target.value);y&&s&&s(y)},[n,s]);return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/80 text-sm",children:e}),m&&a&&t.jsxs("span",{className:"text-base-content/60 text-xs",children:["Available: ",F(a.rawBalance,a.decimals)]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[a&&t.jsx("div",{className:"relative size-8 flex-shrink-0",children:t.jsx(Be,{src:a.icon,alt:a.symbol,fill:!0,className:"rounded-full object-contain"})}),r||n.length<=1?t.jsx("div",{className:"min-w-[100px] font-medium",children:a?.symbol||"-"}):t.jsx("div",{className:"relative min-w-[100px]",children:t.jsx("select",{className:"select select-ghost select-sm w-full max-w-xs pl-0 font-medium focus:outline-none",value:a?.symbol||"",onChange:g,children:n.map(x=>t.jsx("option",{value:x.symbol,children:x.symbol},x.address))})}),t.jsx("div",{className:"relative flex-1",children:d?t.jsx("div",{className:"border-base-300 flex min-h-[32px] w-full items-center justify-end border-0 border-b-2 bg-transparent px-2 py-1 text-right font-medium outline-none",children:c?t.jsx("span",{className:"loading loading-dots loading-xs"}):parseFloat(l||"0").toFixed(6)}):t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:l,onChange:h,placeholder:"0.00",className:"border-base-300 w-full border-0 border-b-2 bg-transparent px-2 py-1 pr-16 text-right font-medium outline-none"}),f&&b&&t.jsx("button",{onClick:b,className:"text-primary hover:text-primary-focus absolute right-0 top-1/2 -translate-y-1/2 text-xs font-bold",children:"MAX"})]})})]}),u!==void 0&&t.jsx("div",{className:"flex justify-end",children:t.jsxs("span",{className:"text-base-content/60 text-xs",children:["≈"," $",u.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})})]})};try{En.displayName="TokenAmountInput",En.__docgenInfo={description:"",displayName:"TokenAmountInput",props:{label:{defaultValue:null,description:'Label for the section (e.g., "Swap From", "Debt to Repay")',name:"label",required:!0,type:{name:"string"}},selectedToken:{defaultValue:null,description:"Selected token",name:"selectedToken",required:!0,type:{name:"SwapAsset | null"}},availableTokens:{defaultValue:null,description:"All available tokens for selection",name:"availableTokens",required:!0,type:{name:"SwapAsset[]"}},onTokenChange:{defaultValue:null,description:"Callback when token changes",name:"onTokenChange",required:!1,type:{name:"((token: SwapAsset) => void)"}},readOnly:{defaultValue:{value:"false"},description:"Whether the token selector is read-only",name:"readOnly",required:!1,type:{name:"boolean"}},amount:{defaultValue:null,description:"Amount value",name:"amount",required:!0,type:{name:"string"}},onAmountChange:{defaultValue:null,description:"Callback when amount changes",name:"onAmountChange",required:!1,type:{name:"((value: string) => void)"}},isOutput:{defaultValue:{value:"false"},description:"Whether this is an output field (read-only amount)",name:"isOutput",required:!1,type:{name:"boolean"}},isLoading:{defaultValue:{value:"false"},description:"Loading state for output",name:"isLoading",required:!1,type:{name:"boolean"}},usdValue:{defaultValue:null,description:"USD value to display",name:"usdValue",required:!1,type:{name:"number"}},showMax:{defaultValue:{value:"false"},description:"Show MAX button",name:"showMax",required:!1,type:{name:"boolean"}},onMaxClick:{defaultValue:null,description:"Callback when MAX is clicked",name:"onMaxClick",required:!1,type:{name:"(() => void)"}},showBalance:{defaultValue:{value:"true"},description:"Show available balance",name:"showBalance",required:!1,type:{name:"boolean"}}}}}catch{}const fa=({value:e,onChange:a,limitAvailable:n=!0,limitReady:s=!0,limitDisabledReason:r,className:l=""})=>{const i=o.useCallback(()=>{a("market")},[a]),d=o.useCallback(()=>{a("limit")},[a]);if(!n)return null;const c=!s;return t.jsxs("div",{className:`bg-base-200/60 mx-auto flex w-fit gap-0.5 rounded-lg p-0.5 ${l}`,children:[t.jsx("button",{onClick:i,className:`rounded-md px-4 py-1.5 text-xs font-medium transition-colors ${e==="market"?"bg-base-100 text-base-content shadow-sm":"text-base-content/60 hover:text-base-content"}`,children:"Market"}),t.jsx("button",{onClick:d,className:`rounded-md px-4 py-1.5 text-xs font-medium transition-colors ${e==="limit"?"bg-base-100 text-base-content shadow-sm":"text-base-content/60 hover:text-base-content"} ${c?"opacity-50 cursor-not-allowed":""}`,disabled:c,title:c?r:"Execute via CoW Protocol limit order",children:"Limit"})]})};try{fa.displayName="ExecutionTypeToggle",fa.__docgenInfo={description:"",displayName:"ExecutionTypeToggle",props:{value:{defaultValue:null,description:"Current execution type",name:"value",required:!0,type:{name:"enum",value:[{value:'"market"'},{value:'"limit"'}]}},onChange:{defaultValue:null,description:"Callback when execution type changes",name:"onChange",required:!0,type:{name:"(type: ExecutionType) => void"}},limitAvailable:{defaultValue:{value:"true"},description:"Whether limit orders are available (e.g., CoW protocol supported)",name:"limitAvailable",required:!1,type:{name:"boolean"}},limitReady:{defaultValue:{value:"true"},description:"Whether limit order is ready (contracts deployed, etc.)",name:"limitReady",required:!1,type:{name:"boolean"}},limitDisabledReason:{defaultValue:null,description:"Optional tooltip for disabled limit button",name:"limitDisabledReason",required:!1,type:{name:"string"}},className:{defaultValue:{value:""},description:"Additional class name",name:"className",required:!1,type:{name:"string"}}}}}catch{}const Cn=[.01,.03,.05,.1,.3,.5,1,2,3,5],Un=.1,$n=.01,bo=5,Bs=e=>{if(e===null||e<=0)return $n;let a;e<.05?a=.01:e<.3?a=.02+e*.1:e<1?a=.05+e*.2:a=.1+e*.3;const n=e+a,s=n<.1?Math.round(n*100)/100:Math.round(n*10)/10;return Math.max($n,Math.min(s,bo))},Fs=e=>{if(e===null)return"low";const a=Math.abs(e);return a<.5?"low":a<2?"medium":"high"},Ds=e=>{switch(e){case"low":return"text-success";case"medium":return"text-warning";case"high":return"text-error"}},Rs=e=>e===null?"-":`${e>0?"-":e<0?"+":""}${Math.abs(e).toFixed(2)}%`,go=(e,a)=>e===null||a===null||e<=0?null:(e-a)/e*100,Os=({slippage:e,setSlippage:a,oneInchQuote:n,pendleQuote:s,swapRouter:r,resetDep:l,enabled:i=!0,srcUsdFallback:d,dstUsdFallback:c})=>{const u=o.useMemo(()=>{if(r==="pendle"&&s?.data?.priceImpact!==void 0)return Math.abs(s.data.priceImpact*100);if(r==="1inch"&&n){const g=n.srcUSD?parseFloat(n.srcUSD):d??null,x=n.dstUSD?parseFloat(n.dstUSD):c??null;return go(g,x)}return null},[r,s,n,d,c]),f=r==="1inch"?!!n:!!s;o.useEffect(()=>{if(i&&u!==null&&f){const g=Bs(u);e===Un&&a(g)}},[u,f,i,a,e]),o.useEffect(()=>{i&&a(Un)},[l,i,a]);const b=Fs(u),m=Ds(b),h=Rs(u);return{priceImpact:u,priceImpactSeverity:b,priceImpactColorClass:m,formattedPriceImpact:h}},Ha=({stats:e,columns:a,className:n=""})=>{const s=a||Math.min(4,e.length),r=s===2?"grid-cols-2":s===3?"grid-cols-3":"grid-cols-4";return t.jsx("div",{className:`grid ${r} bg-base-200/50 gap-3 rounded p-3 text-center text-xs ${n}`,children:e.map((l,i)=>t.jsxs("div",{children:[t.jsxs("div",{className:"text-base-content/70 flex items-center justify-center gap-1",children:[l.label,l.labelExtra]}),t.jsx("div",{className:`font-medium ${l.valueClassName||""}`,children:l.value})]},i))})},ha=({slippage:e,setSlippage:a,options:n=Cn})=>{const s=o.useCallback(r=>()=>a(r),[a]);return t.jsxs("div",{className:"dropdown dropdown-top dropdown-hover",children:[t.jsx("label",{tabIndex:0,className:"hover:text-primary cursor-pointer",children:t.jsx(Ls,{className:"size-3"})}),t.jsx("ul",{tabIndex:0,className:"dropdown-content menu bg-base-100 rounded-box z-[50] mb-1 w-32 p-2 text-xs shadow",children:n.map(r=>t.jsx("li",{children:t.jsxs("a",{className:e===r?"active":"",onClick:s(r),children:[r,"%"]})},r))})]})},Wn=({slippage:e,setSlippage:a,priceImpact:n,priceImpactClass:s="",formattedPriceImpact:r,exchangeRate:l,fromSymbol:i,toSymbol:d,expectedOutput:c,outputCoversRequired:u,className:f=""})=>{const b=o.useMemo(()=>{const m=[{label:"Slippage",value:`${e}%`,labelExtra:t.jsx(ha,{slippage:e,setSlippage:a})}];return n!=null&&m.push({label:"Price Impact",value:r||`${n.toFixed(2)}%`,valueClassName:s}),l&&i&&d&&m.push({label:"Rate",value:`1 ${i} = ${l} ${d}`}),c&&d&&m.push({label:"Output",value:`${c} ${d}`,valueClassName:u===!1?"text-warning":u===!0?"text-success":""}),m},[e,a,n,r,s,l,i,d,c,u]);return t.jsx(Ha,{stats:b,className:f})};try{Ha.displayName="SwapStatsGrid",Ha.__docgenInfo={description:"",displayName:"SwapStatsGrid",props:{stats:{defaultValue:null,description:"Stats to display",name:"stats",required:!0,type:{name:"SwapStatItem[]"}},columns:{defaultValue:null,description:"Number of columns (auto-calculated based on stats length if not provided)",name:"columns",required:!1,type:{name:"enum",value:[{value:"2"},{value:"3"},{value:"4"}]}},className:{defaultValue:{value:""},description:"Additional class name",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{ha.displayName="SlippageSelector",ha.__docgenInfo={description:"",displayName:"SlippageSelector",props:{slippage:{defaultValue:null,description:"Current slippage value",name:"slippage",required:!0,type:{name:"number"}},setSlippage:{defaultValue:null,description:"Callback when slippage changes",name:"setSlippage",required:!0,type:{name:"(value: number) => void"}},options:{defaultValue:{value:"[0.01, 0.03, 0.05, 0.1, 0.3, 0.5, 1, 2, 3, 5] as const"},description:"Available slippage options (defaults to SLIPPAGE_OPTIONS)",name:"options",required:!1,type:{name:"number[]"}}}}}catch{}try{Wn.displayName="MarketSwapStats",Wn.__docgenInfo={description:"",displayName:"MarketSwapStats",props:{slippage:{defaultValue:null,description:"Current slippage",name:"slippage",required:!0,type:{name:"number"}},setSlippage:{defaultValue:null,description:"Callback to change slippage",name:"setSlippage",required:!0,type:{name:"(value: number) => void"}},priceImpact:{defaultValue:null,description:"Price impact percentage",name:"priceImpact",required:!1,type:{name:"number | null"}},priceImpactClass:{defaultValue:{value:""},description:"Price impact CSS class",name:"priceImpactClass",required:!1,type:{name:"string"}},formattedPriceImpact:{defaultValue:null,description:"Formatted price impact string",name:"formattedPriceImpact",required:!1,type:{name:"string"}},exchangeRate:{defaultValue:null,description:'Exchange rate (e.g., "1 ETH = 2500 USDC")',name:"exchangeRate",required:!1,type:{name:"string"}},fromSymbol:{defaultValue:null,description:"From token symbol",name:"fromSymbol",required:!1,type:{name:"string"}},toSymbol:{defaultValue:null,description:"To token symbol",name:"toSymbol",required:!1,type:{name:"string"}},expectedOutput:{defaultValue:null,description:"Expected output amount",name:"expectedOutput",required:!1,type:{name:"string"}},outputCoversRequired:{defaultValue:null,description:"Whether output covers required amount",name:"outputCoversRequired",required:!1,type:{name:"boolean"}},className:{defaultValue:{value:""},description:"Additional class name",name:"className",required:!1,type:{name:"string"}}}}}catch{}const yo=us.v2Vault,xo=us.v3Vault,Kt=Et(["function balanceOf(address account) view returns (uint256)"]),vo=Et(["function getReserveData(address asset) view returns (uint256 configuration, uint128 liquidityIndex, uint128 currentLiquidityRate, uint128 currentVariableBorrowRate, uint128 currentStableBorrowRate, uint40 lastUpdateTimestamp, uint16 id, address aTokenAddress, address stableDebtTokenAddress, address variableDebtTokenAddress, address interestRateStrategyAddress, uint128 accruedToTreasury, uint128 unbacked, uint128 isolationModeTotalDebt)"]),Qa=({chainId:e,sellToken:a,totalAmount:n,onConfigChange:s,useFlashLoan:r,setUseFlashLoan:l,numChunks:i,setNumChunks:d,showFlashLoanToggle:c=!0,showChunksInput:u=!0,showProviderSelect:f=!0,defaultUseFlashLoan:b=!0,defaultChunks:m=1,compact:h=!1})=>{const g=o.useMemo(()=>yr(e),[e]),x=Ut({chainId:e}),[y,N]=o.useState(0),[w,P]=o.useState(b),[I,D]=o.useState(m),[O,B]=o.useState([]),[v,H]=o.useState(!1),S=o.useRef(!1),ce=o.useRef(void 0);o.useEffect(()=>{a.address!==ce.current&&(S.current=!1,ce.current=a.address)},[a.address]);const J=r!==void 0&&l!==void 0,E=J?r:w,_=J?l:P,R=i!==void 0?i:I,k=d||D;o.useEffect(()=>{(async()=>{if(!x||n===0n||g.length===0){B([]);return}H(!0);const $=[];for(const Q of g)try{let K=0n;if(Q.provider==="morpho"){const se=xr[e];se&&(K=await x.readContract({address:a.address,abi:Kt,functionName:"balanceOf",args:[se]}))}else if(Q.provider==="balancerV2")K=await x.readContract({address:a.address,abi:Kt,functionName:"balanceOf",args:[yo]});else if(Q.provider==="balancerV3")K=await x.readContract({address:a.address,abi:Kt,functionName:"balanceOf",args:[xo]});else if(Q.provider==="aaveV3"){const se=vr[e];if(se)try{const ye=(await x.readContract({address:se,abi:vo,functionName:"getReserveData",args:[a.address]}))[8];K=await x.readContract({address:a.address,abi:Kt,functionName:"balanceOf",args:[ye]})}catch{K=0n}}$.push({provider:Q,liquidity:K,hasLiquidity:K>=n,isLoading:!1})}catch(K){console.warn(`Failed to fetch liquidity for ${Q.name}:`,K),$.push({provider:Q,liquidity:0n,hasLiquidity:!1,isLoading:!1})}B($),H(!1)})()},[x,a.address,n,e,g]),o.useEffect(()=>{if(S.current||O.length===0||n===0n)return;const $=["morpho","balancerV2","balancerV3","aaveV3"].find(Q=>{const K=O.find(se=>se.provider.provider===Q);return K&&K.hasLiquidity});if($){const Q=g.findIndex(K=>K.provider===$);Q!==-1&&Q!==y&&N(Q)}},[O,n,g,y]);const X=o.useCallback(U=>{S.current=!0,N(U)},[]),j=o.useCallback(U=>{_(U.target.checked)},[_]),Y=o.useCallback(U=>{k(Math.max(1,Math.min(999,parseInt(U.target.value)||1)))},[k]),C=o.useCallback(U=>()=>X(U),[X]),M=o.useMemo(()=>g.length===0?null:g[y]||g[0],[g,y]),A=o.useMemo(()=>M?O.find(U=>U.provider.address===M.address):null,[M,O]),{chunkSize:ee,chunkSizes:Z,flashLoanFee:oe,explanation:L}=o.useMemo(()=>{if(n===0n||!E)return{chunkSize:n,chunkSizes:[n],flashLoanFee:0n,explanation:"Standard execution"};const U=n/BigInt(R),$=n%BigInt(R),Q=Array(R).fill(U).map((ge,ye)=>ye===R-1?ge+$:ge),K=M?fn(U,M.provider):0n,se=R===1?K>0n?`Single tx execution (fee: ${F(K,a.decimals)} ${a.symbol})`:"Single tx execution (no fee)":`${R} flash loan transactions (~30 min between chunks)`;return{chunkSize:U,chunkSizes:Q,flashLoanFee:K,explanation:se}},[n,R,E,M,a]);return o.useEffect(()=>{const U=M?hn(e,M.provider):null;s({selectedProvider:M,useFlashLoan:E,numChunks:R,chunkSize:ee,chunkSizes:Z,flashLoanLender:U?.address||null,flashLoanFee:oe,explanation:L})},[M,E,R,ee,Z,oe,L,e,s]),g.length===0?t.jsx("div",{className:`text-warning text-xs ${h?"":"p-2"}`,children:"Flash loans not available on this chain for limit orders"}):t.jsxs("div",{className:`flex flex-col gap-2 ${h?"":"p-2"}`,children:[f&&g.length>1&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-base-content/60 text-xs",children:"Flash Loan Provider"}),v&&t.jsx("span",{className:"loading loading-spinner loading-xs opacity-50"})]}),t.jsx("div",{className:"flex gap-1",children:g.map((U,$)=>{const Q=O.find(ge=>ge.provider.address===U.address),K=Q?.hasLiquidity??!0,se=Q&&!Q.hasLiquidity;return t.jsxs("button",{onClick:C($),className:`btn btn-xs ${y===$?se?"btn-warning":"btn-primary":se?"btn-ghost line-through opacity-40":"btn-ghost opacity-60 hover:opacity-100"}`,title:`${U.name} - ${U.feeBps===0?"No fee":`${U.feeBps/100}% fee`}${se?" (insufficient liquidity)":""}`,children:[U.name.replace(" Blue","").replace(" V2","").replace(" V3",""),U.feeBps===0&&K&&t.jsx("span",{className:"text-success ml-1 text-[9px]",children:"0%"}),se&&t.jsx("span",{className:"text-warning ml-1 text-[9px]",children:"!"})]},U.address)})})]}),f&&g.length===1&&M&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/60 text-xs",children:"Flash Loan Provider"}),t.jsxs("span",{className:"text-xs",children:[M.name,M.feeBps===0&&t.jsx("span",{className:"text-success ml-1",children:"(0% fee)"})]})]}),A&&!A.hasLiquidity&&n>0n&&t.jsxs("div",{className:"text-warning flex items-start gap-1.5 text-[10px]",children:[t.jsx("svg",{className:"mt-0.5 size-3 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),t.jsxs("span",{children:[M?.name," may not have enough ",a.symbol," liquidity. Try another provider."]})]}),c&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/60 text-xs",children:"Use Flash Loan"}),t.jsx("input",{type:"checkbox",checked:E,onChange:j,className:"toggle toggle-primary toggle-xs"})]}),u&&E&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/60 text-xs",children:"Chunks"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"number",min:1,max:999,value:R,onChange:Y,className:"input input-bordered input-xs w-16 text-right"}),R>1&&t.jsxs("span",{className:"text-base-content/50 text-[10px]",children:["~",F(ee,a.decimals)," ",a.symbol,"/chunk"]})]})]}),E&&t.jsxs("div",{className:"flex items-start gap-1.5 text-[10px]",children:[t.jsx("svg",{className:"text-success mt-0.5 size-3 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),t.jsxs("div",{children:[t.jsx("span",{className:"text-success font-medium",children:R===1?"Single transaction execution":`${R} flash loan transactions`}),t.jsxs("p",{className:"text-base-content/50 mt-0.5",children:[R===1?"Solver takes flash loan, swaps, you borrow to repay. All in one tx.":"Each chunk executes as independent flash loan. ~30 min between chunks for price discovery.",oe===0n&&" No flash loan fee."]})]})]})]})};try{Qa.displayName="LimitOrderConfig",Qa.__docgenInfo={description:`Reusable limit order configuration component.
Handles flash loan provider selection, chunking, and displays relevant info.

Can be used as controlled or uncontrolled:
- Controlled: Pass useFlashLoan/setUseFlashLoan and numChunks/setNumChunks
- Uncontrolled: Omit these props, component manages its own state`,displayName:"LimitOrderConfig",props:{chainId:{defaultValue:null,description:"Chain ID",name:"chainId",required:!0,type:{name:"number"}},sellToken:{defaultValue:null,description:"Token being sold (flash loaned)",name:"sellToken",required:!0,type:{name:"LimitOrderToken"}},totalAmount:{defaultValue:null,description:"Total amount to process",name:"totalAmount",required:!0,type:{name:"bigint"}},onConfigChange:{defaultValue:null,description:"Callback when configuration changes",name:"onConfigChange",required:!0,type:{name:"(config: LimitOrderResult) => void"}},useFlashLoan:{defaultValue:null,description:"Controlled: use flash loan state",name:"useFlashLoan",required:!1,type:{name:"boolean"}},setUseFlashLoan:{defaultValue:null,description:"Controlled: set use flash loan callback",name:"setUseFlashLoan",required:!1,type:{name:"((value: boolean) => void)"}},numChunks:{defaultValue:null,description:"Controlled: number of chunks",name:"numChunks",required:!1,type:{name:"number"}},setNumChunks:{defaultValue:null,description:"Controlled: set number of chunks callback",name:"setNumChunks",required:!1,type:{name:"((value: number) => void)"}},showFlashLoanToggle:{defaultValue:{value:"true"},description:"Show flash loan toggle (default: true)",name:"showFlashLoanToggle",required:!1,type:{name:"boolean"}},showChunksInput:{defaultValue:{value:"true"},description:"Show chunks input (default: true)",name:"showChunksInput",required:!1,type:{name:"boolean"}},showProviderSelect:{defaultValue:{value:"true"},description:"Show provider selector (default: true)",name:"showProviderSelect",required:!1,type:{name:"boolean"}},defaultUseFlashLoan:{defaultValue:{value:"true"},description:"Default use flash loan - only used if not controlled (default: true)",name:"defaultUseFlashLoan",required:!1,type:{name:"boolean"}},defaultChunks:{defaultValue:{value:"1"},description:"Default number of chunks - only used if not controlled (default: 1)",name:"defaultChunks",required:!1,type:{name:"number"}},compact:{defaultValue:{value:"false"},description:"Compact mode - less padding/margins",name:"compact",required:!1,type:{name:"boolean"}}}}}catch{}const zn=({chainId:e,sellToken:a,totalAmount:n,onConfigChange:s,limitOrderConfig:r,isCowQuoteLoading:l,slippage:i,setSlippage:d,showSlippage:c=!1,showBatchedToggle:u=!1,useBatchedTx:f,setUseBatchedTx:b,extraContent:m,className:h=""})=>{if(!a)return null;const g=r?.numChunks??1;return t.jsxs("div",{className:`bg-base-200/50 space-y-2 rounded-lg p-3 ${h}`,children:[t.jsxs("div",{className:"text-base-content/70 flex items-center gap-1 text-xs font-medium",children:[t.jsx(qs,{className:"size-3.5"}),"Limit Order Configuration"]}),t.jsx(Qa,{chainId:e,sellToken:a,totalAmount:n,onConfigChange:s,showFlashLoanToggle:!1,showChunksInput:!0,compact:!0}),g>1&&t.jsx(Ka,{numChunks:g}),l&&t.jsxs("div",{className:"text-base-content/60 mt-2 flex items-center gap-2 text-xs",children:[t.jsx("span",{className:"loading loading-spinner loading-xs"}),"Fetching CoW quote..."]}),m,c&&i!==void 0&&d&&t.jsxs("div",{className:"border-base-300/30 flex items-center justify-between border-t px-1 pt-2 text-xs",children:[t.jsx("span",{className:"text-base-content/70",children:"Slippage Buffer"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{children:[i,"%"]}),t.jsx(ha,{slippage:i,setSlippage:d})]})]}),u&&b&&t.jsx(Ga,{useBatchedTx:f??!1,setUseBatchedTx:b})]})},Ka=({numChunks:e,className:a=""})=>t.jsxs("div",{className:`mt-2 flex items-start gap-1.5 text-[10px] ${a}`,children:[t.jsx("svg",{className:"text-info mt-0.5 size-3 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),t.jsxs("div",{children:[t.jsxs("span",{className:"text-info font-medium",children:["Multi-chunk: ",e," iterations"]}),t.jsx("p",{className:"text-base-content/50 mt-0.5",children:"~30 min between chunks for price discovery."})]})]}),Ga=({useBatchedTx:e,setUseBatchedTx:a,className:n=""})=>{const s=o.useCallback(r=>a(r.target.checked),[a]);return t.jsxs("div",{className:`border-base-300/30 mt-2 flex items-center justify-between border-t pt-2 ${n}`,children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-base-content/60 text-xs",children:"Batched TX"}),t.jsx("span",{className:"text-base-content/40 text-[10px]",children:"(EIP-5792)"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-base-content/40 text-[10px]",children:e?"faster":"compatible"}),t.jsx("input",{type:"checkbox",checked:e,onChange:s,className:"toggle toggle-xs toggle-primary"})]})]})},Hn=({numChunks:e=1,className:a=""})=>t.jsxs("div",{className:`border-base-300/30 text-base-content/50 mt-2 flex items-start gap-1.5 border-t pt-2 text-[10px] ${a}`,children:[t.jsx(qs,{className:"mt-0.5 size-3 shrink-0"}),t.jsx("span",{children:e===1?"Single transaction via CoW flash loan. MEV protected.":`${e} iterations. ~30 min between chunks. MEV protected.`})]});try{zn.displayName="LimitOrderSection",zn.__docgenInfo={description:"",displayName:"LimitOrderSection",props:{chainId:{defaultValue:null,description:"Chain ID for LimitOrderConfig",name:"chainId",required:!0,type:{name:"number"}},sellToken:{defaultValue:null,description:"Sell token info",name:"sellToken",required:!0,type:{name:"{ symbol: string; decimals: number; address: string; } | null"}},totalAmount:{defaultValue:null,description:"Total amount for the order",name:"totalAmount",required:!0,type:{name:"bigint"}},onConfigChange:{defaultValue:null,description:"Callback when config changes",name:"onConfigChange",required:!0,type:{name:"(config: LimitOrderResult) => void"}},limitOrderConfig:{defaultValue:null,description:"Current limit order config (for chunk display)",name:"limitOrderConfig",required:!1,type:{name:"LimitOrderResult | null"}},isCowQuoteLoading:{defaultValue:null,description:"Whether CoW quote is loading",name:"isCowQuoteLoading",required:!1,type:{name:"boolean"}},slippage:{defaultValue:null,description:"Current slippage",name:"slippage",required:!1,type:{name:"number"}},setSlippage:{defaultValue:null,description:"Callback to set slippage",name:"setSlippage",required:!1,type:{name:"((value: number) => void)"}},showSlippage:{defaultValue:{value:"false"},description:"Show slippage selector",name:"showSlippage",required:!1,type:{name:"boolean"}},showBatchedToggle:{defaultValue:{value:"false"},description:"Show batched TX toggle",name:"showBatchedToggle",required:!1,type:{name:"boolean"}},useBatchedTx:{defaultValue:null,description:"Current batched TX preference",name:"useBatchedTx",required:!1,type:{name:"boolean"}},setUseBatchedTx:{defaultValue:null,description:"Callback to set batched TX preference",name:"setUseBatchedTx",required:!1,type:{name:"((value: boolean) => void)"}},extraContent:{defaultValue:null,description:"Additional content to display",name:"extraContent",required:!1,type:{name:"ReactNode"}},className:{defaultValue:{value:""},description:"Additional class name",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{Ka.displayName="ChunkInfo",Ka.__docgenInfo={description:"",displayName:"ChunkInfo",props:{numChunks:{defaultValue:{value:"1"},description:"",name:"numChunks",required:!1,type:{name:"number"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{Ga.displayName="BatchedTxToggle",Ga.__docgenInfo={description:"",displayName:"BatchedTxToggle",props:{useBatchedTx:{defaultValue:null,description:"",name:"useBatchedTx",required:!0,type:{name:"boolean"}},setUseBatchedTx:{defaultValue:null,description:"",name:"setUseBatchedTx",required:!0,type:{name:"(value: boolean) => void"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{Hn.displayName="LimitOrderInfoNote",Hn.__docgenInfo={description:"",displayName:"LimitOrderInfoNote",props:{numChunks:{defaultValue:{value:"1"},description:"Number of chunks (1 = single transaction)",name:"numChunks",required:!1,type:{name:"number"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}const Tt=e=>(e??"").toLowerCase(),Qn=e=>{const a=e.maxAmount||e.amount||0n;return{address:e.token,symbol:e.symbol,icon:Rt(e.symbol.toLowerCase()),decimals:e.decimals,rawBalance:a,balance:a?Number(F(a,e.decimals)):0}};function wo({collateralsFromHook:e,preSelectedCollaterals:a,disableCollateralSelection:n,sortByAddress:s}){const r=d=>s?[...d].sort((c,u)=>Tt(c.address).localeCompare(Tt(u.address))):d;if(n&&a&&a.length>0)return r(a.map(Qn));if(!a||a.length===0)return r(e);const l=new Map(e.map(d=>[Tt(d.address),d])),i=[...e];return a.forEach(d=>{const c=Tt(d.token);if(!l.has(c))i.push(Qn(d));else{const u=l.get(c);if(u&&(d.maxAmount||d.amount)){const f=d.maxAmount||d.amount||0n;if(f>u.rawBalance){const b=i.findIndex(m=>Tt(m.address)===c);b>=0&&(i[b]={...u,rawBalance:f,balance:Number(F(f,d.decimals))})}}}}),r(i)}function Es(e){const{collateralsFromHook:a,preSelectedCollaterals:n,disableCollateralSelection:s,sortByAddress:r}=e;return o.useMemo(()=>wo({collateralsFromHook:a,preSelectedCollaterals:n,disableCollateralSelection:s,sortByAddress:r}),[a,n,s,r])}const Kn=e=>(e??"").toLowerCase();function Us({isOpen:e,preSelectedCollaterals:a,collaterals:n,expandedCollateral:s,setExpandedCollateral:r,setTempAmount:l,setTempIsMax:i}){o.useEffect(()=>{if(!e||!a||a.length===0||n.length===0)return;const d=a[0],c=Kn(d.token),u=n.find(f=>Kn(f.address)===c);if(!(!u||s))if(r(c),d.amount){const f=F(d.amount,d.decimals);l(f),i&&d.amount===u.rawBalance&&i(!0)}else d.inputValue?l(d.inputValue):(l(F(u.rawBalance,u.decimals)),i?.(!0))},[e,a,n,s,r,l,i])}function $s({isOpen:e,filteredDestinationProtocols:a,selectedProtocol:n,setSelectedProtocol:s}){o.useEffect(()=>{if(e){if(!n&&a.length>0){s(a[0].name);return}n&&a.length>0&&!a.some(r=>r.name===n)&&s(a[0].name)}},[e,a,n,s])}function Ws({isOpen:e,debtConfirmed:a,debtInputRef:n}){o.useEffect(()=>{if(!(e&&!a))return;const s=setTimeout(()=>n.current?.focus(),100);return()=>clearTimeout(s)},[e,a,n])}function ko(e,a){return a?e.filter(n=>n.name!==a):e}function Co(e,a,n){const s=a==="v1"?e.v1Pools:e.v2Pools;return ko(s,n).map(r=>({name:r.name,value:r.name}))}const ba=e=>{const{selectedVersion:a,vesuPools:n,sourcePoolName:s,onVersionChange:r}=e,l=Co(n,a,s),i=()=>e.mode==="evm"?e.selectedPool:a==="v1"?n.v1Pools.find(m=>m.id===e.selectedPoolId)?.name||"":n.v2Pools.find(m=>m.address===e.selectedV2PoolAddress)?.name||"",d=o.useCallback(m=>{if(e.mode==="evm")e.onPoolChange(m);else if(a==="v1"){const h=n.v1Pools.find(g=>g.name===m);h?.id!=null&&e.onPoolIdChange(h.id)}else{const h=n.v2Pools.find(g=>g.name===m);h?.address&&e.onV2PoolAddressChange(h.address)}},[e,a,n.v1Pools,n.v2Pools]),c=o.useCallback((m,h)=>{h.stopPropagation(),a!==m&&(r(m),e.mode==="starknet"&&(m==="v1"&&n.v1Pools[0]?.id?e.onPoolIdChange(n.v1Pools[0].id):m==="v2"&&n.v2Pools[0]?.address&&e.onV2PoolAddressChange(n.v2Pools[0].address)))},[a,r,e,n.v1Pools,n.v2Pools]),u=o.useCallback(m=>c("v1",m),[c]),f=o.useCallback(m=>c("v2",m),[c]),b=o.useCallback(m=>{m.stopPropagation(),d(m.target.value)},[d]);return t.jsxs("div",{className:"ml-auto flex flex-shrink-0 flex-nowrap items-center gap-1",children:[t.jsxs("div",{className:"join join-xs flex-shrink-0",children:[t.jsx("button",{className:`btn btn-ghost btn-xs join-item ${a==="v1"?"btn-active":""}`,onClick:u,children:"V1"}),t.jsx("button",{className:`btn btn-ghost btn-xs join-item ${a==="v2"?"btn-active":""}`,onClick:f,children:"V2"})]}),t.jsx("select",{className:"select select-bordered select-xs w-auto min-w-[100px] max-w-[140px] flex-shrink-0 text-xs",value:i(),onChange:b,children:l.map(m=>t.jsx("option",{value:m.value,children:m.name},m.name))})]})};try{ba.displayName="VesuPoolSelect",ba.__docgenInfo={description:`Vesu pool version toggle and pool selector

Supports both EVM mode (string pool names) and Starknet mode (pool IDs/addresses)`,displayName:"VesuPoolSelect",props:{selectedVersion:{defaultValue:null,description:"Currently selected Vesu version",name:"selectedVersion",required:!0,type:{name:"enum",value:[{value:'"v1"'},{value:'"v2"'}]}},vesuPools:{defaultValue:null,description:"Available Vesu pools",name:"vesuPools",required:!0,type:{name:"VesuPools"}},sourcePoolName:{defaultValue:null,description:"Pool name to exclude from selection (source pool)",name:"sourcePoolName",required:!0,type:{name:"string | null"}},onVersionChange:{defaultValue:null,description:"Callback when version changes",name:"onVersionChange",required:!0,type:{name:'(version: "v1" | "v2") => void'}},mode:{defaultValue:null,description:`EVM mode: use pool name strings
Starknet mode: use pool ID/address`,name:"mode",required:!0,type:{name:"enum",value:[{value:'"evm"'},{value:'"starknet"'}]}},selectedPool:{defaultValue:null,description:"",name:"selectedPool",required:!0,type:{name:"string"}},onPoolChange:{defaultValue:null,description:"",name:"onPoolChange",required:!0,type:{name:"(poolName: string) => void"}},selectedPoolId:{defaultValue:null,description:"",name:"selectedPoolId",required:!1,type:{name:"bigint"}},selectedV2PoolAddress:{defaultValue:null,description:"",name:"selectedV2PoolAddress",required:!1,type:{name:"string"}},onPoolIdChange:{defaultValue:null,description:"",name:"onPoolIdChange",required:!0,type:{name:"(id: bigint) => void"}},onV2PoolAddressChange:{defaultValue:null,description:"",name:"onV2PoolAddressChange",required:!0,type:{name:"(address: string) => void"}}}}}catch{}function ga(e,a){const n=e.trim();if(n==="")return"";const s=parseFloat(n);if(!Number.isFinite(s)||s<0)return"";if(a!=null){const r=parseFloat(a);if(Number.isFinite(r)&&s>r)return a}return n}const Ya=({value:e,onChange:a,onMaxClick:n,onConfirm:s,balance:r,disabled:l=!1,autoFocus:i=!1,className:d="",rawBalance:c,decimals:u})=>{const f=o.useCallback(x=>{const y=ga(x.target.value,String(r));a(y)},[r,a]),b=o.useCallback(x=>{x.key==="Enter"&&s()},[s]),m=o.useCallback(()=>{n()},[n]),h=o.useCallback(x=>{x.stopPropagation()},[]),g=!e||parseFloat(e)<=0;return t.jsxs("div",{className:`flex items-center gap-2 ${d}`,onClick:h,children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("input",{type:"number",value:e,onChange:f,onKeyDown:b,placeholder:"0.00",className:"border-base-300 text-base-content w-full border-0 border-b-2 bg-transparent px-2 py-1 pr-20 outline-none",autoFocus:i,disabled:l}),t.jsx("button",{className:"text-primary absolute right-2 top-1/2 -translate-y-1/2",onClick:m,disabled:l,type:"button",children:r.toLocaleString(void 0,{maximumFractionDigits:6})})]}),t.jsx("button",{className:"btn btn-ghost btn-sm text-success disabled:text-base-content/40",onClick:s,disabled:g||l,title:"Add collateral",type:"button",children:"✓"})]})},ya=({variant:e="expanded",...a})=>{const n=e==="expanded"?"mt-3":"mt-2";return t.jsx(Ya,{...a,className:n,autoFocus:!0})};try{ga.displayName="clampAmount",ga.__docgenInfo={description:"Clamp an amount to be within valid bounds",displayName:"clampAmount",props:{}}}catch{}try{Ya.displayName="CollateralAmountInput",Ya.__docgenInfo={description:`Reusable collateral amount input with max button and confirm

Used in refinance modal for entering collateral amounts to move.
Handles clamping values, max button, and confirm action.`,displayName:"CollateralAmountInput",props:{value:{defaultValue:null,description:"Current input value",name:"value",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"Callback when value changes (receives clamped value)",name:"onChange",required:!0,type:{name:"(value: string) => void"}},onMaxClick:{defaultValue:null,description:"Callback when max button is clicked",name:"onMaxClick",required:!0,type:{name:"() => void"}},onConfirm:{defaultValue:null,description:"Callback when confirm button is clicked",name:"onConfirm",required:!0,type:{name:"() => void"}},balance:{defaultValue:null,description:"Human-readable balance for display and clamping",name:"balance",required:!0,type:{name:"number"}},disabled:{defaultValue:{value:"false"},description:"Whether the input is disabled",name:"disabled",required:!1,type:{name:"boolean"}},autoFocus:{defaultValue:{value:"false"},description:"Whether to auto-focus the input",name:"autoFocus",required:!1,type:{name:"boolean"}},className:{defaultValue:{value:""},description:"Additional class names",name:"className",required:!1,type:{name:"string"}},rawBalance:{defaultValue:null,description:"Raw balance (for parent component use, not used in this component)",name:"rawBalance",required:!0,type:{name:"bigint"}},decimals:{defaultValue:null,description:"Token decimals (for parent component use, not used in this component)",name:"decimals",required:!0,type:{name:"number"}}}}}catch{}try{ya.displayName="CollateralAmountInputStyled",ya.__docgenInfo={description:`Collateral amount input with styling variants

- expanded: For when a collateral tile is expanded for editing
- preselected: For disabled collateral selection with editable amount`,displayName:"CollateralAmountInputStyled",props:{balance:{defaultValue:null,description:"Human-readable balance for display and clamping",name:"balance",required:!0,type:{name:"number"}},decimals:{defaultValue:null,description:"Token decimals (for parent component use, not used in this component)",name:"decimals",required:!0,type:{name:"number"}},onConfirm:{defaultValue:null,description:"Callback when confirm button is clicked",name:"onConfirm",required:!0,type:{name:"() => void"}},value:{defaultValue:null,description:"Current input value",name:"value",required:!0,type:{name:"string"}},disabled:{defaultValue:{value:"false"},description:"Whether the input is disabled",name:"disabled",required:!1,type:{name:"boolean"}},autoFocus:{defaultValue:{value:"false"},description:"Whether to auto-focus the input",name:"autoFocus",required:!1,type:{name:"boolean"}},onChange:{defaultValue:null,description:"Callback when value changes (receives clamped value)",name:"onChange",required:!0,type:{name:"(value: string) => void"}},onMaxClick:{defaultValue:null,description:"Callback when max button is clicked",name:"onMaxClick",required:!0,type:{name:"() => void"}},rawBalance:{defaultValue:null,description:"Raw balance (for parent component use, not used in this component)",name:"rawBalance",required:!0,type:{name:"bigint"}},variant:{defaultValue:{value:"expanded"},description:"Whether this is an expanded tile (adds margin-top)",name:"variant",required:!1,type:{name:"enum",value:[{value:'"expanded"'},{value:'"preselected"'}]}}}}}catch{}const xa=({provider:e,className:a="flex items-center gap-3",nameClassName:n="truncate text-lg font-semibold"})=>t.jsxs("div",{className:a,children:[t.jsx(Be,{src:e.icon,alt:e.name,width:32,height:32,className:"min-w-[32px] rounded-full"}),t.jsx("span",{className:n,children:e.name})]}),Xa=({provider:e,onClick:a})=>t.jsx("li",{children:t.jsxs("button",{className:"flex items-center gap-3 py-2",onClick:a,children:[t.jsx(Be,{src:e.icon,alt:e.name,width:32,height:32,className:"min-w-[32px] rounded-full"}),t.jsx("span",{className:"truncate text-lg",children:e.name})]})},e.name),No=()=>t.jsx("svg",{className:"size-4 shrink-0 opacity-70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})}),Gn=({providers:e,selectedProvider:a,onSelectProvider:n,label:s="Flash Loan Provider"})=>{const r=o.useCallback(l=>()=>n(l),[n]);return e.length===0?null:t.jsxs("div",{children:[t.jsx("label",{className:"text-base-content/80 text-sm font-medium",children:s}),e.length===1?t.jsx("div",{className:"border-base-300 flex h-14 items-center gap-3 border-b-2 px-1",children:a&&t.jsx(xa,{provider:a})}):t.jsxs("div",{className:"dropdown w-full",children:[t.jsxs("div",{tabIndex:0,className:"border-base-300 flex h-14 cursor-pointer items-center justify-between border-b-2 px-1 py-3",children:[t.jsx("div",{className:"flex w-[calc(100%-32px)] items-center gap-3 overflow-hidden",children:a&&t.jsx(xa,{provider:a})}),t.jsx(No,{})]}),t.jsx("ul",{tabIndex:0,className:"dropdown-content menu bg-base-100 dropdown-bottom z-50 mt-1 w-full rounded-lg p-2 shadow-lg",children:e.map(l=>t.jsx(Xa,{provider:l,onClick:r(l)},l.name))})]})]})};try{xa.displayName="ProviderDisplay",xa.__docgenInfo={description:"",displayName:"ProviderDisplay",props:{provider:{defaultValue:null,description:"",name:"provider",required:!0,type:{name:"FlashLoanProviderOption"}},className:{defaultValue:{value:"flex items-center gap-3"},description:"",name:"className",required:!1,type:{name:"string"}},nameClassName:{defaultValue:{value:"truncate text-lg font-semibold"},description:"",name:"nameClassName",required:!1,type:{name:"string"}}}}}catch{}try{Xa.displayName="ProviderDropdownItem",Xa.__docgenInfo={description:"",displayName:"ProviderDropdownItem",props:{provider:{defaultValue:null,description:"",name:"provider",required:!0,type:{name:"FlashLoanProviderOption"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}}}catch{}try{Gn.displayName="FlashLoanProviderSelector",Gn.__docgenInfo={description:"",displayName:"FlashLoanProviderSelector",props:{providers:{defaultValue:null,description:"",name:"providers",required:!0,type:{name:"FlashLoanProviderOption[]"}},selectedProvider:{defaultValue:null,description:"",name:"selectedProvider",required:!0,type:{name:"FlashLoanProviderOption | null"}},onSelectProvider:{defaultValue:null,description:"",name:"onSelectProvider",required:!0,type:{name:"(provider: FlashLoanProviderOption) => void"}},label:{defaultValue:{value:"Flash Loan Provider"},description:"",name:"label",required:!1,type:{name:"string"}}}}}catch{}const Yn=({name:e,icon:a,rate:n,rateLabel:s,balanceLabel:r,onClick:l,rateDecimals:i=2,rateIsRaw:d=!1})=>t.jsxs("button",{className:"hover:bg-base-200/60 flex w-full cursor-pointer items-center justify-between p-3 transition-colors",onClick:l,children:[t.jsxs("div",{className:"flex items-center gap-3 text-left",children:[t.jsx(Be,{src:a,alt:e,width:24,height:24,className:"rounded-full"}),t.jsx("span",{className:"text-base-content text-sm font-medium",children:e})]}),t.jsxs("div",{className:"flex flex-col text-right",children:[t.jsxs("div",{className:"text-base-content/50 text-xs",children:[Rr(n,i,d),"% ",s]}),t.jsxs("div",{className:"text-base-content/70 text-xs",children:["Balance: ",r]})]})]}),Xn=({children:e,emptyMessage:a="No tokens available",isEmpty:n=!1})=>t.jsx("div",{className:"border-base-300/50 divide-base-300/50 max-h-96 divide-y overflow-y-auto rounded-lg border",children:n?t.jsx("div",{className:"text-base-content/50 p-6 text-center text-sm",children:a}):e}),Jn=({isOpen:e,isActionModalOpen:a,onClose:n,title:s,children:r})=>t.jsxs("dialog",{className:`modal ${e&&!a?"modal-open":""}`,children:[t.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm",onClick:n}),t.jsxs("div",{className:"modal-box bg-base-100 border-base-300/50 relative max-w-md rounded-xl border p-4",children:[t.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[t.jsx("h3",{className:"text-base-content text-lg font-semibold",children:s}),t.jsx("button",{className:"text-base-content/40 hover:text-base-content hover:bg-base-200 rounded-lg p-1.5 transition-colors",onClick:n,children:"✕"})]}),r]})]});try{Yn.displayName="TokenListItem",Yn.__docgenInfo={description:`Shared token list item component for token selection modals.

Displays:
- Token icon and name on the left
- Rate and balance on the right

Usage:
\`\`\`tsx
<TokenListItem
  name="USDC"
  icon="/usdc.png"
  rate={0.05}
  rateLabel="APY"
  balanceLabel="1,234.56"
  onClick={() => handleSelectToken(token)}
/>
\`\`\``,displayName:"TokenListItem",props:{name:{defaultValue:null,description:"Token symbol/name to display",name:"name",required:!0,type:{name:"string"}},icon:{defaultValue:null,description:"Token icon URL",name:"icon",required:!0,type:{name:"string"}},rate:{defaultValue:null,description:"Interest rate to display (as a decimal, e.g., 0.05 for 5%)",name:"rate",required:!0,type:{name:"number"}},rateLabel:{defaultValue:null,description:'Label for the rate (e.g., "APR" or "APY")',name:"rateLabel",required:!0,type:{name:"string"}},balanceLabel:{defaultValue:null,description:"Formatted balance string to display",name:"balanceLabel",required:!0,type:{name:"string"}},onClick:{defaultValue:null,description:"Click handler when the item is selected",name:"onClick",required:!0,type:{name:"() => void"}},itemKey:{defaultValue:null,description:"Optional key for the element",name:"itemKey",required:!1,type:{name:"string"}},rateDecimals:{defaultValue:{value:"2"},description:"Number of decimal places for rate formatting (default: 2)",name:"rateDecimals",required:!1,type:{name:"number"}},rateIsRaw:{defaultValue:{value:"false"},description:"Whether to format rate as raw value (default: false, meaning multiply by 100)",name:"rateIsRaw",required:!1,type:{name:"boolean"}}}}}catch{}try{Xn.displayName="TokenListContainer",Xn.__docgenInfo={description:`Container for token list with styling and empty state.

Usage:
\`\`\`tsx
<TokenListContainer isEmpty={tokens.length === 0} emptyMessage="No tokens available">
  {tokens.map(token => <TokenListItem key={token.address} ... />)}
</TokenListContainer>
\`\`\``,displayName:"TokenListContainer",props:{children:{defaultValue:null,description:"Children token list items",name:"children",required:!0,type:{name:"ReactNode"}},emptyMessage:{defaultValue:{value:"No tokens available"},description:"Empty state message",name:"emptyMessage",required:!1,type:{name:"string"}},isEmpty:{defaultValue:{value:"false"},description:"Whether the list is empty",name:"isEmpty",required:!1,type:{name:"boolean"}}}}}catch{}try{Jn.displayName="TokenSelectModalShell",Jn.__docgenInfo={description:`Shell component for token select modals providing consistent structure.

Includes:
- Backdrop with blur
- Modal box with consistent styling
- Header with title and close button

Usage:
\`\`\`tsx
<TokenSelectModalShell
  isOpen={isOpen}
  isActionModalOpen={isActionModalOpen}
  onClose={handleDone}
  title="Select Token to Borrow"
>
  <TokenListContainer>...</TokenListContainer>
</TokenSelectModalShell>
\`\`\``,displayName:"TokenSelectModalShell",props:{isOpen:{defaultValue:null,description:"Whether the modal is open",name:"isOpen",required:!0,type:{name:"boolean"}},isActionModalOpen:{defaultValue:null,description:"Whether a nested action modal is open (hides this modal when true)",name:"isActionModalOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"Handler for clicking backdrop or close button",name:"onClose",required:!0,type:{name:"() => void"}},title:{defaultValue:null,description:"Modal title",name:"title",required:!0,type:{name:"string"}},children:{defaultValue:null,description:"Children content (token list)",name:"children",required:!0,type:{name:"ReactNode"}}}}}catch{}const zs=o.memo(({protocol:e,isSelected:a,isVesu:n,vesuPools:s,selectedVersion:r,sourcePoolName:l,setSelectedVersion:i,selectedPool:d,setSelectedPool:c,selectedPoolId:u,selectedV2PoolAddress:f,onPoolIdChange:b,onV2PoolAddressChange:m,onSelect:h})=>{const g=a&&n&&s,x=o.useCallback(()=>{h(e.name)},[h,e.name]);return t.jsx("div",{className:`${g?"col-span-2 sm:col-span-3":"col-span-1"} border p-2 ${a?"border-primary bg-primary/10":"border-base-300"} cursor-pointer rounded transition-all`,onClick:x,children:t.jsxs("div",{className:"flex min-w-0 flex-nowrap items-center gap-2",children:[t.jsx(Be,{src:e.logo,alt:e.name,width:24,height:24,className:"flex-shrink-0 rounded"}),t.jsx("span",{className:"flex-shrink-0 whitespace-nowrap text-sm",children:e.name}),a&&n&&s&&(d!==void 0&&c?t.jsx(ba,{mode:"evm",selectedVersion:r,vesuPools:s,sourcePoolName:l,onVersionChange:i,selectedPool:d,onPoolChange:c}):t.jsx(ba,{mode:"starknet",selectedVersion:r,vesuPools:s,sourcePoolName:l,onVersionChange:i,selectedPoolId:u,selectedV2PoolAddress:f,onPoolIdChange:b,onV2PoolAddressChange:m}))]})})});zs.displayName="ProtocolTile";const Hs=o.memo(({provider:e,isSelected:a,onSelect:n})=>{const s=e.name.replace(/\sV[0-9]+$/i,""),r=o.useCallback(()=>{n(e.name)},[n,e.name]);return t.jsx("button",{onClick:r,className:`rounded border p-2 text-left ${a?"border-primary bg-primary/10":"border-base-300"}`,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Be,{src:e.icon,alt:e.name,width:20,height:20,className:"rounded"}),t.jsx("span",{className:"text-sm",children:s})]})})});Hs.displayName="FlashLoanProviderButton";const Qs=o.memo(({collateral:e,isAdded:a,isExpanded:n,supported:s,morphoHasOtherSelected:r,isMorphoSelected:l,disableCollateralSelection:i,addedAmount:d,getUsdValue:c,localeOptionsMinMax2:u,localeOptionsMax6:f,tempAmount:b,onTileClick:m,onInputChange:h,onMaxClick:g,onConfirm:x})=>{const y=e,N=o.useCallback(()=>{y.balance<=0||i||r||m(y.address)},[y.balance,y.address,i,r,m]),w=o.useCallback(()=>{g(y.rawBalance,y.decimals)},[y.rawBalance,y.decimals,g]),P=o.useCallback(()=>{x(y.address,y.balance)},[y.address,y.balance,x]);return t.jsxs("div",{className:`rounded border p-2 ${n?"col-span-2":""} ${a?"border-success bg-success/10":s&&!r?"border-base-300":"border-error/50 opacity-60"} ${y.balance<=0||r?"cursor-not-allowed opacity-50":i?"cursor-default":"cursor-pointer"}`,onClick:N,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"relative size-6",children:t.jsx(Be,{src:y.icon,alt:y.symbol,fill:!0,className:"rounded-full"})}),t.jsxs("span",{className:"flex items-center gap-1 font-medium",children:[y.symbol,a&&t.jsx("span",{className:"text-success",children:"✓"})]}),!s&&t.jsx("span",{className:"badge badge-error badge-outline badge-xs ml-1",children:l?"No market":"Not supported"}),t.jsx("span",{className:"text-base-content/70 ml-auto text-sm",children:d?`$${c(y.address,d).toLocaleString(void 0,u)}`:`${y.balance.toLocaleString(void 0,f)}`})]}),n&&!i&&t.jsx(ya,{variant:"expanded",value:b,onChange:h,onMaxClick:w,onConfirm:P,rawBalance:y.rawBalance,decimals:y.decimals,balance:y.balance}),i&&!a&&t.jsx(ya,{variant:"preselected",value:b||"",onChange:h,onMaxClick:w,onConfirm:P,rawBalance:y.rawBalance,decimals:y.decimals,balance:y.balance})]})});Qs.displayName="CollateralTile";const va=({isOpen:e,onClose:a,debtSymbol:n,debtIcon:s,debtAmount:r,setDebtAmount:l,debtMaxLabel:i,debtMaxRaw:d,debtConfirmed:c,setDebtConfirmed:u,debtInputRef:f,sourceProtocol:b,setIsDebtMaxClicked:m,activeTab:h,setActiveTab:g,showFlashLoanTab:x,filteredDestinationProtocols:y,selectedProtocol:N,setSelectedProtocol:w,selectedVersion:P,setSelectedVersion:I,vesuPools:D,sourcePoolName:O,selectedPool:B,setSelectedPool:v,selectedPoolId:H,setSelectedPoolId:S,selectedV2PoolAddress:ce,setSelectedV2PoolAddress:J,flashLoanProviders:E,selectedProvider:_,setSelectedProvider:R,collaterals:k,isLoadingCollaterals:X,effectiveSupportedMap:j,addedCollaterals:Y,expandedCollateral:C,tempAmount:M,setTempAmount:A,setTempIsMax:ee,onCollateralTileClick:Z,onAddCollateral:oe,disableCollateralSelection:L,preSelectedCollaterals:U,getUsdValue:$,refiHF:Q,hfColor:K,totalCollateralUsd:se,ltv:ge,debtUsd:ye,isActionDisabled:Se,isSubmitting:le,handleExecuteMove:Me,showBatchingOption:xe,preferBatching:ve,setPreferBatching:Ve,revokePermissions:ie,setRevokePermissions:re,errorMessage:Ae,apiProbes:Ne,isMorphoSelected:W,morphoMarkets:te,selectedMorphoMarket:fe,onMorphoMarketSelect:ue,morphoSupportedCollaterals:ae,isLoadingMorphoMarkets:Ee,chainId:nt})=>{const ne=z=>(z??"").toLowerCase(),de=W&&ae?ae:j,_e=o.useMemo(()=>({opacity:0,x:-12}),[]),je=o.useMemo(()=>({opacity:1,x:0}),[]),me=o.useMemo(()=>({opacity:0,x:12}),[]),we=o.useMemo(()=>({duration:.15}),[]),Pe=o.useCallback(()=>{a()},[a]),Je=o.useCallback(()=>{a()},[a]),st=o.useCallback(z=>{const pe=ga(z.target.value,d);m(!1),l(pe)},[d,m,l]),ut=o.useCallback(z=>{z.key==="Enter"&&u(!!(r&&parseFloat(r)>0))},[r,u]),Ue=o.useCallback(()=>{const z=(d||i||"").replace(/,/g,"");m(!0),l(z)},[d,i,m,l]),We=o.useCallback(()=>{u(!!(r&&parseFloat(r)>0))},[r,u]),Ie=o.useCallback(()=>{u(!1)},[u]),it=o.useCallback(()=>{g("protocol")},[g]),Fe=o.useCallback(()=>{g("flashloan")},[g]),vt=o.useCallback(()=>{Ve?.(z=>!z)},[Ve]),dt=o.useCallback(()=>{re?.(z=>!z)},[re]),qe=o.useMemo(()=>[{key:"refinance",label:le?"Processing...":"Refinance",icon:le?t.jsx(Ss,{size:"xs"}):void 0,onClick:Me,disabled:Se||le,variant:"ghost"}],[le,Me,Se]),mt=o.useCallback(z=>{ee(!1),A(z)},[ee,A]),pt=o.useCallback(z=>{S?.(z)},[S]),ft=o.useCallback(z=>{J?.(z)},[J]),ze=o.useMemo(()=>({minimumFractionDigits:2,maximumFractionDigits:2}),[]),Qe=o.useMemo(()=>({maximumFractionDigits:6}),[]),rt=o.useMemo(()=>[],[]),Ze=o.useCallback((z,pe)=>{ee(!0),A(F(z,pe))},[ee,A]),et=o.useCallback((z,pe)=>{oe(z,pe)},[oe]);return t.jsxs("dialog",{className:`modal ${e?"modal-open":""}`,children:[t.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm",onClick:Pe}),t.jsxs("div",{className:"modal-box bg-base-100 border-base-300/50 relative flex max-h-[90vh] max-w-2xl flex-col rounded-xl border p-5",children:[t.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[t.jsx("h3",{className:"text-base-content text-lg font-semibold",children:"Refinance Position"}),t.jsx("button",{className:"text-base-content/40 hover:text-base-content hover:bg-base-200 rounded-lg p-1.5 transition-colors",onClick:Je,children:"✕"})]}),t.jsxs("div",{className:"space-y-4 overflow-y-auto",children:[Ne,t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/80 text-sm",children:"Amount to Refinance"}),c&&t.jsx("div",{className:"flex flex-col items-end gap-1",children:t.jsx("span",{className:"text-base-content/60 text-[11px] leading-none",children:"Source Protocol"})})]}),c?t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex cursor-pointer items-center gap-3",onClick:Ie,children:[t.jsx("div",{className:"relative size-6",children:t.jsx(Be,{src:s,alt:n,fill:!0,className:"rounded-full"})}),t.jsx("span",{className:"font-medium",children:n}),t.jsx("span",{children:r})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Be,{src:b.logo,alt:b.name,width:20,height:20,className:"rounded-full"}),t.jsx("span",{children:b.name})]})]}):t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"relative size-6",children:t.jsx(Be,{src:s,alt:n,fill:!0,className:"rounded-full"})}),t.jsx("span",{className:"font-medium",children:n}),t.jsxs("div",{className:"relative flex-1",children:[t.jsx("input",{ref:f,type:"number",value:r,onChange:st,onKeyDown:ut,placeholder:"0.00",className:"border-base-300 w-full border-0 border-b-2 bg-transparent px-2 py-1 pr-20 outline-none"}),i&&t.jsx("button",{onClick:Ue,className:"text-primary absolute right-2 top-1/2 -translate-y-1/2",children:i})]}),t.jsx("button",{onClick:We,disabled:!r||parseFloat(r)<=0,className:"text-base-content/40 hover:text-success p-1 disabled:opacity-40",title:"Confirm amount",children:"✓"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"border-base-300 flex items-center gap-6 border-b",children:[t.jsx("button",{className:`mb-[-1px] border-b-2 pb-2 ${h==="protocol"?"border-primary":"text-base-content/60 border-transparent"}`,onClick:it,children:"Destination Protocol"}),x&&t.jsx("button",{className:`mb-[-1px] border-b-2 pb-2 ${h==="flashloan"?"border-primary":"text-base-content/60 border-transparent"}`,onClick:Fe,children:"Flash Loan Provider"})]}),t.jsx(Or,{mode:"wait",children:h==="protocol"?t.jsx(Ln.div,{initial:_e,animate:je,exit:me,transition:we,className:"grid grid-cols-3 gap-2 sm:grid-cols-4",children:y.map(z=>t.jsx(zs,{protocol:z,isSelected:N===z.name,isVesu:z.name==="Vesu",vesuPools:D,selectedVersion:P,sourcePoolName:O,setSelectedVersion:I,selectedPool:B,setSelectedPool:v,selectedPoolId:H,selectedV2PoolAddress:ce,onPoolIdChange:pt,onV2PoolAddressChange:ft,onSelect:w},z.name))},"protocol"):t.jsx(Ln.div,{initial:_e,animate:je,exit:me,transition:we,className:"grid grid-cols-2 gap-2 sm:grid-cols-4 md:grid-cols-5",children:E.map(z=>t.jsx(Hs,{provider:z,isSelected:_===z.name,onSelect:R},`${z.name}-${z.version}`))},"flashloan")})]}),t.jsx("div",{className:"divider my-2"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-base-content/80 text-sm",children:L&&U&&U.length>0?"Collateral to Move":W?"Select Collateral to Move":"Select Collaterals to Move"}),L&&U&&U.length>0&&t.jsxs("div",{className:"text-base-content/60 bg-info/10 mb-2 rounded p-2 text-xs",children:[t.jsx("strong",{children:"Note:"})," Vesu uses collateral-debt pair isolation. You can adjust the amount, but this collateral cannot be changed."]}),W&&!L&&t.jsxs("div",{className:"text-base-content/60 bg-info/10 mb-2 rounded p-2 text-xs",children:[t.jsx("strong",{children:"Note:"})," Morpho markets are isolated by collateral type. Select one collateral to see available markets."]}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:X?t.jsx("div",{className:"col-span-2 flex items-center justify-center py-6",children:t.jsx(Dr,{size:"md"})}):(L&&U&&U.length>0?k.filter(z=>U.some(pe=>ne(pe.token)===ne(z.address))):k).map(z=>{const pe=ne(z.address),ht=Object.keys(de||{}).length===0?!0:de?.[pe]??!1,bt=!!Y[pe],q=C===pe,p=!!(W&&Object.keys(Y).length>0&&!bt);return t.jsx(Qs,{collateral:z,isAdded:bt,isExpanded:q,supported:ht,morphoHasOtherSelected:p,isMorphoSelected:W,disableCollateralSelection:L,addedAmount:Y[pe],getUsdValue:$,localeOptionsMinMax2:ze,localeOptionsMax6:Qe,tempAmount:M,onTileClick:Z,onInputChange:mt,onMaxClick:Ze,onConfirm:et},z.address)})})]}),W&&Object.keys(Y).length>0&&ue&&nt&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"divider my-2"}),t.jsx(wr,{markets:te??rt,selectedMarket:fe??null,onSelectMarket:ue,chainId:nt,isLoading:Ee})]}),t.jsx("div",{className:"divider my-2"}),t.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-base-content/70 text-xs",children:"Health Factor"}),t.jsx("div",{className:`font-medium ${K.tone}`,children:Q>=999?"∞":Q.toFixed(2)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-base-content/70 text-xs",children:"Collateral Amount"}),t.jsxs("div",{className:"font-medium",children:["$",se.toLocaleString(void 0,ze)]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-base-content/70 text-xs",children:"LTV"}),t.jsxs("div",{className:"font-medium",children:[ge,"%"]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-base-content/70 text-xs",children:"Debt Amount"}),t.jsxs("div",{className:"font-medium",children:["$",ye.toLocaleString(void 0,ze)]})]})]}),Ae&&t.jsx(js,{message:Ae,size:"sm"}),t.jsxs("div",{className:"flex items-center justify-between pt-2",children:[xe&&Ve&&t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsxs("button",{type:"button",onClick:vt,className:`inline-flex cursor-pointer items-center gap-1 text-xs hover:opacity-80 ${ve?"text-success":"text-base-content/60"}`,children:[t.jsx(Ba,{className:`size-4 ${ve?"":"opacity-40"}`}),"Batch transactions"]}),re&&t.jsxs("button",{type:"button",onClick:dt,className:`inline-flex cursor-pointer items-center gap-1 text-xs hover:opacity-80 ${ie?"text-success":"text-base-content/60"}`,children:[t.jsx(Ba,{className:`size-4 ${ie?"":"opacity-40"}`}),"Revoke permissions"]})]}),!xe&&t.jsx("div",{}),t.jsx("div",{className:"ml-4 flex-1",children:t.jsx(xn,{className:"w-full",autoCompact:!0,actions:qe})})]})]})]})]})};try{va.displayName="RefinanceModalContent",va.__docgenInfo={description:"",displayName:"RefinanceModalContent",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},debtSymbol:{defaultValue:null,description:"",name:"debtSymbol",required:!0,type:{name:"string"}},debtIcon:{defaultValue:null,description:"",name:"debtIcon",required:!0,type:{name:"string"}},debtAmount:{defaultValue:null,description:"",name:"debtAmount",required:!0,type:{name:"string"}},setDebtAmount:{defaultValue:null,description:"",name:"setDebtAmount",required:!0,type:{name:"(value: string) => void"}},debtMaxLabel:{defaultValue:null,description:"",name:"debtMaxLabel",required:!1,type:{name:"string"}},debtMaxRaw:{defaultValue:null,description:"",name:"debtMaxRaw",required:!1,type:{name:"string"}},debtConfirmed:{defaultValue:null,description:"",name:"debtConfirmed",required:!0,type:{name:"boolean"}},setDebtConfirmed:{defaultValue:null,description:"",name:"setDebtConfirmed",required:!0,type:{name:"(value: boolean) => void"}},debtInputRef:{defaultValue:null,description:"",name:"debtInputRef",required:!0,type:{name:"RefObject<HTMLInputElement | null>"}},sourceProtocol:{defaultValue:null,description:"",name:"sourceProtocol",required:!0,type:{name:"Protocol"}},setIsDebtMaxClicked:{defaultValue:null,description:"",name:"setIsDebtMaxClicked",required:!0,type:{name:"(value: boolean) => void"}},activeTab:{defaultValue:null,description:"",name:"activeTab",required:!0,type:{name:"enum",value:[{value:'"protocol"'},{value:'"flashloan"'}]}},setActiveTab:{defaultValue:null,description:"",name:"setActiveTab",required:!0,type:{name:'(tab: "protocol" | "flashloan") => void'}},showFlashLoanTab:{defaultValue:null,description:"",name:"showFlashLoanTab",required:!0,type:{name:"boolean"}},filteredDestinationProtocols:{defaultValue:null,description:"",name:"filteredDestinationProtocols",required:!0,type:{name:"Protocol[]"}},selectedProtocol:{defaultValue:null,description:"",name:"selectedProtocol",required:!0,type:{name:"string"}},setSelectedProtocol:{defaultValue:null,description:"",name:"setSelectedProtocol",required:!0,type:{name:"(protocol: string) => void"}},selectedVersion:{defaultValue:null,description:"",name:"selectedVersion",required:!0,type:{name:"enum",value:[{value:'"v1"'},{value:'"v2"'}]}},setSelectedVersion:{defaultValue:null,description:"",name:"setSelectedVersion",required:!0,type:{name:'(version: "v1" | "v2") => void'}},vesuPools:{defaultValue:null,description:"",name:"vesuPools",required:!1,type:{name:"VesuPools"}},sourcePoolName:{defaultValue:null,description:"",name:"sourcePoolName",required:!0,type:{name:"string | null"}},selectedPool:{defaultValue:null,description:"",name:"selectedPool",required:!1,type:{name:"string"}},setSelectedPool:{defaultValue:null,description:"",name:"setSelectedPool",required:!1,type:{name:"((pool: string) => void)"}},selectedPoolId:{defaultValue:null,description:"",name:"selectedPoolId",required:!1,type:{name:"bigint"}},setSelectedPoolId:{defaultValue:null,description:"",name:"setSelectedPoolId",required:!1,type:{name:"((id: bigint) => void)"}},selectedV2PoolAddress:{defaultValue:null,description:"",name:"selectedV2PoolAddress",required:!1,type:{name:"string"}},setSelectedV2PoolAddress:{defaultValue:null,description:"",name:"setSelectedV2PoolAddress",required:!1,type:{name:"((address: string) => void)"}},flashLoanProviders:{defaultValue:null,description:"",name:"flashLoanProviders",required:!0,type:{name:"FlashLoanProvider[]"}},selectedProvider:{defaultValue:null,description:"",name:"selectedProvider",required:!0,type:{name:"string"}},setSelectedProvider:{defaultValue:null,description:"",name:"setSelectedProvider",required:!0,type:{name:"(provider: string) => void"}},collaterals:{defaultValue:null,description:"",name:"collaterals",required:!0,type:{name:"Collateral[]"}},isLoadingCollaterals:{defaultValue:null,description:"",name:"isLoadingCollaterals",required:!0,type:{name:"boolean"}},effectiveSupportedMap:{defaultValue:null,description:"",name:"effectiveSupportedMap",required:!0,type:{name:"Record<string, boolean>"}},addedCollaterals:{defaultValue:null,description:"",name:"addedCollaterals",required:!0,type:{name:"Record<string, string>"}},expandedCollateral:{defaultValue:null,description:"",name:"expandedCollateral",required:!0,type:{name:"string | null"}},tempAmount:{defaultValue:null,description:"",name:"tempAmount",required:!0,type:{name:"string"}},setTempAmount:{defaultValue:null,description:"",name:"setTempAmount",required:!0,type:{name:"(value: string) => void"}},setTempIsMax:{defaultValue:null,description:"",name:"setTempIsMax",required:!0,type:{name:"(value: boolean) => void"}},onCollateralTileClick:{defaultValue:null,description:"",name:"onCollateralTileClick",required:!0,type:{name:"(address: string) => void"}},onAddCollateral:{defaultValue:null,description:"",name:"onAddCollateral",required:!0,type:{name:"(address: string, balance: number) => void"}},disableCollateralSelection:{defaultValue:null,description:"",name:"disableCollateralSelection",required:!1,type:{name:"boolean"}},preSelectedCollaterals:{defaultValue:null,description:"",name:"preSelectedCollaterals",required:!1,type:{name:"{ token: string; symbol: string; decimals: number; amount?: bigint; maxAmount?: bigint; inputValue?: string | undefined; }[] | undefined"}},getUsdValue:{defaultValue:null,description:"",name:"getUsdValue",required:!0,type:{name:"(address: string, amount: string) => number"}},refiHF:{defaultValue:null,description:"",name:"refiHF",required:!0,type:{name:"number"}},hfColor:{defaultValue:null,description:"",name:"hfColor",required:!0,type:{name:"{ tone: string; badge: string; }"}},totalCollateralUsd:{defaultValue:null,description:"",name:"totalCollateralUsd",required:!0,type:{name:"number"}},ltv:{defaultValue:null,description:"",name:"ltv",required:!0,type:{name:"string"}},debtUsd:{defaultValue:null,description:"",name:"debtUsd",required:!0,type:{name:"number"}},isActionDisabled:{defaultValue:null,description:"",name:"isActionDisabled",required:!0,type:{name:"boolean"}},isSubmitting:{defaultValue:null,description:"",name:"isSubmitting",required:!0,type:{name:"boolean"}},handleExecuteMove:{defaultValue:null,description:"",name:"handleExecuteMove",required:!0,type:{name:"() => void"}},showBatchingOption:{defaultValue:null,description:"",name:"showBatchingOption",required:!0,type:{name:"boolean"}},preferBatching:{defaultValue:null,description:"",name:"preferBatching",required:!0,type:{name:"boolean"}},setPreferBatching:{defaultValue:null,description:"",name:"setPreferBatching",required:!1,type:{name:"Dispatch<SetStateAction<boolean>>"}},revokePermissions:{defaultValue:null,description:"",name:"revokePermissions",required:!1,type:{name:"boolean"}},setRevokePermissions:{defaultValue:null,description:"",name:"setRevokePermissions",required:!1,type:{name:"Dispatch<SetStateAction<boolean>>"}},errorMessage:{defaultValue:null,description:"",name:"errorMessage",required:!1,type:{name:"string"}},apiProbes:{defaultValue:null,description:"",name:"apiProbes",required:!1,type:{name:"ReactNode"}},isMorphoSelected:{defaultValue:null,description:"",name:"isMorphoSelected",required:!1,type:{name:"boolean"}},morphoMarkets:{defaultValue:null,description:"",name:"morphoMarkets",required:!1,type:{name:"MorphoMarket[]"}},selectedMorphoMarket:{defaultValue:null,description:"",name:"selectedMorphoMarket",required:!1,type:{name:"MorphoMarket | null"}},onMorphoMarketSelect:{defaultValue:null,description:"",name:"onMorphoMarketSelect",required:!1,type:{name:"((market: MorphoMarket, context: MorphoMarketContext) => void)"}},morphoSupportedCollaterals:{defaultValue:null,description:"",name:"morphoSupportedCollaterals",required:!1,type:{name:"Record<string, boolean>"}},isLoadingMorphoMarkets:{defaultValue:null,description:"",name:"isLoadingMorphoMarkets",required:!1,type:{name:"boolean"}},chainId:{defaultValue:null,description:"",name:"chainId",required:!1,type:{name:"number"}}}}}catch{}const Bt=Et(["function balanceOf(address account) view returns (uint256)"]),Zn=Et(["function getReserveData(address asset) view returns (uint256 configuration, uint128 liquidityIndex, uint128 currentLiquidityRate, uint128 currentVariableBorrowRate, uint128 currentStableBorrowRate, uint40 lastUpdateTimestamp, uint16 id, address aTokenAddress, address stableDebtTokenAddress, address variableDebtTokenAddress, address interestRateStrategyAddress, uint128 accruedToTreasury, uint128 unbacked, uint128 isolationModeTotalDebt)"]),Ft=Et(["function balancerV2Vault() view returns (address)","function balancerV3Vault() view returns (address)","function aaveCompatiblePools(bytes32 key) view returns (address)","function morphoBlue() view returns (address)"]),jo=ks(Cs("aave")),So=ks(Cs("zerolend")),Vo=(e,a,n)=>{const{data:s}=Da({contractName:"KapanRouter",chainId:n}),r=Ut({chainId:n}),[l,i]=o.useState([]),[d,c]=o.useState(!1);o.useEffect(()=>{i([])},[e,n]);const u=o.useCallback(async()=>{if(!(!e||!s||!r||a===0n)){c(!0);try{const[f,b,m,h,g]=await Promise.all([r.readContract({address:s.address,abi:Ft,functionName:"balancerV2Vault"}).catch(()=>"0x0000000000000000000000000000000000000000"),r.readContract({address:s.address,abi:Ft,functionName:"balancerV3Vault"}).catch(()=>"0x0000000000000000000000000000000000000000"),r.readContract({address:s.address,abi:Ft,functionName:"aaveCompatiblePools",args:[jo]}).catch(()=>"0x0000000000000000000000000000000000000000"),r.readContract({address:s.address,abi:Ft,functionName:"aaveCompatiblePools",args:[So]}).catch(()=>"0x0000000000000000000000000000000000000000"),r.readContract({address:s.address,abi:Ft,functionName:"morphoBlue"}).catch(()=>"0x0000000000000000000000000000000000000000")]),x=[];let y;if(f&&f!=="0x0000000000000000000000000000000000000000")try{y=await r.readContract({address:e,abi:Bt,functionName:"balanceOf",args:[f]}),x.push({provider:Oe.BalancerV2,liquidity:y,hasLiquidity:y>=a})}catch{x.push({provider:Oe.BalancerV2,liquidity:0n,hasLiquidity:!1})}if(b&&b!=="0x0000000000000000000000000000000000000000")try{let N=await r.readContract({address:e,abi:Bt,functionName:"balanceOf",args:[b]});N<a&&y!==void 0&&y>=a&&(N=y),x.push({provider:Oe.BalancerV3,liquidity:N,hasLiquidity:N>=a})}catch{x.push({provider:Oe.BalancerV3,liquidity:0n,hasLiquidity:!1})}if(m&&m!=="0x0000000000000000000000000000000000000000")try{const w=(await r.readContract({address:m,abi:Zn,functionName:"getReserveData",args:[e]}))[8],P=await r.readContract({address:e,abi:Bt,functionName:"balanceOf",args:[w]});x.push({provider:Oe.Aave,liquidity:P,hasLiquidity:P>=a})}catch(N){console.error("Aave V3 liquidity check failed",N),x.push({provider:Oe.Aave,liquidity:0n,hasLiquidity:!1})}if(h&&h!=="0x0000000000000000000000000000000000000000")try{const w=(await r.readContract({address:h,abi:Zn,functionName:"getReserveData",args:[e]}))[8],P=await r.readContract({address:e,abi:Bt,functionName:"balanceOf",args:[w]});x.push({provider:Oe.ZeroLend,liquidity:P,hasLiquidity:P>=a})}catch(N){console.error("ZeroLend liquidity check failed",N),x.push({provider:Oe.ZeroLend,liquidity:0n,hasLiquidity:!1})}if(g&&g!=="0x0000000000000000000000000000000000000000")try{const N=await r.readContract({address:e,abi:Bt,functionName:"balanceOf",args:[g]});x.push({provider:Oe.Morpho,liquidity:N,hasLiquidity:N>=a})}catch{x.push({provider:Oe.Morpho,liquidity:0n,hasLiquidity:!1})}i(x)}catch(f){console.error("Error fetching flash loan liquidity:",f)}finally{c(!1)}}},[e,s,r,a]);return o.useEffect(()=>{u()},[u,e,a]),{liquidityData:l,isLoading:d,refetch:u}},Nn=({flashLoanProviders:e,defaultProvider:a,tokenAddress:n,amount:s,chainId:r,initialProviderName:l})=>{const[i,d]=o.useState(void 0),c=o.useRef(!1),u=o.useRef(void 0);o.useEffect(()=>{n!==u.current&&(c.current=!1,u.current=n)},[n]);const f=o.useCallback(h=>{c.current=!0,d(h)},[]);o.useEffect(()=>{if(!i&&!c.current){if(l){const h=e.find(g=>g.name===l);if(h){d(h);return}}a&&d(a)}},[e,a,l,i]);const{liquidityData:b,isLoading:m}=Vo(n,s,r);return o.useEffect(()=>{if(c.current||!b.length||s===0n)return;const h=kr.find(g=>{const x=b.find(y=>y.provider===g);return x&&x.hasLiquidity});if(h!==void 0){const g=e.find(x=>x.providerEnum===h);g&&g.name!==i?.name&&d(g)}},[b,s,e,i]),{selectedProvider:i,setSelectedProvider:f,liquidityData:b,isLoading:m}};async function Ao(e){try{const a=new URLSearchParams({first:"2000",curation:"curated",minLiquidityUsd:"10000",hideSaturated:"true"}),n=await fetch(`/api/morpho/${e}/markets?${a.toString()}`);if(!n.ok)return console.error(`[useMorphoMarketSupport] Markets API error: ${n.status}`),[];const r=(await n.json())?.markets?.items||[];return Cr(r)}catch(a){return console.error("[useMorphoMarketSupport] Failed to fetch markets:",a),[]}}function _o({chainId:e,loanTokenAddress:a,collateralAddresses:n,enabled:s=!0}){const{data:r,isLoading:l,error:i}=Mt({queryKey:["morpho-markets-support",e],queryFn:()=>Ao(e),enabled:s&&!0,staleTime:3e5,gcTime:6e5}),{supportedCollaterals:d,marketsByCollateral:c,allMarketsForLoanToken:u}=o.useMemo(()=>{if(!r||!a)return{supportedCollaterals:{},marketsByCollateral:{},allMarketsForLoanToken:[]};const f=a.toLowerCase(),b=new Set(n.map(y=>y.toLowerCase())),m=r.filter(y=>y.loanAsset.address.toLowerCase()===f),h=m.filter(y=>y.collateralAsset?.address&&b.has(y.collateralAsset.address.toLowerCase())),g={},x={};for(const y of h){const N=y.collateralAsset?.address?.toLowerCase();N&&(g[N]||(g[N]=[]),g[N].push(y),x[N]=!0)}for(const y of Object.keys(g))g[y].sort((N,w)=>N.state.borrowApy-w.state.borrowApy);return{supportedCollaterals:x,marketsByCollateral:g,allMarketsForLoanToken:m}},[r,a,n]);return{supportedCollaterals:d,marketsByCollateral:c,allMarketsForLoanToken:u,isLoading:l,error:i}}const Te=e=>(e??"").toLowerCase(),es=(e,a)=>a[Te(e)]??0n,ts=(e,a)=>!a||a===0n||!isFinite(e)||e<=0?0:e*Number(F(a,8)),qo=(e,a,n)=>!e||!n?0:Number(F(e,a))*Number(F(n,8)),Lo=e=>{const a=Number(e?.liquidationThresholdBps??e?.collateralFactorBps??e?.ltBps??e?.ltvBps??8273);return Math.max(0,Math.min(1e4,a))},Ja=o.memo(({symbol:e,address:a,enabled:n,onPrice:s})=>{const r=(e||"").trim(),{isSuccess:l,price:i}=Yr(r),d=o.useRef(null),c=Te(a);return o.useEffect(()=>{if(!n||!r||!(l&&typeof i=="number"&&isFinite(i)&&i>0))return;const f=BigInt(Math.round(i*1e8));d.current!==f&&(d.current=f,s(c,f))},[n,r,l,i,c,s]),null});Ja.displayName="CollatPriceProbe";const Za=({isOpen:e,onClose:a,fromProtocol:n,position:s,fromContext:r,chainId:l,preSelectedCollaterals:i,disableCollateralSelection:d})=>{const{debtSymbol:c,debtIcon:u,debtMaxRaw:f,debtMaxLabel:b,sourceProtocol:m,collaterals:h,isLoadingCollaterals:g,tokenToPrices:x,destinationProtocols:y,flashLoanProviders:N,defaultFlashLoanProvider:w,vesuPools:P}=_a({isOpen:e,networkType:"evm",fromProtocol:n,chainId:l,position:s}),I=y,D=Es({collateralsFromHook:h,preSelectedCollaterals:i,disableCollateralSelection:d,sortByAddress:!1}),[O,B]=o.useState({});o.useEffect(()=>{e&&B(q=>{let p=!1,V=q;for(const[G,ke]of Object.entries(x||{})){if(!ke||ke<=0n)continue;const De=Te(G);q[De]!==ke&&(V===q&&(V={...q}),V[De]=ke,p=!0)}return p?V:q})},[e,x]);const v=o.useCallback((q,p)=>{!p||p<=0n||B(V=>V[q]===p?V:{...V,[q]:p})},[]),H=Ts(e),{debtAmount:S,setDebtAmount:ce,setIsDebtMaxClicked:J,debtConfirmed:E,setDebtConfirmed:_,activeTab:R,setActiveTab:k,selectedProtocol:X,setSelectedProtocol:j,selectedVersion:Y,setSelectedVersion:C,expandedCollateral:M,setExpandedCollateral:A,tempAmount:ee,setTempAmount:Z,setTempIsMax:oe,addedCollaterals:L,collateralIsMaxMap:U,isSubmitting:$,setIsSubmitting:Q,preferBatching:K,setPreferBatching:se,autoSelectedDest:ge,setAutoSelectedDest:ye,resetState:Se,onCollateralTileClick:le,onAddCollateral:Me,selectedMorphoMarket:xe,morphoContext:ve,onMorphoMarketSelect:Ve}=H,ie=o.useRef(!1);o.useEffect(()=>{if(e&&!ie.current){const q={network:"evm",fromProtocol:n,debtTokenName:s.name,debtTokenAddress:s.tokenAddress,positionType:s.type};l!==void 0&&(q.chainId=l),he("refinance_modal_open",q)}ie.current=e},[l,n,e,s.name,s.tokenAddress,s.type]);const[re,Ae]=o.useState(""),Ne=o.useMemo(()=>{try{return S?jt(S,s.decimals):0n}catch{return 0n}},[S,s.decimals]),{selectedProvider:W,setSelectedProvider:te}=Nn({flashLoanProviders:N,defaultProvider:w,tokenAddress:s.tokenAddress,amount:Ne,chainId:l||1}),fe=W?.name,ue=o.useCallback(q=>{const p=N.find(V=>V.name===q);p&&te(p)},[N,te]),ae=o.useMemo(()=>D.map(q=>q.address),[D]),{supportedCollaterals:Ee,isLoading:nt}=Ms(X||I[0]?.name||"",s.tokenAddress,ae.map(q=>q.toLowerCase()),e&&ae.length>0&&!!(X||I[0]?.name),l),ne=X==="Morpho Blue",{supportedCollaterals:de,marketsByCollateral:_e,isLoading:je}=_o({chainId:l||8453,loanTokenAddress:s.tokenAddress,collateralAddresses:ae.map(q=>q.toLowerCase()),enabled:e&&ne&&ae.length>0}),me=o.useMemo(()=>{if(!ne)return[];const q=Object.keys(L)[0]?.toLowerCase();return q?_e[q]||[]:[]},[ne,L,_e]);o.useEffect(()=>{if(!e||ge||!y.length)return;const q=Ee;if(D.some(G=>q?.[Te(G.address)]&&G.balance>0)){ye(!0);return}const V=y.find(G=>G.name!==X);V&&V.name!==X&&j(V.name),ye(!0)},[e,ge,y,X,D,Ee,j,ye]);const{createMoveBuilder:we,executeFlowBatchedIfPossible:Pe,canDoAtomicBatch:Je}=It();o.useEffect(()=>{if(!e)return;const q=!!Je;se(p=>p===q?p:q)},[e,Je,se]);const[st,ut]=o.useState(!1);o.useEffect(()=>{K&&ut(!0)},[K]);const Ue=o.useRef(null);Us({isOpen:e,preSelectedCollaterals:i,collaterals:D,expandedCollateral:M,setExpandedCollateral:A,setTempAmount:Z}),$s({isOpen:e,filteredDestinationProtocols:I,selectedProtocol:X,setSelectedProtocol:j}),o.useEffect(()=>{if(!(!e||!(X==="Vesu"||X==="VesuV2")||!P))if(Y==="v1"){const p=P.v1Pools[0]?.name||"";p&&re!==p&&Ae(p)}else{const p=P.v2Pools[0]?.name||"";p&&re!==p&&Ae(p)}},[e,X,Y,P,re]),Ws({isOpen:e,debtConfirmed:E,debtInputRef:Ue}),o.useEffect(()=>{Se()},[e,Se]);const We=O[Te(s.tokenAddress)]??0n,Ie=o.useMemo(()=>{if(!E)return 0;const q=parseFloat(S||"0");return Number.isNaN(q)||q<=0?0:ts(q,We)},[S,E,We]),it=o.useCallback((q,p)=>{const V=es(q,O);if(!V||V===0n)return 0;const G=parseFloat(p||"0");return Number.isNaN(G)||G<=0?0:ts(G,V)},[O]),Fe=o.useMemo(()=>{let q=0;for(const[p,V]of Object.entries(L))q+=it(p,V);return q},[L,it]),vt=o.useMemo(()=>Fe?(Ie/Fe*100).toFixed(1):"0.0",[Ie,Fe]),dt=2,qe=1.5,mt=1.1,pt=o.useCallback((q,p,V,G)=>{const ke=new Map;for(const Re of p){const $e=Te(Re.address||"");$e&&ke.set($e,(ke.get($e)??0n)+(Re.amount??0n))}let De=0;for(const Re of q){const $e=Te(Re.address||Re.token||"");if(!$e)continue;const $t=Re.rawBalance??0n,Vt=Re.decimals??18,wt=Lo(Re)/1e4;if(wt<=0)continue;const At=ke.get($e)??0n,Ke=$t-At;if(Ke<=0n)continue;const ot=es($e,V);if(ot===0n)continue;const tt=qo(Ke,Vt,ot);De+=tt*wt}return!isFinite(G)||G<=0?999:De/G},[]),ft=o.useMemo(()=>{const q=[];for(const[p,V]of Object.entries(L)){const G=D.find(ke=>Te(ke.address)===Te(p));G&&q.push({address:Te(p),amount:jt(V||"0",G.decimals),decimals:G.decimals})}return q},[L,D]),ze=o.useMemo(()=>pt(D,ft,O,Ie),[D,ft,O,Ie,pt]),rt=(q=>q>=dt?{tone:"text-success",badge:"badge-success"}:q>=qe?{tone:"text-warning",badge:"badge-warning"}:q>=mt?{tone:"text-error",badge:"badge-error"}:{tone:"text-error",badge:"badge-error"})(ze),Ze=e&&!!s?.name&&!!s?.tokenAddress&&!O[Te(s.tokenAddress)],et=o.useMemo(()=>{if(!e)return null;const q=[];Ze&&q.push(t.jsx(Ja,{address:s.tokenAddress,symbol:s.name,enabled:!0,onPrice:v},`probe-debt-${Te(s.tokenAddress)}`));for(const p of D){const V=Te(p.address);!V||!p.symbol||O[V]||q.push(t.jsx(Ja,{address:V,symbol:p.symbol,enabled:!0,onPrice:v},`probe-${V}`))}return t.jsx(t.Fragment,{children:q})},[e,Ze,s.tokenAddress,s.name,D,O,v]),z=o.useMemo(()=>{if(!E||!X||Object.keys(L).length===0||ne&&!xe)return!0;const q=ne?de:Ee;return!!Object.keys(L).some(p=>q?.[Te(p)]===!1)},[E,X,L,ne,xe,de,Ee]),pe=o.useCallback(async()=>{if(!E||!X)return;let q=!1;try{Q(!0);const p={network:"evm",fromProtocol:n,toProtocol:X,debtTokenName:s.name,debtTokenAddress:s.tokenAddress,positionType:s.type,preferBatching:!!K};l!==void 0&&(p.chainId=l),he("refinance_tx_begin",p);const V=we(),G=(fe||"").toLowerCase(),ke=G.includes("aave")?"aave":G.includes("v3")?"v3":"v2",De=tt=>(tt||"").toLowerCase().replace(/\s+v\d+$/i,"").replace(/\s+/g,""),Re=De(X),$e=De(n);(Re==="compound"||$e==="compound")&&V.setCompoundMarket(s.tokenAddress);const Vt=($e==="morphoblue"||n.toLowerCase().includes("morpho"))&&r?r:"0x";V.buildUnlockDebt({fromProtocol:n,debtToken:s.tokenAddress,expectedDebt:S,debtDecimals:s.decimals,fromContext:Vt,flash:{version:ke,premiumBps:9,bufferBps:10}});const wt=ne&&ve?Nr(ve):void 0;Object.entries(L).forEach(([tt,qa])=>{const Wt=D.find(ct=>Te(ct.address)===Te(tt));if(!Wt)return;const La=U[tt]===!0;V.buildMoveCollateral({fromProtocol:n,toProtocol:X,collateralToken:tt,withdraw:La?{max:!0}:{amount:qa},collateralDecimals:Wt.decimals,fromContext:Vt,toContext:wt||"0x"})}),V.buildBorrow({mode:"coverFlash",toProtocol:X,token:s.tokenAddress,decimals:s.decimals,extraBps:5,approveToRouter:!0,toContext:wt||"0x"});const At=V.build(),Ke=await Pe(At,K,{revokePermissions:st});if(q=Ke?.kind==="batch",!Ke){const tt=await Pe(At,!1,{revokePermissions:st});q=q||tt?.kind==="batch"}const ot={network:"evm",fromProtocol:n,toProtocol:X,debtTokenName:s.name,debtTokenAddress:s.tokenAddress,positionType:s.type,preferBatching:!!K,batchingUsed:q,status:"success"};l!==void 0&&(ot.chainId=l),fe&&(ot.selectedProvider=fe),re&&(ot.selectedPool=re),he("refinance_tx_complete",ot)}catch(p){console.error("Refinance flow error:",p);const V={network:"evm",fromProtocol:n,toProtocol:X,debtTokenName:s.name,debtTokenAddress:s.tokenAddress,positionType:s.type,preferBatching:!!K,batchingUsed:q,status:"error",error:p instanceof Error?p.message:String(p)};l!==void 0&&(V.chainId=l),fe&&(V.selectedProvider=fe),re&&(V.selectedPool=re),he("refinance_tx_complete",V)}finally{Q(!1)}},[E,X,n,s,K,l,ne,xe,Ne,L,D,fe,re,a,we,W]),ht=o.useMemo(()=>null,[]),bt=o.useCallback(q=>{ce(q),J(!1)},[]);return t.jsx(va,{isOpen:e,onClose:a,debtSymbol:c,debtIcon:u,debtAmount:S,setDebtAmount:bt,debtMaxLabel:b,debtMaxRaw:f,debtConfirmed:E,setDebtConfirmed:_,debtInputRef:Ue,sourceProtocol:m,setIsDebtMaxClicked:J,activeTab:R,setActiveTab:k,showFlashLoanTab:!0,filteredDestinationProtocols:I,selectedProtocol:X,setSelectedProtocol:j,selectedVersion:Y,setSelectedVersion:C,vesuPools:P,sourcePoolName:ht,selectedPool:re,setSelectedPool:Ae,flashLoanProviders:N,selectedProvider:fe??"",setSelectedProvider:ue,collaterals:D,isLoadingCollaterals:g||nt,effectiveSupportedMap:Ee,addedCollaterals:L,expandedCollateral:M,tempAmount:ee,setTempAmount:Z,setTempIsMax:oe,onCollateralTileClick:le,onAddCollateral:Me,disableCollateralSelection:d,preSelectedCollaterals:i,getUsdValue:it,refiHF:ze,hfColor:rt,totalCollateralUsd:Fe,ltv:vt,debtUsd:Ie,isActionDisabled:z,isSubmitting:$,handleExecuteMove:pe,showBatchingOption:!0,preferBatching:K,setPreferBatching:se,revokePermissions:st,setRevokePermissions:ut,apiProbes:et,isMorphoSelected:ne,morphoMarkets:me,selectedMorphoMarket:xe,onMorphoMarketSelect:Ve,morphoSupportedCollaterals:de,isLoadingMorphoMarkets:je,chainId:l})};try{RefinanceModalEvmProps.displayName="RefinanceModalEvmProps",RefinanceModalEvmProps.__docgenInfo={description:"EVM-specific props extending base props",displayName:"RefinanceModalEvmProps",props:{}}}catch{}try{Za.displayName="RefinanceModalEvm",Za.__docgenInfo={description:"",displayName:"RefinanceModalEvm",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},fromProtocol:{defaultValue:null,description:"",name:"fromProtocol",required:!0,type:{name:"string"}},position:{defaultValue:null,description:"",name:"position",required:!0,type:{name:"RefinancePosition"}},preSelectedCollaterals:{defaultValue:null,description:"",name:"preSelectedCollaterals",required:!1,type:{name:"PreSelectedCollateral[]"}},disableCollateralSelection:{defaultValue:null,description:"",name:"disableCollateralSelection",required:!1,type:{name:"boolean"}},chainId:{defaultValue:null,description:"",name:"chainId",required:!1,type:{name:"number"}},fromContext:{defaultValue:null,description:"Pre-encoded context for the source protocol (e.g., Morpho MarketParams)",name:"fromContext",required:!1,type:{name:"string"}}}}}catch{}const Po=(e,a,n)=>{const[s,r]=o.useState(ma.Genesis),[l,i]=o.useState(pa.Prime),d=o.useMemo(()=>{if(!(a!=="VesuV2"||!n))try{return _t(n)}catch{return}},[a,n]);return o.useEffect(()=>{a==="VesuV2"&&d&&i(c=>c===d?c:d)},[e,a,d]),{selectedPoolId:s,setSelectedPoolId:r,selectedV2PoolAddress:l,setSelectedV2PoolAddress:i,normalizedCurrentV2PoolAddress:d,vesuPools:{v1Pools:Object.entries(ma).map(([c,u])=>({name:c,id:u})),v2Pools:Object.entries(pa).map(([c,u])=>({name:c,address:u}))}}},Dt=e=>(e??"").toLowerCase(),as=e=>({instruction_index:BigInt(e),output_index:0n}),Io=e=>{const{isOpen:a,fromProtocol:n,toProtocol:s,selectedVersion:r,debtAmount:l,isDebtMaxClicked:i,position:d,addedCollaterals:c,collateralIsMaxMap:u,collaterals:f,selectedPoolId:b,selectedV2PoolAddress:m}=e,{address:h}=vn(),{data:g}=Fr("RouterGateway"),{getAuthorizations:x,isReady:y}=dr(),[N,w]=o.useState([]),[P,I]=o.useState(!1),[D,O]=o.useState(null),B=o.useMemo(()=>{const E=Object.entries(c).map(([_,R])=>[Dt(_),R]).sort((_,R)=>_[0].localeCompare(R[0]));return JSON.stringify({isOpen:a,debtAmount:l,fromProtocol:n,toProtocol:s,selectedVersion:r,positionToken:d.tokenAddress,positionDecimals:d.decimals,positionPoolId:d.poolId==null?null:typeof d.poolId=="string"?d.poolId.toLowerCase():d.poolId.toString(),entries:E,maxMap:Object.entries(u).map(([_,R])=>[Dt(_),!!R]).sort((_,R)=>_[0].localeCompare(R[0])),colls:f.map(_=>({a:Dt(_.address),d:_.decimals,r:_.rawBalance.toString()})).sort((_,R)=>_.a.localeCompare(R.a)),selectedPoolId:b?.toString(),selectedV2PoolAddress:m,isDebtMaxClicked:i,starkUserAddress:h,router:g?.address})},[a,l,n,s,r,d.tokenAddress,d.decimals,d.poolId,c,u,f,b,m,i,h,g?.address]),{pairInstructions:v,authInstructions:H,authCalldataKey:S}=o.useMemo(()=>{if(!a||!l||!h||!g?.address)return{pairInstructions:[],authInstructions:[],authCalldataKey:""};const E=jt(l,d.decimals),_=n==="VesuV2"?"vesu_v2":n.toLowerCase(),R=s==="Vesu"?r==="v2"?"vesu_v2":"vesu":s.toLowerCase(),k=Object.entries(c).map(([Z,oe])=>({lower:Dt(Z),amt:oe})).sort((Z,oe)=>Z.lower.localeCompare(oe.lower));if(k.length===0)return{pairInstructions:[],authInstructions:[],authCalldataKey:""};const X=BigInt(k.length),j=E/X,Y=E-j*X,C=(1n<<256n)-1n,M=Z=>Z*101n/100n+1n,A=k.map((Z,oe)=>{const L=f.find(ae=>Dt(ae.address)===Z.lower);if(!L)return null;const U=oe===k.length-1,$=i&&U,Q=U?$?E-j*BigInt(k.length-1):j+Y:j;let K=null;n==="Vesu"?K=typeof d.poolId=="string"?BigInt(d.poolId):d.poolId??0n:n==="VesuV2"&&(K=BigInt(_t(d.poolId??m)));const se=K!==null?new Ge(Ye.Some,[K,BigInt(L.address)]):new Ge(Ye.None),ge=K!==null?new Ge(Ye.Some,[K,BigInt(d.tokenAddress)]):new Ge(Ye.None),ye=new Ht({Deposit:void 0,Borrow:void 0,Repay:{basic:{token:d.tokenAddress,amount:Ia.bnToUint256(Q),user:h},repay_all:$,context:se},Withdraw:void 0,Redeposit:void 0,Reborrow:void 0}),Se=u[Z.lower]===!0,le=jt(Z.amt||"0",L.decimals),Me=le===L.rawBalance,xe=Se||Me,Ve=xe?(ae=>ae*10001n/10000n+1n)(L.rawBalance):le,ie=new Ht({Deposit:void 0,Borrow:void 0,Repay:void 0,Withdraw:{basic:{token:L.address,amount:Ia.bnToUint256(Ve),user:h},withdraw_all:xe,context:ge},Redeposit:void 0,Reborrow:void 0}),re=as(0),Ae=as(1);let Ne=new Ge(Ye.None),W=new Ge(Ye.None);if(s==="Vesu")if(r==="v1")Ne=new Ge(Ye.Some,[b,BigInt(d.tokenAddress)]),W=new Ge(Ye.Some,[b,BigInt(L.address)]);else{const ae=BigInt(_t(m));Ne=new Ge(Ye.Some,[ae,BigInt(d.tokenAddress)]),W=new Ge(Ye.Some,[ae,BigInt(L.address)])}else if(s==="VesuV2"){const ae=BigInt(_t(m));Ne=new Ge(Ye.Some,[ae,BigInt(d.tokenAddress)]),W=new Ge(Ye.Some,[ae,BigInt(L.address)])}const te=new Ht({Deposit:void 0,Borrow:void 0,Repay:void 0,Withdraw:void 0,Redeposit:{token:L.address,target_output_pointer:Ae,user:h,context:Ne},Reborrow:void 0}),fe=$?C:M(Q),ue=new Ht({Deposit:void 0,Borrow:void 0,Repay:void 0,Withdraw:void 0,Redeposit:void 0,Reborrow:{token:d.tokenAddress,target_output_pointer:re,approval_amount:Ia.bnToUint256(fe),user:h,context:W}});return[{protocol_name:_,instructions:[ye,ie]},{protocol_name:R,instructions:[te,ue]}]}).filter(Boolean),ee=A.flatMap(Z=>{const oe=Z[0].instructions,L=Z[1].instructions;return[{protocol_name:_,instructions:[oe[1]]},{protocol_name:R,instructions:[L[1]]}]});return{pairInstructions:A,authInstructions:ee,authCalldataKey:JSON.stringify(qn.compile({instructions:ee,rawSelectors:!1}))}},[B]);o.useEffect(()=>{if(!a||!y||!H||H.length===0||!S){w([]),O(null),I(!1);return}let E=!1;return(async()=>{try{I(!0),O(null);const R=await x(H);E||w(R)}catch(R){E||(w([]),O(R.message||"Failed to fetch authorizations"))}finally{E||I(!1)}})(),()=>{E=!0}},[a,y,x,H,S]);const ce=o.useMemo(()=>{if(!v||v.length===0)return[];const E=N??[],_=cr(E),R=v.map(k=>({contractName:"RouterGateway",functionName:"move_debt",args:qn.compile({instructions:k})}));return[...E,...R,..._]},[v,N]),{sendAsync:J}=jr({calls:ce});return{calls:ce,isLoadingAuths:P,sendAsync:J||null,error:D}},Mo=(e,a,n,s,r,l)=>{const{address:i}=vn(),d=o.useMemo(()=>a==="Vesu"?n==="v2"?"VesuV2":"Vesu":a,[a,n]),{collaterals:c}=kn({protocolName:d,userAddress:i||"0x0000000000000000000000000000000000000000",isOpen:r&&!!d,vesuV1PoolId:n==="v1"?l?.vesuV1PoolId:void 0,vesuV2PoolAddress:n==="v2"?l?.vesuV2PoolAddress:void 0});return{supportedCollateralMap:o.useMemo(()=>{if(!c||c.length===0)return;const f=new Set(c.map(m=>m.address.toLowerCase())),b={};return s.forEach(m=>{b[m.address.toLowerCase()]=f.has(m.address.toLowerCase())}),b},[c,s]),targetCollaterals:c,targetProtocolName:d}},en=({isOpen:e,onClose:a,fromProtocol:n,position:s,preSelectedCollaterals:r,disableCollateralSelection:l})=>{const{debtSymbol:i,debtIcon:d,debtMaxRaw:c,debtMaxLabel:u,sourceProtocol:f,isLoadingCollaterals:b,destinationProtocols:m,flashLoanProviders:h}=_a({isOpen:e,networkType:"starknet",fromProtocol:n,position:s}),{address:g}=vn(),x=o.useMemo(()=>{const ne=m.filter(de=>de.name!=="VesuV2");return ne.length>0?ne:[{name:"Nostra",logo:at("Nostra")}]},[m]),{selectedPoolId:y,setSelectedPoolId:N,selectedV2PoolAddress:w,setSelectedV2PoolAddress:P,vesuPools:I}=Po("starknet",n,s.poolId),D=o.useMemo(()=>{if(!s.poolId||n!=="Vesu"&&n!=="VesuV2")return null;if(n==="Vesu"){const ne=typeof s.poolId=="string"?BigInt(s.poolId):s.poolId,de=uo(ne);return de!=="Unknown"?de:null}else try{const ne=typeof s.poolId=="string"?_t(s.poolId):_t(String(s.poolId)),de=mo(ne);return de!=="Unknown"?de:null}catch{return null}},[n,s.poolId]),{collaterals:O}=kn({protocolName:n,userAddress:g||"0x0000000000000000000000000000000000000000",isOpen:e}),B=O.map(ne=>({address:ne.address,symbol:ne.symbol,icon:Rt(ne.symbol.toLowerCase()),decimals:ne.decimals,rawBalance:ne.rawBalance,balance:ne.balance})),v=Es({collateralsFromHook:B,preSelectedCollaterals:r,disableCollateralSelection:l,sortByAddress:!0}),H=Ts(e),{debtAmount:S,setDebtAmount:ce,setIsDebtMaxClicked:J,isDebtMaxClicked:E,debtConfirmed:_,setDebtConfirmed:R,activeTab:k,setActiveTab:X,selectedProtocol:j,setSelectedProtocol:Y,selectedProvider:C,setSelectedProvider:M,selectedVersion:A,setSelectedVersion:ee,expandedCollateral:Z,setExpandedCollateral:oe,tempAmount:L,setTempAmount:U,setTempIsMax:$,addedCollaterals:Q,collateralIsMaxMap:K,isSubmitting:se,setIsSubmitting:ge,resetState:ye,onCollateralTileClick:Se,onAddCollateral:le}=H,Me=o.useRef(!1);o.useEffect(()=>{e&&!Me.current&&he("refinance_modal_open",{network:"starknet",fromProtocol:n,debtTokenName:s.name,debtTokenAddress:s.tokenAddress,positionType:s.type}),Me.current=e},[n,e,s.name,s.tokenAddress,s.type]);const{supportedCollateralMap:xe}=Mo(n,j,A,v,e,{vesuV1PoolId:y,vesuV2PoolAddress:w}),ve=o.useMemo(()=>xe??{},[xe]),Ve=o.useRef(null);Us({isOpen:e,preSelectedCollaterals:r,collaterals:v,expandedCollateral:Z,setExpandedCollateral:oe,setTempAmount:U,setTempIsMax:$}),$s({isOpen:e,filteredDestinationProtocols:x,selectedProtocol:j,setSelectedProtocol:Y}),o.useEffect(()=>{if(!(!e||!(j==="Vesu"||j==="VesuV2")||!I))if(A==="v1"){const de=n==="Vesu"&&s.poolId?typeof s.poolId=="string"?BigInt(s.poolId):s.poolId:void 0,_e=I.v1Pools.filter(me=>de===void 0||me.id!==de);if(!(I.v1Pools.some(me=>me.id===y)&&(!de||y!==de))){const me=_e[0]?.id??I.v1Pools[0]?.id;me&&N(me)}}else{const de=n==="VesuV2"&&s.poolId?String(s.poolId):void 0,_e=de?de.toLowerCase():void 0;if(!(!!w&&I.v2Pools.some(me=>me.address.toLowerCase()===w.toLowerCase())&&(!_e||w.toLowerCase()!==_e))){const we=I.v2Pools.filter(Pe=>!_e||Pe.address.toLowerCase()!==_e)[0]?.address??I.v2Pools[0]?.address;we&&P(we)}}},[e,j,A,I,N,P]),Ws({isOpen:e,debtConfirmed:_,debtInputRef:Ve}),o.useEffect(()=>{ye()},[e,ye]);const ie=o.useCallback((ne,de)=>0,[]),re=0,Ae=0,Ne="0.0",W=999,te=o.useMemo(()=>({tone:"text-success",badge:"badge-success"}),[]),fe=Io({isOpen:e,fromProtocol:n,toProtocol:j||"Nostra",selectedVersion:A,debtAmount:S,isDebtMaxClicked:E,position:s,addedCollaterals:Q,collateralIsMaxMap:K,collaterals:v,selectedPoolId:y,selectedV2PoolAddress:w}),ue=fe.sendAsync,ae=fe.error,Ee=!_||!j||Object.keys(Q).length===0,nt=o.useCallback(async()=>{if(!(!_||!j))try{if(ge(!0),he("refinance_tx_begin",{network:"starknet",fromProtocol:n,toProtocol:j,debtTokenName:s.name,debtTokenAddress:s.tokenAddress,positionType:s.type,preferBatching:!1,batchingUsed:!1}),!ue)throw new Error("Starknet transaction not ready");await ue(),he("refinance_tx_complete",{network:"starknet",fromProtocol:n,toProtocol:j,debtTokenName:s.name,debtTokenAddress:s.tokenAddress,positionType:s.type,preferBatching:!1,batchingUsed:!1,status:"success"}),setTimeout(()=>a(),2e3)}catch(ne){console.error("Refinance flow error:",ne),he("refinance_tx_complete",{network:"starknet",fromProtocol:n,toProtocol:j,debtTokenName:s.name,debtTokenAddress:s.tokenAddress,positionType:s.type,preferBatching:!1,batchingUsed:!1,status:"error",error:ne instanceof Error?ne.message:String(ne)})}finally{ge(!1)}},[_,j,n,s.name,s.tokenAddress,s.type,ue,ge,a]);return o.useEffect(()=>{ae&&console.error("Starknet authorization error:",ae)},[ae]),t.jsx(va,{isOpen:e,onClose:a,debtSymbol:i,debtIcon:d,debtAmount:S,setDebtAmount:ce,debtMaxLabel:u,debtMaxRaw:c,debtConfirmed:_,setDebtConfirmed:R,debtInputRef:Ve,sourceProtocol:f,setIsDebtMaxClicked:J,activeTab:k,setActiveTab:X,showFlashLoanTab:!1,filteredDestinationProtocols:x,selectedProtocol:j,setSelectedProtocol:Y,selectedVersion:A,setSelectedVersion:ee,vesuPools:I,sourcePoolName:D,selectedPoolId:y,setSelectedPoolId:N,selectedV2PoolAddress:w,setSelectedV2PoolAddress:P,flashLoanProviders:h,selectedProvider:C??"",setSelectedProvider:M,collaterals:v,isLoadingCollaterals:b,effectiveSupportedMap:ve,addedCollaterals:Q,expandedCollateral:Z,tempAmount:L,setTempAmount:U,setTempIsMax:$,onCollateralTileClick:Se,onAddCollateral:le,disableCollateralSelection:l,preSelectedCollaterals:r,getUsdValue:ie,refiHF:W,hfColor:te,totalCollateralUsd:re,ltv:Ne,debtUsd:Ae,isActionDisabled:Ee,isSubmitting:se,handleExecuteMove:nt,showBatchingOption:!1,preferBatching:!1,errorMessage:ae?`Starknet error: ${ae}`:void 0})};try{RefinanceModalStarkProps.displayName="RefinanceModalStarkProps",RefinanceModalStarkProps.__docgenInfo={description:"Starknet-specific props (currently same as base)",displayName:"RefinanceModalStarkProps",props:{}}}catch{}try{en.displayName="RefinanceModalStark",en.__docgenInfo={description:"",displayName:"RefinanceModalStark",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},fromProtocol:{defaultValue:null,description:"",name:"fromProtocol",required:!0,type:{name:"string"}},position:{defaultValue:null,description:"",name:"position",required:!0,type:{name:"RefinancePosition"}},preSelectedCollaterals:{defaultValue:null,description:"",name:"preSelectedCollaterals",required:!1,type:{name:"PreSelectedCollateral[]"}},disableCollateralSelection:{defaultValue:null,description:"",name:"disableCollateralSelection",required:!1,type:{name:"boolean"}}}}}catch{}const tn=({isOpen:e,onClose:a,fromProtocol:n,position:s,chainId:r,networkType:l,preSelectedCollaterals:i,disableCollateralSelection:d,fromContext:c})=>l==="evm"?t.jsx(Za,{isOpen:e,onClose:a,fromProtocol:n,position:s,chainId:r,preSelectedCollaterals:i,disableCollateralSelection:d,fromContext:c}):t.jsx(en,{isOpen:e,onClose:a,fromProtocol:n,position:s,preSelectedCollaterals:i,disableCollateralSelection:d});try{tn.displayName="RefinanceModal",tn.__docgenInfo={description:"",displayName:"RefinanceModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},fromProtocol:{defaultValue:null,description:"",name:"fromProtocol",required:!0,type:{name:"string"}},position:{defaultValue:null,description:"",name:"position",required:!0,type:{name:'{ name: string; tokenAddress: string; decimals: number; balance?: number | bigint | undefined; poolId?: string | bigint | undefined; type: "borrow" | "supply"; }'}},chainId:{defaultValue:null,description:"",name:"chainId",required:!1,type:{name:"number"}},networkType:{defaultValue:null,description:"",name:"networkType",required:!0,type:{name:"enum",value:[{value:'"evm"'},{value:'"starknet"'}]}},preSelectedCollaterals:{defaultValue:null,description:"",name:"preSelectedCollaterals",required:!1,type:{name:"{ token: string; symbol: string; decimals: number; amount?: bigint; maxAmount?: bigint; inputValue?: string | undefined; }[] | undefined"}},disableCollateralSelection:{defaultValue:null,description:"",name:"disableCollateralSelection",required:!1,type:{name:"boolean"}},fromContext:{defaultValue:null,description:"Pre-encoded context for the source protocol (e.g., Morpho MarketParams)",name:"fromContext",required:!1,type:{name:"string"}}}}}catch{}const Ks="/api/1inch",Gs=async(e,a)=>ms(async()=>{const n=await fetch(e,{headers:{Accept:"application/json"}});if(n.status===429)throw new Error("1inch API rate limit exceeded");const s=await n.json();if(yt.debug(`1inch ${a} response: ${JSON.stringify(s)}`),s.error)throw new Error(s.description||s.error);return s},{retries:2,baseDelay:1e3,isRetryable:n=>ps(n)||fs(n),onRetry:(n,s,r)=>{}}),Ys=e=>{const a=new URLSearchParams;for(const[n,s]of Object.entries(e))s!=null&&a.append(n,String(s));return a},To=async(e,a)=>{const n=Ys({src:a.src,dst:a.dst,amount:a.amount,includeGas:a.includeGas?"true":void 0}),s=`${Ks}/${e}/quote?${n.toString()}`;return Gs(s,"quote")},Bo=async(e,a)=>{const n=Ys({src:a.src,dst:a.dst,amount:a.amount,from:a.from,slippage:a.slippage,disableEstimate:a.disableEstimate,includeTokensInfo:a.includeTokensInfo,includeProtocols:a.includeProtocols,includeGas:a.includeGas}),s=`${Ks}/${e}/swap?${n.toString()}`;return Gs(s,"swap")},ns={REALTIME_STALE:1e4,REALTIME_REFETCH:1e4},jn={FAST:300,STANDARD:500},Sn={quote:{staleTime:ns.REALTIME_STALE,refetchInterval:ns.REALTIME_REFETCH,refetchOnWindowFocus:!1,retry:!1}},Vn={oneInchQuote:(e,a,n,s,r,l)=>["1inch-quote",e,a?.toLowerCase()??"",n?.toLowerCase()??"",s,r?.toLowerCase(),l],oneInchQuoteOnly:(e,a,n,s)=>["1inch-quote-only",e,a?.toLowerCase()??"",n?.toLowerCase()??"",s],cowQuote:(e,a,n,s,r,l)=>["cow-quote",e,a?.toLowerCase()??"",n?.toLowerCase()??"",s,r,l?.toLowerCase()??""],pendleConvert:(e,a,n,s,r,l)=>["pendle-convert",e,a?.toLowerCase()??"",JSON.stringify(n),JSON.stringify(s),JSON.stringify(r),l],morphoMarkets:(e,a)=>["morpho-markets",e,a?.trim()||void 0],morphoMarketsSupport:e=>["morpho-markets-support",e],morphoPositions:(e,a)=>["morpho-positions",e,a?.toLowerCase()??""],pendleYields:e=>["pendle-pt-yields",e],walletTokenBalances:(e,a,n,s)=>["wallet-token-balances",e,a,n?.toLowerCase()??"",(s??[]).map(r=>r?.toLowerCase()??"")],cowOrderStatus:(e,a)=>["cow-order-status",e,a],cowOrdersStatus:(e,a)=>["cow-orders-status",e.join(","),a],cowOrders:()=>["cow-orders"]};function An(...e){return e.every(a=>typeof a=="boolean"?a:typeof a=="string"?a.length>0:typeof a=="number"?a>0:a!=null)}function Xs(e){if(!e)return!1;try{return BigInt(e)>0n}catch{return!1}}const Js=({chainId:e,src:a,dst:n,amount:s,from:r,slippage:l=1,enabled:i=!0})=>{const[d]=yn(s,jn.STANDARD),c=Lt(e),u=An(c,i,Xs(d),a,n,r);return Mt({queryKey:Vn.oneInchQuote(e,a,n,d,r,l),queryFn:async()=>{if(!Lt(e))throw new Error(`1inch is not supported on chain ${e}`);try{return await Bo(wn(e),{src:a,dst:n,amount:d,from:r,slippage:l,disableEstimate:!0,includeTokensInfo:!0})}catch(f){throw console.error("1inch API Error:",f),f}},enabled:u,...Sn.quote})},Fo="/api/pendle",gt=(e,a,n)=>{if(n!=null){if(Array.isArray(n)){n.forEach(s=>e.append(a,s));return}e.append(a,n.toString())}},Do=async(e,a)=>{const n=new URLSearchParams;gt(n,"receiver",a.receiver),gt(n,"slippage",a.slippage),gt(n,"enableAggregator",!0),gt(n,"deadline",a.deadline??so()),gt(n,"tokensIn",Array.isArray(a.tokensIn)?a.tokensIn:[a.tokensIn]),gt(n,"tokensOut",Array.isArray(a.tokensOut)?a.tokensOut:[a.tokensOut]),gt(n,"amountsIn",Array.isArray(a.amountsIn)?a.amountsIn:[a.amountsIn]),gt(n,"aggregators",a.aggregators);const s=`${Fo}/${e}/convert?${n.toString()}`;return ms(async()=>{const r=await fetch(s,{headers:{Accept:"application/json"}});if(r.status===429)throw new Error("Pendle API rate limit exceeded");const l=await r.json();if(!r.ok||l.error){const f=l;throw new Error(f.error||f.description||f.message||"Pendle convert request failed")}const i=l;if(!i.routes||i.routes.length===0)throw new Error("Pendle API returned no routes");const d=i.routes[0],c=d.outputs?.[0]?.amount||"0",u=d.data?.priceImpact;return{transaction:{to:d.tx.to,data:d.tx.data,from:d.tx.from},data:{amountTokenOut:c,amountPtOut:c,priceImpact:u}}},{retries:2,baseDelay:1e3,isRetryable:r=>ps(r)||fs(r),onRetry:(r,l,i)=>{console.warn(`[Pendle convert] Retry ${r}, waiting ${i}ms`,l)}})},Ro=e=>{if(Array.isArray(e))return e.some(a=>{try{return BigInt(a||"0")>0n}catch{return!1}});try{return BigInt(e||"0")>0n}catch{return!1}},an=({chainId:e,enabled:a=!0,...n})=>{const[s]=yn(n.amountsIn,jn.FAST),r=bn(e),l=Array.isArray(n.tokensIn)?n.tokensIn.length>0:!!n.tokensIn,i=Array.isArray(n.tokensOut)?n.tokensOut.length>0:!!n.tokensOut,d=An(r,a,n.receiver,Ro(s),l,i);return Mt({queryKey:Vn.pendleConvert(e,n.receiver,n.tokensIn,n.tokensOut,s,n.slippage),queryFn:()=>Do(wn(e),{...n,amountsIn:s}),enabled:d,...Sn.quote})};function wa({sellToken:e,buyToken:a,sellAmount:n,buyAmount:s,kind:r="sell",from:l,enabled:i=!0}){const d=As(),c=r==="buy"?s:n;return Mt({queryKey:["cow-quote",d,e,a,c,r,l],queryFn:async()=>{if(!e||!a||!c||c==="0"||!l)return null;try{const u=`/api/cow/${d}/quote`,f={sellToken:e,buyToken:a,from:l,kind:r,receiver:l,appData:'{"version":"1.0.0","metadata":{}}',signingScheme:"eip1271",onchainOrder:!1,partiallyFillable:!1};r==="buy"?f.buyAmountAfterFee=c:f.sellAmountBeforeFee=c;const b=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});if(!b.ok){const h=await b.text();return yt.warn("[useCowQuote] Quote failed:",b.status,h),null}return await b.json()}catch(u){return yt.error("[useCowQuote] Error fetching quote:",u),null}},enabled:i&&!!e&&!!a&&!!c&&c!=="0"&&!!l&&Fa(d),staleTime:1e4,refetchInterval:15e3})}function ss(e){return e?.quote?.buyAmount?BigInt(e.quote.buyAmount):0n}function ka(e){return e?.quote?.sellAmount?BigInt(e.quote.sellAmount):0n}function rs(e){return e?.quote?.feeAmount?BigInt(e.quote.feeAmount):0n}try{wa.displayName="useCowQuote",wa.__docgenInfo={description:"Hook to fetch a quote from CoW Protocol API",displayName:"useCowQuote",props:{sellToken:{defaultValue:null,description:"Token being sold",name:"sellToken",required:!0,type:{name:"string"}},buyToken:{defaultValue:null,description:"Token being bought",name:"buyToken",required:!0,type:{name:"string"}},sellAmount:{defaultValue:null,description:'Amount to sell (in wei) - use for kind="sell"',name:"sellAmount",required:!1,type:{name:"string"}},buyAmount:{defaultValue:null,description:'Amount to buy (in wei) - use for kind="buy"',name:"buyAmount",required:!1,type:{name:"string"}},kind:{defaultValue:{value:"sell"},description:'Order kind: "sell" (exact sell, min buy) or "buy" (exact buy, max sell)',name:"kind",required:!1,type:{name:"enum",value:[{value:'"sell"'},{value:'"buy"'}]}},from:{defaultValue:null,description:"Address that will sign the order",name:"from",required:!0,type:{name:"string"}},enabled:{defaultValue:{value:"true"},description:"Whether the quote is enabled",name:"enabled",required:!1,type:{name:"boolean"}}}}}catch{}try{ss.displayName="getCowQuoteBuyAmount",ss.__docgenInfo={description:"Extract the buy amount from a CoW quote",displayName:"getCowQuoteBuyAmount",props:{quote:{defaultValue:null,description:"",name:"quote",required:!0,type:{name:"{ sellToken: string; buyToken: string; receiver: string; sellAmount: string; buyAmount: string; validTo: number; appData: string; feeAmount: string; kind: string; partiallyFillable: boolean; sellTokenBalance: string; buyTokenBalance: string; }"}},from:{defaultValue:null,description:"",name:"from",required:!0,type:{name:"string"}},expiration:{defaultValue:null,description:"",name:"expiration",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"number"}}}}}catch{}try{ka.displayName="getCowQuoteSellAmount",ka.__docgenInfo={description:"Extract the sell amount from a CoW quote (useful for KIND_BUY quotes)",displayName:"getCowQuoteSellAmount",props:{quote:{defaultValue:null,description:"",name:"quote",required:!0,type:{name:"{ sellToken: string; buyToken: string; receiver: string; sellAmount: string; buyAmount: string; validTo: number; appData: string; feeAmount: string; kind: string; partiallyFillable: boolean; sellTokenBalance: string; buyTokenBalance: string; }"}},from:{defaultValue:null,description:"",name:"from",required:!0,type:{name:"string"}},expiration:{defaultValue:null,description:"",name:"expiration",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"number"}}}}}catch{}try{rs.displayName="getCowQuoteFeeAmount",rs.__docgenInfo={description:"Extract the fee amount from a CoW quote",displayName:"getCowQuoteFeeAmount",props:{quote:{defaultValue:null,description:"",name:"quote",required:!0,type:{name:"{ sellToken: string; buyToken: string; receiver: string; sellAmount: string; buyAmount: string; validTo: number; appData: string; feeAmount: string; kind: string; partiallyFillable: boolean; sellTokenBalance: string; buyTokenBalance: string; }"}},from:{defaultValue:null,description:"",name:"from",required:!0,type:{name:"string"}},expiration:{defaultValue:null,description:"",name:"expiration",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"number"}}}}}catch{}const Oo=[{inputs:[{components:[{name:"user",type:"address"},{name:"preInstructionsPerIteration",type:"bytes[]"},{name:"preTotalAmount",type:"uint256"},{name:"sellToken",type:"address"},{name:"buyToken",type:"address"},{name:"chunkSize",type:"uint256"},{name:"minBuyPerChunk",type:"uint256"},{name:"postInstructionsPerIteration",type:"bytes[]"},{name:"completion",type:"uint8"},{name:"targetValue",type:"uint256"},{name:"minHealthFactor",type:"uint256"},{name:"appDataHash",type:"bytes32"},{name:"isFlashLoanOrder",type:"bool"},{name:"isKindBuy",type:"bool"}],name:"params",type:"tuple"},{name:"salt",type:"bytes32"},{name:"seedAmount",type:"uint256"}],name:"createOrder",outputs:[{name:"orderHash",type:"bytes32"}],stateMutability:"nonpayable",type:"function"}],Eo=[{inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}];function Uo(e,a,n,s,r){const l=[],i=new Set;if(n&&s&&r!==void 0&&(l.push(Nt(_n(r,s))),l.push(Nt(_n(0n,s)))),a)for(const d of a){const c=`${d.protocolName}:${d.data}`;i.has(c)||(i.add(c),l.push(d))}for(const d of e)for(const c of[...d.preInstructions,...d.postInstructions]){const u=`${c.protocolName}:${c.data}`;i.has(u)||(i.add(u),l.push(c))}return l}function Zs(){const{address:e}=Sa(),a=Ut(),n=As(),{data:s,isLoading:r}=Da({contractName:"KapanOrderManager"}),{data:l}=Da({contractName:"KapanRouter"}),i=s?.address,{getAuthorizations:d}=It(),c=o.useCallback(async()=>{if(!e||!i||!a||!l)return!1;try{return await a.readContract({address:l.address,abi:l.abi,functionName:"userDelegates",args:[e,i]})}catch(m){return yt.error("[useCowLimitOrder] Error checking delegation:",m),!1}},[e,i,a,l]),u=o.useCallback(async m=>{if(!e||!i||!l){yt.error("[useCowLimitOrder] Missing context for buildOrderCalls");return}if(!Fa(n)){yt.error("[useCowLimitOrder] Chain not supported:",n);return}const h=Sr(),g=await Vr(n,i,e,h,m.flashLoan?{flashLoan:{lender:m.flashLoan.lender,token:m.flashLoan.token,amount:m.flashLoan.amount}}:void 0);if(!g.registered)return yt.error("[useCowLimitOrder] AppData registration failed:",g.error),{success:!1,calls:[],salt:h,appDataHash:g.appDataHash||"",error:`AppData registration failed: ${g.error}`,errorDetails:{stage:"appData",apiResponse:g.error}};yt.debug("[useCowLimitOrder] AppData registered:",g.appDataHash);const x=m.chunks.map(O=>O.preInstructions),y=m.chunks.map(O=>{if(m.flashLoan&&O.flashLoanRepaymentUtxoIndex!==void 0){const B=Ar(n)||_r(m.flashLoan.lender,n),v=Nt(qr(O.flashLoanRepaymentUtxoIndex,B));return[...O.postInstructions,v]}return O.postInstructions}),N=Lr({user:e,sellToken:m.sellToken,buyToken:m.buyToken,preTotalAmount:m.totalAmount,chunkSize:m.chunkSize,minBuyPerChunk:m.minBuyPerChunk,completion:m.completion,targetValue:m.targetValue,minHealthFactor:m.minHealthFactor??"1.1",preInstructions:x,postInstructions:y,appDataHash:g.appDataHash,isFlashLoanOrder:!!m.flashLoan,isKindBuy:m.isKindBuy??!1}),w=[];await c()||w.push({to:l.address,data:zt({abi:l.abi,functionName:"setDelegate",args:[i,!0]})});const I=Uo(m.chunks,m.preOrderInstructions,m.isKindBuy,m.sellToken,m.totalAmount);if(I.length>0){const O=await d(I);for(const{target:B,data:v}of O)B&&v&&v.length>0&&w.push({to:B,data:v})}const D=m.flashLoan?0n:m.seedAmount??0n;return D>0n&&w.push({to:m.sellToken,data:zt({abi:Eo,functionName:"approve",args:[i,D]})}),w.push({to:i,data:zt({abi:s?.abi??Oo,functionName:"createOrder",args:[N,h,D]})}),{success:!0,calls:w,salt:h,appDataHash:g.appDataHash}},[e,i,s,l,n,c,d]),f=o.useMemo(()=>!!(e&&i&&l&&Fa(n)),[e,i,l,n]),b=o.useCallback(m=>{if(!(!l||m.length===0))return{to:l.address,data:zt({abi:l.abi,functionName:"processProtocolInstructions",args:[m.map(h=>({protocolName:h.protocolName,data:h.data}))]})}},[l]);return{buildOrderCalls:u,buildRouterCall:b,isReady:f,orderManagerAddress:i,routerAddress:l?.address,isLoading:r,checkDelegation:c}}const nn=(e,a)=>{if(!e||!a)return 0;const n=parseFloat(e);return isNaN(n)?0:n*Number(F(a,8))},er=e=>e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),os=({flashLoanProviders:e,selectedProvider:a,flashLoanLiquidityData:n,swapRouter:s,setSwapRouter:r,onFlashLoanProviderChange:l,onSwapRouterChange:i,className:d=""})=>{const c=e&&e.length>1,u=e&&e.length===1&&a;if(!(r||c||u))return null;const b=h=>{i(h.target.value)},m=h=>{const g=e?.find(x=>x.name===h.target.value);g&&l(g)};return t.jsxs("div",{className:`flex flex-wrap items-center gap-x-3 gap-y-1 text-xs ${d}`,children:[r&&t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-base-content/50",children:"Router:"}),t.jsx("select",{className:"select select-xs select-ghost text-base-content/80 font-medium min-h-0 h-auto py-0.5",value:s||"1inch",onChange:b,children:Ho.map(h=>t.jsx("option",{value:h.value,children:h.label},h.value))})]}),c&&t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-base-content/50",children:"Flash Loan:"}),t.jsx("select",{className:"select select-xs select-ghost text-base-content/80 font-medium min-h-0 h-auto py-0.5",value:a?.name||"",onChange:m,children:e.map(h=>{const g=n?.find(y=>y.provider===h.providerEnum),x=g?.hasLiquidity??!0;return t.jsxs("option",{value:h.name,children:[h.name," ",g?x?"✓":"⚠️":""]},h.name)})})]}),u&&!c&&t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-base-content/50",children:"Flash Loan:"}),t.jsx("span",{className:"text-base-content/80 font-medium",children:a.name})]})]})},ls=({label:e,asset:a,assets:n,isReadOnly:s,showAvailable:r=!1,value:l,isLoading:i=!1,usdValue:d,onTokenChange:c,onValueChange:u,onSetMax:f})=>t.jsxs("div",{className:"bg-base-200/50 border border-base-300/50 rounded-lg px-3 py-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-[10px] text-base-content/50 mb-1",children:[t.jsx("span",{className:"uppercase tracking-wide",children:e}),r&&t.jsxs("span",{children:["Available: ",a?Number(F(a.rawBalance,a.decimals)).toLocaleString(void 0,{maximumFractionDigits:4}):"0"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[a&&t.jsx("div",{className:"relative size-5 flex-shrink-0",children:t.jsx(Be,{src:a.icon,alt:a.symbol,fill:!0,className:"rounded-full object-contain"})}),s?t.jsx("span",{className:"font-medium text-sm",children:a?.symbol||"-"}):t.jsx("select",{className:"select select-ghost select-xs pl-0 font-medium text-sm focus:outline-none bg-transparent min-h-0 h-auto",value:a?.symbol||"",onChange:c,children:n.map(b=>t.jsx("option",{value:b.symbol,children:b.symbol},b.address))})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[u?t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:l,onChange:u,placeholder:"0.00",className:"w-[100px] bg-transparent text-right text-sm font-medium outline-none placeholder:text-base-content/30"}),f&&t.jsx("button",{onClick:f,className:"text-primary hover:text-primary/80 text-[10px] font-bold px-1.5 py-0.5 rounded bg-primary/10",children:"MAX"})]}):t.jsx("span",{className:"text-sm font-medium",children:i?t.jsx("span",{className:"loading loading-dots loading-xs"}):Number(l||"0").toLocaleString(void 0,{maximumFractionDigits:6})}),t.jsxs("span",{className:"text-base-content/40 text-[10px]",children:["≈$",er(d)]})]})]})]}),$o=({afterHf:e,afterLtv:a,beforeHf:n,beforeLtv:s})=>{if(e===void 0&&a===void 0)return null;const r=e!==void 0&&n!==void 0?e-n:void 0,l=a!==void 0&&s!==void 0?a-s:void 0,i=c=>!Number.isFinite(c)||c>=4?"text-success":c>2?"text-warning":"text-error",d=(c,u=!1)=>Math.abs(c)<.01?"text-base-content/50":(u?c<0:c>0)?"text-success":"text-error";return t.jsxs("div",{className:"bg-base-200/50 border border-base-300/50 rounded-lg p-3",children:[t.jsx("div",{className:"text-base-content/60 text-xs font-medium uppercase tracking-wide mb-2",children:"After Swap"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e!==void 0&&t.jsxs("div",{children:[t.jsx("div",{className:"text-base-content/50 text-xs",children:"Health Factor"}),t.jsxs("div",{className:"flex items-baseline gap-2",children:[t.jsx("span",{className:`text-lg font-semibold ${i(e)}`,children:Number.isFinite(e)?e.toFixed(2):"∞"}),r!==void 0&&Math.abs(r)>=.01&&t.jsxs("span",{className:`text-xs ${d(r)}`,children:[r>0?"+":"",r.toFixed(2)]})]})]}),a!==void 0&&t.jsxs("div",{children:[t.jsx("div",{className:"text-base-content/50 text-xs",children:"Loan To Value"}),t.jsxs("div",{className:"flex items-baseline gap-2",children:[t.jsxs("span",{className:"text-lg font-semibold",children:[a.toFixed(2),"%"]}),l!==void 0&&Math.abs(l)>=.01&&t.jsxs("span",{className:`text-xs ${d(l,!0)}`,children:[l>0?"+":"",l.toFixed(2),"%"]})]})]})]})]})},Wo=({slippage:e,slippageHandlers:a,priceImpact:n,minOutput:s,selectedTo:r})=>t.jsxs("div",{className:`grid ${n!==void 0?"grid-cols-3":"grid-cols-2"} bg-base-200/50 gap-4 rounded p-3 text-center`,children:[t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsxs("div",{className:"text-base-content/70 flex items-center gap-1 text-xs",children:["Slippage",t.jsxs("div",{className:"dropdown dropdown-top dropdown-hover",children:[t.jsx("label",{tabIndex:0,className:"hover:text-primary cursor-pointer",children:t.jsx(Ls,{className:"size-3"})}),t.jsx("ul",{tabIndex:0,className:"dropdown-content menu bg-base-100 rounded-box z-[50] mb-1 w-32 p-2 text-xs shadow",children:Cn.map(l=>t.jsx("li",{children:t.jsxs("a",{className:e===l?"active":"",onClick:a[l],children:[l,"%"]})},l))})]})]}),t.jsxs("div",{className:"text-sm font-medium",children:[e,"%"]})]}),n!==void 0&&t.jsxs("div",{children:[t.jsx("div",{className:"text-base-content/70 text-xs",children:"Price Impact"}),t.jsx("div",{className:`text-sm font-medium ${Ds(Fs(n))}`,children:Rs(n)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-base-content/70 text-xs",children:"Min Output"}),t.jsx("div",{className:"text-sm font-medium",children:s?t.jsxs(t.Fragment,{children:[parseFloat(s).toFixed(6),t.jsxs("span",{className:"text-base-content/60 ml-1 text-xs",children:["($",er(nn(s,r?.price)),")"]})]}):"-"})]})]}),zo=({preferBatching:e,setPreferBatching:a,onToggleBatching:n,swapActions:s})=>t.jsxs("div",{className:"flex items-center justify-between pt-2",children:[t.jsx("div",{className:"flex flex-col gap-1",children:a&&t.jsxs("button",{type:"button",onClick:n,className:`inline-flex cursor-pointer items-center gap-1 text-xs hover:opacity-80 ${e?"text-success":"text-base-content/60"}`,children:[t.jsx(Ba,{className:`size-4 ${e?"":"opacity-40"}`}),"Batch transactions"]})}),t.jsx("div",{className:"ml-4 flex-1",children:t.jsx(xn,{className:"w-full",autoCompact:!0,actions:s})})]}),Ho=[{value:"1inch",label:"1inch"},{value:"pendle",label:"Pendle"}],Ca=({isOpen:e,onClose:a,title:n,fromAssets:s,toAssets:r,initialFromAddress:l,selectedFrom:i,setSelectedFrom:d,selectedTo:c,setSelectedTo:u,amountIn:f,setAmountIn:b,setIsMax:m,amountOut:h,isQuoteLoading:g,quoteError:x,slippage:y,setSlippage:N,preferBatching:w,setPreferBatching:P,onSubmit:I,isSubmitting:D,canSubmit:O,submitLabel:B,infoContent:v,warnings:H,fromLabel:S="Swap From",toLabel:ce="Swap To",fromReadOnly:J=!1,toReadOnly:E=!1,customStats:_,hideDefaultStats:R=!1,priceImpact:k,leftPanel:X,rightPanel:j,afterMetrics:Y,positionMetrics:C,projectedMetrics:M})=>{const[A,ee]=o.useState("swap");o.useEffect(()=>{if(e&&!i&&s.length>0){if(l){const W=s.find(te=>te.address.toLowerCase()===l.toLowerCase());if(W){d(W);return}}d(s[0])}},[e,s,i,l,d]),o.useEffect(()=>{e&&!c&&r.length>0?u(r[0]):c&&i&&c.address===i.address&&u(r[0]||null)},[e,r,c,i,u]);const Z=o.useCallback(()=>{i&&(b(F(i.rawBalance,i.decimals)),m(!0))},[i,b,m]),oe=o.useCallback(()=>ee("swap"),[]),L=o.useCallback(()=>ee("info"),[]),U=o.useCallback(W=>{const te=s.find(fe=>fe.symbol===W.target.value);te&&d(te)},[s,d]),$=o.useCallback(W=>{b(W.target.value),m(!1)},[b,m]),Q=o.useCallback(W=>{const te=r.find(fe=>fe.symbol===W.target.value);te&&u(te)},[r,u]),K=o.useCallback(()=>{P&&P(W=>!W)},[P]),se=o.useCallback(W=>()=>{N(W)},[N]),ge=o.useMemo(()=>Cn.reduce((W,te)=>(W[te]=se(te),W),{}),[se]),ye=i?nn(f,i.price):0,Se=c?nn(h,c.price):0,le=o.useMemo(()=>{if(!h||parseFloat(h)===0)return null;const W=c?.decimals||18,te=Va(h,W);if(!te.value)return null;const fe=te.value*(10000n-BigInt(Math.round(y*100)))/10000n;return F(fe,W)},[h,y,c?.decimals]),Me=o.useMemo(()=>[{key:"swap",label:D?"Processing...":g?"Fetching Quote...":B,icon:D?t.jsx(Ss,{size:"xs"}):void 0,onClick:I,disabled:!O||g||D,variant:"ghost"}],[D,g,B,I,O]),xe=()=>t.jsx("div",{className:"space-y-4 py-2",children:v||t.jsxs("div",{className:"alert alert-info bg-info/10 border-info/20 text-sm",children:[t.jsx(Aa,{className:"size-5 flex-shrink-0"}),t.jsxs("span",{children:[t.jsxs("strong",{children:["How ",n," Works"]}),t.jsx("br",{}),"This feature uses flash loans and 1inch swaps to atomically change your position."]})]})}),ve=()=>_||(R?null:t.jsx(Wo,{slippage:y,slippageHandlers:ge,priceImpact:k,minOutput:le,selectedTo:c})),Ve=()=>t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"relative space-y-0.5",children:[t.jsx(ls,{label:S,asset:i,assets:s,isReadOnly:J,showAvailable:!0,value:f,usdValue:ye,onTokenChange:U,onValueChange:$,onSetMax:Z}),t.jsx(ls,{label:ce,asset:c,assets:r,isReadOnly:E,value:h,isLoading:g,usdValue:Se,onTokenChange:Q}),t.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10",children:t.jsx("div",{className:"bg-base-100 border border-base-300 rounded p-1 shadow-sm",children:t.jsx(Ur,{className:"text-base-content/60 size-3"})})})]}),ve(),Y,M&&t.jsx($o,{afterHf:M.afterHf,afterLtv:M.afterLtv,beforeHf:C?.hf,beforeLtv:C?.ltv}),x&&t.jsx(js,{message:`Error fetching quote: ${x.message}`,size:"sm",breakAll:!0}),H,t.jsx(zo,{preferBatching:w,setPreferBatching:P,onToggleBatching:K,swapActions:Me})]}),ie=X||C,re=!!j,Ae=ie&&re?"max-w-4xl":ie||re?"max-w-3xl":"max-w-2xl",Ne=()=>X||(C?t.jsx(mr,{hf:C.hf,utilization:0,ltv:C.ltv,metricLabel:C.metricLabel,metricValue:C.metricValue,token:C.token}):null);return t.jsxs("dialog",{className:`modal ${e?"modal-open":""}`,children:[t.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm",onClick:a}),t.jsx("div",{className:`modal-box bg-base-100 border-base-300/50 relative ${Ae} overflow-hidden rounded-xl border p-0`,children:t.jsxs("div",{className:"flex flex-col md:flex-row",children:[Ne(),t.jsxs("div",{className:"flex-1 p-5",children:[t.jsx("div",{className:"mb-4 flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("h3",{className:"text-base-content text-lg font-semibold",children:n}),t.jsxs("div",{className:"bg-base-200/50 flex items-center gap-1 rounded-lg p-1",children:[t.jsx("button",{className:`rounded-md px-3 py-1 text-xs font-medium transition-colors ${A==="swap"?"bg-base-100 text-base-content shadow-sm":"text-base-content/50"}`,onClick:oe,children:"Swap"}),t.jsx("button",{className:`rounded-md px-3 py-1 text-xs font-medium transition-colors ${A==="info"?"bg-base-100 text-base-content shadow-sm":"text-base-content/50"}`,onClick:L,children:"Info"})]})]})}),A==="info"?xe():Ve()]}),j&&t.jsx("div",{className:"bg-base-200/30 border-l border-base-300/50 p-4 w-64 flex-shrink-0",children:j})]})})]})};try{os.displayName="ProviderSelectors",os.__docgenInfo={description:"",displayName:"ProviderSelectors",props:{flashLoanProviders:{defaultValue:null,description:"",name:"flashLoanProviders",required:!1,type:{name:"FlashLoanProviderOption[]"}},selectedProvider:{defaultValue:null,description:"",name:"selectedProvider",required:!1,type:{name:"FlashLoanProviderOption | null"}},flashLoanLiquidityData:{defaultValue:null,description:"",name:"flashLoanLiquidityData",required:!1,type:{name:"{ provider: number; liquidity: bigint; hasLiquidity: boolean; }[]"}},swapRouter:{defaultValue:null,description:"",name:"swapRouter",required:!1,type:{name:"enum",value:[{value:'"1inch"'},{value:'"pendle"'}]}},setSwapRouter:{defaultValue:null,description:"",name:"setSwapRouter",required:!1,type:{name:"((router: SwapRouter) => void)"}},onFlashLoanProviderChange:{defaultValue:null,description:"",name:"onFlashLoanProviderChange",required:!0,type:{name:"(provider: FlashLoanProviderOption) => void"}},onSwapRouterChange:{defaultValue:null,description:"",name:"onSwapRouterChange",required:!0,type:{name:"(router: SwapRouter) => void"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{Ca.displayName="SwapModalShell",Ca.__docgenInfo={description:"",displayName:"SwapModalShell",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},protocolName:{defaultValue:null,description:"",name:"protocolName",required:!0,type:{name:"string"}},fromAssets:{defaultValue:null,description:"",name:"fromAssets",required:!0,type:{name:"SwapAsset[]"}},toAssets:{defaultValue:null,description:"",name:"toAssets",required:!0,type:{name:"SwapAsset[]"}},initialFromAddress:{defaultValue:null,description:"",name:"initialFromAddress",required:!1,type:{name:"string"}},selectedFrom:{defaultValue:null,description:"",name:"selectedFrom",required:!0,type:{name:"SwapAsset | null"}},setSelectedFrom:{defaultValue:null,description:"",name:"setSelectedFrom",required:!0,type:{name:"(a: SwapAsset | null) => void"}},selectedTo:{defaultValue:null,description:"",name:"selectedTo",required:!0,type:{name:"SwapAsset | null"}},setSelectedTo:{defaultValue:null,description:"",name:"setSelectedTo",required:!0,type:{name:"(a: SwapAsset | null) => void"}},amountIn:{defaultValue:null,description:"",name:"amountIn",required:!0,type:{name:"string"}},setAmountIn:{defaultValue:null,description:"",name:"setAmountIn",required:!0,type:{name:"(v: string) => void"}},isMax:{defaultValue:null,description:"",name:"isMax",required:!0,type:{name:"boolean"}},setIsMax:{defaultValue:null,description:"",name:"setIsMax",required:!0,type:{name:"(v: boolean) => void"}},amountOut:{defaultValue:null,description:"",name:"amountOut",required:!0,type:{name:"string"}},isQuoteLoading:{defaultValue:null,description:"",name:"isQuoteLoading",required:!0,type:{name:"boolean"}},quoteError:{defaultValue:null,description:"",name:"quoteError",required:!1,type:{name:"Error | null"}},slippage:{defaultValue:null,description:"",name:"slippage",required:!0,type:{name:"number"}},setSlippage:{defaultValue:null,description:"",name:"setSlippage",required:!0,type:{name:"(v: number) => void"}},preferBatching:{defaultValue:null,description:"",name:"preferBatching",required:!1,type:{name:"boolean"}},setPreferBatching:{defaultValue:null,description:"",name:"setPreferBatching",required:!1,type:{name:"((fn: (prev: boolean) => boolean) => void)"}},onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"() => void"}},isSubmitting:{defaultValue:null,description:"",name:"isSubmitting",required:!0,type:{name:"boolean"}},canSubmit:{defaultValue:null,description:"",name:"canSubmit",required:!0,type:{name:"boolean"}},submitLabel:{defaultValue:null,description:"",name:"submitLabel",required:!0,type:{name:"string"}},infoContent:{defaultValue:null,description:"",name:"infoContent",required:!1,type:{name:"ReactNode"}},warnings:{defaultValue:null,description:"",name:"warnings",required:!1,type:{name:"ReactNode"}},fromLabel:{defaultValue:{value:"Swap From"},description:"",name:"fromLabel",required:!1,type:{name:"string"}},toLabel:{defaultValue:{value:"Swap To"},description:"",name:"toLabel",required:!1,type:{name:"string"}},fromReadOnly:{defaultValue:{value:"false"},description:"",name:"fromReadOnly",required:!1,type:{name:"boolean"}},toReadOnly:{defaultValue:{value:"false"},description:"",name:"toReadOnly",required:!1,type:{name:"boolean"}},customStats:{defaultValue:null,description:"",name:"customStats",required:!1,type:{name:"ReactNode"}},hideDefaultStats:{defaultValue:{value:"false"},description:"",name:"hideDefaultStats",required:!1,type:{name:"boolean"}},priceImpact:{defaultValue:null,description:"",name:"priceImpact",required:!1,type:{name:"number | null"}},leftPanel:{defaultValue:null,description:"",name:"leftPanel",required:!1,type:{name:"ReactNode"}},rightPanel:{defaultValue:null,description:"",name:"rightPanel",required:!1,type:{name:"ReactNode"}},afterMetrics:{defaultValue:null,description:"",name:"afterMetrics",required:!1,type:{name:"ReactNode"}},positionMetrics:{defaultValue:null,description:"",name:"positionMetrics",required:!1,type:{name:"{ hf: number; ltv: number; metricLabel: string; metricValue: number; token: TokenInfo; }"}},projectedMetrics:{defaultValue:null,description:"",name:"projectedMetrics",required:!1,type:{name:"{ afterHf?: number; afterLtv?: number; } | undefined"}}}}}catch{}const Qo=9n;async function Ko(e){const{selectedFrom:a,selectedTo:n,amountInBigInt:s,minBuyAmount:r,cowFlashLoanInfo:l,buildCowInstructions:i,limitOrderConfig:d,buildLimitOrderCalls:c}=e;console.log("[Limit Order] Building collateral swap order:",{sellToken:a.address,buyToken:n.address,amount:F(s,a.decimals),minBuy:F(r.raw,n.decimals),flashLoanLender:l.lender});const u=d?.numChunks??1,f=s/BigInt(u),b=r.raw/BigInt(u),m=f,h=await c({sellToken:a.address,buyToken:n.address,chunkSize:f,minBuyPerChunk:b,totalAmount:s,chunks:i,completion:ws.Iterations,targetValue:u,minHealthFactor:"1.1",seedAmount:0n,flashLoan:{lender:l.lender,token:a.address,amount:m},preOrderInstructions:i[0]?.postInstructions||[],isKindBuy:!1});if(!h)throw new Error("Failed to build CoW order calls");return h}function Go(e){if(e.success)return;const a=e.error||"Unknown error building order",n=e.errorDetails?.apiResponse?`${a}

API Response: ${e.errorDetails.apiResponse}`:a;throw console.error("[Limit Order] Build failed:",n,e.errorDetails),Ce.error(t.jsx(Xe,{step:"failed",message:`CoW API Error: ${a}`})),new Error(a)}async function Yo(e,a,n,s){const{limitOrderResult:r,chainId:l,orderManagerAddress:i,sendCallsAsync:d}=e;if(!d)throw new Error("sendCallsAsync not available");const{id:c}=await d({calls:r.calls,experimental_fallback:!0});Ce.remove(a);const u=i?ja(l,i):void 0;Ce.success(t.jsx(Xe,{step:"confirmed",message:"Limit order created!",secondaryLink:u,secondaryLinkText:"View on CoW Explorer"})),he("collateral_swap_limit_order_complete",{...s,status:"success",batchId:c}),n()}async function Xo(e,a,n,s){const{limitOrderResult:r,userAddress:l,chainId:i,walletClient:d,publicClient:c}=e;if(!d||!c)throw new Error("Wallet not connected");for(let f=0;f<r.calls.length;f++){const b=r.calls[f];Ce.remove(a);const m=Ce.loading(t.jsx(Xe,{step:"pending",message:`Executing step ${f+1}/${r.calls.length}...`})),h=await d.sendTransaction({account:l,to:b.to,data:b.data,chain:null});await c.waitForTransactionReceipt({hash:h}),Ce.remove(m)}const u=ja(i,l);Ce.success(t.jsx(Xe,{step:"confirmed",message:"Limit order created!",blockExplorerLink:u})),he("collateral_swap_limit_order_complete",{...s,status:"success",mode:"sequential"}),n()}function Jo(e,a,n,s,r){e&&Ps(to(e,a,n,s,r))}function Zo(e,a,n,s){const r=a?.decimals||18,l=n&&a?.rawBalance?a.rawBalance:jt(e||"0",r);if(!(n&&(s===Oe.Aave||s===Oe.ZeroLend))||l===0n)return l.toString();const d=(l*Qo+10000n-1n)/10000n,c=l-d,u=c/10000n;return(c-u).toString()}function el(e,a,n){const s=[];if(e?.dstAmount&&s.push({source:"1inch",amount:BigInt(e.dstAmount)}),a?.data){const r=a.data.amountPtOut||a.data.amountTokenOut||"0";r!=="0"&&s.push({source:"Pendle",amount:BigInt(r)})}return n?.quote?.buyAmount&&s.push({source:"CoW",amount:BigInt(n.quote.buyAmount)}),s.length===0?null:s.reduce((r,l)=>l.amount>r.amount?l:r)}function tl(e,a,n,s,r,l){if(e==="limit"&&a)return F(a.amount,l);if(n==="1inch"&&s)return F(BigInt(s.dstAmount),l);if(n==="pendle"&&r){const i=r.data.amountPtOut||r.data.amountTokenOut||"0";return F(BigInt(i),l)}return"0"}function al(e,a,n){if(e==="pendle"&&a?.data?.priceImpact!==void 0)return Math.abs(a.data.priceImpact*100);if(e==="1inch"&&n?.srcUSD&&n?.dstUSD){const s=parseFloat(n.srcUSD),r=parseFloat(n.dstUSD);if(s>0)return Math.max(0,(s-r)/s*100)}return null}function nl(e){const a=gn(e);return a==="morpho-blue"||a==="compound"?Ot.DepositCollateral:Ot.Deposit}const sn=({isOpen:e,onClose:a,protocolName:n,availableAssets:s,initialFromTokenAddress:r,chainId:l,context:i,position:d,hf:c,ltv:u,totalCollateralUsd:f,projectedMetrics:b})=>{const{buildCollateralSwapFlow:m}=It(),h=Lt(l),g=bn(l),x=hs(l),y=bs(l),N=gs(l),[w,P]=o.useState(N||"1inch");o.useEffect(()=>{w==="1inch"&&!h?P(g?"pendle":"1inch"):w==="pendle"&&!g&&P(h?"1inch":"pendle")},[l,h,g,w]);const I=o.useRef(!1);o.useEffect(()=>{if(e&&!I.current){const p={network:"evm",protocol:n,chainId:l,market:i??null,positionType:d.type,positionToken:d.tokenAddress,positionName:d.name,initialFromTokenAddress:r??null};he("collateral_swap_modal_open",p)}I.current=e},[l,r,e,i,d.name,d.tokenAddress,d.type,n]);const{flashLoanProviders:D,defaultFlashLoanProvider:O}=_a({isOpen:e,networkType:"evm",fromProtocol:n,chainId:l,position:d||{name:"",tokenAddress:"",decimals:18,type:"borrow"}}),B=o.useMemo(()=>s.filter(p=>p.rawBalance>0n),[s]),[v,H]=o.useState(null),[S,ce]=o.useState(null),[J,E]=o.useState(.1),[_,R]=o.useState(""),[k,X]=o.useState(!1),[j,Y]=o.useState(!1),[C,M]=o.useState("market"),[A,ee]=o.useState(.1),[Z,oe]=o.useState(!1),L=ys(l),U=!1,{address:$}=Sa(),{data:Q}=_s(),K=Ut(),{sendCallsAsync:se}=xs(),{buildOrderCalls:ge,isReady:ye,orderManagerAddress:Se}=Zs(),[le,Me]=o.useState(null),xe=o.useCallback(p=>{Me(p)},[]),ve=o.useMemo(()=>v?{symbol:v.symbol,decimals:v.decimals,address:v.address}:null,[v]),Ve=o.useMemo(()=>s.filter(p=>p.address.toLowerCase()!==v?.address.toLowerCase()),[s,v]);o.useEffect(()=>{const p=v&&ia(v.symbol),V=S&&ia(S.symbol);(p||V)&&g&&P("pendle")},[v,S,g]);const ie=o.useMemo(()=>v?Va(_||"0",v.decimals).value??0n:0n,[_,v]),{selectedProvider:re,setSelectedProvider:Ae,liquidityData:Ne}=Nn({flashLoanProviders:D,defaultProvider:O,tokenAddress:v?.address,amount:ie,chainId:l}),W=o.useMemo(()=>Zo(_,v,k,re?.providerEnum),[_,v,k,re?.providerEnum]),{data:te,isLoading:fe,error:ue}=Js({chainId:l,src:v?.address,dst:S?.address,amount:W,from:x?.address||"",slippage:J,enabled:h&&w==="1inch"&&!!_&&parseFloat(_)>0&&!!v&&!!S&&!!x}),{data:ae,isLoading:Ee,error:nt}=an({chainId:l,receiver:y?.address,tokensIn:v?.address,tokensOut:S?.address,amountsIn:W,slippage:J/100,enabled:g&&w==="pendle"&&!!_&&parseFloat(_)>0&&!!v&&!!S&&!!y}),{data:ne,isLoading:de}=wa({sellToken:v?.address||"",buyToken:S?.address||"",sellAmount:W,from:$||"",enabled:L&&C==="limit"&&!!_&&parseFloat(_)>0&&!!v&&!!S&&!!$}),_e=C==="limit"?de:w==="1inch"?fe:Ee,je=w==="1inch"?ue:nt,me=o.useMemo(()=>el(te,ae,ne??void 0),[te,ae,ne]),we=o.useMemo(()=>tl(C,me,w,te,ae,S?.decimals||18),[C,me,w,te,ae,S?.decimals]),Pe=o.useMemo(()=>{if(!me||!v||ie===0n)return null;const p=Number(F(ie,v.decimals)),V=Number(F(me.amount,S?.decimals??18));return p===0?null:V/p},[me,v,S,ie]),Je=o.useMemo(()=>al(w,ae,te),[w,ae,te]);o.useEffect(()=>{if(C!=="limit"||Z||Je===null)return;const p=Bs(Je);ee(p),oe(!0)},[C,Je,Z]),o.useEffect(()=>{oe(!1),ee(.1)},[v?.address,S?.address]);const st=o.useMemo(()=>{if(!v?.price||!_)return;const p=parseFloat(_);if(!(isNaN(p)||p<=0))return p*Number(F(v.price,8))},[v?.price,_]),ut=o.useMemo(()=>{if(!S?.price||!we)return;const p=parseFloat(we);if(!(isNaN(p)||p<=0))return p*Number(F(S.price,8))},[S?.price,we]),{priceImpact:Ue}=Os({slippage:J,setSlippage:E,oneInchQuote:te,pendleQuote:ae,swapRouter:w,resetDep:`${v?.address}-${S?.address}`,srcUsdFallback:st,dstUsdFallback:ut}),We=o.useMemo(()=>{if(!S||!me)return{raw:0n,formatted:"0"};const V=BigInt(Math.round((C==="limit"?A:J)*100)),G=me.amount*(10000n-V)/10000n;return{raw:G,formatted:F(G,S.decimals)}},[S,me,C,A,J]),Ie=o.useMemo(()=>{if(C!=="limit"||!v)return null;const p=le?.selectedProvider?.provider,V=hn(l,p);if(!V)return null;const G=fn(ie,V.provider);return{lender:V.address,provider:V.provider,fee:G}},[C,v,l,ie,le]),it=o.useMemo(()=>{if(!v||!S||!$||ie===0n||!Se||!Ie)return[{preInstructions:[],postInstructions:[]}];const p=gn(n),V=nl(n),G=le?.numChunks??1,ke=ie/BigInt(G),De=Ie.fee/BigInt(G),Re=ke+De;return console.log("[buildCowInstructions] Collateral swap (KIND_SELL):",{sellToken:v.symbol,buyToken:S.symbol,totalSellAmount:F(ie,v.decimals),totalFlashLoanFee:F(Ie.fee,v.decimals),numChunks:G,chunkSellAmount:F(ke,v.decimals),chunkWithdrawAmount:F(Re,v.decimals),flow:"swap[0] → approve[1] → deposit → withdraw[2] → (hook appends push)"}),Array(G).fill(null).map(()=>{const $e=[Nt(vs(0,p)),da(p,ca(V,S.address,$,0n,i||"0x",0)),da(p,ca(Ot.WithdrawCollateral,v.address,$,Re,i||"0x",999))];return{preInstructions:[],postInstructions:$e,flashLoanRepaymentUtxoIndex:2}})},[v,S,$,ie,Se,n,i,Ie,le?.numChunks]),Fe=()=>{if(!v||!S)return[];let p,V;if(w==="1inch"){if(!te||!x)return[];p=te.tx.data,V="1"}else{if(!ae||!y)return[];p=ae.transaction.data,V=ae.data.minPtOut||ae.data.minTokenOut||"1"}const G=re?.providerEnum??Oe.BalancerV2;return m(n,v.address,S.address,_,V,p,v.decimals,i,k,G,!1,w==="1inch"?"oneinch":"pendle")},{handleConfirm:vt,batchingPreference:dt}=Na({isOpen:e,chainId:l,onClose:a,buildFlow:Fe,successMessage:"Collateral Swapped successfully!",emptyFlowErrorMessage:"Failed to build swap instructions",simulateWhenBatching:!0}),qe=async p=>{if(he("collateral_swap_limit_order_begin",p),!v||!S||!$||!Se||!Ie)throw new Error("Missing required data for limit order");const V=await Ko({selectedFrom:v,selectedTo:S,amountInBigInt:ie,minBuyAmount:We,cowFlashLoanInfo:Ie,buildCowInstructions:it,limitOrderConfig:le,buildLimitOrderCalls:ge});Go(V),console.log("[Limit Order] Order calls built:",V.calls.length),Jo(V.salt,n,v.symbol,S.symbol,l);const G=Ce.loading(t.jsx(Xe,{step:"pending",message:`Creating limit order (${V.calls.length} operations)...`})),ke={limitOrderResult:V,userAddress:$,chainId:l,orderManagerAddress:Se,sendCallsAsync:se,walletClient:Q,publicClient:K};try{if(typeof se=="function")await Yo(ke,G,a,p);else if(Q&&K)await Xo(ke,G,a,p);else throw new Error("Wallet not connected")}catch(De){throw Ce.remove(G),De}},mt=async p=>{he("collateral_swap_tx_begin",p),await vt(_,k),he("collateral_swap_tx_complete",{...p,status:"success"})},pt=o.useCallback(async()=>{const p={network:"evm",protocol:n,chainId:l,market:i??null,fromToken:v?.address??null,fromName:v?.symbol??null,toToken:S?.address??null,toName:S?.symbol??null,amountIn:_,isMax:k,slippage:C==="limit"?A:J,preferBatching:dt.enabled,flashLoanProvider:re?.name??null,swapRouter:w,executionType:C};try{Y(!0),C==="limit"?await qe(p):await mt(p)}catch(V){throw he(C==="limit"?"collateral_swap_limit_order_complete":"collateral_swap_tx_complete",{...p,status:"error",error:V instanceof Error?V.message:String(V)}),V}finally{Y(!1)}},[C,qe,mt,n,l,i,v,S,_,k,A,J,dt.enabled,re,w]),{enabled:ft,setEnabled:ze}=dt,Ze=(w==="1inch"?!!te:!!ae)&&(w==="1inch"?!!x:!!y)&&parseFloat(_)>0,et=!!v&&!!S&&parseFloat(_)>0&&ye&&!!Ie&&U,z=C==="limit"?et:Ze,pe=o.useMemo(()=>t.jsxs("div",{className:"space-y-4 py-2",children:[t.jsxs("div",{className:"alert alert-info bg-info/10 border-info/20 text-sm",children:[t.jsx(Aa,{className:"size-5 flex-shrink-0"}),t.jsxs("span",{children:[t.jsx("strong",{children:"How Collateral Swap Works"}),t.jsx("br",{}),"This feature allows you to change your collateral asset without closing your debt position."]})]}),t.jsxs("div",{className:"space-y-4 px-2",children:[t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"bg-primary/20 text-primary flex size-6 items-center justify-center rounded-full text-xs font-bold",children:"1"}),t.jsx("div",{className:"bg-base-300 my-1 h-full w-0.5"})]}),t.jsxs("div",{className:"pb-4",children:[t.jsx("h4",{className:"text-sm font-medium",children:"Flash Loan"}),t.jsx("p",{className:"text-base-content/70 text-xs",children:"We borrow the new collateral asset via a Flash Loan."}),t.jsxs("div",{className:"bg-base-200 mt-1 inline-block rounded p-1 text-xs",children:["Provider: ",re?.name||"Auto"]})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"bg-primary/20 text-primary flex size-6 items-center justify-center rounded-full text-xs font-bold",children:"2"}),t.jsx("div",{className:"bg-base-300 my-1 h-full w-0.5"})]}),t.jsxs("div",{className:"pb-4",children:[t.jsx("h4",{className:"text-sm font-medium",children:"Swap"}),t.jsxs("p",{className:"text-base-content/70 text-xs",children:["We swap your current collateral for the new asset using ",w==="pendle"?"Pendle":"1inch","."]}),t.jsxs("div",{className:"bg-base-200 mt-1 inline-block rounded p-1 text-xs",children:["Router: ",w==="pendle"?"Pendle":"1inch"]})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"bg-primary/20 text-primary flex size-6 items-center justify-center rounded-full text-xs font-bold",children:"3"}),t.jsx("div",{className:"bg-base-300 my-1 h-full w-0.5"})]}),t.jsxs("div",{className:"pb-4",children:[t.jsx("h4",{className:"text-sm font-medium",children:"Deposit & Withdraw"}),t.jsx("p",{className:"text-base-content/70 text-xs",children:"The new asset is deposited as collateral, and your old collateral is withdrawn."})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"flex flex-col items-center",children:t.jsx("div",{className:"bg-primary/20 text-primary flex size-6 items-center justify-center rounded-full text-xs font-bold",children:"4"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium",children:"Repay Flash Loan"}),t.jsx("p",{className:"text-base-content/70 text-xs",children:"The withdrawn collateral is used to repay the Flash Loan."})]})]})]})]}),[re?.name,w]),ht=o.useMemo(()=>t.jsxs(t.Fragment,{children:[w==="1inch"&&te&&x&&te.tx.from.toLowerCase()!==x.address.toLowerCase()&&t.jsx(qt,{message:"Warning: Quote 'from' address mismatch!",size:"sm",breakAll:!0}),w==="1inch"&&!x&&e&&t.jsx(qt,{message:"1inch Adapter not found on this network. Try Pendle for PT swaps.",size:"sm"}),w==="pendle"&&!y&&e&&t.jsx(qt,{message:"Pendle Adapter not found on this network.",size:"sm"})]}),[w,te,x,y,e]),bt=o.useMemo(()=>t.jsxs("div",{className:"space-y-3",children:[t.jsx(fa,{value:C,onChange:M,limitAvailable:L,limitReady:ye&&U,limitDisabledReason:"Limit orders are only available in development environment"}),C==="market"&&t.jsxs("div",{className:"space-y-2 text-xs",children:[t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Slippage"}),t.jsx("select",{className:"select select-xs select-ghost text-base-content/80 font-medium min-h-0 h-auto py-0.5 text-right",value:J,onChange:p=>E(parseFloat(p.target.value)),children:[.1,.3,.5,1,3].map(p=>t.jsxs("option",{value:p,children:[p,"%"]},p))})]}),h&&g&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Router"}),t.jsxs("select",{className:"select select-xs select-ghost text-base-content/80 font-medium min-h-0 h-auto py-0.5 text-right",value:w,onChange:p=>P(p.target.value),children:[t.jsx("option",{value:"1inch",children:"1inch"}),t.jsx("option",{value:"pendle",children:"Pendle"})]})]}),D&&D.length>1&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Flash Loan"}),t.jsx("select",{className:"select select-xs select-ghost text-base-content/80 font-medium min-h-0 h-auto py-0.5 text-right",value:re?.name||"",onChange:p=>{const V=D.find(G=>G.name===p.target.value);V&&Ae(V)},children:D.map(p=>{const V=Ne?.find(G=>G.provider===p.providerEnum);return t.jsxs("option",{value:p.name,children:[p.name," ",V?V.hasLiquidity?"✓":"⚠️":""]},p.name)})})]})]}),t.jsxs("div",{className:"border-t border-base-300/30 pt-2 space-y-1",children:[Ue!=null&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Price Impact"}),t.jsxs("span",{className:Ue>1?"text-warning":Ue>3?"text-error":"text-base-content/80",children:[Ue.toFixed(2),"%"]})]}),we&&parseFloat(we)>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Min Output"}),t.jsxs("span",{className:"text-base-content/80",children:[(parseFloat(we)*(1-J/100)).toFixed(4)," ",S?.symbol]})]})]})]}),C==="limit"&&t.jsxs("div",{className:"space-y-2 text-xs",children:[le?.selectedProvider&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Flash Loan"}),t.jsx("span",{className:"text-base-content/80 font-medium",children:le.selectedProvider.provider})]}),t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Limit Price"}),t.jsx("span",{className:"text-base-content/80",children:_e?t.jsx("span",{className:"loading loading-dots loading-xs"}):Pe?`1:${(Pe*(1-A/100)).toFixed(4)}`:"-"})]}),t.jsxs("div",{className:"flex items-center justify-center gap-1",children:[[-1,-.5,-.1].map(p=>t.jsxs("button",{onClick:()=>ee(Math.max(0,A-p)),className:`px-2 py-0.5 rounded text-[10px] ${A===-p?"bg-primary text-primary-content":"bg-base-300/50 hover:bg-base-300"}`,children:[p>0?"+":"",p,"%"]},p)),t.jsx("span",{className:"px-1 text-base-content/40",children:"|"}),[.1,.5,1].map(p=>t.jsxs("button",{onClick:()=>ee(Math.min(10,A+p)),className:`px-2 py-0.5 rounded text-[10px] ${A===p?"bg-primary text-primary-content":"bg-base-300/50 hover:bg-base-300"}`,children:["+",p,"%"]},p))]}),t.jsxs("div",{className:"text-center text-[10px] text-base-content/40",children:[A>0?`${A}% below`:A<0?`${Math.abs(A)}% above`:"at"," market"]})]}),t.jsxs("div",{className:"flex items-center justify-between border-t border-base-300/30 pt-2",children:[t.jsx("span",{className:"text-base-content/50",children:"Min Output"}),t.jsx("span",{className:"text-success font-medium",children:We.raw>0n?`${Number(We.formatted).toFixed(4)} ${S?.symbol}`:"-"})]}),v&&ve&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Chunks"}),t.jsx("select",{className:"select select-xs select-ghost text-base-content/80 font-medium min-h-0 h-auto py-0.5 text-right",value:le?.numChunks??1,onChange:p=>{xe&&le&&xe({...le,numChunks:parseInt(p.target.value)})},children:[1,2,3,5,10].map(p=>t.jsx("option",{value:p,children:p},p))})]})]})]}),[C,M,L,ye,U,_e,Pe,v,S,A,ee,We,ve,l,xe,le,J,E,Ue,we,D,re,Ne,w,P,h,g,Ae]),q=o.useMemo(()=>{if(c===void 0&&u===void 0)return;const p=v||(B.length>0?B[0]:null);if(!p)return;const V={name:p.symbol,icon:p.icon,address:p.address,currentRate:0,usdPrice:p.price?Number(F(p.price,8)):void 0,decimals:p.decimals};return{hf:c??1/0,ltv:u??0,metricLabel:"Total collateral",metricValue:f??p.balance,token:V}},[c,u,f,v,B]);return t.jsx(Ca,{isOpen:e,onClose:a,title:"Swap Collateral",protocolName:n,fromAssets:B,toAssets:Ve,initialFromAddress:r,selectedFrom:v,setSelectedFrom:H,selectedTo:S,setSelectedTo:ce,amountIn:_,setAmountIn:R,isMax:k,setIsMax:X,amountOut:we,isQuoteLoading:_e,quoteError:C==="market"?je:null,slippage:C==="limit"?A:J,setSlippage:C==="limit"?ee:E,preferBatching:C==="market"?ft:void 0,setPreferBatching:C==="market"?ze:void 0,onSubmit:pt,isSubmitting:j,canSubmit:z,submitLabel:C==="limit"?"Create Order":"Swap Collateral",infoContent:pe,warnings:ht,fromLabel:"Swap From",toLabel:"Swap To",priceImpact:C==="market"?Ue:void 0,hideDefaultStats:!0,positionMetrics:q,projectedMetrics:b,rightPanel:bt})};try{sn.displayName="CollateralSwapModal",sn.__docgenInfo={description:"",displayName:"CollateralSwapModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},protocolName:{defaultValue:null,description:"",name:"protocolName",required:!0,type:{name:"string"}},availableAssets:{defaultValue:null,description:"",name:"availableAssets",required:!0,type:{name:"ExtendedCollateral[]"}},initialFromTokenAddress:{defaultValue:null,description:"",name:"initialFromTokenAddress",required:!1,type:{name:"string"}},chainId:{defaultValue:null,description:"",name:"chainId",required:!0,type:{name:"number"}},context:{defaultValue:null,description:"Pre-encoded protocol context (e.g., Morpho MarketParams, Compound market address)",name:"context",required:!1,type:{name:"string"}},position:{defaultValue:null,description:"",name:"position",required:!0,type:{name:'{ name: string; tokenAddress: string; decimals: number; balance?: number | bigint | undefined; type: "borrow" | "supply"; }'}},hf:{defaultValue:null,description:"",name:"hf",required:!1,type:{name:"number"}},ltv:{defaultValue:null,description:"",name:"ltv",required:!1,type:{name:"number"}},totalCollateralUsd:{defaultValue:null,description:"",name:"totalCollateralUsd",required:!1,type:{name:"number"}},projectedMetrics:{defaultValue:null,description:"",name:"projectedMetrics",required:!1,type:{name:"{ afterHf?: number; afterLtv?: number; } | undefined"}}}}}catch{}const sl=({chainId:e,src:a,dst:n,amount:s,enabled:r=!0})=>{const[l]=yn(s,jn.STANDARD),i=Lt(e),d=An(i,r,Xs(l),a,n);return Mt({queryKey:Vn.oneInchQuoteOnly(e,a,n,l),queryFn:async()=>{if(!Lt(e))throw new Error(`1inch is not supported on chain ${e}`);try{return await To(wn(e),{src:a,dst:n,amount:l})}catch(c){throw console.error("1inch Quote API Error:",c),c}},enabled:d,...Sn.quote,refetchInterval:15e3})};function rl(e,a,n,s,r,l){he("debt_swap_modal_open",{network:"evm",protocol:e,chainId:a,market:n??null,debtFromToken:s,debtFromName:r,availableAssets:l})}function rn(e){return{network:"evm",protocol:e.protocolName,chainId:e.chainId,executionType:"limit",oldDebtToken:e.debtFromToken,oldDebtName:e.debtFromName,newDebtToken:e.selectedTo.address,newDebtName:e.selectedTo.symbol,repayAmount:F(e.repayAmountRaw,e.debtFromDecimals),newDebtAmount:F(e.limitOrderNewDebt,e.selectedTo.decimals),flashLoanProvider:e.flashLoanProviderName,market:null}}function ol(e,a,n,s,r){const l=a?.selectedProvider,i=n==="limit",d=s!==null,c=r>0n;if(!l||!i||!d||!c)return null;const u=hn(e,a.selectedProvider.provider);if(!u)return null;const f=fn(r,u.provider);return{lender:u.address,provider:u.provider,fee:f,amount:r,token:s.address}}function on(e){const{selectedTo:a,userAddress:n,repayAmountRaw:s,orderManagerAddress:r,protocolName:l,context:i,debtFromToken:d,debtFromName:c,debtFromDecimals:u,cowFlashLoanInfo:f,limitOrderConfig:b}=e;if(!a||!n||s===0n||!r||!f)return[{preInstructions:[],postInstructions:[]}];const m=gn(l),h=b?.numChunks??1,g=s/BigInt(h),x=f.amount/BigInt(h),y=[],N=[Nt(Pr(g,d,r)),Nt(vs(2,m)),da(m,ca(Ot.Repay,d,n,g,i||"0x",2)),da(m,ca(Ot.Borrow,a.address,n,x,i||"0x",0)),Nt(Ir(5,1))];return ll({selectedTo:a,debtFromName:c,repayAmountRaw:s,debtFromDecimals:u,chunkBuyAmount:g,cowFlashLoanInfo:f,chunkFlashLoanAmount:x,numChunks:h}),Array(h).fill(null).map(()=>({preInstructions:y,postInstructions:N,flashLoanRepaymentUtxoIndex:6}))}function ll(e){console.log("[buildCowInstructions] Debt Swap (KIND_BUY):",{sellToken:e.selectedTo.symbol,buyToken:e.debtFromName,totalOldDebtToBuy:F(e.repayAmountRaw,e.debtFromDecimals),chunkOldDebtToBuy:F(e.chunkBuyAmount,e.debtFromDecimals),flashLoanToken:e.selectedTo.symbol,totalFlashLoanAmount:F(e.cowFlashLoanInfo.amount,e.selectedTo.decimals),chunkFlashLoanAmount:F(e.chunkFlashLoanAmount,e.selectedTo.decimals),numChunks:e.numChunks,utxoLayout:"UTXO[0]=actualSell, UTXO[1]=leftover, UTXO[5]=borrowed, UTXO[6]=borrowed+leftover"})}function ln(e){const{selectedTo:a,debtFromName:n,limitOrderNewDebt:s,repayAmountRaw:r,debtFromDecimals:l,cowFlashLoanInfo:i,cowQuote:d}=e;console.log("[Limit Order] Building debt swap order (KIND_BUY):",{sellToken:a.symbol,buyToken:n,maxSellAmount:F(s,a.decimals),exactBuyAmount:F(r,l),flashLoanToken:a.symbol,flashLoanAmount:F(i.amount,a.decimals),flashLoanLender:i.lender,cowQuoteSellAmount:d?F(ka(d),a.decimals):"N/A"})}function dn(e){const{selectedTo:a,debtFromToken:n,limitOrderNewDebt:s,repayAmountRaw:r,cowFlashLoanInfo:l,buildCowInstructions:i,limitOrderConfig:d}=e,c=d?.numChunks??1,u=s/BigInt(c),f=r/BigInt(c),b=l.amount/BigInt(c);return{sellToken:a.address,buyToken:n,chunkSize:u,minBuyPerChunk:f,totalAmount:s,chunks:i,completion:ws.Iterations,targetValue:c,minHealthFactor:"1.0",seedAmount:0n,flashLoan:{lender:l.lender,token:a.address,amount:b},preOrderInstructions:[],isKindBuy:!0}}function il(e,a){const n=e.error||"Unknown error building order",s=e.errorDetails?.apiResponse?`${n}

API Response: ${e.errorDetails.apiResponse}`:n;throw console.error("[Limit Order] Build failed:",s,e.errorDetails),Ce.error(t.jsx(Xe,{step:"failed",message:`CoW API Error: ${n}`})),he("debt_swap_limit_order_complete",{...a,status:"error",error:n}),new Error(n)}function dl(e,a,n,s,r){e&&Ps(eo(e,a,n,s,r))}async function cn(e){const{allCalls:a,sendCallsAsync:n,setSuppressBatchNotifications:s,setBatchId:r,setLastOrderSalt:l,setLimitOrderNotificationId:i,salt:d,notificationId:c,analyticsProps:u}=e;console.log("[Limit Order] Using batched TX mode (EIP-5792)");const{id:f}=await n({calls:a});s(!0),r(f),l(d),i(c),Ce.remove(c),Ce.loading(t.jsx(Xe,{step:"pending",message:"Waiting for batch confirmation..."})),he("debt_swap_limit_order_complete",{...u,status:"batched",batchId:f})}async function un(e){const{allCalls:a,walletClient:n,publicClient:s,chainId:r,orderManagerAddress:l,analyticsProps:i,onClose:d}=e;let{notificationId:c}=e;if(console.log("[Limit Order] Using sequential TX mode"),!n.account)throw new Error("WalletClient must have an account configured");const u=n.account;for(let b=0;b<a.length;b++){const m=a[b];Ce.remove(c),c=Ce.loading(t.jsx(Xe,{step:"pending",message:`Executing step ${b+1}/${a.length}...`}));const h=await n.sendTransaction({to:m.to,data:m.data,chain:n.chain,account:u});await s.waitForTransactionReceipt({hash:h})}Ce.remove(c);const f=ja(r,l);Ce.success(t.jsx(Xe,{step:"confirmed",message:"Limit order created!",blockExplorerLink:f})),he("debt_swap_limit_order_complete",{...i,status:"success"}),d()}function cl(e,a,n){a&&Ce.remove(a);const s=e instanceof Error?e.message:"Transaction failed";Ce.error(t.jsx(Xe,{step:"failed",message:s})),he("debt_swap_limit_order_complete",{...n,status:"error",error:e instanceof Error?e.message:String(e)})}function ul(e,a,n){return e==="1inch"&&!a?n?"pendle":null:e==="pendle"&&!n&&a?"1inch":null}function mn(e){const{selectedTo:a,repayAmountRaw:n,oneInchUnitQuote:s,pendleUnitQuote:r,debtFromDecimals:l,slippage:i}=e;if(!a||n===0n)return{requiredNewDebt:0n,requiredNewDebtFormatted:"0",exchangeRate:"0"};const d=ml(s,r);if(d===0n)return{requiredNewDebt:0n,requiredNewDebtFormatted:"0",exchangeRate:"0"};const c=F(d,l),u=10n**BigInt(a.decimals),f=n*u/d,b=BigInt(Math.round(i*100)),m=f*(10000n+b)/10000n;return{requiredNewDebt:m,requiredNewDebtFormatted:F(m,a.decimals),exchangeRate:c}}function ml(e,a){if(e)return BigInt(e.dstAmount);if(a){const n=a.data.amountPtOut||a.data.amountTokenOut||"0";return BigInt(n)}return 0n}function pl(e,a,n){if(!e||!a)return 0n;const s=ka(e);if(s===0n)return 0n;const r=BigInt(Math.round(n*100));return s*(10000n+r)/10000n}try{rn.displayName="createLimitOrderAnalyticsProps",rn.__docgenInfo={description:"",displayName:"createLimitOrderAnalyticsProps",props:{protocolName:{defaultValue:null,description:"",name:"protocolName",required:!0,type:{name:"string"}},chainId:{defaultValue:null,description:"",name:"chainId",required:!0,type:{name:"number"}},debtFromToken:{defaultValue:null,description:"",name:"debtFromToken",required:!0,type:{name:"string"}},debtFromName:{defaultValue:null,description:"",name:"debtFromName",required:!0,type:{name:"string"}},selectedTo:{defaultValue:null,description:"",name:"selectedTo",required:!0,type:{name:"SwapAsset"}},repayAmountRaw:{defaultValue:null,description:"",name:"repayAmountRaw",required:!0,type:{name:"bigint"}},debtFromDecimals:{defaultValue:null,description:"",name:"debtFromDecimals",required:!0,type:{name:"number"}},limitOrderNewDebt:{defaultValue:null,description:"",name:"limitOrderNewDebt",required:!0,type:{name:"bigint"}},flashLoanProviderName:{defaultValue:null,description:"",name:"flashLoanProviderName",required:!0,type:{name:"string"}}}}}catch{}try{on.displayName="buildCowChunkInstructions",on.__docgenInfo={description:"",displayName:"buildCowChunkInstructions",props:{selectedTo:{defaultValue:null,description:"",name:"selectedTo",required:!0,type:{name:"SwapAsset"}},userAddress:{defaultValue:null,description:"",name:"userAddress",required:!0,type:{name:"string"}},repayAmountRaw:{defaultValue:null,description:"",name:"repayAmountRaw",required:!0,type:{name:"bigint"}},orderManagerAddress:{defaultValue:null,description:"",name:"orderManagerAddress",required:!0,type:{name:"string"}},protocolName:{defaultValue:null,description:"",name:"protocolName",required:!0,type:{name:"string"}},context:{defaultValue:null,description:"",name:"context",required:!0,type:{name:"string | undefined"}},debtFromToken:{defaultValue:null,description:"",name:"debtFromToken",required:!0,type:{name:"string"}},debtFromName:{defaultValue:null,description:"",name:"debtFromName",required:!0,type:{name:"string"}},debtFromDecimals:{defaultValue:null,description:"",name:"debtFromDecimals",required:!0,type:{name:"number"}},cowFlashLoanInfo:{defaultValue:null,description:"",name:"cowFlashLoanInfo",required:!0,type:{name:"FlashLoanInfo"}},limitOrderConfig:{defaultValue:null,description:"",name:"limitOrderConfig",required:!0,type:{name:"LimitOrderResult | null"}}}}}catch{}try{ln.displayName="logLimitOrderBuildStart",ln.__docgenInfo={description:"",displayName:"logLimitOrderBuildStart",props:{selectedTo:{defaultValue:null,description:"",name:"selectedTo",required:!0,type:{name:"SwapAsset"}},debtFromName:{defaultValue:null,description:"",name:"debtFromName",required:!0,type:{name:"string"}},limitOrderNewDebt:{defaultValue:null,description:"",name:"limitOrderNewDebt",required:!0,type:{name:"bigint"}},repayAmountRaw:{defaultValue:null,description:"",name:"repayAmountRaw",required:!0,type:{name:"bigint"}},debtFromDecimals:{defaultValue:null,description:"",name:"debtFromDecimals",required:!0,type:{name:"number"}},cowFlashLoanInfo:{defaultValue:null,description:"",name:"cowFlashLoanInfo",required:!0,type:{name:"FlashLoanInfo"}},cowQuote:{defaultValue:null,description:"",name:"cowQuote",required:!0,type:{name:"CowQuoteResponse | null | undefined"}}}}}catch{}try{dn.displayName="buildLimitOrderCallParams",dn.__docgenInfo={description:"",displayName:"buildLimitOrderCallParams",props:{selectedTo:{defaultValue:null,description:"",name:"selectedTo",required:!0,type:{name:"SwapAsset"}},debtFromToken:{defaultValue:null,description:"",name:"debtFromToken",required:!0,type:{name:"string"}},limitOrderNewDebt:{defaultValue:null,description:"",name:"limitOrderNewDebt",required:!0,type:{name:"bigint"}},repayAmountRaw:{defaultValue:null,description:"",name:"repayAmountRaw",required:!0,type:{name:"bigint"}},cowFlashLoanInfo:{defaultValue:null,description:"",name:"cowFlashLoanInfo",required:!0,type:{name:"FlashLoanInfo"}},buildCowInstructions:{defaultValue:null,description:"",name:"buildCowInstructions",required:!0,type:{name:"ChunkInstructions[]"}},limitOrderConfig:{defaultValue:null,description:"",name:"limitOrderConfig",required:!0,type:{name:"LimitOrderResult"}}}}}catch{}try{cn.displayName="executeBatchedLimitOrder",cn.__docgenInfo={description:"",displayName:"executeBatchedLimitOrder",props:{allCalls:{defaultValue:null,description:"",name:"allCalls",required:!0,type:{name:"{ to: string; data: string; }[]"}},sendCallsAsync:{defaultValue:null,description:"",name:"sendCallsAsync",required:!0,type:{name:"(params: { calls: readonly unknown[]; }) => Promise<{ id: string; }>"}},setSuppressBatchNotifications:{defaultValue:null,description:"",name:"setSuppressBatchNotifications",required:!0,type:{name:"(val: boolean) => void"}},setBatchId:{defaultValue:null,description:"",name:"setBatchId",required:!0,type:{name:"(id: string) => void"}},setLastOrderSalt:{defaultValue:null,description:"",name:"setLastOrderSalt",required:!0,type:{name:"(salt: string | null) => void"}},setLimitOrderNotificationId:{defaultValue:null,description:"",name:"setLimitOrderNotificationId",required:!0,type:{name:"(id: string | number | null) => void"}},salt:{defaultValue:null,description:"",name:"salt",required:!0,type:{name:"string"}},notificationId:{defaultValue:null,description:"",name:"notificationId",required:!0,type:{name:"string | number"}},analyticsProps:{defaultValue:null,description:"",name:"analyticsProps",required:!0,type:{name:"DebtSwapAnalyticsProps"}}}}}catch{}try{un.displayName="executeSequentialLimitOrder",un.__docgenInfo={description:"",displayName:"executeSequentialLimitOrder",props:{allCalls:{defaultValue:null,description:"",name:"allCalls",required:!0,type:{name:"{ to: string; data: string; }[]"}},walletClient:{defaultValue:null,description:"",name:"walletClient",required:!0,type:{name:"{ account: Account | undefined; batch?: { multicall?: boolean | { batchSize?: number | undefined; deployless?: boolean | undefined; wait?: number | undefined; } | undefined; } | undefined; ... 39 more ...; extend: <const client extends { ...; } & ExactPartial<...>>(fn: (client: Client<...>) => client) => Client<...>..."}},publicClient:{defaultValue:null,description:"",name:"publicClient",required:!0,type:{name:"{ account: undefined; batch?: { multicall?: boolean | { batchSize?: number | undefined; deployless?: boolean | undefined; wait?: number | undefined; } | undefined; } | undefined; cacheTime: number; ... 67 more ...; extend: <const client extends { ...; } & ExactPartial<...>>(fn: (client: Client<...>) => client) => Cl..."}},chainId:{defaultValue:null,description:"",name:"chainId",required:!0,type:{name:"number"}},orderManagerAddress:{defaultValue:null,description:"",name:"orderManagerAddress",required:!0,type:{name:"string"}},analyticsProps:{defaultValue:null,description:"",name:"analyticsProps",required:!0,type:{name:"DebtSwapAnalyticsProps"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},notificationId:{defaultValue:null,description:"",name:"notificationId",required:!0,type:{name:"string | number"}}}}}catch{}try{mn.displayName="calculateRequiredNewDebt",mn.__docgenInfo={description:"",displayName:"calculateRequiredNewDebt",props:{selectedTo:{defaultValue:null,description:"",name:"selectedTo",required:!0,type:{name:"SwapAsset | null"}},repayAmountRaw:{defaultValue:null,description:"",name:"repayAmountRaw",required:!0,type:{name:"bigint"}},oneInchUnitQuote:{defaultValue:null,description:"",name:"oneInchUnitQuote",required:!0,type:{name:"{ dstAmount: string; } | null | undefined"}},pendleUnitQuote:{defaultValue:null,description:"",name:"pendleUnitQuote",required:!0,type:{name:"{ data: { amountPtOut?: string | undefined; amountTokenOut?: string | undefined; }; } | null | undefined"}},debtFromDecimals:{defaultValue:null,description:"",name:"debtFromDecimals",required:!0,type:{name:"number"}},slippage:{defaultValue:null,description:"",name:"slippage",required:!0,type:{name:"number"}}}}}catch{}const pn=({isOpen:e,onClose:a,protocolName:n,chainId:s,debtFromToken:r,debtFromName:l,debtFromIcon:i,debtFromDecimals:d,debtFromPrice:c,currentDebtBalance:u,availableAssets:f,context:b,hf:m,ltv:h})=>{const{buildDebtSwapFlow:g,setBatchId:x,setSuppressBatchNotifications:y,isBatchConfirmed:N}=It(),w=Lt(s),P=bn(s),I=hs(s),D=bs(s),O=gs(s),[B,v]=o.useState(O||"1inch");o.useEffect(()=>{const T=ul(B,w,P);T&&v(T)},[s,w,P,B]);const H=o.useRef(!1);o.useEffect(()=>{e&&!H.current&&rl(n,s,b,r,l,f?.length??null),H.current=e},[f?.length,s,l,r,e,b,n]);const{flashLoanProviders:S,defaultFlashLoanProvider:ce}=_a({isOpen:e,networkType:"evm",fromProtocol:n,chainId:s,position:{name:l,tokenAddress:r,decimals:d,type:"borrow"}}),J=o.useMemo(()=>({symbol:l,address:r,decimals:d,rawBalance:u,balance:parseFloat(F(u,d)),icon:i,price:c}),[l,r,d,u,i,c]),E=o.useMemo(()=>[J],[J]),[_,R]=o.useState(J),[k,X]=o.useState(null),[j,Y]=o.useState(.1),[C,M]=o.useState(""),[A,ee]=o.useState(!1),[Z,oe]=o.useState(!1),[L,U]=o.useState("market"),[$,Q]=o.useState(null),[K,se]=o.useState(!1),[ge]=o.useState(!1),[ye,Se]=o.useState(null),[le,Me]=o.useState(null),xe=ys(s),{address:ve}=Sa(),{data:Ve}=_s(),ie=Ut(),{sendCallsAsync:re}=xs(),{buildOrderCalls:Ae,isReady:Ne,orderManagerAddress:W}=Zs(),te=o.useCallback(T=>{Q(T)},[]);o.useEffect(()=>{(!_||_.address!==r)&&R(J)},[_,r,J]);const fe=o.useMemo(()=>(f||[]).filter(T=>T.address.toLowerCase()!==r.toLowerCase()),[f,r]);o.useEffect(()=>{const T=ia(l),Le=k&&ia(k.symbol);(T||Le)&&P&&v("pendle")},[l,k,P]),o.useEffect(()=>{if(!(N&&L==="limit"&&W&&ye))return;le&&Ce.remove(le);const Le=ja(s,W);Ce.success(t.jsx(Xe,{step:"confirmed",message:"Limit order created!",blockExplorerLink:Le})),Se(null),Me(null),a()},[N,L,W,s,ye,le,a]);const ue=o.useMemo(()=>Va(C||"0",d).value??0n,[C,d]),ae=o.useMemo(()=>k?jt("1",k.decimals).toString():"0",[k]),{data:Ee,isLoading:nt}=sl({chainId:s,src:k?.address,dst:r,amount:ae,enabled:w&&B==="1inch"&&!!k&&e&&L==="market"}),{data:ne,isLoading:de}=an({chainId:s,receiver:D?.address,tokensIn:k?.address,tokensOut:r,amountsIn:ae,slippage:.03,enabled:P&&B==="pendle"&&!!k&&!!D&&e&&ae!=="0"&&L==="market"}),_e=B==="1inch"?nt:de,{requiredNewDebt:je,requiredNewDebtFormatted:me,exchangeRate:we}=o.useMemo(()=>mn({selectedTo:k,repayAmountRaw:ue,oneInchUnitQuote:Ee,pendleUnitQuote:ne,debtFromDecimals:d,slippage:j}),[Ee,ne,k,ue,d,j]),{selectedProvider:Pe,setSelectedProvider:Je}=Nn({flashLoanProviders:S,defaultProvider:ce,tokenAddress:k?.address,amount:je,chainId:s}),st=k?jt("0.001",k.decimals):0n,ut=w&&B==="1inch"&&je>st&&!!k&&!!I&&e&&L==="market",Ue=P&&B==="pendle"&&je>st&&!!k&&!!D&&e&&L==="market",{data:We,isLoading:Ie,error:it}=Js({chainId:s,src:k?.address,dst:r,amount:je.toString(),from:I?.address||"",slippage:j,enabled:ut}),{data:Fe,isLoading:vt,error:dt}=an({chainId:s,receiver:D?.address,slippage:j/100,tokensIn:k?.address,tokensOut:r,amountsIn:je.toString(),enableAggregator:!0,enabled:Ue}),qe=o.useMemo(()=>B==="pendle"&&Fe?{dstAmount:Fe.data.amountPtOut||Fe.data.amountTokenOut||"0",tx:{data:Fe.transaction.data},srcUSD:null,dstUSD:null}:We,[B,Fe,We]),mt=B==="1inch"?Ie:vt,pt=B==="1inch"?it:dt,ft=_e||mt,ze=B==="1inch"?!!I:!!D,Qe=qe?F(BigInt(qe.dstAmount),d):"0",rt=qe?BigInt(qe.dstAmount)>=ue:!1,{data:Ze,isLoading:et}=wa({sellToken:k?.address||"",buyToken:r,buyAmount:ue.toString(),kind:"buy",from:ve||"",enabled:xe&&L==="limit"&&ue>0n&&!!k&&!!ve&&e}),z=o.useMemo(()=>pl(Ze,k,j),[Ze,k,j]),pe=o.useMemo(()=>ol(s,$,L,k,z),[s,$,L,z,k]),ht=o.useMemo(()=>!k||!ve||!W||!pe?[{preInstructions:[],postInstructions:[]}]:on({selectedTo:k,userAddress:ve,repayAmountRaw:ue,orderManagerAddress:W,protocolName:n,context:b,debtFromToken:r,debtFromName:l,debtFromDecimals:d,cowFlashLoanInfo:pe,limitOrderConfig:$}),[k,ve,ue,W,n,b,r,l,d,pe,$]),bt=L==="limit"?z>0n&&k?F(z,k.decimals):"0":me,q=()=>{if(!qe||!k||!ze||je===0n)return[];const T=Pe?.providerEnum??Oe.BalancerV2;return g(n,r,k.address,ue,je,qe.tx.data,T,b,A,B==="1inch"?"oneinch":"pendle")},{handleConfirm:p,batchingPreference:V}=Na({isOpen:e,chainId:s,onClose:a,buildFlow:q,successMessage:"Debt Swapped successfully!",emptyFlowErrorMessage:"Failed to build swap instructions",simulateWhenBatching:!0}),{enabled:G,setEnabled:ke}=V,De=o.useCallback(async()=>{const T={network:"evm",protocol:n,chainId:s,market:b??null,fromToken:r,fromName:l,toToken:k?.address??null,toName:k?.symbol??null,amountIn:C,isMax:A,slippage:j,preferBatching:G,flashLoanProvider:Pe?.name??null,swapRouter:B};try{oe(!0),he("debt_swap_tx_begin",T),await p(C,A),he("debt_swap_tx_complete",{...T,status:"success"})}catch(Le){throw he("debt_swap_tx_complete",{...T,status:"error",error:Le instanceof Error?Le.message:String(Le)}),Le}finally{oe(!1)}},[n,s,b,r,l,k?.address,k?.symbol,C,A,j,G,Pe?.name,B,p]),Re=o.useCallback(async()=>{if(!k||!ve||!W||!Ve||!ie)throw new Error("Missing required data for limit order");if(!$?.selectedProvider||!pe)throw new Error("No flash loan provider selected");const T=rn({protocolName:n,chainId:s,debtFromToken:r,debtFromName:l,selectedTo:k,repayAmountRaw:ue,debtFromDecimals:d,limitOrderNewDebt:z,flashLoanProviderName:$.selectedProvider.name});se(!0);let Le;try{he("debt_swap_limit_order_begin",T),ln({selectedTo:k,debtFromName:l,limitOrderNewDebt:z,repayAmountRaw:ue,debtFromDecimals:d,cowFlashLoanInfo:pe,cowQuote:Ze});const kt=dn({selectedTo:k,debtFromToken:r,limitOrderNewDebt:z,repayAmountRaw:ue,cowFlashLoanInfo:pe,buildCowInstructions:ht,limitOrderConfig:$}),Ct=await Ae(kt);if(!Ct)throw new Error("Failed to build limit order calls");Ct.success||il(Ct,T),console.log("[Limit Order] Order calls built:",Ct.calls.length),dl(Ct.salt,n,l,k.symbol,s);const Pa=Ct.calls;Le=Ce.loading(t.jsx(Xe,{step:"pending",message:`Creating limit order (${Pa.length} operations)...`})),ge?await cn({allCalls:Pa,sendCallsAsync:ir=>re(ir),setSuppressBatchNotifications:y,setBatchId:x,setLastOrderSalt:Se,setLimitOrderNotificationId:Me,salt:Ct.salt,notificationId:Le,analyticsProps:T}):await un({allCalls:Pa,walletClient:Ve,publicClient:ie,chainId:s,orderManagerAddress:W,analyticsProps:T,onClose:a,notificationId:Le})}catch(kt){throw cl(kt,Le,T),kt}finally{se(!1)}},[k,ve,W,Ve,ie,$,pe,n,s,r,l,ue,d,z,Ze,ht,Ae,ge,re,y,x,a]),$e=!!qe&&parseFloat(C)>0&&je>0n&&ze,$t=L==="limit"&&Ne&&!!pe&&parseFloat(C)>0&&!!W&&z>0n,Vt=L==="market"?$e:$t,wt=o.useMemo(()=>{if(!k?.price||je===0n)return;const T=parseFloat(F(je,k.decimals));if(!(T<=0))return T*Number(F(k.price,8))},[k?.price,k?.decimals,je]),At=o.useMemo(()=>{if(!c||!Qe)return;const T=parseFloat(Qe);if(!(isNaN(T)||T<=0))return T*Number(F(c,8))},[c,Qe]),{priceImpact:Ke,formattedPriceImpact:ot}=Os({slippage:j,setSlippage:Y,oneInchQuote:We,pendleQuote:Fe,swapRouter:B,resetDep:k?.address,srcUsdFallback:wt,dstUsdFallback:At}),tt=o.useMemo(()=>t.jsxs("div",{className:"space-y-3",children:[t.jsx(fa,{value:L,onChange:U,limitAvailable:xe,limitReady:Ne}),L==="market"&&t.jsxs("div",{className:"space-y-2 text-xs",children:[t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Slippage"}),t.jsx("select",{className:"select select-xs select-ghost text-base-content/80 font-medium min-h-0 h-auto py-0.5 text-right",value:j,onChange:T=>Y(parseFloat(T.target.value)),children:[.1,.3,.5,1,3].map(T=>t.jsxs("option",{value:T,children:[T,"%"]},T))})]}),w&&P&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Router"}),t.jsxs("select",{className:"select select-xs select-ghost text-base-content/80 font-medium min-h-0 h-auto py-0.5 text-right",value:B,onChange:T=>v(T.target.value),children:[t.jsx("option",{value:"1inch",children:"1inch"}),t.jsx("option",{value:"pendle",children:"Pendle"})]})]}),S&&S.length>1&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Flash Loan"}),t.jsx("select",{className:"select select-xs select-ghost text-base-content/80 font-medium min-h-0 h-auto py-0.5 text-right",value:Pe?.name||"",onChange:T=>{const Le=S.find(kt=>kt.name===T.target.value);Le&&Je(Le)},children:S.map(T=>t.jsx("option",{value:T.name,children:T.name},T.name))})]})]}),t.jsxs("div",{className:"border-t border-base-300/30 pt-2 space-y-1",children:[Ke!=null&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Price Impact"}),t.jsx("span",{className:Ke>1?"text-warning":Ke>3?"text-error":"text-base-content/80",children:ot||`${Ke.toFixed(2)}%`})]}),we&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Rate"}),t.jsxs("span",{className:"text-base-content/80",children:["1:",parseFloat(we).toFixed(4)]})]}),qe&&Qe&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Output"}),t.jsxs("span",{className:rt===!1?"text-warning":rt===!0?"text-success":"text-base-content/80",children:[parseFloat(Qe).toFixed(4)," ",l]})]})]})]}),L==="limit"&&k&&t.jsxs("div",{className:"space-y-2 text-xs",children:[$?.selectedProvider&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Flash Loan"}),t.jsx("span",{className:"text-base-content/80 font-medium",children:$.selectedProvider.provider})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Slippage"}),t.jsx("select",{className:"select select-xs select-ghost text-base-content/80 font-medium min-h-0 h-auto py-0.5 text-right",value:j,onChange:T=>Y(parseFloat(T.target.value)),children:[.1,.3,.5,1,2,3,5].map(T=>t.jsxs("option",{value:T,children:[T,"%"]},T))})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-base-content/50",children:"Chunks"}),t.jsx("select",{className:"select select-xs select-ghost text-base-content/80 font-medium min-h-0 h-auto py-0.5 text-right",value:$?.numChunks??1,onChange:T=>{te&&$&&te({...$,numChunks:parseInt(T.target.value)})},children:[1,2,3,5,10].map(T=>t.jsx("option",{value:T,children:T},T))})]}),et&&t.jsxs("div",{className:"text-base-content/60 flex items-center gap-2",children:[t.jsx("span",{className:"loading loading-spinner loading-xs"}),"Fetching CoW quote..."]})]})]}),[L,U,xe,Ne,j,Y,Ke,ot,we,k,l,qe,Qe,rt,S,Pe,Je,w,P,B,v,$,te,et]),qa=L==="market"?t.jsx(fl,{swapRouter:B,selectedProviderName:Pe?.name}):t.jsx(hl,{}),Wt=o.useMemo(()=>t.jsx(bl,{executionType:L,swapQuote:qe,outputCoversRepay:rt,expectedOutput:Qe,debtFromName:l,swapRouter:B,oneInchAdapter:I,hasAdapter:ze,isOpen:e,isCowQuoteLoading:et}),[L,qe,rt,Qe,l,B,I,ze,e,et]),La=o.useMemo(()=>{if(m===void 0&&h===void 0)return;const T={name:l,icon:i,address:r,currentRate:0,usdPrice:c?Number(F(c,8)):void 0,decimals:d},Le=Number(F(u,d));return{hf:m??1/0,ltv:h??0,metricLabel:"Total debt",metricValue:Le,token:T}},[m,h,l,i,r,c,d,u]),ct=L==="market",tr=ct?ft:et,ar=ct?pt:null,nr=ct?G:void 0,sr=ct?ke:void 0,rr=ct?De:Re,or=ct?Z:K,lr=ct?"Swap Debt":"Create Limit Order";return t.jsx(Ca,{isOpen:e,onClose:a,title:"Swap Debt",protocolName:n,fromAssets:E,toAssets:fe,initialFromAddress:r,selectedFrom:_,setSelectedFrom:R,selectedTo:k,setSelectedTo:X,amountIn:C,setAmountIn:M,isMax:A,setIsMax:ee,amountOut:bt,isQuoteLoading:tr,quoteError:ar,slippage:j,setSlippage:Y,preferBatching:nr,setPreferBatching:sr,onSubmit:rr,isSubmitting:or,canSubmit:Vt,submitLabel:lr,infoContent:qa,warnings:Wt,fromLabel:"Repay Debt",toLabel:"New Debt",fromReadOnly:!0,hideDefaultStats:!0,positionMetrics:La,rightPanel:tt})},fl=({swapRouter:e,selectedProviderName:a})=>t.jsxs("div",{className:"space-y-4 py-2",children:[t.jsxs("div",{className:"alert alert-info bg-info/10 border-info/20 text-sm",children:[t.jsx(Aa,{className:"size-5 flex-shrink-0"}),t.jsxs("span",{children:[t.jsx("strong",{children:"How Debt Swap Works"}),t.jsx("br",{}),"This feature allows you to change your debt asset without closing your collateral position."]})]}),t.jsxs("div",{className:"space-y-4 px-2",children:[t.jsxs(xt,{step:1,title:"Flash Loan",isLast:!1,children:[t.jsx("p",{className:"text-base-content/70 text-xs",children:"We borrow the new debt asset via a Flash Loan."}),t.jsxs("div",{className:"bg-base-200 mt-1 inline-block rounded p-1 text-xs",children:["Provider: ",a||"Auto"]})]}),t.jsx(xt,{step:2,title:"Swap",isLast:!1,children:t.jsxs("p",{className:"text-base-content/70 text-xs",children:["We swap the new debt token for your current debt token using ",e==="1inch"?"1inch":"Pendle","."]})}),t.jsx(xt,{step:3,title:"Repay Current Debt",isLast:!1,children:t.jsx("p",{className:"text-base-content/70 text-xs",children:"Your current debt is repaid with the swapped tokens."})}),t.jsx(xt,{step:4,title:"Borrow New Debt",isLast:!0,children:t.jsx("p",{className:"text-base-content/70 text-xs",children:"New debt is borrowed to repay the Flash Loan."})})]})]}),hl=()=>t.jsxs("div",{className:"space-y-4 py-2",children:[t.jsxs("div",{className:"alert alert-info bg-info/10 border-info/20 text-sm",children:[t.jsx(Aa,{className:"size-5 flex-shrink-0"}),t.jsxs("span",{children:[t.jsx("strong",{children:"How Limit Order Debt Swap Works"}),t.jsx("br",{}),"Your order waits for CoW solvers to find the best price, then executes atomically."]})]}),t.jsxs("div",{className:"space-y-4 px-2",children:[t.jsx(xt,{step:1,title:"Create Order",isLast:!1,children:t.jsx("p",{className:"text-base-content/70 text-xs",children:"Your limit order is created and submitted to CoW Protocol."})}),t.jsx(xt,{step:2,title:"Solver Competition",isLast:!1,children:t.jsx("p",{className:"text-base-content/70 text-xs",children:"Solvers compete to fill your order at the best price."})}),t.jsx(xt,{step:3,title:"Flash Loan + Swap",isLast:!1,children:t.jsx("p",{className:"text-base-content/70 text-xs",children:"Solver takes flash loan, swaps new debt for old debt."})}),t.jsx(xt,{step:4,title:"Repay + Borrow",isLast:!0,children:t.jsx("p",{className:"text-base-content/70 text-xs",children:"Old debt repaid, new debt borrowed to cover flash loan. All atomic!"})})]})]}),xt=({step:e,title:a,isLast:n,children:s})=>t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"bg-primary/20 text-primary flex size-6 items-center justify-center rounded-full text-xs font-bold",children:e}),!n&&t.jsx("div",{className:"bg-base-300 my-1 h-full w-0.5"})]}),t.jsxs("div",{className:n?"":"pb-4",children:[t.jsx("h4",{className:"text-sm font-medium",children:a}),s]})]}),bl=({executionType:e,swapQuote:a,outputCoversRepay:n,expectedOutput:s,debtFromName:r,swapRouter:l,oneInchAdapter:i,hasAdapter:d,isOpen:c,isCowQuoteLoading:u})=>{const f=e==="market"&&a&&!n,b=e==="market"&&l==="1inch"&&a&&i&&"from"in a.tx&&a.tx.from?.toLowerCase()!==i.address.toLowerCase(),m=e==="market"&&!d&&c,h=e==="limit"&&u;return t.jsxs(t.Fragment,{children:[f&&t.jsx(qt,{message:`Swap output (${s} ${r}) may not fully cover repay amount. Consider increasing slippage or reducing amount.`,size:"sm"}),b&&t.jsx(qt,{message:"Warning: Quote 'from' address mismatch!",size:"sm",breakAll:!0}),m&&t.jsx(qt,{message:`${l==="1inch"?"1inch":"Pendle"} Adapter not found on this network. Swaps unavailable.`,size:"sm"}),h&&t.jsxs("div",{className:"alert alert-info py-2 text-xs",children:[t.jsx("span",{className:"loading loading-spinner loading-xs"}),t.jsx("span",{children:"Fetching CoW quote..."})]})]})};try{pn.displayName="DebtSwapEvmModal",pn.__docgenInfo={description:"",displayName:"DebtSwapEvmModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},protocolName:{defaultValue:null,description:"",name:"protocolName",required:!0,type:{name:"string"}},chainId:{defaultValue:null,description:"",name:"chainId",required:!0,type:{name:"number"}},debtFromToken:{defaultValue:null,description:"",name:"debtFromToken",required:!0,type:{name:"`0x${string}`"}},debtFromName:{defaultValue:null,description:"",name:"debtFromName",required:!0,type:{name:"string"}},debtFromIcon:{defaultValue:null,description:"",name:"debtFromIcon",required:!0,type:{name:"string"}},debtFromDecimals:{defaultValue:null,description:"",name:"debtFromDecimals",required:!0,type:{name:"number"}},debtFromPrice:{defaultValue:null,description:"",name:"debtFromPrice",required:!1,type:{name:"bigint"}},currentDebtBalance:{defaultValue:null,description:"",name:"currentDebtBalance",required:!0,type:{name:"bigint"}},availableAssets:{defaultValue:null,description:"",name:"availableAssets",required:!0,type:{name:"SwapAsset[]"}},context:{defaultValue:null,description:"Pre-encoded protocol context (e.g., Morpho MarketParams, Compound market address)",name:"context",required:!1,type:{name:"string"}},position:{defaultValue:null,description:"",name:"position",required:!1,type:{name:"PositionManager"}},hf:{defaultValue:null,description:"",name:"hf",required:!1,type:{name:"number"}},ltv:{defaultValue:null,description:"",name:"ltv",required:!1,type:{name:"number"}}}}}catch{}const He=()=>{},be={usdc:{name:"USDC",icon:"https://assets.coingecko.com/coins/images/6319/small/usdc.png",address:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",currentRate:3.5,usdPrice:1,decimals:6},weth:{name:"WETH",icon:"https://assets.coingecko.com/coins/images/2518/small/weth.png",address:"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1",currentRate:2.1,usdPrice:3500,decimals:18}},Zl={title:"Modals/Real",component:St,parameters:{layout:"fullscreen"}},Gt={name:"Deposit USDC",render:()=>t.jsx(cs,{isOpen:!0,onClose:He,token:be.usdc,protocolName:"Aave",chainId:42161})},Yt={name:"Deposit WETH",render:()=>t.jsx(cs,{isOpen:!0,onClose:He,token:be.weth,protocolName:"Compound",chainId:42161})},Xt={name:"Withdraw USDC",render:()=>t.jsx(ur,{isOpen:!0,onClose:He,token:be.usdc,protocolName:"Aave",supplyBalance:BigInt("5000000000"),chainId:42161})},Jt={name:"Borrow USDC",render:()=>t.jsx(ua,{isOpen:!0,onClose:He,token:be.usdc,protocolName:"Aave",currentDebt:500,chainId:42161})},Zt={name:"Borrow WETH",render:()=>t.jsx(ua,{isOpen:!0,onClose:He,token:be.weth,protocolName:"Morpho",currentDebt:.5,chainId:42161})},ea={name:"Repay USDC",render:()=>t.jsx(Ea,{isOpen:!0,onClose:He,token:be.usdc,protocolName:"Aave",debtBalance:BigInt("2500000000"),chainId:42161})},ta={name:"TokenActionModal - Deposit",render:()=>t.jsx(St,{isOpen:!0,onClose:He,action:"Deposit",token:be.usdc,protocolName:"Aave",apyLabel:"Supply APY",apy:3.5,metricLabel:"Total supplied",before:1e3,balance:BigInt("5000000000"),network:"evm",chainId:42161,hf:2.5,ltv:45,utilization:65})},aa={name:"TokenActionModal - Borrow",render:()=>t.jsx(St,{isOpen:!0,onClose:He,action:"Borrow",token:be.weth,protocolName:"Morpho",apyLabel:"Borrow APY",apy:2.8,metricLabel:"Total debt",before:.5,balance:BigInt("2000000000000000000"),network:"evm",chainId:42161,hf:1.9,ltv:55,utilization:68})},na={name:"TokenActionModal - Repay",render:()=>t.jsx(St,{isOpen:!0,onClose:He,action:"Repay",token:be.usdc,protocolName:"Aave",apyLabel:"Borrow APY",apy:5.2,metricLabel:"Total debt",before:5e3,balance:BigInt("6000000000"),network:"evm",chainId:42161,hf:1.15,ltv:85,utilization:92})},sa={name:"TokenActionModal - Withdraw",render:()=>t.jsx(St,{isOpen:!0,onClose:He,action:"Withdraw",token:be.weth,protocolName:"Compound",apyLabel:"Supply APY",apy:2.1,metricLabel:"Total supplied",before:5,balance:BigInt("5000000000000000000"),network:"evm",chainId:42161,hf:2.8,ltv:40,utilization:60})},ra={name:"Refinance Debt",render:()=>t.jsx(tn,{isOpen:!0,onClose:He,fromProtocol:"Aave",position:{name:"USDC",tokenAddress:be.usdc.address,decimals:6,balance:BigInt("5000000000"),type:"borrow"},chainId:42161,networkType:"evm",preSelectedCollaterals:[{token:be.weth.address,symbol:"WETH",decimals:18,amount:BigInt("2000000000000000000"),maxAmount:BigInt("5000000000000000000")}]})},gl=[{address:be.weth.address,symbol:"WETH",icon:be.weth.icon,decimals:18,rawBalance:BigInt("3000000000000000000"),balance:3,usdValue:10500,price:BigInt("350000000000")},{address:be.usdc.address,symbol:"USDC",icon:be.usdc.icon,decimals:6,rawBalance:BigInt("5000000000"),balance:5e3,usdValue:5e3,price:BigInt("100000000")}],oa={name:"Collateral Swap",render:()=>t.jsx(sn,{isOpen:!0,onClose:He,protocolName:"Aave",availableAssets:gl,initialFromTokenAddress:be.weth.address,chainId:42161,position:{name:"USDC",tokenAddress:be.usdc.address,decimals:6,balance:BigInt("2000000000"),type:"borrow"},hf:1.85,ltv:72,totalCollateralUsd:15500,projectedMetrics:{afterHf:1.92,afterLtv:68}})},yl=[{symbol:"USDC",address:be.usdc.address,decimals:6,rawBalance:BigInt("5000000000"),balance:5e3,icon:be.usdc.icon,usdValue:5e3,price:BigInt("100000000")},{symbol:"WETH",address:be.weth.address,decimals:18,rawBalance:BigInt("2000000000000000000"),balance:2,icon:be.weth.icon,usdValue:7e3,price:BigInt("350000000000")}],la={name:"Debt Swap",render:()=>t.jsx(pn,{isOpen:!0,onClose:He,protocolName:"Aave",chainId:42161,debtFromToken:be.usdc.address,debtFromName:"USDC",debtFromIcon:be.usdc.icon,debtFromDecimals:6,debtFromPrice:BigInt("100000000"),currentDebtBalance:BigInt("5000000000"),availableAssets:yl,hf:1.65,ltv:78})};Gt.parameters={...Gt.parameters,docs:{...Gt.parameters?.docs,source:{originalSource:`{
  name: "Deposit USDC",
  render: () => <DepositModal isOpen={true} onClose={noop} token={tokens.usdc} protocolName="Aave" chainId={42161} />
}`,...Gt.parameters?.docs?.source}}};Yt.parameters={...Yt.parameters,docs:{...Yt.parameters?.docs,source:{originalSource:`{
  name: "Deposit WETH",
  render: () => <DepositModal isOpen={true} onClose={noop} token={tokens.weth} protocolName="Compound" chainId={42161} />
}`,...Yt.parameters?.docs?.source}}};Xt.parameters={...Xt.parameters,docs:{...Xt.parameters?.docs,source:{originalSource:`{
  name: "Withdraw USDC",
  render: () => <WithdrawModal isOpen={true} onClose={noop} token={tokens.usdc} protocolName="Aave" supplyBalance={BigInt("5000000000")} chainId={42161} />
}`,...Xt.parameters?.docs?.source}}};Jt.parameters={...Jt.parameters,docs:{...Jt.parameters?.docs,source:{originalSource:`{
  name: "Borrow USDC",
  render: () => <BorrowModal isOpen={true} onClose={noop} token={tokens.usdc} protocolName="Aave" currentDebt={500} chainId={42161} />
}`,...Jt.parameters?.docs?.source}}};Zt.parameters={...Zt.parameters,docs:{...Zt.parameters?.docs,source:{originalSource:`{
  name: "Borrow WETH",
  render: () => <BorrowModal isOpen={true} onClose={noop} token={tokens.weth} protocolName="Morpho" currentDebt={0.5} chainId={42161} />
}`,...Zt.parameters?.docs?.source}}};ea.parameters={...ea.parameters,docs:{...ea.parameters?.docs,source:{originalSource:`{
  name: "Repay USDC",
  render: () => <RepayModal isOpen={true} onClose={noop} token={tokens.usdc} protocolName="Aave" debtBalance={BigInt("2500000000")} chainId={42161} />
}`,...ea.parameters?.docs?.source}}};ta.parameters={...ta.parameters,docs:{...ta.parameters?.docs,source:{originalSource:`{
  name: "TokenActionModal - Deposit",
  render: () => <TokenActionModal isOpen={true} onClose={noop} action="Deposit" token={tokens.usdc} protocolName="Aave" apyLabel="Supply APY" apy={3.5} metricLabel="Total supplied" before={1000} balance={BigInt("5000000000")} network="evm" chainId={42161} hf={2.5} ltv={45} utilization={65} />
}`,...ta.parameters?.docs?.source}}};aa.parameters={...aa.parameters,docs:{...aa.parameters?.docs,source:{originalSource:`{
  name: "TokenActionModal - Borrow",
  render: () => <TokenActionModal isOpen={true} onClose={noop} action="Borrow" token={tokens.weth} protocolName="Morpho" apyLabel="Borrow APY" apy={2.8} metricLabel="Total debt" before={0.5} balance={BigInt("2000000000000000000")} network="evm" chainId={42161} hf={1.9} ltv={55} utilization={68} />
}`,...aa.parameters?.docs?.source}}};na.parameters={...na.parameters,docs:{...na.parameters?.docs,source:{originalSource:`{
  name: "TokenActionModal - Repay",
  render: () => <TokenActionModal isOpen={true} onClose={noop} action="Repay" token={tokens.usdc} protocolName="Aave" apyLabel="Borrow APY" apy={5.2} metricLabel="Total debt" before={5000} balance={BigInt("6000000000")} network="evm" chainId={42161} hf={1.15} ltv={85} utilization={92} />
}`,...na.parameters?.docs?.source}}};sa.parameters={...sa.parameters,docs:{...sa.parameters?.docs,source:{originalSource:`{
  name: "TokenActionModal - Withdraw",
  render: () => <TokenActionModal isOpen={true} onClose={noop} action="Withdraw" token={tokens.weth} protocolName="Compound" apyLabel="Supply APY" apy={2.1} metricLabel="Total supplied" before={5.0} balance={BigInt("5000000000000000000")} network="evm" chainId={42161} hf={2.8} ltv={40} utilization={60} />
}`,...sa.parameters?.docs?.source}}};ra.parameters={...ra.parameters,docs:{...ra.parameters?.docs,source:{originalSource:`{
  name: "Refinance Debt",
  render: () => <RefinanceModal isOpen={true} onClose={noop} fromProtocol="Aave" position={{
    name: "USDC",
    tokenAddress: tokens.usdc.address,
    decimals: 6,
    balance: BigInt("5000000000"),
    type: "borrow"
  }} chainId={42161} networkType="evm" preSelectedCollaterals={[{
    token: tokens.weth.address,
    symbol: "WETH",
    decimals: 18,
    amount: BigInt("2000000000000000000"),
    maxAmount: BigInt("5000000000000000000")
  }]} />
}`,...ra.parameters?.docs?.source}}};oa.parameters={...oa.parameters,docs:{...oa.parameters?.docs,source:{originalSource:`{
  name: "Collateral Swap",
  render: () => <CollateralSwapModal isOpen={true} onClose={noop} protocolName="Aave" availableAssets={mockCollaterals} initialFromTokenAddress={tokens.weth.address} chainId={42161} position={{
    name: "USDC",
    tokenAddress: tokens.usdc.address,
    decimals: 6,
    balance: BigInt("2000000000"),
    type: "borrow"
  }} hf={1.85} ltv={72} totalCollateralUsd={15500} projectedMetrics={{
    afterHf: 1.92,
    afterLtv: 68
  }} />
}`,...oa.parameters?.docs?.source}}};la.parameters={...la.parameters,docs:{...la.parameters?.docs,source:{originalSource:`{
  name: "Debt Swap",
  render: () => <DebtSwapEvmModal isOpen={true} onClose={noop} protocolName="Aave" chainId={42161} debtFromToken={tokens.usdc.address} debtFromName="USDC" debtFromIcon={tokens.usdc.icon} debtFromDecimals={6} debtFromPrice={BigInt("100000000")} currentDebtBalance={BigInt("5000000000")} availableAssets={mockSwapAssets} hf={1.65} ltv={78} />
}`,...la.parameters?.docs?.source}}};const ei=["DepositUSDC","DepositWETH","WithdrawUSDC","BorrowUSDC","BorrowWETH","RepayUSDC","TokenActionDeposit","TokenActionBorrow","TokenActionRepay","TokenActionWithdraw","RefinanceDebt","CollateralSwap","DebtSwap"];export{Jt as BorrowUSDC,Zt as BorrowWETH,oa as CollateralSwap,la as DebtSwap,Gt as DepositUSDC,Yt as DepositWETH,ra as RefinanceDebt,ea as RepayUSDC,aa as TokenActionBorrow,ta as TokenActionDeposit,na as TokenActionRepay,sa as TokenActionWithdraw,Xt as WithdrawUSDC,ei as __namedExportsOrder,Zl as default};
