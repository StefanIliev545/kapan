import{j as e}from"./jsx-runtime-CcWEvojh.js";import{t as re}from"./index-CXgENQ1a.js";import{r as l}from"./index-Bk_d_yAU.js";import{I as Q}from"./next-image-DV_ejeD4.js";import{u as Ce,a as Le,S as je}from"./Constants-BRuV1-4o.js";import{c as q}from"./clsx-B-dksMZM.js";import{t as _e}from"./externalContracts-_f_8pMJw.js";import{k as Ue,l as X,u as Ee}from"./createSafeContext-Dp97sAkz.js";import{g as Fe,h as Be,i as Pe}from"./SelectedGasTokenContext-BLwdQCB-.js";import{u as ve}from"./store-CUKCto7f.js";import{f as fe}from"./formatPercentage-BDNxS5DB.js";import{p as Se,s as ze,c as De}from"./validation-DM-NIpAK.js";const Re=[["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 4 0v-6.998a2 2 0 0 0-.59-1.42L18 5",key:"1wtuz0"}],["path",{d:"M14 21V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v16",key:"e09ifn"}],["path",{d:"M2 21h13",key:"1x0fut"}],["path",{d:"M3 9h11",key:"1p7c0w"}]],He=Ue("fuel",Re),xe={xs:{icon:12,text:"text-[10px]",containerClass:"w-3 h-3"},sm:{icon:16,text:"text-xs",containerClass:"w-4 h-4"},md:{icon:24,text:"text-sm",containerClass:"w-6 h-6"},lg:{icon:32,text:"text-base",containerClass:"w-8 h-8"},xl:{icon:40,text:"text-lg",containerClass:"w-10 h-10"}},R=({icon:n,symbol:a,alt:t,size:s="md",customSize:u,className:r,rounded:c="full",showContainer:i=!1,fallbackIcon:o="/logos/x-logo.svg"})=>{const d=n||(a?_e(a):o),x=t||a||"token",f=xe[s],m=c===!0||c==="full"?"rounded-full":c==="lg"?"rounded-lg":c==="xl"?"rounded-xl":"",y=u?{width:u,height:u}:void 0,N=l.useCallback(v=>{const w=v.target;w.src=o},[o]);return i?e.jsx("div",{className:q("from-base-200 to-base-300/50 ring-base-300/50 relative flex-shrink-0 rounded-xl bg-gradient-to-br p-1 ring-1",!u&&f.containerClass,r),style:y,children:e.jsx(Q,{src:d,alt:x,fill:!0,className:q("object-contain",m),onError:N})}):e.jsx("div",{className:q("relative flex-shrink-0",!u&&f.containerClass,r),style:y,children:e.jsx(Q,{src:d,alt:x,fill:!0,className:q("object-contain",m),onError:N})})},he=({icon:n,symbol:a,name:t,size:s="md",customSize:u,className:r,rounded:c="full",showContainer:i=!1,fallbackIcon:o,showSymbol:d=!0,textColorClass:x="text-base-content",suffix:f})=>{const m=xe[s],y=t||a||"Unknown";return e.jsxs("div",{className:q("flex items-center gap-2",r),children:[e.jsx(R,{icon:n,symbol:a,alt:y,size:s,customSize:u,rounded:c,showContainer:i,fallbackIcon:o}),d&&e.jsx("span",{className:q("font-medium",m.text,x),children:y}),f]})},ie=({balance:n,decimals:a=18,symbol:t,maxDecimals:s=6,className:u,isNegative:r=!1})=>{const c=typeof n=="bigint"?n:BigInt(n||0),i=X(c,a),o=parseFloat(i),d=o.toLocaleString("en-US",{maximumFractionDigits:s});return e.jsxs("span",{className:q("font-mono tabular-nums",u),children:[r&&o>0?"-":"",d,t&&e.jsx("span",{className:"ml-1",children:t})]})},ke=({icon:n,symbol:a,name:t,size:s="md",customSize:u,className:r,rounded:c="full",showContainer:i=!1,fallbackIcon:o,showSymbol:d=!0,textColorClass:x="text-base-content",balance:f,decimals:m=18,maxBalanceDecimals:y=6,showBalance:N=!1,isNegativeBalance:v=!1,balanceColorClass:w,direction:_="row",children:C})=>{const V=xe[s],g=w||(v?"text-error":"text-success");return _==="column"?e.jsxs("div",{className:q("flex flex-col items-center",r),children:[e.jsx(R,{icon:n,symbol:a,alt:t||a,size:s,customSize:u,rounded:c,showContainer:i,fallbackIcon:o}),d&&e.jsx("span",{className:q("mt-1 font-medium",V.text,x),children:t||a||"Unknown"}),N&&f!==void 0&&e.jsx(ie,{balance:f,decimals:m,maxDecimals:y,className:q(V.text,g),isNegative:v}),C]}):e.jsxs("div",{className:q("flex items-center gap-2",r),children:[e.jsx(R,{icon:n,symbol:a,alt:t||a,size:s,customSize:u,rounded:c,showContainer:i,fallbackIcon:o}),e.jsxs("div",{className:"flex min-w-0 flex-col",children:[d&&e.jsx("span",{className:q("truncate font-medium",V.text,x),children:t||a||"Unknown"}),N&&f!==void 0&&e.jsx(ie,{balance:f,decimals:m,maxDecimals:y,className:q("text-xs",g),isNegative:v})]}),C]})},oe=({icon:n,symbol:a,name:t,value:s,size:u="sm",className:r})=>{const i={xs:{icon:10,text:"text-[10px]"},sm:{icon:12,text:"text-xs"},md:{icon:16,text:"text-sm"}}[u],o=a||t,d=n||(o?_e(o):"/logos/x-logo.svg"),x=l.useMemo(()=>({width:i.icon,height:i.icon}),[i.icon]),f=l.useCallback(m=>{const y=m.target;y.src="/logos/x-logo.svg"},[]);return e.jsxs("div",{className:q("flex items-center gap-1",i.text,r),children:[e.jsx("div",{className:"relative flex-shrink-0",style:x,children:e.jsx(Q,{src:d,alt:o||"token",fill:!0,className:"rounded-full object-contain",onError:f})}),s!==void 0&&e.jsx("span",{className:"text-base-content/80 font-mono tabular-nums",children:typeof s=="number"?s.toLocaleString("en-US",{maximumFractionDigits:2}):s})]})},Ne=({fromIcon:n,fromSymbol:a,toIcon:t,toSymbol:s,size:u="sm",separator:r,className:c})=>e.jsxs("div",{className:q("flex items-center gap-2",c),children:[e.jsx(R,{icon:n,symbol:a,size:u}),r||e.jsx("span",{className:"text-base-content/40",children:"→"}),e.jsx(R,{icon:t,symbol:s,size:u})]});try{R.displayName="TokenIcon",R.__docgenInfo={description:`TokenIcon - A standardized component for displaying token icons

Usage:
\`\`\`tsx
<TokenIcon icon="/logos/eth.svg" size="md" />
<TokenIcon symbol="USDC" size="lg" rounded="full" />
<TokenIcon icon={token.icon} customSize={28} showContainer />
\`\`\``,displayName:"TokenIcon",props:{icon:{defaultValue:null,description:"Token icon URL or symbol to resolve to icon",name:"icon",required:!1,type:{name:"string"}},symbol:{defaultValue:null,description:"Token symbol for fallback icon resolution",name:"symbol",required:!1,type:{name:"string"}},alt:{defaultValue:null,description:"Alt text for the image",name:"alt",required:!1,type:{name:"string"}},size:{defaultValue:{value:"sm"},description:"Size variant",name:"size",required:!1,type:{name:"enum",value:[{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xs"'},{value:'"xl"'}]}},customSize:{defaultValue:null,description:"Custom size in pixels (overrides size variant)",name:"customSize",required:!1,type:{name:"number"}},className:{defaultValue:null,description:"Additional CSS classes for the container",name:"className",required:!1,type:{name:"string"}},rounded:{defaultValue:{value:"full"},description:"Whether to show rounded corners",name:"rounded",required:!1,type:{name:'boolean | "lg" | "xl" | "full"'}},showContainer:{defaultValue:{value:"false"},description:"Whether to show a container/background styling",name:"showContainer",required:!1,type:{name:"boolean"}},fallbackIcon:{defaultValue:{value:"/logos/x-logo.svg"},description:"Fallback icon URL if main icon fails",name:"fallbackIcon",required:!1,type:{name:"string"}}}}}catch{}try{he.displayName="TokenLabel",he.__docgenInfo={description:'TokenLabel - Displays token icon with its name/symbol\n\nUsage:\n```tsx\n<TokenLabel icon="/logos/eth.svg" symbol="ETH" />\n<TokenLabel symbol="USDC" name="USD Coin" size="lg" />\n```',displayName:"TokenLabel",props:{name:{defaultValue:null,description:"Token name to display (falls back to symbol)",name:"name",required:!1,type:{name:"string"}},showSymbol:{defaultValue:{value:"true"},description:"Whether to show the symbol (default: true if symbol provided)",name:"showSymbol",required:!1,type:{name:"boolean"}},textColorClass:{defaultValue:{value:"text-base-content"},description:"Text color class",name:"textColorClass",required:!1,type:{name:"string"}},suffix:{defaultValue:null,description:"Additional content to render after the name",name:"suffix",required:!1,type:{name:"ReactNode"}},symbol:{defaultValue:null,description:"Token symbol for fallback icon resolution",name:"symbol",required:!1,type:{name:"string"}},size:{defaultValue:{value:"sm"},description:"Size variant",name:"size",required:!1,type:{name:"enum",value:[{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xs"'},{value:'"xl"'}]}},icon:{defaultValue:null,description:"Token icon URL or symbol to resolve to icon",name:"icon",required:!1,type:{name:"string"}},className:{defaultValue:null,description:"Additional CSS classes for the container",name:"className",required:!1,type:{name:"string"}},rounded:{defaultValue:{value:"full"},description:"Whether to show rounded corners",name:"rounded",required:!1,type:{name:'boolean | "lg" | "xl" | "full"'}},customSize:{defaultValue:null,description:"Custom size in pixels (overrides size variant)",name:"customSize",required:!1,type:{name:"number"}},showContainer:{defaultValue:{value:"false"},description:"Whether to show a container/background styling",name:"showContainer",required:!1,type:{name:"boolean"}},fallbackIcon:{defaultValue:{value:"/logos/x-logo.svg"},description:"Fallback icon URL if main icon fails",name:"fallbackIcon",required:!1,type:{name:"string"}}}}}catch{}try{ie.displayName="TokenBalance",ie.__docgenInfo={description:'TokenBalance - Formats and displays a token balance\n\nUsage:\n```tsx\n<TokenBalance balance={1000000000000000000n} decimals={18} symbol="ETH" />\n<TokenBalance balance="5000000" decimals={6} maxDecimals={2} />\n```',displayName:"TokenBalance",props:{balance:{defaultValue:null,description:"Raw balance value (bigint or number string)",name:"balance",required:!0,type:{name:"string | number | bigint"}},decimals:{defaultValue:{value:"18"},description:"Token decimals for formatting",name:"decimals",required:!1,type:{name:"number"}},symbol:{defaultValue:null,description:"Token symbol to append",name:"symbol",required:!1,type:{name:"string"}},maxDecimals:{defaultValue:{value:"6"},description:"Maximum fraction digits to display",name:"maxDecimals",required:!1,type:{name:"number"}},className:{defaultValue:null,description:"Additional CSS classes",name:"className",required:!1,type:{name:"string"}},isNegative:{defaultValue:{value:"false"},description:"Whether this is a negative value (e.g., debt)",name:"isNegative",required:!1,type:{name:"boolean"}}}}}catch{}try{ke.displayName="TokenDisplay",ke.__docgenInfo={description:`TokenDisplay - Full token display component combining icon, name, and balance

Usage:
\`\`\`tsx
<TokenDisplay icon="/logos/eth.svg" symbol="ETH" balance={1000000000000000000n} decimals={18} />
<TokenDisplay symbol="USDC" showBalance={false} size="lg" />
<TokenDisplay
  icon={token.icon}
  name={token.name}
  balance={token.balance}
  decimals={token.decimals}
  direction="column"
/>
\`\`\``,displayName:"TokenDisplay",props:{balance:{defaultValue:null,description:"Raw balance value",name:"balance",required:!1,type:{name:"string | number | bigint"}},decimals:{defaultValue:{value:"18"},description:"Token decimals for balance formatting",name:"decimals",required:!1,type:{name:"number"}},maxBalanceDecimals:{defaultValue:{value:"6"},description:"Maximum fraction digits for balance",name:"maxBalanceDecimals",required:!1,type:{name:"number"}},showBalance:{defaultValue:{value:"false"},description:"Whether to show balance",name:"showBalance",required:!1,type:{name:"boolean"}},isNegativeBalance:{defaultValue:{value:"false"},description:"Whether balance is negative (e.g., debt)",name:"isNegativeBalance",required:!1,type:{name:"boolean"}},balanceColorClass:{defaultValue:null,description:"Balance text color class",name:"balanceColorClass",required:!1,type:{name:"string"}},direction:{defaultValue:{value:"row"},description:"Layout direction",name:"direction",required:!1,type:{name:"enum",value:[{value:'"row"'},{value:'"column"'}]}},children:{defaultValue:null,description:"Additional content to render",name:"children",required:!1,type:{name:"ReactNode"}},symbol:{defaultValue:null,description:"Token symbol for fallback icon resolution",name:"symbol",required:!1,type:{name:"string"}},size:{defaultValue:{value:"sm"},description:"Size variant",name:"size",required:!1,type:{name:"enum",value:[{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xs"'},{value:'"xl"'}]}},icon:{defaultValue:null,description:"Token icon URL or symbol to resolve to icon",name:"icon",required:!1,type:{name:"string"}},className:{defaultValue:null,description:"Additional CSS classes for the container",name:"className",required:!1,type:{name:"string"}},name:{defaultValue:null,description:"Token name to display (falls back to symbol)",name:"name",required:!1,type:{name:"string"}},rounded:{defaultValue:{value:"full"},description:"Whether to show rounded corners",name:"rounded",required:!1,type:{name:'boolean | "lg" | "xl" | "full"'}},customSize:{defaultValue:null,description:"Custom size in pixels (overrides size variant)",name:"customSize",required:!1,type:{name:"number"}},showContainer:{defaultValue:{value:"false"},description:"Whether to show a container/background styling",name:"showContainer",required:!1,type:{name:"boolean"}},fallbackIcon:{defaultValue:{value:"/logos/x-logo.svg"},description:"Fallback icon URL if main icon fails",name:"fallbackIcon",required:!1,type:{name:"string"}},showSymbol:{defaultValue:{value:"true"},description:"Whether to show the symbol (default: true if symbol provided)",name:"showSymbol",required:!1,type:{name:"boolean"}},textColorClass:{defaultValue:{value:"text-base-content"},description:"Text color class",name:"textColorClass",required:!1,type:{name:"string"}}}}}catch{}try{oe.displayName="TokenPill",oe.__docgenInfo={description:'TokenPill - Compact inline token display\n\nUsage:\n```tsx\n<TokenPill icon="/logos/eth.svg" symbol="ETH" value="1.5" />\n<TokenPill symbol="USDC" value={formattedBalance} size="sm" />\n```',displayName:"TokenPill",props:{icon:{defaultValue:null,description:"Token icon URL",name:"icon",required:!1,type:{name:"string"}},symbol:{defaultValue:null,description:"Token symbol",name:"symbol",required:!1,type:{name:"string"}},name:{defaultValue:null,description:"Token name (alternative to symbol, for alt text)",name:"name",required:!1,type:{name:"string"}},value:{defaultValue:null,description:"Formatted value to display",name:"value",required:!1,type:{name:"string | number"}},size:{defaultValue:{value:"sm"},description:"Size variant",name:"size",required:!1,type:{name:"enum",value:[{value:'"sm"'},{value:'"md"'},{value:'"xs"'}]}},className:{defaultValue:null,description:"Additional CSS classes",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{Ne.displayName="TokenPair",Ne.__docgenInfo={description:`TokenPair - Displays two tokens for swap/trade scenarios

Usage:
\`\`\`tsx
<TokenPair fromSymbol="ETH" toSymbol="USDC" />
<TokenPair
  fromIcon="/logos/eth.svg"
  toIcon="/logos/usdc.svg"
  separator={<ArrowRightIcon className="w-4 h-4" />}
/>
\`\`\``,displayName:"TokenPair",props:{fromIcon:{defaultValue:null,description:"From token icon",name:"fromIcon",required:!1,type:{name:"string"}},fromSymbol:{defaultValue:null,description:"From token symbol",name:"fromSymbol",required:!1,type:{name:"string"}},toIcon:{defaultValue:null,description:"To token icon",name:"toIcon",required:!1,type:{name:"string"}},toSymbol:{defaultValue:null,description:"To token symbol",name:"toSymbol",required:!1,type:{name:"string"}},size:{defaultValue:{value:"sm"},description:"Size variant",name:"size",required:!1,type:{name:"enum",value:[{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xs"'},{value:'"xl"'}]}},separator:{defaultValue:null,description:"Separator element",name:"separator",required:!1,type:{name:"ReactNode"}},className:{defaultValue:null,description:"Additional CSS classes",name:"className",required:!1,type:{name:"string"}}}}}catch{}function Ve(n){return Number(n)/1e18}function Te(n){return Number(n)/1e18}const We={FAST:300};function Ge(n){const{enabled:a,buildCalls:t,currency:s="ETH",debounceMs:u=We.FAST,preferPaymaster:r=!0}=n,{account:c}=Ce(),{selectedToken:i}=Fe(),o=ve(p=>p.nativeCurrencyPrice),d=ve(p=>p.strkCurrencyPrice),[x,f]=l.useState(void 0),m=l.useRef(null),y=l.useRef(null),N=()=>{m.current!=null&&(window.clearTimeout(m.current),m.current=null)},v=p=>{const T=new WeakSet,b=h=>{if(h&&typeof h=="object"){if(T.has(h))return"[[cyclic]]";if(T.add(h),Array.isArray(h))return h.map(b);const B={};for(const E of Object.keys(h).sort()){const P=h[E];B[E]=typeof P=="bigint"?P.toString():b(P)}return B}return typeof h=="bigint"?h.toString():h};return JSON.stringify(b(p))};l.useEffect(()=>{if(N(),!a){f(void 0),y.current=null;return}return m.current=window.setTimeout(async()=>{const p=await t();if(!p){f(void 0),y.current=null;return}const T=Array.isArray(p)?p:[p],b=v(T);y.current!==b&&(y.current=b,f(T))},u),N},[a,u,t]);const[w,_]=l.useState(!1),[C,V]=l.useState(null),[g,z]=l.useState(null),[M,L]=l.useState(null),[k,I]=l.useState(null),[F,H]=l.useState(null),[ee,G]=l.useState(null),K=()=>{V(null),z(null),L(null),I(null),H(null),G(null)},ae=l.useCallback((p,T)=>{const b=T==="WEI"?"ETH":"STRK",h=T==="WEI"?Ve(p):Te(p),B=b==="ETH"?o??null:d??null,E=B!=null?h*B:null;if(s===b)return{native:h,usd:E,used:b};if(E!=null){const P=s==="ETH"?o??null:d??null;if(P!=null&&P>0)return{native:E/P,usd:E,used:s}}return{native:h,usd:E,used:b}},[s,o,d]),ne=l.useCallback(async(p,T)=>{if(!T||T.length===0){K();return}_(!0),V(null);try{const b=await p.estimateInvokeFee(T),h=b?.suggestedMaxFee??b?.overall_fee??0n,B=b?.unit;if(L(h),B){z(B);const{native:E,usd:P,used:Me}=ae(h,B);I(E),H(P),G(Me)}else I(null),H(null),G(null)}catch(b){console.error("standard fee estimation failed",b),K(),V("Fee estimation unavailable")}finally{_(!1)}},[ae]);l.useEffect(()=>{if(!a||!c?.address){K();return}ne(c,x)},[a,c?.address,x,ne,c]);const{data:te}=Be(),A=l.useMemo(()=>{const p=i?.address?.toLowerCase?.(),T=te?.find(b=>(b.address??b.tokenAddress??b.token_address??"").toLowerCase?.()===p);return Number(T?.decimals??18)},[te,i?.address]),$=l.useMemo(()=>i?.address?{feeMode:{mode:"default",gasToken:i.address}}:{feeMode:{mode:"default",gasToken:Le}},[i?.address]),j=a&&!!x?.length&&!!$,{data:S,error:O,isPending:J}=Pe({calls:x,options:$,enabled:j}),U=l.useMemo(()=>{if(!S)return null;const p=S?.suggested_max_fee_in_gas_token??S?.suggestedMaxFeeInGasToken??S?.suggested_max_fee??S?.suggestedMaxFee??0;try{return typeof p=="bigint"?p:BigInt(p)}catch{return null}},[S]),D=l.useMemo(()=>{if(U==null||!i?.symbol)return null;if(i.symbol==="ETH")return Ve(U);if(i.symbol==="STRK")return Te(U);try{return Number(U)/10**A}catch{return null}},[U,A,i?.symbol]),Y=l.useMemo(()=>D==null||!i?.symbol?null:i.symbol==="ETH"&&o!=null?D*o:i.symbol==="STRK"&&d!=null?D*d:null,[D,i?.symbol,o,d]),se=O?O.message??"Paymaster estimation failed":null,W=!!U&&(!!r||i?.symbol!==(g==="WEI"?"ETH":"STRK")),pe=W?D:k,ge=W?Y:F,le=W?i?.symbol??null:ee,be=w||j&&J,Z=W?se:C,ye=l.useCallback(async()=>{const p=await t();f(p?Array.isArray(p)?p:[p]:void 0)},[t]);return{loading:be,error:Z,feeWei:M,feeNative:k,feeUsd:F,feeUnit:g,usedCurrency:ee,paymaster:{enabled:j,loading:J,error:se,feeAtomic:U,feeNative:D,feeUsd:Y,token:i,decimals:A,raw:S},usingPaymaster:!!W,effectiveNative:pe,effectiveUsd:ge,effectiveCurrency:le,refresh:ye}}class ue{constructor(a,t,s=0){this.suppliedUsd=a,this.borrowedUsd=t,this.ltvBps=s}static fromPositions(a,t,s=0){const u=a.reduce((o,d)=>o+d.balance,0),r=t.reduce((o,d)=>o+(d.collateralValue||0),0),c=u+r,i=t.reduce((o,d)=>o+Math.abs(d.balance),0);return new ue(c,i,s)}clone(){return new ue(this.suppliedUsd,this.borrowedUsd,this.ltvBps)}utilization(a=this){return a.suppliedUsd>0?a.borrowedUsd/a.suppliedUsd*100:0}healthFactor(a=this){return a.borrowedUsd>0?a.suppliedUsd/a.borrowedUsd:10}loanToValue(a=this){return this.utilization(a)}maxBorrowUsd(a=this){const t=a.ltvBps>0?a.ltvBps:1e4;return a.suppliedUsd*t/1e4}freeBorrowUsd(a=this){return Math.max(0,this.maxBorrowUsd(a)-a.borrowedUsd)}apply(a,t){const s=this.clone();switch(a){case"Borrow":s.borrowedUsd+=t;break;case"Repay":s.borrowedUsd=Math.max(0,s.borrowedUsd-t);break;case"Deposit":s.suppliedUsd+=t;break;case"Withdraw":s.suppliedUsd=Math.max(0,s.suppliedUsd-t);break}return s}}function Ke({action:n,amount:a,price:t,position:s,hf:u=1.9,utilization:r=65,ltv:c=75}){const i=parseFloat(a||"0"),o=l.useMemo(()=>s??new ue(0,0),[s]),d=l.useMemo(()=>o.apply(n,i*t),[o,n,i,t]),x=s?o.healthFactor():u,f=s?o.utilization():r,m=s?o.loanToValue():c,y=s?d.healthFactor():u,N=s?d.loanToValue():c,v=n==="Deposit"&&!s;return{beforeHf:v?1/0:x,beforeUtil:f,beforeLtv:v?0:m,afterHf:v?1/0:y,afterLtv:v?0:N}}function $e(n,a,t){switch(n){case"Borrow":case"Deposit":return a+t;case"Withdraw":case"Repay":return Math.max(0,a-t);default:return a}}function Oe(n,a,t,s,u){if(n!=="Borrow"||!a||!t)return u;const r=a.freeBorrowUsd();if(r<=0||t===0)return 0n;const c=Math.floor(r/t*10**s);return BigInt(c)}function Ie({action:n,token:a,before:t,position:s,hf:u=1.9,utilization:r=65,ltv:c=75,max:i}){const[o,d]=l.useState(""),x=parseFloat(o||"0"),f=a.usdPrice||0,m=a.decimals||18,{beforeHf:y,beforeUtil:N,beforeLtv:v,afterHf:w,afterLtv:_}=Ke({action:n,amount:o,price:f,position:s,hf:u,utilization:r,ltv:c}),C=l.useMemo(()=>Oe(n,s,a.usdPrice,m,i),[n,s,a.usdPrice,m,i]),V=l.useMemo(()=>$e(n,t,x),[n,t,x]);return{amount:o,setAmount:d,parsed:x,price:f,decimals:m,effectiveMax:C,afterValue:V,beforeHfEffective:y,beforeUtil:N,beforeLtvEffective:v,afterHfEffective:w,afterLtvEffective:_}}const ce=({action:n,afterHf:a,afterLtv:t,afterValue:s,tokenIcon:u,tokenName:r})=>{const c=Number.isFinite(a)?a>=4?"text-success":a>2?"text-warning":"text-error":"text-success",i=n==="Borrow"||n==="Repay"?"Debt":"Balance";return e.jsxs("div",{className:"pt-2 text-xs",children:[e.jsxs("div",{className:"grid grid-cols-3",children:[e.jsx("div",{className:"text-center opacity-70",children:"Health Factor"}),e.jsx("div",{className:"border-base-300 border-l text-center opacity-70",children:"Loan To Value"}),e.jsx("div",{className:"border-base-300 border-l text-center opacity-70",children:i})]}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center",children:[e.jsx("div",{className:`text-center ${c}`,children:Number.isFinite(a)?a.toFixed(2):"∞"}),e.jsxs("div",{className:"border-base-300 border-l text-center",children:[fe(t),"%"]}),e.jsx("div",{className:"border-base-300 flex items-center justify-center gap-2 border-l",children:e.jsx(oe,{value:s,icon:u,name:r})})]})]})},Ae=n=>new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(n),Je=({value:n})=>{const a=Number.isFinite(n),t=a?Math.min(100,Math.max(0,(n-1)/3*100)):100,s=l.useMemo(()=>({width:`${t}%`}),[t]);return e.jsxs("div",{className:"flex flex-col text-xs",children:[e.jsx("span",{className:"text-base-content/50 mb-1",children:"Health Factor"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-base-300 h-1.5 w-20 overflow-hidden rounded-full",children:e.jsx("div",{className:"bg-base-content/60 h-full rounded-full",style:s})}),e.jsx("span",{className:"text-base-content font-medium",children:a?n.toFixed(2):"∞"})]})]})},Ye=({value:n})=>{const a=l.useMemo(()=>({width:`${n}%`}),[n]);return e.jsxs("div",{className:"flex flex-col text-xs",children:[e.jsx("span",{className:"text-base-content/50 mb-1",children:"Loan To Value"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-base-300 h-1.5 w-20 overflow-hidden rounded-full",children:e.jsx("div",{className:"bg-base-content/60 h-full rounded-full",style:a})}),e.jsxs("span",{className:"text-base-content font-medium",children:[fe(n),"%"]})]})]})},de=({balance:n,decimals:a,price:t=0,onChange:s,percentBase:u,max:r,resetTrigger:c,insufficientFunds:i})=>{const[o,d]=l.useState(""),[x,f]=l.useState(null);l.useEffect(()=>{d(""),f(null)},[c]);const m=l.useCallback(g=>{const M=(u??n)*BigInt(g)/100n,L=X(M,a);d(L),f(g),s(L,g===100)},[u,n,a,s]),y=l.useCallback(g=>{let M=Se(g||"0",a).value??0n;const k=r??(u??n),I=!1;k>0n&&M>=k&&(M=k,g=X(k,a)),d(g),f(null),s(g,I)},[a,u,n,r,s]),N=l.useCallback(g=>{y(g.target.value)},[y]),v=l.useCallback(()=>m(25),[m]),w=l.useCallback(()=>m(50),[m]),_=l.useCallback(()=>m(100),[m]),C=l.useMemo(()=>({25:v,50:w,100:_}),[v,w,_]),V=(parseFloat(o||"0")*t).toFixed(2);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:o,onChange:N,placeholder:"0.0",className:"bg-base-200/50 border-base-300/50 text-base-content placeholder:text-base-content/30 focus:border-base-content/30 w-full rounded-lg border px-4 py-3 pr-24 focus:outline-none"}),i&&e.jsx("div",{className:"absolute -top-4 right-1 z-10",children:e.jsx("span",{className:"badge badge-error badge-sm whitespace-nowrap",children:"Insufficient funds"})}),e.jsx("div",{className:"divide-base-300 absolute inset-y-0 right-3 flex items-center divide-x text-xs",children:[25,50,100].map(g=>e.jsxs("button",{type:"button",onClick:C[g],className:`px-1 ${x===g?"underline":""}`,children:[g,"%"]},g))})]}),e.jsxs("div",{className:"mt-1 text-center text-xs opacity-70",children:["≈ $",V]})]})},me=({hf:n,ltv:a,metricLabel:t,metricValue:s,token:u})=>e.jsxs("div",{className:"bg-base-200/50 border-base-300/50 w-full space-y-4 border-b p-5 text-sm md:w-52 md:border-b-0 md:border-r",children:[e.jsx("div",{className:"text-base-content/40 text-xs font-medium uppercase tracking-wider",children:"Before"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Je,{value:n}),e.jsx(Ye,{value:a}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-base-content/50",children:t}),e.jsx(oe,{value:s,icon:u.icon,name:u.name})]})]})]}),we=({isOpen:n,onClose:a,action:t,apyLabel:s,apy:u,token:r,protocolName:c,metricLabel:i,before:o,balance:d,percentBase:x,max:f,network:m,chainId:y,hf:N=1.9,utilization:v=65,ltv:w=75,position:_,buildCalls:C,onConfirm:V,renderExtraContent:g})=>{const{address:z,chain:M}=Ee(),{address:L}=Ce(),{amount:k,setAmount:I,decimals:F,effectiveMax:H,afterValue:ee,beforeHfEffective:G,beforeUtil:K,beforeLtvEffective:ae,afterHfEffective:ne,afterLtvEffective:te}=Ie({action:t,token:r,before:o,position:_,hf:N,utilization:v,ltv:w,max:f}),[A,$]=l.useState(!1),[j,S]=l.useState("idle"),O=l.useRef(!1),J=l.useMemo(()=>Se(k,F),[k,F]),U=J.value,D=J.isPositive,Y=l.useMemo(()=>ze(t,U,d),[t,U,d]),se=m!=="evm"||!y||M?.id===y,pe=De({isAmountPositive:D,hasSufficientFunds:!Y,isWalletConnected:m==="evm"?!!z:!!L,isCorrectChain:se}),le=j==="pending"||!(j==="success")&&!pe,be=l.useCallback(()=>C?C(k,A):null,[C,k,A]);Ge({enabled:!1,buildCalls:be,currency:"STRK"}),l.useEffect(()=>{n&&!O.current&&(S("idle"),re("token_action_modal_open",{action:t,tokenName:r.name,tokenAddress:r.address,network:m,protocol:c??"unknown"})),O.current=n},[t,n,m,c,r.address,r.name]);const Z=l.useCallback(()=>{I(""),$(!1),S("idle"),a()},[a,I]),ye=l.useCallback((b,h)=>{I(b),$(h)},[I]),p=l.useCallback(async()=>{if(j==="success"){Z();return}try{S("pending"),re("token_action_tx_begin",{action:t,tokenName:r.name,tokenAddress:r.address,network:m,protocol:c??"unknown",amount:k,isMax:A}),await V?.(k,A),S("success"),re("token_action_tx_complete",{action:t,tokenName:r.name,tokenAddress:r.address,network:m,protocol:c??"unknown",amount:k,isMax:A,status:"success"})}catch(b){console.error(b),S("error"),re("token_action_tx_complete",{action:t,tokenName:r.name,tokenAddress:r.address,network:m,protocol:c??"unknown",amount:k,isMax:A,status:"error",error:b instanceof Error?b.message:String(b)})}},[j,Z,t,r.name,r.address,m,c,k,A,V]),T=l.useMemo(()=>[{key:j==="success"?"close":"confirm",label:j==="pending"?"Submitting...":j==="success"?"Close":j==="error"?"Retry":t,icon:j==="pending"?e.jsx("span",{className:"loading loading-spinner loading-xs"}):m==="stark"?e.jsx(He,{className:"size-4 text-gray-400"}):void 0,onClick:p,disabled:le,variant:"ghost"}],[j,t,m,p,le]);return e.jsxs("dialog",{className:`modal ${n?"modal-open":""}`,children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm",onClick:Z}),e.jsx("div",{className:"modal-box bg-base-100 border-base-300/50 relative max-w-2xl overflow-hidden rounded-xl border p-0",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsx(me,{hf:G,utilization:K,ltv:ae,metricLabel:i,metricValue:o,token:r}),e.jsxs("div",{className:"flex-1 space-y-4 p-5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{src:r.icon,alt:r.name,width:28,height:28,className:"rounded-full"}),e.jsxs("h3",{className:"text-base-content text-lg font-semibold",children:[t," ",r.name]})]}),c&&e.jsx("div",{className:"text-base-content/40 text-xs uppercase tracking-wider",children:c})]}),e.jsxs("div",{className:"text-base-content/70 flex items-center justify-between text-xs",children:[e.jsxs("span",{children:[s," ",fe(u),"%"]}),e.jsxs("span",{children:["Balance: ",Ae(Number(X(d,F)))]})]}),e.jsx(de,{balance:d,decimals:F,price:r.usdPrice,onChange:ye,percentBase:x??(t==="Borrow"?H:void 0),max:H,resetTrigger:n,insufficientFunds:Y}),e.jsx(ce,{action:t,afterHf:ne,afterLtv:te,afterValue:ee,tokenIcon:r.icon,tokenName:r.name}),g&&g(),e.jsx("div",{className:"modal-action pt-2",children:e.jsx(je,{className:"w-full",autoCompact:!0,actions:T})})]})]})})]})},qe=({action:n,apyLabel:a,apy:t,token:s,protocolName:u,metricLabel:r,before:c,balance:i,percentBase:o,max:d,hf:x=1.9,utilization:f=65,ltv:m=75,position:y})=>{const{setAmount:N,decimals:v,effectiveMax:w,afterValue:_,beforeHfEffective:C,beforeUtil:V,beforeLtvEffective:g,afterHfEffective:z,afterLtvEffective:M}=Ie({action:n,token:s,before:c,position:y,hf:x,utilization:f,ltv:m,max:d}),L=l.useCallback(F=>{N(F)},[N]),k=l.useCallback(()=>{console.debug("Demo confirm disabled")},[]),I=l.useMemo(()=>[{key:"confirm",label:n,onClick:k,disabled:!0,variant:"ghost"}],[n,k]);return e.jsx("div",{className:"card bg-base-100 border-base-300 overflow-hidden rounded-none border",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsx(me,{hf:C,utilization:V,ltv:g,metricLabel:r,metricValue:c,token:s}),e.jsxs("div",{className:"flex-1 space-y-4 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h3",{className:"text-xl font-bold",children:[n," ",s.name]}),e.jsx(Q,{src:s.icon,alt:s.name,width:32,height:32})]}),u&&e.jsx("div",{className:"text-base-content/70 text-sm",children:u})]}),e.jsxs("div",{className:"text-base-content/70 flex items-center justify-between text-xs",children:[e.jsxs("span",{children:[a," ",fe(t),"%"]}),e.jsxs("span",{children:["Balance: ",Ae(Number(X(i,v)))]})]}),e.jsx(de,{balance:i,decimals:v,price:s.usdPrice,onChange:L,percentBase:o??(n==="Borrow"?w:void 0),max:w,resetTrigger:!0}),e.jsx(ce,{action:n,afterHf:z,afterLtv:M,afterValue:_,tokenIcon:s.icon,tokenName:s.name}),e.jsx("div",{className:"pt-2",children:e.jsx(je,{className:"w-full",autoCompact:!0,actions:I})})]})]})})};try{ce.displayName="AfterMetricsGrid",ce.__docgenInfo={description:`Renders the "After" metrics grid showing Health Factor, Loan To Value, and Debt/Balance.
Used by both TokenActionModal and TokenActionCard.`,displayName:"AfterMetricsGrid",props:{action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"enum",value:[{value:'"Borrow"'},{value:'"Deposit"'},{value:'"Withdraw"'},{value:'"Repay"'}]}},afterHf:{defaultValue:null,description:"",name:"afterHf",required:!0,type:{name:"number"}},afterLtv:{defaultValue:null,description:"",name:"afterLtv",required:!0,type:{name:"number"}},afterValue:{defaultValue:null,description:"",name:"afterValue",required:!0,type:{name:"number"}},tokenIcon:{defaultValue:null,description:"",name:"tokenIcon",required:!0,type:{name:"string"}},tokenName:{defaultValue:null,description:"",name:"tokenName",required:!0,type:{name:"string"}}}}}catch{}try{de.displayName="PercentInput",de.__docgenInfo={description:"",displayName:"PercentInput",props:{balance:{defaultValue:null,description:"",name:"balance",required:!0,type:{name:"bigint"}},decimals:{defaultValue:null,description:"",name:"decimals",required:!0,type:{name:"number"}},price:{defaultValue:{value:"0"},description:"",name:"price",required:!1,type:{name:"number"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"PercentOnChange"}},percentBase:{defaultValue:null,description:"",name:"percentBase",required:!1,type:{name:"bigint"}},max:{defaultValue:null,description:"",name:"max",required:!1,type:{name:"bigint"}},resetTrigger:{defaultValue:null,description:"",name:"resetTrigger",required:!1,type:{name:"boolean"}},insufficientFunds:{defaultValue:null,description:"",name:"insufficientFunds",required:!1,type:{name:"boolean"}}}}}catch{}try{me.displayName="LeftMetrics",me.__docgenInfo={description:"",displayName:"LeftMetrics",props:{hf:{defaultValue:{value:"1.9"},description:"",name:"hf",required:!1,type:{name:"number"}},utilization:{defaultValue:{value:"65"},description:"",name:"utilization",required:!1,type:{name:"number"}},ltv:{defaultValue:{value:"75"},description:"",name:"ltv",required:!1,type:{name:"number"}},metricLabel:{defaultValue:null,description:"",name:"metricLabel",required:!0,type:{name:"string"}},metricValue:{defaultValue:null,description:"",name:"metricValue",required:!0,type:{name:"number"}},token:{defaultValue:null,description:"",name:"token",required:!0,type:{name:"TokenInfo"}}}}}catch{}try{we.displayName="TokenActionModal",we.__docgenInfo={description:"",displayName:"TokenActionModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"enum",value:[{value:'"Borrow"'},{value:'"Deposit"'},{value:'"Withdraw"'},{value:'"Repay"'}]}},apyLabel:{defaultValue:null,description:"",name:"apyLabel",required:!0,type:{name:"string"}},apy:{defaultValue:null,description:"",name:"apy",required:!0,type:{name:"number"}},token:{defaultValue:null,description:"",name:"token",required:!0,type:{name:"TokenInfo"}},protocolName:{defaultValue:null,description:"",name:"protocolName",required:!1,type:{name:"string"}},metricLabel:{defaultValue:null,description:"",name:"metricLabel",required:!0,type:{name:"string"}},before:{defaultValue:null,description:"",name:"before",required:!0,type:{name:"number"}},balance:{defaultValue:null,description:"",name:"balance",required:!0,type:{name:"bigint"}},percentBase:{defaultValue:null,description:"",name:"percentBase",required:!1,type:{name:"bigint"}},max:{defaultValue:null,description:"",name:"max",required:!1,type:{name:"bigint"}},network:{defaultValue:null,description:"",name:"network",required:!0,type:{name:"enum",value:[{value:'"evm"'},{value:'"stark"'}]}},chainId:{defaultValue:null,description:"",name:"chainId",required:!1,type:{name:"number"}},buildTx:{defaultValue:null,description:"",name:"buildTx",required:!1,type:{name:"((amount: string, isMax: boolean) => any)"}},buildCalls:{defaultValue:null,description:"",name:"buildCalls",required:!1,type:{name:"((amount: string, isMax: boolean) => Call | Call[] | Promise<Call | Call[] | null> | null) | undefined"}},hf:{defaultValue:{value:"1.9"},description:"",name:"hf",required:!1,type:{name:"number"}},utilization:{defaultValue:{value:"65"},description:"",name:"utilization",required:!1,type:{name:"number"}},ltv:{defaultValue:{value:"75"},description:"",name:"ltv",required:!1,type:{name:"number"}},position:{defaultValue:null,description:"",name:"position",required:!1,type:{name:"PositionManager"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!1,type:{name:"((amount: string, isMax?: boolean) => void | Promise<unknown>)"}},renderExtraContent:{defaultValue:null,description:"",name:"renderExtraContent",required:!1,type:{name:"(() => ReactNode)"}}}}}catch{}try{qe.displayName="TokenActionCard",qe.__docgenInfo={description:"",displayName:"TokenActionCard",props:{balance:{defaultValue:null,description:"",name:"balance",required:!0,type:{name:"bigint"}},protocolName:{defaultValue:null,description:"",name:"protocolName",required:!1,type:{name:"string"}},chainId:{defaultValue:null,description:"",name:"chainId",required:!1,type:{name:"number"}},position:{defaultValue:null,description:"",name:"position",required:!1,type:{name:"PositionManager"}},apy:{defaultValue:null,description:"",name:"apy",required:!0,type:{name:"number"}},before:{defaultValue:null,description:"",name:"before",required:!0,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"enum",value:[{value:'"Borrow"'},{value:'"Deposit"'},{value:'"Withdraw"'},{value:'"Repay"'}]}},apyLabel:{defaultValue:null,description:"",name:"apyLabel",required:!0,type:{name:"string"}},token:{defaultValue:null,description:"",name:"token",required:!0,type:{name:"TokenInfo"}},metricLabel:{defaultValue:null,description:"",name:"metricLabel",required:!0,type:{name:"string"}},percentBase:{defaultValue:null,description:"",name:"percentBase",required:!1,type:{name:"bigint"}},max:{defaultValue:null,description:"",name:"max",required:!1,type:{name:"bigint"}},network:{defaultValue:null,description:"",name:"network",required:!0,type:{name:"enum",value:[{value:'"evm"'},{value:'"stark"'}]}},buildTx:{defaultValue:null,description:"",name:"buildTx",required:!1,type:{name:"((amount: string, isMax: boolean) => any)"}},buildCalls:{defaultValue:null,description:"",name:"buildCalls",required:!1,type:{name:"((amount: string, isMax: boolean) => Call | Call[] | Promise<Call | Call[] | null> | null) | undefined"}},hf:{defaultValue:{value:"1.9"},description:"",name:"hf",required:!1,type:{name:"number"}},utilization:{defaultValue:{value:"65"},description:"",name:"utilization",required:!1,type:{name:"number"}},ltv:{defaultValue:{value:"75"},description:"",name:"ltv",required:!1,type:{name:"number"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!1,type:{name:"((amount: string, isMax?: boolean) => void | Promise<unknown>)"}},renderExtraContent:{defaultValue:null,description:"",name:"renderExtraContent",required:!1,type:{name:"(() => ReactNode)"}},disabledConfirm:{defaultValue:null,description:"",name:"disabledConfirm",required:!1,type:{name:"boolean"}}}}}catch{}export{me as L,qe as T,we as a};
