import{j as v}from"./jsx-runtime-CcWEvojh.js";import{r as S}from"./index-Bk_d_yAU.js";import{I as Tn}from"./next-image-DV_ejeD4.js";import{t as Vn,E as fn}from"./externalContracts-_f_8pMJw.js";import{L as Cs}from"./Loading-Bz06Coe0.js";import{k as vs,N as Ns,u as vr,j as Re,O as Nr,P as Bs,f as xe,R as Br}from"./createSafeContext-Dp97sAkz.js";import"./networks-DgHYYcb8.js";import{I as ks,J as Ke,K as ke,L as Is,M as Os,c as Ss,N as kr,f as gn,d as yn,u as Ir,C as Rs,z as U,T as rt,n as Qe,O as _s,P as Ls}from"./en_US-YBXRRIY6-ByhZuFgc.js";import{b as Ts,d as Vs,M as Ps,B as Pn,e as Un,A as Us,f as Fs,h as Ds,w as $s,a as Ms,s as Fn,i as dn,j as Hs}from"./contract-CleVho0y.js";import{a as zs,l as Nt,h as Ks,d as qs,i as Ws}from"./protocols-CRHRSpKz.js";import{s as Js,w as Gs}from"./prepareAuthorization-7YKPcvtF.js";import{a as ct}from"./validation-DM-NIpAK.js";import{g as js}from"./_commonjsHelpers-CE1G-McA.js";import{v as Zs,w as Ys,C as Xs}from"./SelectedGasTokenContext-BLwdQCB-.js";const Qs=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],ti=vs("external-link",Qs);function ei(e){return{marketId:e.uniqueKey,loanToken:e.loanAsset.address,collateralToken:e.collateralAsset?.address||"",oracle:e.oracle?.address||"",irm:e.irmAddress,lltv:BigInt(e.lltv)}}function ni(e){const t=e.state.liquidityAssetsUsd;if(typeof t=="number"&&Number.isFinite(t))return t;const n=typeof e.state.liquidityAssets=="number"&&Number.isFinite(e.state.liquidityAssets)?e.state.liquidityAssets:Math.max(0,(e.state.supplyAssets||0)-(e.state.borrowAssets||0)),r=e.loanAsset.priceUsd??0;return n*r}function Ac(e){return e.map((t,n)=>({m:t,i:n,liqUsd:ni(t)})).sort((t,n)=>{if(n.liqUsd!==t.liqUsd)return n.liqUsd-t.liqUsd;const r=n.m.state.supplyAssetsUsd??0,s=t.m.state.supplyAssetsUsd??0;return r!==s?r-s:t.i-n.i}).map(t=>t.m)}const Or=Vs,ri=Ts,si=Ps;function ii(e){return e in Or}const Dn={aaveBorrower:Un.AAVE_BORROWER,erc3156Borrower:Un.ERC3156_BORROWER},mt={v2Vault:Pn.V2,v3Vault:Pn.V3},tn={...Fs},st={...Us},oi=["0x87870Bca3F3fD6335C3F4ce8392D69350B4fA4E2","0x794a61358D6845594F94dc1DB02A252b5b4814aD","0xA238Dd80C259a72e81d7e4664a9801593F98d1c5","0x3E5f750726cc1D0d4a9c62c507f890f984576507"],$n={8453:"0xdeCC46a4b09162F5369c5C80383AAa9159bCf192"},ai=ks;function wn(e,t){if(e)return ai[e]?.[t]}function Sr(e,t){return wn(e,t)?.address}function Ec(e){return Sr(e,"KapanOrderManager")}function ci(e){return Sr(e,"KapanCowAdapter")}function ui(e,t,n,r){const s=si[e];if(!s)return null;const i=`${n.toLowerCase()}-${r.toLowerCase()}`;return`https://app.morpho.org/${s}/market/${t}/${i}`}function Mn(e,t=2){return Number.isFinite(e)?new Intl.NumberFormat("en-US",{style:"percent",minimumFractionDigits:t,maximumFractionDigits:t}).format(e):"-.--"}function li(e){return!Number.isFinite(e)||e<=0?"$0":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",notation:"compact",maximumFractionDigits:1}).format(e)}function fi(e){try{const t=BigInt(e);return`${(Number(t)/1e16).toFixed(0)}%`}catch{return"--%"}}function di(e){return e>=.95?"text-error":e>=.85?"text-warning":"text-base-content/70"}const Hn=({markets:e,selectedMarket:t,onSelectMarket:n,chainId:r,isLoading:s=!1,disabled:i=!1,className:o=""})=>{const a=S.useMemo(()=>{if(e.length===0)return null;let h=e[0];for(const B of e)B.state.borrowApy<h.state.borrowApy&&(h=B);return h.uniqueKey},[e]),c=S.useCallback(h=>{if(i)return;const B=ei(h);n(h,B)},[i,n]),u=S.useCallback(h=>{h.stopPropagation()},[]),l=S.useCallback(h=>()=>c(h),[c]);return s?v.jsxs("div",{className:`space-y-2 ${o}`,children:[v.jsx("div",{className:"text-base-content/80 text-sm",children:"Select Morpho Market"}),v.jsx("div",{className:"border-base-300 flex items-center justify-center rounded-lg border py-6",children:v.jsx(Cs,{size:"md"})})]}):e.length===0?v.jsxs("div",{className:`space-y-2 ${o}`,children:[v.jsx("div",{className:"text-base-content/80 text-sm",children:"Select Morpho Market"}),v.jsx("div",{className:"border-base-300 bg-base-200/30 rounded-lg border p-4",children:v.jsx("div",{className:"text-base-content/60 text-center text-sm",children:"No compatible Morpho markets found for this collateral/debt pair."})})]}):v.jsxs("div",{className:`space-y-2 ${o}`,children:[v.jsx("div",{className:"text-base-content/80 text-sm",children:"Select Morpho Market"}),v.jsx("div",{className:"max-h-48 space-y-2 overflow-y-auto",children:e.map(h=>{const B=t?.uniqueKey===h.uniqueKey,C=h.uniqueKey===a,X=h.collateralAsset?.symbol||"???",L=h.loanAsset.symbol,G=ui(r,h.uniqueKey,X,L),Et=h.state.supplyAssetsUsd??0,ut=h.state.utilization??0;return v.jsx("div",{className:`
                cursor-pointer rounded-lg border p-3 transition-all
                ${B?"border-primary bg-primary/10":"border-base-300 hover:border-base-content/30"}
                ${i?"cursor-not-allowed opacity-50":""}
              `,onClick:l(h),children:v.jsxs("div",{className:"flex items-center justify-between gap-3",children:[v.jsxs("div",{className:"flex min-w-0 items-center gap-3",children:[v.jsx("div",{className:`
                      flex size-4 flex-shrink-0 items-center justify-center rounded-full border-2
                      ${B?"border-primary bg-primary":"border-base-content/30"}
                    `,children:B&&v.jsx("div",{className:"bg-primary-content size-1.5 rounded-full"})}),v.jsxs("div",{className:"flex flex-shrink-0 items-center -space-x-1.5",children:[v.jsx("div",{className:"ring-base-100 relative size-5 overflow-hidden rounded-full ring-2",children:v.jsx(Tn,{src:Vn(X.toLowerCase()),alt:X,fill:!0,className:"object-cover"})}),v.jsx("div",{className:"ring-base-100 relative size-5 overflow-hidden rounded-full ring-2",children:v.jsx(Tn,{src:Vn(L.toLowerCase()),alt:L,fill:!0,className:"object-cover"})})]}),v.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[v.jsxs("span",{className:"whitespace-nowrap text-sm font-medium",children:[X,"/",L]}),C&&e.length>1&&v.jsx("span",{className:"badge badge-success badge-xs whitespace-nowrap",children:"Best Rate"}),G&&v.jsx("a",{href:G,target:"_blank",rel:"noopener noreferrer",onClick:u,className:"text-base-content/40 hover:text-primary transition-colors",children:v.jsx(ti,{className:"size-3"})})]})]}),v.jsxs("div",{className:"flex flex-shrink-0 items-center gap-4 text-xs",children:[v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"text-base-content/50",children:"LTV"}),v.jsx("div",{className:"font-medium",children:fi(h.lltv)})]}),v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"text-base-content/50",children:"Borrow"}),v.jsx("div",{className:"font-medium",children:Mn(h.state.borrowApy)})]}),v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"text-base-content/50",children:"TVL"}),v.jsx("div",{className:"font-medium",children:li(Et)})]}),v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"text-base-content/50",children:"Util"}),v.jsx("div",{className:`font-medium ${di(ut)}`,children:Mn(ut)})]})]})]})},h.uniqueKey)})})]})};try{Hn.displayName="MorphoMarketSelector",Hn.__docgenInfo={description:"",displayName:"MorphoMarketSelector",props:{markets:{defaultValue:null,description:"",name:"markets",required:!0,type:{name:"MorphoMarket[]"}},selectedMarket:{defaultValue:null,description:"",name:"selectedMarket",required:!0,type:{name:"MorphoMarket | null"}},onSelectMarket:{defaultValue:null,description:"",name:"onSelectMarket",required:!0,type:{name:"(market: MorphoMarket, context: MorphoMarketContext) => void"}},chainId:{defaultValue:null,description:"",name:"chainId",required:!0,type:{name:"number"}},isLoading:{defaultValue:{value:"false"},description:"",name:"isLoading",required:!1,type:{name:"boolean"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}async function pi(e,t={}){const{account:n,chainId:r,connector:s}=t,i=await Ke(e,{account:n,connector:s});return Ds(i,{account:n,chainId:r})}async function hi(e,t){const{account:n,chainId:r,connector:s,calls:i,...o}=t,a=await Ke(e,{account:n,assertChainId:!1,chainId:r,connector:s});return ke(a,Js,"sendCalls")({...o,...typeof n<"u"?{account:n}:{},calls:i,chain:r?{id:r}:void 0})}async function mi(e,t){const{connector:n}=t,r=await Ke(e,{connector:n});return Gs(r,t)}async function gi(e,t){const{chainId:n,timeout:r=0,...s}=t,i=e.getClient({chainId:n}),a=await ke(i,Is,"waitForTransactionReceipt")({...s,timeout:r});if(a.status==="reverted"){const c=ke(i,Os,"getTransaction"),{from:u,...l}=await c({hash:a.transactionHash}),B=await ke(i,Ss,"call")({...l,account:u,data:l.input,gasPrice:l.type!=="eip1559"?l.gasPrice:void 0,maxFeePerGas:l.type==="eip1559"?l.maxFeePerGas:void 0,maxPriorityFeePerGas:l.type==="eip1559"?l.maxPriorityFeePerGas:void 0}),C=B?.data?Ns(`0x${B.data.substring(138)}`):"unknown reason";throw new Error(C)}return{...a,chainId:i.chain.id}}async function yi(e,t){const{account:n,chainId:r,connector:s,...i}=t;let o;return typeof n=="object"&&n?.type==="local"?o=e.getClient({chainId:r}):o=await Ke(e,{account:n??void 0,assertChainId:!1,chainId:r,connector:s}),await ke(o,$s,"writeContract")({...i,...n?{account:n}:{},chain:r?{id:r}:null})}function wi(e,t={}){return{async queryFn({queryKey:n}){const{scopeKey:r,...s}=n[1];return await pi(e,s)},queryKey:bi(t),retry(n,r){return r instanceof kr?!1:n<3}}}function bi(e={}){return["capabilities",gn(e)]}function xi(e){return{mutationFn(t){return hi(e,t)},mutationKey:["sendCalls"]}}function Ai(e,t){return{async queryFn({queryKey:n}){const{scopeKey:r,id:s,...i}=n[1];if(!s)throw new Error("id is required");return await mi(e,{...i,id:s})},queryKey:Ei(t),retry(n,r){return r instanceof kr?!1:n<3}}}function Ei(e){return["callsStatus",gn(e)]}function Ci(e,t={}){return{async queryFn({queryKey:n}){const{hash:r,...s}=n[1];if(!r)throw new Error("hash is required");return gi(e,{...s,onReplaced:t.onReplaced,hash:r})},queryKey:vi(t)}}function vi(e={}){const{onReplaced:t,...n}=e;return["waitForTransactionReceipt",gn(n)]}function Ni(e){return{mutationFn(t){return yi(e,t)},mutationKey:["writeContract"]}}function Bi(e={}){const{account:t,query:n={}}=e,{address:r}=vr(),s=Re(e),i=wi(s,{...e,account:t??r});return yn({...n,...i})}function ki(e={}){const{mutation:t}=e,n=Re(e),r=xi(n),{mutate:s,mutateAsync:i,...o}=Nr({...t,...r});return{...o,sendCalls:s,sendCallsAsync:i}}function Ii(e){const{id:t,query:n={}}=e,r=Re(e),s=Ai(r,e),i=!!(t&&(n.enabled??!0));return yn({...n,...s,enabled:i})}function Oi(e={}){const{hash:t,query:n={}}=e,r=Re(e),s=Ir({config:r}),i=Ci(r,{...e,chainId:e.chainId??s}),o=!!(t&&(n.enabled??!0));return yn({...n,...i,enabled:o})}function Si(e={}){const{mutation:t}=e,n=Re(e),r=Ni(n),{mutate:s,mutateAsync:i,...o}=Nr({...t,...r});return{...o,writeContract:s,writeContractAsync:i}}const Ri="6.16.0";function _i(e,t,n){const r=t.split("|").map(i=>i.trim());for(let i=0;i<r.length;i++)switch(t){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof e===t)return}const s=new Error(`invalid value for type ${t}`);throw s.code="INVALID_ARGUMENT",s.argument=`value.${n}`,s.value=e,s}function D(e,t,n){for(let r in t){let s=t[r];const i=n?n[r]:null;i&&_i(s,i,r),Object.defineProperty(e,r,{enumerable:!0,value:s,writable:!1})}}function pe(e,t){if(e==null)return"null";if(t==null&&(t=new Set),typeof e=="object"){if(t.has(e))return"[Circular]";t.add(e)}if(Array.isArray(e))return"[ "+e.map(n=>pe(n,t)).join(", ")+" ]";if(e instanceof Uint8Array){const n="0123456789abcdef";let r="0x";for(let s=0;s<e.length;s++)r+=n[e[s]>>4],r+=n[e[s]&15];return r}if(typeof e=="object"&&typeof e.toJSON=="function")return pe(e.toJSON(),t);switch(typeof e){case"boolean":case"number":case"symbol":return e.toString();case"bigint":return BigInt(e).toString();case"string":return JSON.stringify(e);case"object":{const n=Object.keys(e);return n.sort(),"{ "+n.map(r=>`${pe(r,t)}: ${pe(e[r],t)}`).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function zn(e,t){return e&&e.code===t}function Rr(e,t,n){let r=e;{const i=[];if(n){if("message"in n||"code"in n||"name"in n)throw new Error(`value will overwrite populated values: ${pe(n)}`);for(const o in n){if(o==="shortMessage")continue;const a=n[o];i.push(o+"="+pe(a))}}i.push(`code=${t}`),i.push(`version=${Ri}`),i.length&&(e+=" ("+i.join(", ")+")")}let s;switch(t){case"INVALID_ARGUMENT":s=new TypeError(e);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":s=new RangeError(e);break;default:s=new Error(e)}return D(s,{code:t}),n&&Object.assign(s,n),s.shortMessage==null&&D(s,{shortMessage:r}),s}function P(e,t,n,r){if(!e)throw Rr(t,n,r)}function m(e,t,n,r){P(e,t,"INVALID_ARGUMENT",{argument:n,value:r})}function _r(e,t,n){n==null&&(n=""),n&&(n=": "+n),P(e>=t,"missing argument"+n,"MISSING_ARGUMENT",{count:e,expectedCount:t}),P(e<=t,"too many arguments"+n,"UNEXPECTED_ARGUMENT",{count:e,expectedCount:t})}["NFD","NFC","NFKD","NFKC"].reduce((e,t)=>{try{if("test".normalize(t)!=="test")throw new Error("bad");if(t==="NFD"&&"é".normalize("NFD")!=="é")throw new Error("broken");e.push(t)}catch{}return e},[]);function qe(e,t,n){if(n==null&&(n=""),e!==t){let r=n,s="new";n&&(r+=".",s+=" "+n),P(!1,`private constructor; use ${r}from* methods`,"UNSUPPORTED_OPERATION",{operation:s})}}function Lr(e,t,n){if(e instanceof Uint8Array)return n?new Uint8Array(e):e;if(typeof e=="string"&&e.length%2===0&&e.match(/^0x[0-9a-f]*$/i)){const r=new Uint8Array((e.length-2)/2);let s=2;for(let i=0;i<r.length;i++)r[i]=parseInt(e.substring(s,s+2),16),s+=2;return r}m(!1,"invalid BytesLike value",t||"value",e)}function Ot(e,t){return Lr(e,t,!1)}function It(e,t){return Lr(e,t,!0)}function Ue(e,t){return!(typeof e!="string"||!e.match(/^0x[0-9A-Fa-f]*$/)||typeof t=="number"&&e.length!==2+2*t||t===!0&&e.length%2!==0)}const Kn="0123456789abcdef";function Y(e){const t=Ot(e);let n="0x";for(let r=0;r<t.length;r++){const s=t[r];n+=Kn[(s&240)>>4]+Kn[s&15]}return n}function ye(e){return"0x"+e.map(t=>Y(t).substring(2)).join("")}function ue(e,t,n){const r=Ot(e);return n!=null&&n>r.length&&P(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:r,length:r.length,offset:n}),Y(r.slice(t??0,n??r.length))}function Tr(e,t,n){const r=Ot(e);P(t>=r.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(r),length:t,offset:t+1});const s=new Uint8Array(t);return s.fill(0),n?s.set(r,t-r.length):s.set(r,0),Y(s)}function Li(e,t){return Tr(e,t,!0)}function Ti(e,t){return Tr(e,t,!1)}const _e=BigInt(0),yt=BigInt(1),he=9007199254740991;function He(e,t){const n=We(e,"value"),r=BigInt(xt(t,"width"));if(P(n>>r===_e,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:e}),n>>r-yt){const s=(yt<<r)-yt;return-((~n&s)+yt)}return n}function Vi(e,t){let n=oe(e,"value");const r=BigInt(xt(t,"width")),s=yt<<r-yt;if(n<_e){n=-n,P(n<=s,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:e});const i=(yt<<r)-yt;return(~n&i)+yt}else P(n<s,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:e});return n}function me(e,t){const n=We(e,"value"),r=BigInt(xt(t,"bits"));return n&(yt<<r)-yt}function oe(e,t){switch(typeof e){case"bigint":return e;case"number":return m(Number.isInteger(e),"underflow",t||"value",e),m(e>=-he&&e<=he,"overflow",t||"value",e),BigInt(e);case"string":try{if(e==="")throw new Error("empty string");return e[0]==="-"&&e[1]!=="-"?-BigInt(e.substring(1)):BigInt(e)}catch(n){m(!1,`invalid BigNumberish string: ${n.message}`,t||"value",e)}}m(!1,"invalid BigNumberish value",t||"value",e)}function We(e,t){const n=oe(e,t);return P(n>=_e,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:e}),n}const qn="0123456789abcdef";function bn(e){if(e instanceof Uint8Array){let t="0x0";for(const n of e)t+=qn[n>>4],t+=qn[n&15];return BigInt(t)}return oe(e)}function xt(e,t){switch(typeof e){case"bigint":return m(e>=-he&&e<=he,"overflow",t||"value",e),Number(e);case"number":return m(Number.isInteger(e),"underflow",t||"value",e),m(e>=-he&&e<=he,"overflow",t||"value",e),e;case"string":try{if(e==="")throw new Error("empty string");return xt(BigInt(e),t)}catch(n){m(!1,`invalid numeric string: ${n.message}`,t||"value",e)}}m(!1,"invalid numeric value",t||"value",e)}function Pi(e){return xt(bn(e))}function Vr(e,t){const n=We(e,"value");let r=n.toString(16);if(t==null)r.length%2&&(r="0"+r);else{const s=xt(t,"width");if(s===0&&n===_e)return"0x";for(P(s*2>=r.length,`value exceeds width (${s} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:e});r.length<s*2;)r="0"+r}return"0x"+r}function Ui(e,t){const n=We(e,"value");if(n===_e)return new Uint8Array(0);let r=n.toString(16);r.length%2&&(r="0"+r);const s=new Uint8Array(r.length/2);for(let i=0;i<s.length;i++){const o=i*2;s[i]=parseInt(r.substring(o,o+2),16)}return s}function Fi(e,t,n,r,s){m(!1,`invalid codepoint at offset ${t}; ${e}`,"bytes",n)}function Pr(e,t,n,r,s){if(e==="BAD_PREFIX"||e==="UNEXPECTED_CONTINUE"){let i=0;for(let o=t+1;o<n.length&&n[o]>>6===2;o++)i++;return i}return e==="OVERRUN"?n.length-t-1:0}function Di(e,t,n,r,s){return e==="OVERLONG"?(m(typeof s=="number","invalid bad code point for replacement","badCodepoint",s),r.push(s),0):(r.push(65533),Pr(e,t,n))}const $i=Object.freeze({error:Fi,ignore:Pr,replace:Di});function Mi(e,t){t==null&&(t=$i.error);const n=Ot(e,"bytes"),r=[];let s=0;for(;s<n.length;){const i=n[s++];if(i>>7===0){r.push(i);continue}let o=null,a=null;if((i&224)===192)o=1,a=127;else if((i&240)===224)o=2,a=2047;else if((i&248)===240)o=3,a=65535;else{(i&192)===128?s+=t("UNEXPECTED_CONTINUE",s-1,n,r):s+=t("BAD_PREFIX",s-1,n,r);continue}if(s-1+o>=n.length){s+=t("OVERRUN",s-1,n,r);continue}let c=i&(1<<8-o-1)-1;for(let u=0;u<o;u++){let l=n[s];if((l&192)!=128){s+=t("MISSING_CONTINUE",s,n,r),c=null;break}c=c<<6|l&63,s++}if(c!==null){if(c>1114111){s+=t("OUT_OF_RANGE",s-1-o,n,r,c);continue}if(c>=55296&&c<=57343){s+=t("UTF16_SURROGATE",s-1-o,n,r,c);continue}if(c<=a){s+=t("OVERLONG",s-1-o,n,r,c);continue}r.push(c)}}return r}function Je(e,t){m(typeof e=="string","invalid string value","str",e);let n=[];for(let r=0;r<e.length;r++){const s=e.charCodeAt(r);if(s<128)n.push(s);else if(s<2048)n.push(s>>6|192),n.push(s&63|128);else if((s&64512)==55296){r++;const i=e.charCodeAt(r);m(r<e.length&&(i&64512)===56320,"invalid surrogate pair","str",e);const o=65536+((s&1023)<<10)+(i&1023);n.push(o>>18|240),n.push(o>>12&63|128),n.push(o>>6&63|128),n.push(o&63|128)}else n.push(s>>12|224),n.push(s>>6&63|128),n.push(s&63|128)}return new Uint8Array(n)}function Hi(e){return e.map(t=>t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10&1023)+55296,(t&1023)+56320))).join("")}function zi(e,t){return Hi(Mi(e,t))}const Ki=BigInt(-1),gt=BigInt(0),ge=BigInt(1),qi=BigInt(5),le={};let we="0000";for(;we.length<80;)we+=we;function Qt(e){let t=we;for(;t.length<e;)t+=t;return BigInt("1"+t.substring(0,e))}function Ae(e,t,n){const r=BigInt(t.width);if(t.signed){const s=ge<<r-ge;P(n==null||e>=-s&&e<s,"overflow","NUMERIC_FAULT",{operation:n,fault:"overflow",value:e}),e>gt?e=He(me(e,r),r):e=-He(me(-e,r),r)}else{const s=ge<<r;P(n==null||e>=0&&e<s,"overflow","NUMERIC_FAULT",{operation:n,fault:"overflow",value:e}),e=(e%s+s)%s&s-ge}return e}function en(e){typeof e=="number"&&(e=`fixed128x${e}`);let t=!0,n=128,r=18;if(typeof e=="string"){if(e!=="fixed")if(e==="ufixed")t=!1;else{const i=e.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);m(i,"invalid fixed format","format",e),t=i[1]!=="u",n=parseInt(i[2]),r=parseInt(i[3])}}else if(e){const i=e,o=(a,c,u)=>i[a]==null?u:(m(typeof i[a]===c,"invalid fixed format ("+a+" not "+c+")","format."+a,i[a]),i[a]);t=o("signed","boolean",t),n=o("width","number",n),r=o("decimals","number",r)}m(n%8===0,"invalid FixedNumber width (not byte aligned)","format.width",n),m(r<=80,"invalid FixedNumber decimals (too large)","format.decimals",r);const s=(t?"":"u")+"fixed"+String(n)+"x"+String(r);return{signed:t,width:n,decimals:r,name:s}}function Wi(e,t){let n="";e<gt&&(n="-",e*=Ki);let r=e.toString();if(t===0)return n+r;for(;r.length<=t;)r=we+r;const s=r.length-t;for(r=r.substring(0,s)+"."+r.substring(s);r[0]==="0"&&r[1]!==".";)r=r.substring(1);for(;r[r.length-1]==="0"&&r[r.length-2]!==".";)r=r.substring(0,r.length-1);return n+r}class Vt{format;#t;#e;#n;_value;constructor(t,n,r){qe(t,le,"FixedNumber"),this.#e=n,this.#t=r;const s=Wi(n,r.decimals);D(this,{format:r.name,_value:s}),this.#n=Qt(r.decimals)}get signed(){return this.#t.signed}get width(){return this.#t.width}get decimals(){return this.#t.decimals}get value(){return this.#e}#r(t){m(this.format===t.format,"incompatible format; use fixedNumber.toFormat","other",t)}#s(t,n){return t=Ae(t,this.#t,n),new Vt(le,t,this.#t)}#i(t,n){return this.#r(t),this.#s(this.#e+t.#e,n)}addUnsafe(t){return this.#i(t)}add(t){return this.#i(t,"add")}#o(t,n){return this.#r(t),this.#s(this.#e-t.#e,n)}subUnsafe(t){return this.#o(t)}sub(t){return this.#o(t,"sub")}#a(t,n){return this.#r(t),this.#s(this.#e*t.#e/this.#n,n)}mulUnsafe(t){return this.#a(t)}mul(t){return this.#a(t,"mul")}mulSignal(t){this.#r(t);const n=this.#e*t.#e;return P(n%this.#n===gt,"precision lost during signalling mul","NUMERIC_FAULT",{operation:"mulSignal",fault:"underflow",value:this}),this.#s(n/this.#n,"mulSignal")}#c(t,n){return P(t.#e!==gt,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),this.#r(t),this.#s(this.#e*this.#n/t.#e,n)}divUnsafe(t){return this.#c(t)}div(t){return this.#c(t,"div")}divSignal(t){P(t.#e!==gt,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),this.#r(t);const n=this.#e*this.#n;return P(n%t.#e===gt,"precision lost during signalling div","NUMERIC_FAULT",{operation:"divSignal",fault:"underflow",value:this}),this.#s(n/t.#e,"divSignal")}cmp(t){let n=this.value,r=t.value;const s=this.decimals-t.decimals;return s>0?r*=Qt(s):s<0&&(n*=Qt(-s)),n<r?-1:n>r?1:0}eq(t){return this.cmp(t)===0}lt(t){return this.cmp(t)<0}lte(t){return this.cmp(t)<=0}gt(t){return this.cmp(t)>0}gte(t){return this.cmp(t)>=0}floor(){let t=this.#e;return this.#e<gt&&(t-=this.#n-ge),t=this.#e/this.#n*this.#n,this.#s(t,"floor")}ceiling(){let t=this.#e;return this.#e>gt&&(t+=this.#n-ge),t=this.#e/this.#n*this.#n,this.#s(t,"ceiling")}round(t){if(t==null&&(t=0),t>=this.decimals)return this;const n=this.decimals-t,r=qi*Qt(n-1);let s=this.value+r;const i=Qt(n);return s=s/i*i,Ae(s,this.#t,"round"),new Vt(le,s,this.#t)}isZero(){return this.#e===gt}isNegative(){return this.#e<gt}toString(){return this._value}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(t){return Vt.fromString(this.toString(),t)}static fromValue(t,n,r){const s=n==null?0:xt(n),i=en(r);let o=oe(t,"value");const a=s-i.decimals;if(a>0){const c=Qt(a);P(o%c===gt,"value loses precision for format","NUMERIC_FAULT",{operation:"fromValue",fault:"underflow",value:t}),o/=c}else a<0&&(o*=Qt(-a));return Ae(o,i,"fromValue"),new Vt(le,o,i)}static fromString(t,n){const r=t.match(/^(-?)([0-9]*)\.?([0-9]*)$/);m(r&&r[2].length+r[3].length>0,"invalid FixedNumber string value","value",t);const s=en(n);let i=r[2]||"0",o=r[3]||"";for(;o.length<s.decimals;)o+=we;P(o.substring(s.decimals).match(/^0*$/),"too many decimals for format","NUMERIC_FAULT",{operation:"fromString",fault:"underflow",value:t}),o=o.substring(0,s.decimals);const a=BigInt(r[1]+i+o);return Ae(a,s,"fromString"),new Vt(le,a,s)}static fromBytes(t,n){let r=bn(Ot(t,"value"));const s=en(n);return s.signed&&(r=He(r,s.width)),Ae(r,s,"fromBytes"),new Vt(le,r,s)}}const Ur=["wei","kwei","mwei","gwei","szabo","finney","ether"];function Cc(e,t){let n=18;if(typeof t=="string"){const r=Ur.indexOf(t);m(r>=0,"invalid unit","unit",t),n=3*r}else t!=null&&(n=xt(t,"unit"));return Vt.fromValue(e,n,{decimals:n,width:512}).toString()}function xn(e,t){m(typeof e=="string","value must be a string","value",e);let n=18;if(typeof t=="string"){const r=Ur.indexOf(t);m(r>=0,"invalid unit","unit",t),n=3*r}else t!=null&&(n=xt(t,"unit"));return Vt.fromString(e,{decimals:n,width:512}).value}function vc(e){return xn(e,18)}const tt=32,pn=new Uint8Array(tt),Ji=["then"],Fe={},Fr=new WeakMap;function ne(e){return Fr.get(e)}function Wn(e,t){Fr.set(e,t)}function Ee(e,t){const n=new Error(`deferred error during ABI decoding triggered accessing ${e}`);throw n.error=t,n}function hn(e,t,n){return e.indexOf(null)>=0?t.map((r,s)=>r instanceof Ut?hn(ne(r),r,n):r):e.reduce((r,s,i)=>{let o=t.getValue(s);return s in r||(n&&o instanceof Ut&&(o=hn(ne(o),o,n)),r[s]=o),r},{})}class Ut extends Array{#t;constructor(...t){const n=t[0];let r=t[1],s=(t[2]||[]).slice(),i=!0;n!==Fe&&(r=t,s=[],i=!1),super(r.length),r.forEach((c,u)=>{this[u]=c});const o=s.reduce((c,u)=>(typeof u=="string"&&c.set(u,(c.get(u)||0)+1),c),new Map);if(Wn(this,Object.freeze(r.map((c,u)=>{const l=s[u];return l!=null&&o.get(l)===1?l:null}))),this.#t=[],this.#t==null&&this.#t,!i)return;Object.freeze(this);const a=new Proxy(this,{get:(c,u,l)=>{if(typeof u=="string"){if(u.match(/^[0-9]+$/)){const B=xt(u,"%index");if(B<0||B>=this.length)throw new RangeError("out of result range");const C=c[B];return C instanceof Error&&Ee(`index ${B}`,C),C}if(Ji.indexOf(u)>=0)return Reflect.get(c,u,l);const h=c[u];if(h instanceof Function)return function(...B){return h.apply(this===l?c:this,B)};if(!(u in c))return c.getValue.apply(this===l?c:this,[u])}return Reflect.get(c,u,l)}});return Wn(a,ne(this)),a}toArray(t){const n=[];return this.forEach((r,s)=>{r instanceof Error&&Ee(`index ${s}`,r),t&&r instanceof Ut&&(r=r.toArray(t)),n.push(r)}),n}toObject(t){const n=ne(this);return n.reduce((r,s,i)=>(P(s!=null,`value at index ${i} unnamed`,"UNSUPPORTED_OPERATION",{operation:"toObject()"}),hn(n,this,t)),{})}slice(t,n){t==null&&(t=0),t<0&&(t+=this.length,t<0&&(t=0)),n==null&&(n=this.length),n<0&&(n+=this.length,n<0&&(n=0)),n>this.length&&(n=this.length);const r=ne(this),s=[],i=[];for(let o=t;o<n;o++)s.push(this[o]),i.push(r[o]);return new Ut(Fe,s,i)}filter(t,n){const r=ne(this),s=[],i=[];for(let o=0;o<this.length;o++){const a=this[o];a instanceof Error&&Ee(`index ${o}`,a),t.call(n,a,o,this)&&(s.push(a),i.push(r[o]))}return new Ut(Fe,s,i)}map(t,n){const r=[];for(let s=0;s<this.length;s++){const i=this[s];i instanceof Error&&Ee(`index ${s}`,i),r.push(t.call(n,i,s,this))}return r}getValue(t){const n=ne(this).indexOf(t);if(n===-1)return;const r=this[n];return r instanceof Error&&Ee(`property ${JSON.stringify(t)}`,r.error),r}static fromItems(t,n){return new Ut(Fe,t,n)}}function Jn(e){let t=Ui(e);return P(t.length<=tt,"value out-of-bounds","BUFFER_OVERRUN",{buffer:t,length:tt,offset:t.length}),t.length!==tt&&(t=It(ye([pn.slice(t.length%tt),t]))),t}class Ht{name;type;localName;dynamic;constructor(t,n,r,s){D(this,{name:t,type:n,localName:r,dynamic:s},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(t,n){m(!1,t,this.localName,n)}}class mn{#t;#e;constructor(){this.#t=[],this.#e=0}get data(){return ye(this.#t)}get length(){return this.#e}#n(t){return this.#t.push(t),this.#e+=t.length,t.length}appendWriter(t){return this.#n(It(t.data))}writeBytes(t){let n=It(t);const r=n.length%tt;return r&&(n=It(ye([n,pn.slice(r)]))),this.#n(n)}writeValue(t){return this.#n(Jn(t))}writeUpdatableValue(){const t=this.#t.length;return this.#t.push(pn),this.#e+=tt,n=>{this.#t[t]=Jn(n)}}}class An{allowLoose;#t;#e;#n;#r;#s;constructor(t,n,r){D(this,{allowLoose:!!n}),this.#t=It(t),this.#n=0,this.#r=null,this.#s=r??1024,this.#e=0}get data(){return Y(this.#t)}get dataLength(){return this.#t.length}get consumed(){return this.#e}get bytes(){return new Uint8Array(this.#t)}#i(t){if(this.#r)return this.#r.#i(t);this.#n+=t,P(this.#s<1||this.#n<=this.#s*this.dataLength,`compressed ABI data exceeds inflation ratio of ${this.#s} ( see: https://github.com/ethers-io/ethers.js/issues/4537 )`,"BUFFER_OVERRUN",{buffer:It(this.#t),offset:this.#e,length:t,info:{bytesRead:this.#n,dataLength:this.dataLength}})}#o(t,n,r){let s=Math.ceil(n/tt)*tt;return this.#e+s>this.#t.length&&(this.allowLoose&&r&&this.#e+n<=this.#t.length?s=n:P(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:It(this.#t),length:this.#t.length,offset:this.#e+s})),this.#t.slice(this.#e,this.#e+s)}subReader(t){const n=new An(this.#t.slice(this.#e+t),this.allowLoose,this.#s);return n.#r=this,n}readBytes(t,n){let r=this.#o(0,t,!!n);return this.#i(t),this.#e+=r.length,r.slice(0,t)}readValue(){return bn(this.readBytes(tt))}readIndex(){return Pi(this.readBytes(tt))}}function Gn(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Dr(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function jn(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Gi(e,t){Dr(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const ji=e=>e instanceof Uint8Array,Zi=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Yi=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Yi)throw new Error("Non little-endian hardware is not supported");function Xi(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function $r(e){if(typeof e=="string"&&(e=Xi(e)),!ji(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}class Qi{clone(){return this._cloneInto()}}function to(e){const t=r=>e().update($r(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}const De=BigInt(2**32-1),Zn=BigInt(32);function eo(e,t=!1){return t?{h:Number(e&De),l:Number(e>>Zn&De)}:{h:Number(e>>Zn&De)|0,l:Number(e&De)|0}}function no(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let s=0;s<e.length;s++){const{h:i,l:o}=eo(e[s],t);[n[s],r[s]]=[i,o]}return[n,r]}const ro=(e,t,n)=>e<<n|t>>>32-n,so=(e,t,n)=>t<<n|e>>>32-n,io=(e,t,n)=>t<<n-32|e>>>64-n,oo=(e,t,n)=>e<<n-32|t>>>64-n,[Mr,Hr,zr]=[[],[],[]],ao=BigInt(0),Ce=BigInt(1),co=BigInt(2),uo=BigInt(7),lo=BigInt(256),fo=BigInt(113);for(let e=0,t=Ce,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],Mr.push(2*(5*r+n)),Hr.push((e+1)*(e+2)/2%64);let s=ao;for(let i=0;i<7;i++)t=(t<<Ce^(t>>uo)*fo)%lo,t&co&&(s^=Ce<<(Ce<<BigInt(i))-Ce);zr.push(s)}const[po,ho]=no(zr,!0),Yn=(e,t,n)=>n>32?io(e,t,n):ro(e,t,n),Xn=(e,t,n)=>n>32?oo(e,t,n):so(e,t,n);function mo(e,t=24){const n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let o=0;o<10;o++)n[o]=e[o]^e[o+10]^e[o+20]^e[o+30]^e[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=n[c],l=n[c+1],h=Yn(u,l,1)^n[a],B=Xn(u,l,1)^n[a+1];for(let C=0;C<50;C+=10)e[o+C]^=h,e[o+C+1]^=B}let s=e[2],i=e[3];for(let o=0;o<24;o++){const a=Hr[o],c=Yn(s,i,a),u=Xn(s,i,a),l=Mr[o];s=e[l],i=e[l+1],e[l]=c,e[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=e[o+a];for(let a=0;a<10;a++)e[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}e[0]^=po[r],e[1]^=ho[r]}n.fill(0)}class En extends Qi{constructor(t,n,r,s=!1,i=24){if(super(),this.blockLen=t,this.suffix=n,this.outputLen=r,this.enableXOF=s,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Gn(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Zi(this.state)}keccak(){mo(this.state32,this.rounds),this.posOut=0,this.pos=0}update(t){jn(this);const{blockLen:n,state:r}=this;t=$r(t);const s=t.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);for(let a=0;a<o;a++)r[this.pos++]^=t[i++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:r,blockLen:s}=this;t[r]^=n,(n&128)!==0&&r===s-1&&this.keccak(),t[s-1]^=128,this.keccak()}writeInto(t){jn(this,!1),Dr(t),this.finish();const n=this.state,{blockLen:r}=this;for(let s=0,i=t.length;s<i;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,i-s);t.set(n.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Gn(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(Gi(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){const{blockLen:n,suffix:r,outputLen:s,rounds:i,enableXOF:o}=this;return t||(t=new En(n,r,s,o,i)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=i,t.suffix=r,t.outputLen=s,t.enableXOF=o,t.destroyed=this.destroyed,t}}const go=(e,t,n)=>to(()=>new En(t,e,n)),yo=go(1,136,256/8);let Kr=!1;const qr=function(e){return yo(e)};let Wr=qr;function St(e){const t=Ot(e,"data");return Y(Wr(t))}St._=qr;St.lock=function(){Kr=!0};St.register=function(e){if(Kr)throw new TypeError("keccak256 is locked");Wr=e};Object.freeze(St);const wo=BigInt(0),bo=BigInt(36);function Qn(e){e=e.toLowerCase();const t=e.substring(2).split(""),n=new Uint8Array(40);for(let s=0;s<40;s++)n[s]=t[s].charCodeAt(0);const r=Ot(St(n));for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&(t[s]=t[s].toUpperCase()),(r[s>>1]&15)>=8&&(t[s+1]=t[s+1].toUpperCase());return"0x"+t.join("")}const Cn={};for(let e=0;e<10;e++)Cn[String(e)]=String(e);for(let e=0;e<26;e++)Cn[String.fromCharCode(65+e)]=String(10+e);const tr=15;function xo(e){e=e.toUpperCase(),e=e.substring(4)+e.substring(0,2)+"00";let t=e.split("").map(r=>Cn[r]).join("");for(;t.length>=tr;){let r=t.substring(0,tr);t=parseInt(r,10)%97+t.substring(r.length)}let n=String(98-parseInt(t,10)%97);for(;n.length<2;)n="0"+n;return n}const Ao=(function(){const e={};for(let t=0;t<36;t++){const n="0123456789abcdefghijklmnopqrstuvwxyz"[t];e[n]=BigInt(t)}return e})();function Eo(e){e=e.toLowerCase();let t=wo;for(let n=0;n<e.length;n++)t=t*bo+Ao[e[n]];return t}function ze(e){if(m(typeof e=="string","invalid address","address",e),e.match(/^(0x)?[0-9a-fA-F]{40}$/)){e.startsWith("0x")||(e="0x"+e);const t=Qn(e);return m(!e.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||t===e,"bad address checksum","address",e),t}if(e.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){m(e.substring(2,4)===xo(e),"bad icap checksum","address",e);let t=Eo(e.substring(4)).toString(16);for(;t.length<40;)t="0"+t;return Qn("0x"+t)}m(!1,"invalid address","address",e)}const Tt={};function w(e,t){let n=!1;return t<0&&(n=!0,t*=-1),new q(Tt,`${n?"":"u"}int${t}`,e,{signed:n,width:t})}function T(e,t){return new q(Tt,`bytes${t||""}`,e,{size:t})}const er=Symbol.for("_ethers_typed");class q{type;value;#t;_typedSymbol;constructor(t,n,r,s){s==null&&(s=null),qe(Tt,t,"Typed"),D(this,{_typedSymbol:er,type:n,value:r}),this.#t=s,this.format()}format(){if(this.type==="array")throw new Error("");if(this.type==="dynamicArray")throw new Error("");return this.type==="tuple"?`tuple(${this.value.map(t=>t.format()).join(",")})`:this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return this.type==="string"}get tupleName(){if(this.type!=="tuple")throw TypeError("not a tuple");return this.#t}get arrayLength(){if(this.type!=="array")throw TypeError("not an array");return this.#t===!0?-1:this.#t===!1?this.value.length:null}static from(t,n){return new q(Tt,t,n)}static uint8(t){return w(t,8)}static uint16(t){return w(t,16)}static uint24(t){return w(t,24)}static uint32(t){return w(t,32)}static uint40(t){return w(t,40)}static uint48(t){return w(t,48)}static uint56(t){return w(t,56)}static uint64(t){return w(t,64)}static uint72(t){return w(t,72)}static uint80(t){return w(t,80)}static uint88(t){return w(t,88)}static uint96(t){return w(t,96)}static uint104(t){return w(t,104)}static uint112(t){return w(t,112)}static uint120(t){return w(t,120)}static uint128(t){return w(t,128)}static uint136(t){return w(t,136)}static uint144(t){return w(t,144)}static uint152(t){return w(t,152)}static uint160(t){return w(t,160)}static uint168(t){return w(t,168)}static uint176(t){return w(t,176)}static uint184(t){return w(t,184)}static uint192(t){return w(t,192)}static uint200(t){return w(t,200)}static uint208(t){return w(t,208)}static uint216(t){return w(t,216)}static uint224(t){return w(t,224)}static uint232(t){return w(t,232)}static uint240(t){return w(t,240)}static uint248(t){return w(t,248)}static uint256(t){return w(t,256)}static uint(t){return w(t,256)}static int8(t){return w(t,-8)}static int16(t){return w(t,-16)}static int24(t){return w(t,-24)}static int32(t){return w(t,-32)}static int40(t){return w(t,-40)}static int48(t){return w(t,-48)}static int56(t){return w(t,-56)}static int64(t){return w(t,-64)}static int72(t){return w(t,-72)}static int80(t){return w(t,-80)}static int88(t){return w(t,-88)}static int96(t){return w(t,-96)}static int104(t){return w(t,-104)}static int112(t){return w(t,-112)}static int120(t){return w(t,-120)}static int128(t){return w(t,-128)}static int136(t){return w(t,-136)}static int144(t){return w(t,-144)}static int152(t){return w(t,-152)}static int160(t){return w(t,-160)}static int168(t){return w(t,-168)}static int176(t){return w(t,-176)}static int184(t){return w(t,-184)}static int192(t){return w(t,-192)}static int200(t){return w(t,-200)}static int208(t){return w(t,-208)}static int216(t){return w(t,-216)}static int224(t){return w(t,-224)}static int232(t){return w(t,-232)}static int240(t){return w(t,-240)}static int248(t){return w(t,-248)}static int256(t){return w(t,-256)}static int(t){return w(t,-256)}static bytes1(t){return T(t,1)}static bytes2(t){return T(t,2)}static bytes3(t){return T(t,3)}static bytes4(t){return T(t,4)}static bytes5(t){return T(t,5)}static bytes6(t){return T(t,6)}static bytes7(t){return T(t,7)}static bytes8(t){return T(t,8)}static bytes9(t){return T(t,9)}static bytes10(t){return T(t,10)}static bytes11(t){return T(t,11)}static bytes12(t){return T(t,12)}static bytes13(t){return T(t,13)}static bytes14(t){return T(t,14)}static bytes15(t){return T(t,15)}static bytes16(t){return T(t,16)}static bytes17(t){return T(t,17)}static bytes18(t){return T(t,18)}static bytes19(t){return T(t,19)}static bytes20(t){return T(t,20)}static bytes21(t){return T(t,21)}static bytes22(t){return T(t,22)}static bytes23(t){return T(t,23)}static bytes24(t){return T(t,24)}static bytes25(t){return T(t,25)}static bytes26(t){return T(t,26)}static bytes27(t){return T(t,27)}static bytes28(t){return T(t,28)}static bytes29(t){return T(t,29)}static bytes30(t){return T(t,30)}static bytes31(t){return T(t,31)}static bytes32(t){return T(t,32)}static address(t){return new q(Tt,"address",t)}static bool(t){return new q(Tt,"bool",!!t)}static bytes(t){return new q(Tt,"bytes",t)}static string(t){return new q(Tt,"string",t)}static array(t,n){throw new Error("not implemented yet")}static tuple(t,n){throw new Error("not implemented yet")}static overrides(t){return new q(Tt,"overrides",Object.assign({},t))}static isTyped(t){return t&&typeof t=="object"&&"_typedSymbol"in t&&t._typedSymbol===er}static dereference(t,n){if(q.isTyped(t)){if(t.type!==n)throw new Error(`invalid type: expecetd ${n}, got ${t.type}`);return t.value}return t}}class Co extends Ht{constructor(t){super("address","address",t,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(t,n){let r=q.dereference(n,"string");try{r=ze(r)}catch(s){return this._throwError(s.message,n)}return t.writeValue(r)}decode(t){return ze(Vr(t.readValue(),20))}}class vo extends Ht{coder;constructor(t){super(t.name,t.type,"_",t.dynamic),this.coder=t}defaultValue(){return this.coder.defaultValue()}encode(t,n){return this.coder.encode(t,n)}decode(t){return this.coder.decode(t)}}function Jr(e,t,n){let r=[];if(Array.isArray(n))r=n;else if(n&&typeof n=="object"){let c={};r=t.map(u=>{const l=u.localName;return P(l,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:u},value:n}),P(!c[l],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:u},value:n}),c[l]=!0,n[l]})}else m(!1,"invalid tuple value","tuple",n);m(t.length===r.length,"types/value length mismatch","tuple",n);let s=new mn,i=new mn,o=[];t.forEach((c,u)=>{let l=r[u];if(c.dynamic){let h=i.length;c.encode(i,l);let B=s.writeUpdatableValue();o.push(C=>{B(C+h)})}else c.encode(s,l)}),o.forEach(c=>{c(s.length)});let a=e.appendWriter(s);return a+=e.appendWriter(i),a}function Gr(e,t){let n=[],r=[],s=e.subReader(0);return t.forEach(i=>{let o=null;if(i.dynamic){let a=e.readIndex(),c=s.subReader(a);try{o=i.decode(c)}catch(u){if(zn(u,"BUFFER_OVERRUN"))throw u;o=u,o.baseType=i.name,o.name=i.localName,o.type=i.type}}else try{o=i.decode(e)}catch(a){if(zn(a,"BUFFER_OVERRUN"))throw a;o=a,o.baseType=i.name,o.name=i.localName,o.type=i.type}if(o==null)throw new Error("investigate");n.push(o),r.push(i.localName||null)}),Ut.fromItems(n,r)}class No extends Ht{coder;length;constructor(t,n,r){const s=t.type+"["+(n>=0?n:"")+"]",i=n===-1||t.dynamic;super("array",s,r,i),D(this,{coder:t,length:n})}defaultValue(){const t=this.coder.defaultValue(),n=[];for(let r=0;r<this.length;r++)n.push(t);return n}encode(t,n){const r=q.dereference(n,"array");Array.isArray(r)||this._throwError("expected array value",r);let s=this.length;s===-1&&(s=r.length,t.writeValue(r.length)),_r(r.length,s,"coder array"+(this.localName?" "+this.localName:""));let i=[];for(let o=0;o<r.length;o++)i.push(this.coder);return Jr(t,i,r)}decode(t){let n=this.length;n===-1&&(n=t.readIndex(),P(n*tt<=t.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:t.bytes,offset:n*tt,length:t.dataLength}));let r=[];for(let s=0;s<n;s++)r.push(new vo(this.coder));return Gr(t,r)}}class Bo extends Ht{constructor(t){super("bool","bool",t,!1)}defaultValue(){return!1}encode(t,n){const r=q.dereference(n,"bool");return t.writeValue(r?1:0)}decode(t){return!!t.readValue()}}class jr extends Ht{constructor(t,n){super(t,t,n,!0)}defaultValue(){return"0x"}encode(t,n){n=It(n);let r=t.writeValue(n.length);return r+=t.writeBytes(n),r}decode(t){return t.readBytes(t.readIndex(),!0)}}class ko extends jr{constructor(t){super("bytes",t)}decode(t){return Y(super.decode(t))}}class Io extends Ht{size;constructor(t,n){let r="bytes"+String(t);super(r,r,n,!1),D(this,{size:t},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+this.size*2)}encode(t,n){let r=It(q.dereference(n,this.type));return r.length!==this.size&&this._throwError("incorrect data length",n),t.writeBytes(r)}decode(t){return Y(t.readBytes(this.size))}}const Oo=new Uint8Array([]);class So extends Ht{constructor(t){super("null","",t,!1)}defaultValue(){return null}encode(t,n){return n!=null&&this._throwError("not null",n),t.writeBytes(Oo)}decode(t){return t.readBytes(0),null}}const Ro=BigInt(0),_o=BigInt(1),Lo=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class To extends Ht{size;signed;constructor(t,n,r){const s=(n?"int":"uint")+t*8;super(s,s,r,!1),D(this,{size:t,signed:n},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(t,n){let r=oe(q.dereference(n,this.type)),s=me(Lo,tt*8);if(this.signed){let i=me(s,this.size*8-1);(r>i||r<-(i+_o))&&this._throwError("value out-of-bounds",n),r=Vi(r,8*tt)}else(r<Ro||r>me(s,this.size*8))&&this._throwError("value out-of-bounds",n);return t.writeValue(r)}decode(t){let n=me(t.readValue(),this.size*8);return this.signed&&(n=He(n,this.size*8)),n}}class Vo extends jr{constructor(t){super("string",t)}defaultValue(){return""}encode(t,n){return super.encode(t,Je(q.dereference(n,"string")))}decode(t){return zi(super.decode(t))}}class $e extends Ht{coders;constructor(t,n){let r=!1;const s=[];t.forEach(o=>{o.dynamic&&(r=!0),s.push(o.type)});const i="tuple("+s.join(",")+")";super("tuple",i,n,r),D(this,{coders:Object.freeze(t.slice())})}defaultValue(){const t=[];this.coders.forEach(r=>{t.push(r.defaultValue())});const n=this.coders.reduce((r,s)=>{const i=s.localName;return i&&(r[i]||(r[i]=0),r[i]++),r},{});return this.coders.forEach((r,s)=>{let i=r.localName;!i||n[i]!==1||(i==="length"&&(i="_length"),t[i]==null&&(t[i]=t[s]))}),Object.freeze(t)}encode(t,n){const r=q.dereference(n,"tuple");return Jr(t,this.coders,r)}decode(t){return Gr(t,this.coders)}}function Ie(e){return St(Je(e))}function et(e){const t=new Set;return e.forEach(n=>t.add(n)),Object.freeze(t)}const Po="external public payable override",Uo=et(Po.split(" ")),Zr="constant external internal payable private public pure view override",Fo=et(Zr.split(" ")),Yr="constructor error event fallback function receive struct",Xr=et(Yr.split(" ")),Qr="calldata memory storage payable indexed",Do=et(Qr.split(" ")),$o="tuple returns",Mo=[Yr,Qr,$o,Zr].join(" "),Ho=et(Mo.split(" ")),zo={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},Ko=new RegExp("^(\\s*)"),qo=new RegExp("^([0-9]+)"),Wo=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),ts=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),es=new RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$");class pt{#t;#e;get offset(){return this.#t}get length(){return this.#e.length-this.#t}constructor(t){this.#t=0,this.#e=t.slice()}clone(){return new pt(this.#e)}reset(){this.#t=0}#n(t=0,n=0){return new pt(this.#e.slice(t,n).map(r=>Object.freeze(Object.assign({},r,{match:r.match-t,linkBack:r.linkBack-t,linkNext:r.linkNext-t}))))}popKeyword(t){const n=this.peek();if(n.type!=="KEYWORD"||!t.has(n.text))throw new Error(`expected keyword ${n.text}`);return this.pop().text}popType(t){if(this.peek().type!==t){const n=this.peek();throw new Error(`expected ${t}; got ${n.type} ${JSON.stringify(n.text)}`)}return this.pop().text}popParen(){const t=this.peek();if(t.type!=="OPEN_PAREN")throw new Error("bad start");const n=this.#n(this.#t+1,t.match+1);return this.#t=t.match+1,n}popParams(){const t=this.peek();if(t.type!=="OPEN_PAREN")throw new Error("bad start");const n=[];for(;this.#t<t.match-1;){const r=this.peek().linkNext;n.push(this.#n(this.#t+1,r)),this.#t=r}return this.#t=t.match+1,n}peek(){if(this.#t>=this.#e.length)throw new Error("out-of-bounds");return this.#e[this.#t]}peekKeyword(t){const n=this.peekType("KEYWORD");return n!=null&&t.has(n)?n:null}peekType(t){if(this.length===0)return null;const n=this.peek();return n.type===t?n.text:null}pop(){const t=this.peek();return this.#t++,t}toString(){const t=[];for(let n=this.#t;n<this.#e.length;n++){const r=this.#e[n];t.push(`${r.type}:${r.text}`)}return`<TokenString ${t.join(" ")}>`}}function Zt(e){const t=[],n=o=>{const a=i<e.length?JSON.stringify(e[i]):"$EOI";throw new Error(`invalid token ${a} at ${i}: ${o}`)};let r=[],s=[],i=0;for(;i<e.length;){let o=e.substring(i),a=o.match(Ko);a&&(i+=a[1].length,o=e.substring(i));const c={depth:r.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:i,value:-1};t.push(c);let u=zo[o[0]]||"";if(u){if(c.type=u,c.text=o[0],i++,u==="OPEN_PAREN")r.push(t.length-1),s.push(t.length-1);else if(u=="CLOSE_PAREN")r.length===0&&n("no matching open bracket"),c.match=r.pop(),t[c.match].match=t.length-1,c.depth--,c.linkBack=s.pop(),t[c.linkBack].linkNext=t.length-1;else if(u==="COMMA")c.linkBack=s.pop(),t[c.linkBack].linkNext=t.length-1,s.push(t.length-1);else if(u==="OPEN_BRACKET")c.type="BRACKET";else if(u==="CLOSE_BRACKET"){let l=t.pop().text;if(t.length>0&&t[t.length-1].type==="NUMBER"){const h=t.pop().text;l=h+l,t[t.length-1].value=xt(h)}if(t.length===0||t[t.length-1].type!=="BRACKET")throw new Error("missing opening bracket");t[t.length-1].text+=l}continue}if(a=o.match(Wo),a){if(c.text=a[1],i+=c.text.length,Ho.has(c.text)){c.type="KEYWORD";continue}if(c.text.match(es)){c.type="TYPE";continue}c.type="ID";continue}if(a=o.match(qo),a){c.text=a[1],c.type="NUMBER",i+=c.text.length;continue}throw new Error(`unexpected token ${JSON.stringify(o[0])} at position ${i}`)}return new pt(t.map(o=>Object.freeze(o)))}function nr(e,t){let n=[];for(const r in t.keys())e.has(r)&&n.push(r);if(n.length>1)throw new Error(`conflicting types: ${n.join(", ")}`)}function Ge(e,t){if(t.peekKeyword(Xr)){const n=t.pop().text;if(n!==e)throw new Error(`expected ${e}, got ${n}`)}return t.popType("ID")}function $t(e,t){const n=new Set;for(;;){const r=e.peekType("KEYWORD");if(r==null||t&&!t.has(r))break;if(e.pop(),n.has(r))throw new Error(`duplicate keywords: ${JSON.stringify(r)}`);n.add(r)}return Object.freeze(n)}function ns(e){let t=$t(e,Fo);return nr(t,et("constant payable nonpayable".split(" "))),nr(t,et("pure view payable nonpayable".split(" "))),t.has("view")?"view":t.has("pure")?"pure":t.has("payable")?"payable":t.has("nonpayable")?"nonpayable":t.has("constant")?"view":"nonpayable"}function Dt(e,t){return e.popParams().map(n=>F.from(n,t))}function rs(e){if(e.peekType("AT")){if(e.pop(),e.peekType("NUMBER"))return oe(e.pop().text);throw new Error("invalid gas")}return null}function se(e){if(e.length)throw new Error(`unexpected tokens at offset ${e.offset}: ${e.toString()}`)}const Jo=new RegExp(/^(.*)\[([0-9]*)\]$/);function rr(e){const t=e.match(es);if(m(t,"invalid type","type",e),e==="uint")return"uint256";if(e==="int")return"int256";if(t[2]){const n=parseInt(t[2]);m(n!==0&&n<=32,"invalid bytes length","type",e)}else if(t[3]){const n=parseInt(t[3]);m(n!==0&&n<=256&&n%8===0,"invalid numeric width","type",e)}return e}const M={},ot=Symbol.for("_ethers_internal"),sr="_ParamTypeInternal",ir="_ErrorInternal",or="_EventInternal",ar="_ConstructorInternal",cr="_FallbackInternal",ur="_FunctionInternal",lr="_StructInternal";class F{name;type;baseType;indexed;components;arrayLength;arrayChildren;constructor(t,n,r,s,i,o,a,c){if(qe(t,M,"ParamType"),Object.defineProperty(this,ot,{value:sr}),o&&(o=Object.freeze(o.slice())),s==="array"){if(a==null||c==null)throw new Error("")}else if(a!=null||c!=null)throw new Error("");if(s==="tuple"){if(o==null)throw new Error("")}else if(o!=null)throw new Error("");D(this,{name:n,type:r,baseType:s,indexed:i,components:o,arrayLength:a,arrayChildren:c})}format(t){if(t==null&&(t="sighash"),t==="json"){const r=this.name||"";if(this.isArray()){const i=JSON.parse(this.arrayChildren.format("json"));return i.name=r,i.type+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`,JSON.stringify(i)}const s={type:this.baseType==="tuple"?"tuple":this.type,name:r};return typeof this.indexed=="boolean"&&(s.indexed=this.indexed),this.isTuple()&&(s.components=this.components.map(i=>JSON.parse(i.format(t)))),JSON.stringify(s)}let n="";return this.isArray()?(n+=this.arrayChildren.format(t),n+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`):this.isTuple()?n+="("+this.components.map(r=>r.format(t)).join(t==="full"?", ":",")+")":n+=this.type,t!=="sighash"&&(this.indexed===!0&&(n+=" indexed"),t==="full"&&this.name&&(n+=" "+this.name)),n}isArray(){return this.baseType==="array"}isTuple(){return this.baseType==="tuple"}isIndexable(){return this.indexed!=null}walk(t,n){if(this.isArray()){if(!Array.isArray(t))throw new Error("invalid array value");if(this.arrayLength!==-1&&t.length!==this.arrayLength)throw new Error("array is wrong length");const r=this;return t.map(s=>r.arrayChildren.walk(s,n))}if(this.isTuple()){if(!Array.isArray(t))throw new Error("invalid tuple value");if(t.length!==this.components.length)throw new Error("array is wrong length");const r=this;return t.map((s,i)=>r.components[i].walk(s,n))}return n(this.type,t)}#t(t,n,r,s){if(this.isArray()){if(!Array.isArray(n))throw new Error("invalid array value");if(this.arrayLength!==-1&&n.length!==this.arrayLength)throw new Error("array is wrong length");const o=this.arrayChildren,a=n.slice();a.forEach((c,u)=>{o.#t(t,c,r,l=>{a[u]=l})}),s(a);return}if(this.isTuple()){const o=this.components;let a;if(Array.isArray(n))a=n.slice();else{if(n==null||typeof n!="object")throw new Error("invalid tuple value");a=o.map(c=>{if(!c.name)throw new Error("cannot use object value with unnamed components");if(!(c.name in n))throw new Error(`missing value for component ${c.name}`);return n[c.name]})}if(a.length!==this.components.length)throw new Error("array is wrong length");a.forEach((c,u)=>{o[u].#t(t,c,r,l=>{a[u]=l})}),s(a);return}const i=r(this.type,n);i.then?t.push((async function(){s(await i)})()):s(i)}async walkAsync(t,n){const r=[],s=[t];return this.#t(r,t,n,i=>{s[0]=i}),r.length&&await Promise.all(r),s[0]}static from(t,n){if(F.isParamType(t))return t;if(typeof t=="string")try{return F.from(Zt(t),n)}catch{m(!1,"invalid param type","obj",t)}else if(t instanceof pt){let a="",c="",u=null;$t(t,et(["tuple"])).has("tuple")||t.peekType("OPEN_PAREN")?(c="tuple",u=t.popParams().map(L=>F.from(L)),a=`tuple(${u.map(L=>L.format()).join(",")})`):(a=rr(t.popType("TYPE")),c=a);let l=null,h=null;for(;t.length&&t.peekType("BRACKET");){const L=t.pop();l=new F(M,"",a,c,null,u,h,l),h=L.value,a+=L.text,c="array",u=null}let B=null;if($t(t,Do).has("indexed")){if(!n)throw new Error("");B=!0}const X=t.peekType("ID")?t.pop().text:"";if(t.length)throw new Error("leftover tokens");return new F(M,X,a,c,B,u,h,l)}const r=t.name;m(!r||typeof r=="string"&&r.match(ts),"invalid name","obj.name",r);let s=t.indexed;s!=null&&(m(n,"parameter cannot be indexed","obj.indexed",t.indexed),s=!!s);let i=t.type,o=i.match(Jo);if(o){const a=parseInt(o[2]||"-1"),c=F.from({type:o[1],components:t.components});return new F(M,r||"",i,"array",s,null,a,c)}if(i==="tuple"||i.startsWith("tuple(")||i.startsWith("(")){const a=t.components!=null?t.components.map(u=>F.from(u)):null;return new F(M,r||"",i,"tuple",s,a,null,null)}return i=rr(t.type),new F(M,r||"",i,i,s,null,null,null)}static isParamType(t){return t&&t[ot]===sr}}class ie{type;inputs;constructor(t,n,r){qe(t,M,"Fragment"),r=Object.freeze(r.slice()),D(this,{type:n,inputs:r})}static from(t){if(typeof t=="string"){try{ie.from(JSON.parse(t))}catch{}return ie.from(Zt(t))}if(t instanceof pt)switch(t.peekKeyword(Xr)){case"constructor":return Ft.from(t);case"error":return it.from(t);case"event":return Bt.from(t);case"fallback":case"receive":return Pt.from(t);case"function":return kt.from(t);case"struct":return re.from(t)}else if(typeof t=="object"){switch(t.type){case"constructor":return Ft.from(t);case"error":return it.from(t);case"event":return Bt.from(t);case"fallback":case"receive":return Pt.from(t);case"function":return kt.from(t);case"struct":return re.from(t)}P(!1,`unsupported type: ${t.type}`,"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}m(!1,"unsupported frgament object","obj",t)}static isConstructor(t){return Ft.isFragment(t)}static isError(t){return it.isFragment(t)}static isEvent(t){return Bt.isFragment(t)}static isFunction(t){return kt.isFragment(t)}static isStruct(t){return re.isFragment(t)}}class je extends ie{name;constructor(t,n,r,s){super(t,n,s),m(typeof r=="string"&&r.match(ts),"invalid identifier","name",r),s=Object.freeze(s.slice()),D(this,{name:r})}}function Oe(e,t){return"("+t.map(n=>n.format(e)).join(e==="full"?", ":",")+")"}class it extends je{constructor(t,n,r){super(t,"error",n,r),Object.defineProperty(this,ot,{value:ir})}get selector(){return Ie(this.format("sighash")).substring(0,10)}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(r=>JSON.parse(r.format(t)))});const n=[];return t!=="sighash"&&n.push("error"),n.push(this.name+Oe(t,this.inputs)),n.join(" ")}static from(t){if(it.isFragment(t))return t;if(typeof t=="string")return it.from(Zt(t));if(t instanceof pt){const n=Ge("error",t),r=Dt(t);return se(t),new it(M,n,r)}return new it(M,t.name,t.inputs?t.inputs.map(F.from):[])}static isFragment(t){return t&&t[ot]===ir}}class Bt extends je{anonymous;constructor(t,n,r,s){super(t,"event",n,r),Object.defineProperty(this,ot,{value:or}),D(this,{anonymous:s})}get topicHash(){return Ie(this.format("sighash"))}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(r=>JSON.parse(r.format(t)))});const n=[];return t!=="sighash"&&n.push("event"),n.push(this.name+Oe(t,this.inputs)),t!=="sighash"&&this.anonymous&&n.push("anonymous"),n.join(" ")}static getTopicHash(t,n){return n=(n||[]).map(s=>F.from(s)),new Bt(M,t,n,!1).topicHash}static from(t){if(Bt.isFragment(t))return t;if(typeof t=="string")try{return Bt.from(Zt(t))}catch{m(!1,"invalid event fragment","obj",t)}else if(t instanceof pt){const n=Ge("event",t),r=Dt(t,!0),s=!!$t(t,et(["anonymous"])).has("anonymous");return se(t),new Bt(M,n,r,s)}return new Bt(M,t.name,t.inputs?t.inputs.map(n=>F.from(n,!0)):[],!!t.anonymous)}static isFragment(t){return t&&t[ot]===or}}class Ft extends ie{payable;gas;constructor(t,n,r,s,i){super(t,n,r),Object.defineProperty(this,ot,{value:ar}),D(this,{payable:s,gas:i})}format(t){if(P(t!=null&&t!=="sighash","cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),t==="json")return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(r=>JSON.parse(r.format(t)))});const n=[`constructor${Oe(t,this.inputs)}`];return this.payable&&n.push("payable"),this.gas!=null&&n.push(`@${this.gas.toString()}`),n.join(" ")}static from(t){if(Ft.isFragment(t))return t;if(typeof t=="string")try{return Ft.from(Zt(t))}catch{m(!1,"invalid constuctor fragment","obj",t)}else if(t instanceof pt){$t(t,et(["constructor"]));const n=Dt(t),r=!!$t(t,Uo).has("payable"),s=rs(t);return se(t),new Ft(M,"constructor",n,r,s)}return new Ft(M,"constructor",t.inputs?t.inputs.map(F.from):[],!!t.payable,t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[ot]===ar}}class Pt extends ie{payable;constructor(t,n,r){super(t,"fallback",n),Object.defineProperty(this,ot,{value:cr}),D(this,{payable:r})}format(t){const n=this.inputs.length===0?"receive":"fallback";if(t==="json"){const r=this.payable?"payable":"nonpayable";return JSON.stringify({type:n,stateMutability:r})}return`${n}()${this.payable?" payable":""}`}static from(t){if(Pt.isFragment(t))return t;if(typeof t=="string")try{return Pt.from(Zt(t))}catch{m(!1,"invalid fallback fragment","obj",t)}else if(t instanceof pt){const n=t.toString(),r=t.peekKeyword(et(["fallback","receive"]));if(m(r,"type must be fallback or receive","obj",n),t.popKeyword(et(["fallback","receive"]))==="receive"){const a=Dt(t);return m(a.length===0,"receive cannot have arguments","obj.inputs",a),$t(t,et(["payable"])),se(t),new Pt(M,[],!0)}let i=Dt(t);i.length?m(i.length===1&&i[0].type==="bytes","invalid fallback inputs","obj.inputs",i.map(a=>a.format("minimal")).join(", ")):i=[F.from("bytes")];const o=ns(t);if(m(o==="nonpayable"||o==="payable","fallback cannot be constants","obj.stateMutability",o),$t(t,et(["returns"])).has("returns")){const a=Dt(t);m(a.length===1&&a[0].type==="bytes","invalid fallback outputs","obj.outputs",a.map(c=>c.format("minimal")).join(", "))}return se(t),new Pt(M,i,o==="payable")}if(t.type==="receive")return new Pt(M,[],!0);if(t.type==="fallback"){const n=[F.from("bytes")],r=t.stateMutability==="payable";return new Pt(M,n,r)}m(!1,"invalid fallback description","obj",t)}static isFragment(t){return t&&t[ot]===cr}}class kt extends je{constant;outputs;stateMutability;payable;gas;constructor(t,n,r,s,i,o){super(t,"function",n,s),Object.defineProperty(this,ot,{value:ur}),i=Object.freeze(i.slice()),D(this,{constant:r==="view"||r==="pure",gas:o,outputs:i,payable:r==="payable",stateMutability:r})}get selector(){return Ie(this.format("sighash")).substring(0,10)}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(r=>JSON.parse(r.format(t))),outputs:this.outputs.map(r=>JSON.parse(r.format(t)))});const n=[];return t!=="sighash"&&n.push("function"),n.push(this.name+Oe(t,this.inputs)),t!=="sighash"&&(this.stateMutability!=="nonpayable"&&n.push(this.stateMutability),this.outputs&&this.outputs.length&&(n.push("returns"),n.push(Oe(t,this.outputs))),this.gas!=null&&n.push(`@${this.gas.toString()}`)),n.join(" ")}static getSelector(t,n){return n=(n||[]).map(s=>F.from(s)),new kt(M,t,"view",n,[],null).selector}static from(t){if(kt.isFragment(t))return t;if(typeof t=="string")try{return kt.from(Zt(t))}catch{m(!1,"invalid function fragment","obj",t)}else if(t instanceof pt){const r=Ge("function",t),s=Dt(t),i=ns(t);let o=[];$t(t,et(["returns"])).has("returns")&&(o=Dt(t));const a=rs(t);return se(t),new kt(M,r,i,s,o,a)}let n=t.stateMutability;return n==null&&(n="payable",typeof t.constant=="boolean"?(n="view",t.constant||(n="payable",typeof t.payable=="boolean"&&!t.payable&&(n="nonpayable"))):typeof t.payable=="boolean"&&!t.payable&&(n="nonpayable")),new kt(M,t.name,n,t.inputs?t.inputs.map(F.from):[],t.outputs?t.outputs.map(F.from):[],t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[ot]===ur}}class re extends je{constructor(t,n,r){super(t,"struct",n,r),Object.defineProperty(this,ot,{value:lr})}format(){throw new Error("@TODO")}static from(t){if(typeof t=="string")try{return re.from(Zt(t))}catch{m(!1,"invalid struct fragment","obj",t)}else if(t instanceof pt){const n=Ge("struct",t),r=Dt(t);return se(t),new re(M,n,r)}return new re(M,t.name,t.inputs?t.inputs.map(F.from):[])}static isFragment(t){return t&&t[ot]===lr}}const At=new Map;At.set(0,"GENERIC_PANIC");At.set(1,"ASSERT_FALSE");At.set(17,"OVERFLOW");At.set(18,"DIVIDE_BY_ZERO");At.set(33,"ENUM_RANGE_ERROR");At.set(34,"BAD_STORAGE_DATA");At.set(49,"STACK_UNDERFLOW");At.set(50,"ARRAY_RANGE_ERROR");At.set(65,"OUT_OF_MEMORY");At.set(81,"UNINITIALIZED_FUNCTION_CALL");const Go=new RegExp(/^bytes([0-9]*)$/),jo=new RegExp(/^(u?int)([0-9]*)$/);let nn=null,fr=1024;function Zo(e,t,n,r){let s="missing revert data",i=null;const o=null;let a=null;if(n){s="execution reverted";const u=Ot(n);if(n=Y(n),u.length===0)s+=" (no data present; likely require(false) occurred",i="require(false)";else if(u.length%32!==4)s+=" (could not decode reason; invalid data length)";else if(Y(u.slice(0,4))==="0x08c379a0")try{i=r.decode(["string"],u.slice(4))[0],a={signature:"Error(string)",name:"Error",args:[i]},s+=`: ${JSON.stringify(i)}`}catch{s+=" (could not decode reason; invalid string data)"}else if(Y(u.slice(0,4))==="0x4e487b71")try{const l=Number(r.decode(["uint256"],u.slice(4))[0]);a={signature:"Panic(uint256)",name:"Panic",args:[l]},i=`Panic due to ${At.get(l)||"UNKNOWN"}(${l})`,s+=`: ${i}`}catch{s+=" (could not decode panic code)"}else s+=" (unknown custom error)"}const c={to:t.to?ze(t.to):null,data:t.data||"0x"};return t.from&&(c.from=ze(t.from)),Rr(s,"CALL_EXCEPTION",{action:e,data:n,reason:i,transaction:c,invocation:o,revert:a})}class Mt{#t(t){if(t.isArray())return new No(this.#t(t.arrayChildren),t.arrayLength,t.name);if(t.isTuple())return new $e(t.components.map(r=>this.#t(r)),t.name);switch(t.baseType){case"address":return new Co(t.name);case"bool":return new Bo(t.name);case"string":return new Vo(t.name);case"bytes":return new ko(t.name);case"":return new So(t.name)}let n=t.type.match(jo);if(n){let r=parseInt(n[2]||"256");return m(r!==0&&r<=256&&r%8===0,"invalid "+n[1]+" bit length","param",t),new To(r/8,n[1]==="int",t.name)}if(n=t.type.match(Go),n){let r=parseInt(n[1]);return m(r!==0&&r<=32,"invalid bytes length","param",t),new Io(r,t.name)}m(!1,"invalid type","type",t.type)}getDefaultValue(t){const n=t.map(s=>this.#t(F.from(s)));return new $e(n,"_").defaultValue()}encode(t,n){_r(n.length,t.length,"types/values length mismatch");const r=t.map(o=>this.#t(F.from(o))),s=new $e(r,"_"),i=new mn;return s.encode(i,n),i.data}decode(t,n,r){const s=t.map(o=>this.#t(F.from(o)));return new $e(s,"_").decode(new An(n,r,fr))}static _setDefaultMaxInflation(t){m(typeof t=="number"&&Number.isInteger(t),"invalid defaultMaxInflation factor","value",t),fr=t}static defaultAbiCoder(){return nn==null&&(nn=new Mt),nn}static getBuiltinCallException(t,n,r){return Zo(t,n,r,Mt.defaultAbiCoder())}}class Yo{fragment;name;signature;topic;args;constructor(t,n,r){const s=t.name,i=t.format();D(this,{fragment:t,name:s,signature:i,topic:n,args:r})}}class Xo{fragment;name;args;signature;selector;value;constructor(t,n,r,s){const i=t.name,o=t.format();D(this,{fragment:t,name:i,args:r,signature:o,selector:n,value:s})}}class Qo{fragment;name;args;signature;selector;constructor(t,n,r){const s=t.name,i=t.format();D(this,{fragment:t,name:s,args:r,signature:i,selector:n})}}class dr{hash;_isIndexed;static isIndexed(t){return!!(t&&t._isIndexed)}constructor(t){D(this,{hash:t,_isIndexed:!0})}}const pr={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},hr={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:e=>`reverted with reason string ${JSON.stringify(e)}`},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:e=>{let t="unknown panic code";return e>=0&&e<=255&&pr[e.toString()]&&(t=pr[e.toString()]),`reverted with panic code 0x${e.toString(16)} (${t})`}}};class wt{fragments;deploy;fallback;receive;#t;#e;#n;#r;constructor(t){let n=[];typeof t=="string"?n=JSON.parse(t):n=t,this.#n=new Map,this.#t=new Map,this.#e=new Map;const r=[];for(const o of n)try{r.push(ie.from(o))}catch(a){console.log(`[Warning] Invalid Fragment ${JSON.stringify(o)}:`,a.message)}D(this,{fragments:Object.freeze(r)});let s=null,i=!1;this.#r=this.getAbiCoder(),this.fragments.forEach((o,a)=>{let c;switch(o.type){case"constructor":if(this.deploy){console.log("duplicate definition - constructor");return}D(this,{deploy:o});return;case"fallback":o.inputs.length===0?i=!0:(m(!s||o.payable!==s.payable,"conflicting fallback fragments",`fragments[${a}]`,o),s=o,i=s.payable);return;case"function":c=this.#n;break;case"event":c=this.#e;break;case"error":c=this.#t;break;default:return}const u=o.format();c.has(u)||c.set(u,o)}),this.deploy||D(this,{deploy:Ft.from("constructor()")}),D(this,{fallback:s,receive:i})}format(t){const n=t?"minimal":"full";return this.fragments.map(s=>s.format(n))}formatJson(){const t=this.fragments.map(n=>n.format("json"));return JSON.stringify(t.map(n=>JSON.parse(n)))}getAbiCoder(){return Mt.defaultAbiCoder()}#s(t,n,r){if(Ue(t)){const i=t.toLowerCase();for(const o of this.#n.values())if(i===o.selector)return o;return null}if(t.indexOf("(")===-1){const i=[];for(const[o,a]of this.#n)o.split("(")[0]===t&&i.push(a);if(n){const o=n.length>0?n[n.length-1]:null;let a=n.length,c=!0;q.isTyped(o)&&o.type==="overrides"&&(c=!1,a--);for(let u=i.length-1;u>=0;u--){const l=i[u].inputs.length;l!==a&&(!c||l!==a-1)&&i.splice(u,1)}for(let u=i.length-1;u>=0;u--){const l=i[u].inputs;for(let h=0;h<n.length;h++)if(q.isTyped(n[h])){if(h>=l.length){if(n[h].type==="overrides")continue;i.splice(u,1);break}if(n[h].type!==l[h].baseType){i.splice(u,1);break}}}}if(i.length===1&&n&&n.length!==i[0].inputs.length){const o=n[n.length-1];(o==null||Array.isArray(o)||typeof o!="object")&&i.splice(0,1)}if(i.length===0)return null;if(i.length>1&&r){const o=i.map(a=>JSON.stringify(a.format())).join(", ");m(!1,`ambiguous function description (i.e. matches ${o})`,"key",t)}return i[0]}const s=this.#n.get(kt.from(t).format());return s||null}getFunctionName(t){const n=this.#s(t,null,!1);return m(n,"no matching function","key",t),n.name}hasFunction(t){return!!this.#s(t,null,!1)}getFunction(t,n){return this.#s(t,n||null,!0)}forEachFunction(t){const n=Array.from(this.#n.keys());n.sort((r,s)=>r.localeCompare(s));for(let r=0;r<n.length;r++){const s=n[r];t(this.#n.get(s),r)}}#i(t,n,r){if(Ue(t)){const i=t.toLowerCase();for(const o of this.#e.values())if(i===o.topicHash)return o;return null}if(t.indexOf("(")===-1){const i=[];for(const[o,a]of this.#e)o.split("(")[0]===t&&i.push(a);if(n){for(let o=i.length-1;o>=0;o--)i[o].inputs.length<n.length&&i.splice(o,1);for(let o=i.length-1;o>=0;o--){const a=i[o].inputs;for(let c=0;c<n.length;c++)if(q.isTyped(n[c])&&n[c].type!==a[c].baseType){i.splice(o,1);break}}}if(i.length===0)return null;if(i.length>1&&r){const o=i.map(a=>JSON.stringify(a.format())).join(", ");m(!1,`ambiguous event description (i.e. matches ${o})`,"key",t)}return i[0]}const s=this.#e.get(Bt.from(t).format());return s||null}getEventName(t){const n=this.#i(t,null,!1);return m(n,"no matching event","key",t),n.name}hasEvent(t){return!!this.#i(t,null,!1)}getEvent(t,n){return this.#i(t,n||null,!0)}forEachEvent(t){const n=Array.from(this.#e.keys());n.sort((r,s)=>r.localeCompare(s));for(let r=0;r<n.length;r++){const s=n[r];t(this.#e.get(s),r)}}getError(t,n){if(Ue(t)){const s=t.toLowerCase();if(hr[s])return it.from(hr[s].signature);for(const i of this.#t.values())if(s===i.selector)return i;return null}if(t.indexOf("(")===-1){const s=[];for(const[i,o]of this.#t)i.split("(")[0]===t&&s.push(o);if(s.length===0)return t==="Error"?it.from("error Error(string)"):t==="Panic"?it.from("error Panic(uint256)"):null;if(s.length>1){const i=s.map(o=>JSON.stringify(o.format())).join(", ");m(!1,`ambiguous error description (i.e. ${i})`,"name",t)}return s[0]}if(t=it.from(t).format(),t==="Error(string)")return it.from("error Error(string)");if(t==="Panic(uint256)")return it.from("error Panic(uint256)");const r=this.#t.get(t);return r||null}forEachError(t){const n=Array.from(this.#t.keys());n.sort((r,s)=>r.localeCompare(s));for(let r=0;r<n.length;r++){const s=n[r];t(this.#t.get(s),r)}}_decodeParams(t,n){return this.#r.decode(t,n)}_encodeParams(t,n){return this.#r.encode(t,n)}encodeDeploy(t){return this._encodeParams(this.deploy.inputs,t||[])}decodeErrorResult(t,n){if(typeof t=="string"){const r=this.getError(t);m(r,"unknown error","fragment",t),t=r}return m(ue(n,0,4)===t.selector,`data signature does not match error ${t.name}.`,"data",n),this._decodeParams(t.inputs,ue(n,4))}encodeErrorResult(t,n){if(typeof t=="string"){const r=this.getError(t);m(r,"unknown error","fragment",t),t=r}return ye([t.selector,this._encodeParams(t.inputs,n||[])])}decodeFunctionData(t,n){if(typeof t=="string"){const r=this.getFunction(t);m(r,"unknown function","fragment",t),t=r}return m(ue(n,0,4)===t.selector,`data signature does not match function ${t.name}.`,"data",n),this._decodeParams(t.inputs,ue(n,4))}encodeFunctionData(t,n){if(typeof t=="string"){const r=this.getFunction(t);m(r,"unknown function","fragment",t),t=r}return ye([t.selector,this._encodeParams(t.inputs,n||[])])}decodeFunctionResult(t,n){if(typeof t=="string"){const i=this.getFunction(t);m(i,"unknown function","fragment",t),t=i}let r="invalid length for result data";const s=It(n);if(s.length%32===0)try{return this.#r.decode(t.outputs,s)}catch{r="could not decode result data"}P(!1,r,"BAD_DATA",{value:Y(s),info:{method:t.name,signature:t.format()}})}makeError(t,n){const r=Ot(t,"data"),s=Mt.getBuiltinCallException("call",n,r);if(s.message.startsWith("execution reverted (unknown custom error)")){const a=Y(r.slice(0,4)),c=this.getError(a);if(c)try{const u=this.#r.decode(c.inputs,r.slice(4));s.revert={name:c.name,signature:c.format(),args:u},s.reason=s.revert.signature,s.message=`execution reverted: ${s.reason}`}catch{s.message="execution reverted (coult not decode custom error)"}}const o=this.parseTransaction(n);return o&&(s.invocation={method:o.name,signature:o.signature,args:o.args}),s}encodeFunctionResult(t,n){if(typeof t=="string"){const r=this.getFunction(t);m(r,"unknown function","fragment",t),t=r}return Y(this.#r.encode(t.outputs,n||[]))}encodeFilterTopics(t,n){if(typeof t=="string"){const i=this.getEvent(t);m(i,"unknown event","eventFragment",t),t=i}P(n.length<=t.inputs.length,`too many arguments for ${t.format()}`,"UNEXPECTED_ARGUMENT",{count:n.length,expectedCount:t.inputs.length});const r=[];t.anonymous||r.push(t.topicHash);const s=(i,o)=>i.type==="string"?Ie(o):i.type==="bytes"?St(Y(o)):(i.type==="bool"&&typeof o=="boolean"?o=o?"0x01":"0x00":i.type.match(/^u?int/)?o=Vr(o):i.type.match(/^bytes/)?o=Ti(o,32):i.type==="address"&&this.#r.encode(["address"],[o]),Li(Y(o),32));for(n.forEach((i,o)=>{const a=t.inputs[o];if(!a.indexed){m(i==null,"cannot filter non-indexed parameters; must be null","contract."+a.name,i);return}i==null?r.push(null):a.baseType==="array"||a.baseType==="tuple"?m(!1,"filtering with tuples or arrays not supported","contract."+a.name,i):Array.isArray(i)?r.push(i.map(c=>s(a,c))):r.push(s(a,i))});r.length&&r[r.length-1]===null;)r.pop();return r}encodeEventLog(t,n){if(typeof t=="string"){const o=this.getEvent(t);m(o,"unknown event","eventFragment",t),t=o}const r=[],s=[],i=[];return t.anonymous||r.push(t.topicHash),m(n.length===t.inputs.length,"event arguments/values mismatch","values",n),t.inputs.forEach((o,a)=>{const c=n[a];if(o.indexed)if(o.type==="string")r.push(Ie(c));else if(o.type==="bytes")r.push(St(c));else{if(o.baseType==="tuple"||o.baseType==="array")throw new Error("not implemented");r.push(this.#r.encode([o.type],[c]))}else s.push(o),i.push(c)}),{data:this.#r.encode(s,i),topics:r}}decodeEventLog(t,n,r){if(typeof t=="string"){const C=this.getEvent(t);m(C,"unknown event","eventFragment",t),t=C}if(r!=null&&!t.anonymous){const C=t.topicHash;m(Ue(r[0],32)&&r[0].toLowerCase()===C,"fragment/topic mismatch","topics[0]",r[0]),r=r.slice(1)}const s=[],i=[],o=[];t.inputs.forEach((C,X)=>{C.indexed?C.type==="string"||C.type==="bytes"||C.baseType==="tuple"||C.baseType==="array"?(s.push(F.from({type:"bytes32",name:C.name})),o.push(!0)):(s.push(C),o.push(!1)):(i.push(C),o.push(!1))});const a=r!=null?this.#r.decode(s,ye(r)):null,c=this.#r.decode(i,n,!0),u=[],l=[];let h=0,B=0;return t.inputs.forEach((C,X)=>{let L=null;if(C.indexed)if(a==null)L=new dr(null);else if(o[X])L=new dr(a[B++]);else try{L=a[B++]}catch(G){L=G}else try{L=c[h++]}catch(G){L=G}u.push(L),l.push(C.name||null)}),Ut.fromItems(u,l)}parseTransaction(t){const n=Ot(t.data,"tx.data"),r=oe(t.value!=null?t.value:0,"tx.value"),s=this.getFunction(Y(n.slice(0,4)));if(!s)return null;const i=this.#r.decode(s.inputs,n.slice(4));return new Xo(s,s.selector,i,r)}parseCallResult(t){throw new Error("@TODO")}parseLog(t){const n=this.getEvent(t.topics[0]);return!n||n.anonymous?null:new Yo(n,n.topicHash,this.decodeEventLog(n,t.data,t.topics))}parseError(t){const n=Y(t),r=this.getError(ue(n,0,4));if(!r)return null;const s=this.#r.decode(r.inputs,ue(n,4));return new Qo(r,r.selector,s)}static from(t){return t instanceof wt?t:typeof t=="string"?new wt(JSON.parse(t)):typeof t.formatJson=="function"?new wt(t.formatJson()):typeof t.format=="function"?new wt(t.format("json")):new wt(t)}}const bt="0x0000000000000000000000000000000000000000";var H=(e=>(e[e.BalancerV2=0]="BalancerV2",e[e.BalancerV3=1]="BalancerV3",e[e.Aave=2]="Aave",e[e.ZeroLend=3]="ZeroLend",e[e.UniswapV3=4]="UniswapV3",e[e.Morpho=5]="Morpho",e))(H||{}),k=(e=>(e[e.Deposit=0]="Deposit",e[e.DepositCollateral=1]="DepositCollateral",e[e.WithdrawCollateral=2]="WithdrawCollateral",e[e.Borrow=3]="Borrow",e[e.Repay=4]="Repay",e[e.GetBorrowBalance=5]="GetBorrowBalance",e[e.GetSupplyBalance=6]="GetSupplyBalance",e[e.Swap=7]="Swap",e[e.SwapExactOut=8]="SwapExactOut",e))(k||{});const Yt=Mt.defaultAbiCoder(),be="tuple(uint256 amount,address token,address user,uint8 instructionType)",Se="tuple(uint256 index)";function jt(e,t,n=bt){return Yt.encode([be,"uint8",Se,"address"],[[0n,bt,bt,0],e,{index:t},n])}function ve(e,t,n){return Yt.encode([be],[[e,t,n,1]])}function K(e,t){return Yt.encode([be,"string",Se],[[0n,bt,bt,4],t,{index:e}])}function te(e,t){return Yt.encode([be],[[e,t,bt,3]])}function dt(e,t){return Yt.encode(["tuple(tuple(uint256 amount,address token,address user,uint8 instructionType),tuple(uint256 index))"],[[[0n,bt,t,2],{index:e}]])}const ta="tuple(uint8 op,address token,address user,uint256 amount,bytes context,tuple(uint256 index) input)";function R(e,t,n,r,s="0x",i=999){return Yt.encode([ta],[[e,t,n,r,s,{index:i}]])}function N(e){return{protocolName:"router",data:e}}function _(e,t){return{protocolName:e,data:t}}function Q(e){let t=e.toLowerCase();return t=t.replace(/\s+v\d+$/i,""),t=t.replace(/\s+/g,""),t==="morphoblue"?"morpho-blue":t}function Nc(e){return Mt.defaultAbiCoder().encode(["tuple(address loanToken, address collateralToken, address oracle, address irm, uint256 lltv)"],[[e.loanToken,e.collateralToken,e.oracle,e.irm,e.lltv]])}function ea(e,t){return Yt.encode([be,Se,"uint256"],[[0n,bt,bt,5],{index:e},t])}function na(e,t){return Yt.encode([be,Se,Se],[[0n,bt,bt,6],{index:e},{index:t}])}const ra=new Set([9745]),sa=new Set([1,42161,8453,59144,31337]),ia=new Set([1,10,42161,8453,9745,31337]),oa=new Set([1,10,42161,8453,59144,9745,31337]),aa=new Set([1,42161,8453,10,31337]),ca=new Set([1,42161,8453,10,31337]),ua=new Set([1,42161,8453,10]),la=new Set([59144,8453]),fa=new Set([1]),da=new Set([1,42161,8453,130]),Ne={BalancerV2:0,BalancerV3:0,Morpho:0,Aave:5,ZeroLend:5};function ss(e){return e===void 0?!1:!ra.has(e)}function is(e){return e===void 0?!1:ia.has(e)}function Bc(e){if(e!==void 0){if(ss(e))return"1inch";if(is(e))return"pendle"}}function kc(e){if(!e)return!1;const t=e.toLowerCase();return t.startsWith("pt-")||t.startsWith("pt ")}function Ic(e){return e===void 0?!1:sa.has(e)}function pa(e){return e===void 0?!1:oa.has(e)}function ha(e){return e===void 0?!1:aa.has(e)}function ma(e){return e===void 0?!1:ca.has(e)}function ga(e){return e===void 0?!1:ua.has(e)}function ya(e){return e===void 0?!1:la.has(e)}function Oc(e){return e===void 0?!1:fa.has(e)}function Sc(e){return e===void 0?!1:da.has(e)}function Rc(e){if(!(!e||!is(e)))return wn(e,"PendleAdapter")}function _c(e){if(!(!e||!ss(e)))return wn(e,"OneInchAdapter")}const Be=[{name:"Balancer V2",version:"v2",icon:"/logos/balancer.svg",providerEnum:H.BalancerV2,feeBps:Ne.BalancerV2},{name:"Morpho",version:"morpho",icon:"/logos/morpho.svg",providerEnum:H.Morpho,feeBps:Ne.Morpho},{name:"Balancer V3",version:"v3",icon:"/logos/balancer.svg",providerEnum:H.BalancerV3,feeBps:Ne.BalancerV3},{name:"Aave",version:"aave",icon:"/logos/aave.svg",providerEnum:H.Aave,feeBps:Ne.Aave},{name:"ZeroLend",version:"zerolend",icon:"/logos/zerolend.svg",providerEnum:H.ZeroLend,feeBps:Ne.ZeroLend}],Lc=[H.BalancerV2,H.Morpho,H.BalancerV3,H.Aave,H.ZeroLend];function Tc(e){if(e===void 0)return[];const t=[];return ha(e)&&t.push(Be[0]),ga(e)&&t.push(Be[1]),ma(e)&&t.push(Be[2]),pa(e)&&t.push(Be[3]),ya(e)&&t.push(Be[4]),t}function wa(e){switch(e){case"aave":return H.Aave;case"zerolend":return H.ZeroLend;case"morpho":return H.Morpho;case"v3":return H.BalancerV3;default:return H.BalancerV2}}const ba=[{inputs:[{components:[{name:"protocolName",type:"string"},{name:"data",type:"bytes"}],name:"instructions",type:"tuple[]"},{name:"caller",type:"address"}],name:"deauthorizeInstructions",outputs:[{name:"targets",type:"address[]"},{name:"data",type:"bytes[]"}],stateMutability:"view",type:"function"}],xa="0x095ea7b3",Aa=e=>{if(!e||e==="0x"||e.length<10)return!1;try{const t=Ls({abi:fn,data:e});return t.functionName==="approve"?t.args?.[1]===0n:!1}catch{try{if(e.slice(0,10).toLowerCase()!==xa)return!1;const[,n]=Br([{type:"address"},{type:"uint256"}],e.slice(10));return n===0n}catch{return!1}}},Ea=e=>{const n=(e?.message||"").toLowerCase(),r=["user rejected","user denied","user cancelled","rejected","denied","cancelled"],s=[4001,"ACTION_REJECTED","USER_REJECTED"];return r.some(i=>n.includes(i))||s.includes(e?.code)},mr=e=>{if(!e)return"";if(typeof e=="string"&&e.startsWith("0x"))return e;if(typeof e=="object"&&e!==null){if("data"in e&&typeof e.data=="string")return e.data;const n=String(e).match(/(0x[a-fA-F0-9]{8,})/);return n?n[1]:""}return""},Ca=e=>{const t=e?.message||"";let n=mr(e?.cause?.data)||mr(e?.data)||"";if(!n&&t){const r=t.match(/return data: (0x[a-fA-F0-9]+)/i)||t.match(/data: (0x[a-fA-F0-9]+)/i)||t.match(/(0x[a-fA-F0-9]{8,})/);r&&(n=r[1])}return n},va=e=>{if(Ea(e))return"User rejected the request";const t=Ca(e);if(t&&t.length>=10){const n=Hs(t),r=dn(n);return r.suggestion?`${r.title}: ${r.description} ${r.suggestion}`:`${r.title}: ${r.description}`}return e.shortMessage||e.message||"Failed to execute instructions"},Na=e=>!!(!e.target||!e.data||e.data.length===0||Aa(e.data)),rn=(e,t)=>t?![59144,9745].includes(e):!1,sn=e=>e.filter(t=>!Na(t)),on=e=>e.filter(({target:t,data:n})=>t&&n&&n.length>0),gr=()=>{const{address:e}=vr(),{data:t}=zs({contractName:"KapanRouter"}),n=Rs(),{data:r}=Ms(),s=Bs(),i=Ir(),a={8453:1,84531:1,84532:1,10:1,420:1,11155420:1,42161:1,421614:1,59144:1,59141:1,31337:1}[i]??1,{writeContract:c,writeContractAsync:u,data:l,isPending:h}=Si(),{isLoading:B,isSuccess:C}=Oi({hash:l,confirmations:a,pollingInterval:1e3}),[X,L]=S.useState(!1),[G,Et]=S.useState(void 0),[ut,ae]=S.useState(!1),{data:zt}=Bi({account:e}),$=`0x${i.toString(16)}`,Kt=zt?.[$]?.atomic?.status,Ct=Kt==="supported"||Kt==="ready",{sendCallsAsync:qt}=ki(),{data:Rt,isSuccess:nt,isError:Wt}=Ii({id:G,query:{enabled:!!G}}),[Xt,ce]=S.useState(null);S.useEffect(()=>{if(!G||ut)return;const p=U.loading(v.jsx(rt,{step:"sent",message:"Transaction submitted — waiting for confirmation..."}));return ce(p),()=>{p&&U.remove(p)}},[G,ut]),S.useEffect(()=>{!G||!Rt||ut||(Xt&&(U.remove(Xt),ce(null)),nt?U.success(v.jsx(rt,{step:"confirmed",message:"Transaction confirmed!"})):Wt&&U.error(v.jsx(rt,{step:"failed",message:"Transaction failed"})))},[G,Rt,nt,Wt,Xt,ut]),S.useEffect(()=>{(C||nt)&&(Promise.all([s.refetchQueries({queryKey:["readContract"],type:"active"}),s.refetchQueries({queryKey:["readContracts"],type:"active"}),s.refetchQueries({queryKey:["balance"],type:"active"}),s.refetchQueries({queryKey:["token"],type:"active"}),s.refetchQueries({queryKey:["morpho-positions"],type:"active"}),s.refetchQueries({queryKey:["morpho-markets-support"],type:"active"})]).catch(f=>Nt.warn("Post-tx refetch err:",f)),typeof window<"u"&&window.dispatchEvent(new Event("txCompleted")))},[C,nt,s]);const vt=S.useCallback(p=>xe([{type:"address"}],[p]),[]),us=S.useCallback((p,f,d,g=18,b="0x")=>{if(!e)return[];const A=Q(p),y=ct(d,g),I=A==="compound"||A==="morpho-blue"?k.DepositCollateral:k.Deposit;return[N(ve(y,f,e)),N(K(0,A)),_(A,R(I,f,e,0n,b,0))]},[e]),ls=S.useCallback((p,f,d,g=18,b="0x")=>{if(!e)return[];const A=Q(p),y=ct(d,g);return[_(A,R(k.Borrow,f,e,y,b,999)),N(dt(0,e))]},[e]),fs=S.useCallback((p,f,d,g=18,b=!1)=>{if(!e)return[];const A=Q(p);if(b||d.toLowerCase()==="max")return[];const y=ct(d,g);return[N(ve(y,f,e)),N(K(0,A)),_(A,R(k.Repay,f,e,0n,"0x",0)),N(dt(2,e))]},[e]),ds=S.useCallback(async(p,f,d,g=18,b=!1,A,y="0x")=>{if(!e||!n)return[];const E=Q(p);let x;if(b||d.toLowerCase()==="max"){const I=await n.readContract({address:f,abi:fn,functionName:"balanceOf",args:[e]});A!==void 0&&A<I?x=A:x=I}else x=ct(d,g);return[N(ve(x,f,e)),N(K(0,E)),_(E,R(k.GetBorrowBalance,f,e,0n,y,999)),_(E,R(k.Repay,f,e,0n,y,b?2:0)),N(dt(3,e))]},[e,n]),ps=S.useCallback((p,f,d,g=18,b=!1,A="0x")=>{if(!e)return[];const y=Q(p),E=b||d.toLowerCase()==="max"?2n**256n-1n:ct(d,g);return[_(y,R(k.GetSupplyBalance,f,e,0n,A,0)),_(y,R(k.WithdrawCollateral,f,e,E,A,b?0:999)),N(dt(1,e))]},[e]),hs=S.useCallback((p,f,d,g,b,A,y,E="0x",x=!1,I=H.BalancerV2,O=!1,V="oneinch")=>{if(!e)return[];const W=Q(p),at=ct(g,y),J=BigInt(b),j=W==="compound"?k.DepositCollateral:k.Deposit,z=k.WithdrawCollateral,Lt=xe([{type:"address"},{type:"uint256"},{type:"bytes"}],[d,J,A]),ht=O?k.SwapExactOut:k.Swap,ft=x&&(I===H.Aave||I===H.ZeroLend),Gt=9;return ft?[_(W,R(k.GetSupplyBalance,f,e,0n,E,999)),N(ea(0,Gt)),N(jt(I,2)),N(K(2,V)),_(V,R(ht,f,e,0n,Lt,2)),N(K(5,W)),_(W,R(j,d,e,0n,E,5)),_(W,R(z,f,e,0n,E,3)),N(dt(6,e))]:[x?_(W,R(k.GetSupplyBalance,f,e,0n,E,999)):N(te(at,f)),N(jt(I,0)),N(K(1,V)),_(V,R(ht,f,e,0n,Lt,1)),N(K(3,W)),_(W,R(j,d,e,0n,E,3)),_(W,R(z,f,e,0n,E,1))]},[e]),ms=S.useCallback(p=>{if(!e)return[];const{protocolName:f,collateralToken:d,debtToken:g,initialCollateral:b,flashLoanAmount:A,minCollateralOut:y,swapData:E,collateralDecimals:x=18,debtDecimals:I=18,flashLoanProvider:O=H.BalancerV2,market:V,morphoContext:W,includeRefundPush:at=!0,swapRouter:J="oneinch",zapMode:lt=!1,depositAmount:j}=p,z=Q(f),Lt=z==="compound",ht=z==="morpho-blue",ft=ht&&W?W:Lt&&V?vt(V):"0x",Gt=Lt||ht?k.DepositCollateral:k.Deposit,Pe=ct(b,x),Ye=ct(A,I),Es=ct(y,x),Xe=j?ct(j,I):0n,Ln=xe([{type:"address"},{type:"uint256"},{type:"bytes"}],[d,Es,E]);return Nt.debug("[buildMultiplyFlow] zapMode:",lt,"depositAmountRaw:",Xe.toString(),"flashAmount:",Ye.toString()),lt&&Xe>0n?[N(ve(Xe,g,e)),N(te(Ye,g)),N(jt(O,1)),N(na(0,1)),N(K(3,J)),_(J,R(k.Swap,g,e,0n,Ln,3)),N(K(5,z)),_(z,R(Gt,d,e,0n,ft,5)),_(z,R(k.Borrow,g,e,0n,ft,2)),...at?[N(dt(6,e))]:[]]:[N(ve(Pe,d,e)),N(K(0,z)),_(z,R(Gt,d,e,0n,ft,0)),N(te(Ye,g)),N(jt(O,2)),N(K(2,J)),_(J,R(k.Swap,g,e,0n,Ln,2)),N(K(5,z)),_(z,R(Gt,d,e,0n,ft,5)),_(z,R(k.Borrow,g,e,0n,ft,3)),...at?[N(dt(6,e))]:[]]},[e,vt]),gs=S.useCallback((p,f,d,g,b,A,y=H.BalancerV2,E="0x",x=!1,I="oneinch")=>{if(!e)return[];const O=Q(p),V=xe([{type:"address"},{type:"uint256"},{type:"bytes"}],[d,b,A]);return[x?_(O,R(k.GetBorrowBalance,d,e,0n,E,999)):N(te(b,d)),N(jt(y,0)),N(K(1,O)),_(O,R(k.Repay,d,e,0n,E,0)),N(te(g,f)),_(O,R(k.WithdrawCollateral,f,e,0n,E,4)),N(K(5,I)),_(I,R(k.SwapExactOut,f,e,0n,V,5)),N(dt(8,e))]},[e]),ys=S.useCallback((p,f,d,g,b,A,y=H.BalancerV2,E="0x",x=!1,I="oneinch")=>{if(!e)return[];const O=Q(p),V=xe([{type:"address"},{type:"uint256"},{type:"bytes"}],[f,g,A]);return x?[_(O,R(k.GetBorrowBalance,f,e,0n,E,999)),N(te(b,d)),N(jt(y,1)),N(K(1,I)),_(I,R(k.SwapExactOut,d,e,0n,V,1)),N(K(4,O)),_(O,R(k.Repay,f,e,0n,E,0)),N(dt(7,e)),N(dt(5,e)),_(O,R(k.Borrow,d,e,0n,E,2))]:[N(te(b,d)),N(jt(y,0)),N(K(0,I)),_(I,R(k.SwapExactOut,d,e,0n,V,0)),N(K(3,O)),_(O,R(k.Repay,f,e,0n,E,3)),N(dt(6,e)),N(dt(4,e)),_(O,R(k.Borrow,d,e,0n,E,1))]},[e]),_t=S.useCallback(async p=>{if(!t||!e||!n)return[];try{const f=p.map(y=>({protocolName:Q(y.protocolName),data:y.data}));Nt.info("[getAuthorizations] Calling authorizeInstructions with",f.length,"instructions"),Nt.debug("[getAuthorizations] Instructions:",f.map(y=>y.protocolName));const d=await n.readContract({address:t.address,abi:t.abi,functionName:"authorizeInstructions",args:[f,e],blockTag:"pending"}),[g,b]=d;Nt.info("[getAuthorizations] Raw result:",{targetsCount:g.length,targets:g.map((y,E)=>({index:E,target:y,hasData:b[E]?.length>2}))});const A=[];for(let y=0;y<g.length;y++){const E=g[y],x=b[y],I=E&&E!=="0x0000000000000000000000000000000000000000"&&x&&x.length>0;Nt.debug(`[getAuthorizations] Index ${y}: target=${E}, dataLen=${x?.length}, isValid=${I}`),I&&A.push({target:E,data:x})}return Nt.info("[getAuthorizations] Filtered auth calls:",A.length),A}catch(f){return console.error("Error calling authorizeInstructions:",f),Nt.error("[getAuthorizations] Error:",f),[]}},[t,e,n]),Jt=S.useCallback(async p=>{if(!t||!e||!n)return[];try{const f=p.map(y=>({protocolName:Q(y.protocolName),data:y.data})),d=await n.readContract({address:t.address,abi:ba,functionName:"deauthorizeInstructions",args:[f,e],blockTag:"pending"}),[g,b]=d,A=[];for(let y=0;y<g.length;y++){const E=g[y],x=b[y];E&&E!=="0x0000000000000000000000000000000000000000"&&x&&x.length>0&&A.push({target:E,data:x})}return A}catch(f){return console.error("Error calling deauthorizeInstructions:",f),[]}},[t,e,n]),vn=S.useCallback(p=>{if(p.length===0||p.length>4)return!1;const f=new Set([k.Deposit,k.DepositCollateral,k.WithdrawCollateral,k.Borrow,k.Repay,k.GetBorrowBalance,k.GetSupplyBalance]);return p.every(d=>{if(d.protocolName==="router")return!0;try{const[g]=Br([{type:"tuple(uint8 op,address token,address user,uint256 amount,bytes context,tuple(uint256 index) input)"}],d.data),b=Number(g.op);return f.has(b)}catch{return!1}})},[]),Nn=S.useCallback(p=>/health.?factor|liquidation|borrow.?cap|supply.?cap|frozen|paused|insufficient.?collateral|siloed|isolation.?mode|debt.?ceiling/i.test(p),[]),Le=S.useCallback(p=>p.suggestion?`${p.title}: ${p.description} ${p.suggestion}`:`${p.title}: ${p.description}`,[]),Bn=S.useCallback(async(p,f,d)=>{for(const{target:g,data:b}of p){if(!g||!b)continue;const A=await Fn(f,g,b,d);if(!A.success&&A.error){const y=dn(A.error);throw new Error(Le(y))}}},[Le]),kn=S.useCallback((p,f)=>{if(p.success||!p.error)return;const d=dn(p.error),g=`${d.description||""} ${d.title||""}`.toLowerCase();if(!(f&&!Nn(g)))throw new Error(Le(d))},[Nn,Le]),ws=S.useCallback(async(p,f)=>{if(!t||!e||!n)throw new Error("Router contract or user address not available");if(vn(p))return;const d=await _t(p);if(f?.skipWhenAuthCallsExist&&d.length>0)return;await Bn(d,n,e);const g=p.map(y=>({protocolName:y.protocolName,data:y.data})),b=Qe({abi:t.abi,functionName:"processProtocolInstructions",args:[g]}),A=await Fn(n,t.address,b,e);kn(A,d.length>0)},[t,e,n,_t,vn,Bn,kn]),Te=S.useCallback(async p=>{if(!t||!e)throw new Error("Router contract or user address not available");let f=null,d,g="";try{f=U.loading(v.jsx(rt,{step:"pending",message:"Waiting for approval..."}));const b=setTimeout(()=>{f&&U.remove(f)},1e4);try{const y=p.map(E=>({protocolName:E.protocolName,data:E.data}));d=await u({address:t.address,abi:t.abi,functionName:"processProtocolInstructions",args:[y]}),clearTimeout(b)}catch(y){throw clearTimeout(b),y}const A=await n?.getChainId();return g=A?_s(A,d):"",f&&U.remove(f),f=U.loading(v.jsx(rt,{step:"sent",txHash:d,message:"Waiting for transaction to complete.",blockExplorerLink:g})),n&&d&&await n.waitForTransactionReceipt({hash:d,confirmations:a,pollingInterval:1e3}),f&&U.remove(f),U.success(v.jsx(rt,{step:"confirmed",txHash:d,message:"Transaction completed successfully!",blockExplorerLink:g})),d}catch(b){f&&U.remove(f),console.error("Error executing instructions:",b);const A=va(b);throw U.error(v.jsx(rt,{step:"failed",txHash:d,message:A,blockExplorerLink:g})),new Error(A)}},[t,e,u,n,a]),In=S.useCallback(async p=>{if(!n||!r||!e)return;const f=p.target;let d=f.substring(0,6)+"...";try{d=await n.readContract({address:f,abi:fn,functionName:"symbol",args:[]})}catch{}let g=null;try{g=U.loading(v.jsx(rt,{step:"pending",message:`Approving ${d}...`}));const b=await n.getTransactionCount({address:e}),A=await r.sendTransaction({account:e,to:p.target,data:p.data,nonce:b});U.remove(g),g=U.loading(v.jsx(rt,{step:"sent",txHash:A,message:`Approving ${d}...`})),await n.waitForTransactionReceipt({hash:A,confirmations:a,pollingInterval:1e3}),await new Promise(y=>setTimeout(y,100)),U.remove(g),U.success(v.jsx(rt,{step:"confirmed",txHash:A,message:`${d} approved`}))}catch(b){throw g&&U.remove(g),b}},[n,r,e,a]),On=S.useCallback(async p=>{if(!n||!r||!e||!p.target||!p.data)return;let f=null;try{f=U.loading(v.jsx(rt,{step:"pending",message:"Revoking permissions..."}));const d=await n.getTransactionCount({address:e}),g=await r.sendTransaction({account:e,to:p.target,data:p.data,nonce:d});U.remove(f),f=U.loading(v.jsx(rt,{step:"sent",txHash:g,message:"Revoking permissions..."})),await n.waitForTransactionReceipt({hash:g,confirmations:a,pollingInterval:1e3}),U.remove(f),U.success(v.jsx(rt,{step:"confirmed",txHash:g,message:"Permissions revoked"}))}catch{f&&U.remove(f)}},[n,r,e,a]),Sn=S.useCallback(async p=>{const f=sn(p);for(const d of f)L(!0),await In(d),L(!1)},[In]),Rn=S.useCallback(async p=>{const f=on(p);for(const d of f)await On(d)},[On]),_n=S.useCallback((p,f)=>{if(!t)return[];const d={to:t.address,data:Qe({abi:t.abi,functionName:"processProtocolInstructions",args:[p.map(b=>({protocolName:b.protocolName,data:b.data}))]}),value:0n},g=f.map(b=>({to:b.target,data:b.data,value:0n}));return[d,...g]},[t]),Ze=S.useCallback(async(p,f)=>{if(!t||!e||!n||!r)throw new Error("Context not available");try{const d=await _t(p);if(d.length===0)return await Te(p);if(await Sn(d),Ct&&qt){const b=f?.revokePermissions?await Jt(p):[],A=_n(p,b),{id:y}=await qt({calls:A,capabilities:zt});return Et(y),y}const g=await Te(p);if(rn(i,f?.revokePermissions))try{const b=await Jt(p);await Rn(b)}catch(b){Nt.warn("Deauthorization check failed",b)}return g}catch(d){throw L(!1),console.error("Error in executeFlowWithApprovals:",d),d}},[t,e,n,r,_t,Te,Sn,Ct,qt,zt,_n,Jt,Rn,i]),Ve=S.useCallback(p=>{if(!t)throw new Error("Router contract not available");const f=p.map(d=>({protocolName:d.protocolName,data:d.data}));return Qe({abi:t.abi,functionName:"processProtocolInstructions",args:[f]})},[t]),bs=S.useCallback(async(p,f)=>{if(!t||!e)throw new Error("Missing context");const d=Ve(p),g=await _t(p),b=sn(g),A=rn(i,f?.revokePermissions)?await Jt(p):[],y=on(A);return[...b.map(({target:E,data:x})=>({to:E,data:x})),{to:t.address,data:d},...y.map(({target:E,data:x})=>({to:E,data:x}))]},[t,e,Ve,_t,Jt,i]),xs=S.useCallback(async(p,f=!1,d)=>{if(!t||!e||!n||!r)throw new Error("Missing context");const g=Ve(p),b=await _t(p),A=sn(b),y=rn(i,d?.revokePermissions)?await Jt(p):[],E=on(y),x=[...A.map(({target:O,data:V})=>({to:O,data:V})),{to:t.address,data:g},...E.map(({target:O,data:V})=>({to:O,data:V}))];if(Nt.info("[executeFlowBatchedIfPossible] Call order:",{authCallsCount:A.length,authCalls:A.map(O=>({to:O.target,dataPrefix:O.data?.slice(0,10)})),mainCall:{to:t.address,dataPrefix:g.slice(0,10)},deauthCallsCount:E.length,totalCalls:x.length,callOrder:x.map((O,V)=>({index:V,to:O.to,dataPrefix:O.data?.slice(0,10)}))}),f){const{id:O}=await qt({calls:x,experimental_fallback:!0});Et(O);const V=U.loading(v.jsx(rt,{step:"sent",message:"Batch transaction sent — waiting for confirmation..."}));return ce(V),{kind:"batch",id:O}}const I=await Ze(p,d);return I?{kind:"tx",hash:I}:void 0},[t,e,n,r,Ve,_t,qt,Ze,Jt,i]),As=S.useCallback(()=>{if(!e){const x=()=>{};return{buildUnlockDebt:x,buildMoveCollateral:x,buildBorrow:x,setCompoundMarket:x,build:()=>[],getFlashObligations:()=>({})}}const p=[],f=new Map;let d=null,g=0;const b=(x,I=!1)=>(p.push(x),I&&g++,p.length-1),A=(x,I=!1)=>b(N(x),I),y=(x,I,O=!1)=>b(_(x,I),O),E=(x,I="0x")=>x==="compound"&&d?vt(d):I;return{buildUnlockDebt:({fromProtocol:x,debtToken:I,expectedDebt:O,debtDecimals:V=18,fromContext:W="0x",flash:{version:at}})=>{const J=Q(x);if(ct(O,V)===0n)throw new Error("Invalid debt amount");const j=J==="compound"?E(J,vt(I)):E(J,W),z=g;y(J,R(k.GetBorrowBalance,I,e,0n,j,999),!0);const Lt=wa(at),ht=jt(Lt,z),ft=g;A(ht,!0),f.set(I.toLowerCase(),ft),A(K(ft,J),!0),y(J,R(k.Repay,I,e,0n,j,z),!0)},buildMoveCollateral:({fromProtocol:x,toProtocol:I,collateralToken:O,withdraw:V,collateralDecimals:W=18,fromContext:at="0x",toContext:J="0x"})=>{const lt=Q(x),j=Q(I),z=lt==="compound"?E(lt,vt(O)):E(lt,at),Lt=j==="compound"&&d?E(j,vt(d)):E(j,J);let ht;"max"in V&&V.max&&(ht=g,y(lt,R(k.GetSupplyBalance,O,e,0n,z,999),!0));const ft="amount"in V?ct(V.amount,W):0n,Gt=g;y(lt,R(k.WithdrawCollateral,O,e,ft,z,"max"in V&&V.max&&ht!==void 0?ht:999),!0),A(K(Gt,j),!0);const Pe=j==="morpho-blue"?k.DepositCollateral:k.Deposit;y(j,R(Pe,O,e,0n,Lt,Gt),!1)},buildBorrow:x=>{const{toProtocol:I,token:O,toContext:V="0x",approveToRouter:W=!0}=x,at=Q(I);let J=0n;x.mode==="exact"&&(J=ct(x.amount,x.decimals??18));const lt=at==="compound"&&d?E(at,vt(d)):E(at,V),j=g,z=x.mode==="coverFlash"?f.get(O.toLowerCase())??999:999;y(at,R(k.Borrow,O,e,J,lt,z),!0),W&&x.mode!=="coverFlash"&&A(K(j,"router"),!0)},setCompoundMarket:x=>{d=x},build:()=>p,getFlashObligations:()=>{const x={};for(const[I,O]of f.entries())x[I]={flashLoanUtxoIndex:O};return x}}},[e,vt]);return{buildDepositFlow:us,buildBorrowFlow:ls,buildRepayFlow:fs,buildRepayFlowAsync:ds,buildWithdrawFlow:ps,buildCollateralSwapFlow:hs,buildMultiplyFlow:ms,buildCloseWithCollateralFlow:gs,buildDebtSwapFlow:ys,createMoveBuilder:As,simulateInstructions:ws,executeInstructions:Te,executeFlowWithApprovals:Ze,executeFlowBatchedIfPossible:xs,buildFlowCalls:bs,getAuthorizations:_t,getDeauthorizations:Jt,sendCallsAsync:qt,setBatchId:Et,setSuppressBatchNotifications:ae,routerContract:t,hash:l,isPending:h,isConfirming:B,isConfirmed:C,isApproving:X,writeContract:c,batchId:G,batchStatus:Rt,isBatchConfirmed:nt,canDoAtomicBatch:Ct,isAnyConfirmed:C||nt}};try{gr.displayName="useKapanRouterV2",gr.__docgenInfo={description:"Hook for building and executing instructions on KapanRouter v2",displayName:"useKapanRouterV2",props:{}}}catch{}const fe="Balancer V2",Me="Balancer V3";function Z(e,t){if(!e)throw new Error(`Missing required address: ${t}`);return e}function Vc(e,t){const n=ri[e];if(n)return`${n}/address/${t}`}function Pc(e){return ii(e)}function Ba(e){return Or[e]}function yr(e){return ci(e)}Z(st[1],"AAVE_V3_POOLS[1]"),Z(st[42161],"AAVE_V3_POOLS[42161]"),Z(st[8453],"AAVE_V3_POOLS[8453]"),Z(st[10],"AAVE_V3_POOLS[10]"),Z(st[137],"AAVE_V3_POOLS[137]"),Z(st[59144],"AAVE_V3_POOLS[59144]"),Z(st[43114],"AAVE_V3_POOLS[43114]");const os={1:[{address:Z(tn[1],"MORPHO_BLUE[1]"),provider:"morpho",feeBps:0,name:"Morpho Blue"},{address:mt.v2Vault,provider:"balancerV2",feeBps:0,name:fe},{address:mt.v3Vault,provider:"balancerV3",feeBps:0,name:Me},{address:Z(st[1],"AAVE_V3_POOLS[1]"),provider:"aaveV3",feeBps:5,name:"Aave V3"}],8453:[{address:Z(tn[8453],"MORPHO_BLUE[8453]"),provider:"morpho",feeBps:0,name:"Morpho Blue"},{address:mt.v2Vault,provider:"balancerV2",feeBps:0,name:fe},{address:mt.v3Vault,provider:"balancerV3",feeBps:0,name:Me},{address:Z(st[8453],"AAVE_V3_POOLS[8453]"),provider:"aaveV3",feeBps:5,name:"Aave V3"}],42161:[{address:Z(tn[42161],"MORPHO_BLUE[42161]"),provider:"morpho",feeBps:0,name:"Morpho Blue"},{address:mt.v2Vault,provider:"balancerV2",feeBps:0,name:fe},{address:mt.v3Vault,provider:"balancerV3",feeBps:0,name:Me},{address:Z(st[42161],"AAVE_V3_POOLS[42161]"),provider:"aaveV3",feeBps:5,name:"Aave V3"}],10:[{address:mt.v2Vault,provider:"balancerV2",feeBps:0,name:fe},{address:mt.v3Vault,provider:"balancerV3",feeBps:0,name:Me},{address:Z(st[10],"AAVE_V3_POOLS[10]"),provider:"aaveV3",feeBps:5,name:"Aave V3"}],137:[{address:mt.v2Vault,provider:"balancerV2",feeBps:0,name:fe},{address:Z(st[137],"AAVE_V3_POOLS[137]"),provider:"aaveV3",feeBps:5,name:"Aave V3"}],100:[{address:mt.v2Vault,provider:"balancerV2",feeBps:0,name:fe}],59144:[{address:Z(st[59144],"AAVE_V3_POOLS[59144]"),provider:"aaveV3",feeBps:5,name:"Aave V3"}],43114:[{address:Z(st[43114],"AAVE_V3_POOLS[43114]"),provider:"aaveV3",feeBps:5,name:"Aave V3"}]},ka={morpho:0,aaveV3:5,balancerV2:0};function Uc(e){return os[e]??[]}function Fc(e,t){const n=os[e];if(!n||n.length===0)return;if(t){const s=n.find(i=>i.provider===t);if(s)return{address:s.address,provider:s.provider,feeBps:s.feeBps}}const r=n[0];return{address:r.address,provider:r.provider,feeBps:r.feeBps}}function Ia(e="aaveV3"){return ka[e]??5}function Dc(e,t="aaveV3"){const n=Ia(t);return e*BigInt(n)/10000n}var an,wr;function Oa(){return wr||(wr=1,an={space:"",cycles:!1,replacer:(e,t)=>t,stringify:JSON.stringify}),an}var cn,br;function ee(){return br||(br=1,cn={isArray:Array.isArray,assign:Object.assign,isObject:e=>typeof e=="object",isFunction:e=>typeof e=="function",isBoolean:e=>typeof e=="boolean",isRegex:e=>e instanceof RegExp,keys:Object.keys}),cn}var un,xr;function Sa(){if(xr)return un;xr=1;const e=Oa(),t=ee().isFunction,n=ee().isBoolean,r=ee().isObject,s=ee().isArray,i=ee().isRegex,o=ee().assign,a=ee().keys;function c(l){return l==null?l:i(l)?l.toString():l.toJSON?l.toJSON():l}function u(l,h){h=h||o({},e),t(h)&&(h={compare:h});const B=h.space||e.space,C=n(h.cycles)?h.cycles:e.cycles,X=h.replacer||e.replacer,L=h.stringify||e.stringify,G=h.compare&&(function(ut){return function(ae){return function(zt,$){const Kt={key:zt,value:ae[zt]},Ct={key:$,value:ae[$]};return ut(Kt,Ct)}}})(h.compare);C||L(l);const Et=[];return(function ut(ae,zt,$,Kt){const Ct=B?`
`+new Array(Kt+1).join(B):"",qt=B?": ":":";if($=c($),$=X.call(ae,zt,$),$!==void 0){if(!r($)||$===null)return L($);if(s($)){const Rt=[];for(let nt=0;nt<$.length;nt++){const Wt=ut($,nt,$[nt],Kt+1)||L(null);Rt.push(Ct+B+Wt)}return"["+Rt.join(",")+Ct+"]"}else{if(C){if(Et.indexOf($)!==-1)return L("[Circular]");Et.push($)}const Rt=a($).sort(G&&G($)),nt=[];for(let Wt=0;Wt<Rt.length;Wt++){const Xt=Rt[Wt],ce=ut($,Xt,$[Xt],Kt+1);if(!ce)continue;const vt=L(Xt)+qt+ce;nt.push(Ct+B+vt)}return Et.splice(Et.indexOf($),1),"{"+nt.join(",")+Ct+"}"}}})({"":l},"",l,0)}return un=u,un}var Ra=Sa();const as=js(Ra),de={retries:3,baseDelay:1e3,maxDelay:3e4,backoffMultiplier:2,jitter:!0,isRetryable:()=>!0};function _a(e,t,n,r,s){let i=Math.min(t*Math.pow(r,e),n);return s&&(i=i+i*Math.random()*.25),Math.round(i)}function La(e,t){return new Promise((n,r)=>{if(t?.aborted){r(new DOMException("Aborted","AbortError"));return}const s=setTimeout(n,e);t&&t.addEventListener("abort",()=>{clearTimeout(s),r(new DOMException("Aborted","AbortError"))},{once:!0})})}function Ta(e){return e instanceof DOMException&&e.name==="AbortError"}function Va(e){if(e?.aborted)throw new DOMException("Aborted","AbortError")}function Pa(e,t,n,r){return Ta(n)?!1:e<t&&r(n)}function Ua(e,t,n,r,s){s&&s(e+1,n,r)}async function Fa(e,t={}){const{retries:n=de.retries,baseDelay:r=de.baseDelay,maxDelay:s=de.maxDelay,backoffMultiplier:i=de.backoffMultiplier,jitter:o=de.jitter,isRetryable:a=de.isRetryable,onRetry:c,signal:u}=t;let l;for(let h=0;h<=n;h++){Va(u);try{return await e()}catch(B){if(l=B,!Pa(h,n,B,a))throw B;const C=_a(h,r,s,i,o);Ua(h,n,B,C,c),await La(C,u)}}throw l}class Da extends Error{constructor(t,n,r){super(`HTTP ${t} ${n} from ${r}`),this.status=t,this.statusText=n,this.url=r,this.name="RetryableHttpError"}}function $a(e){if(e instanceof TypeError){const t=e.message.toLowerCase();return t.includes("fetch")||t.includes("network")||t.includes("failed to fetch")||t.includes("load failed")||t.includes("networkerror")}return!1}function Ma(e){if(e instanceof Da)return e.status===429;if(e instanceof Error){const t=e.message.toLowerCase();return t.includes("rate limit")||t.includes("too many requests")}return!1}const Ha=["function executePreHookBySalt(address user, bytes32 salt) external","function executePostHookBySalt(address user, bytes32 salt) external"],cs=new wt(Ha),za=["function approve(address token, address target, uint256 amount) external"],Ka=["function transfer(address to, uint256 amount) external returns (bool)","function transferFrom(address from, address to, uint256 amount) external returns (bool)"],qa=["function fundOrder(address token, address recipient, uint256 amount) external"];new wt(za);new wt(Ka);const Wa=new wt(qa);function Ar(e,t){return oi.map(r=>r.toLowerCase()).includes(e.toLowerCase())?t&&$n[t]?$n[t]:Dn.aaveBorrower:(e.toLowerCase()===mt.v2Vault.toLowerCase()&&(console.error("[getCowBorrower] ERROR: Balancer V2 is NOT supported by CoW FlashLoanRouter!"),console.error("[getCowBorrower] Balancer V2 does not implement ERC-3156. Order will fail!"),console.error("[getCowBorrower] Use getCowFlashLoanLender() to get a supported lender (Aave V3).")),Dn.erc3156Borrower)}function Ja(e,t,n){return Wa.encodeFunctionData("fundOrder",[e,t,n])}function Ga(e,t,n){return cs.encodeFunctionData("executePreHookBySalt",[t,n])}function ja(e,t,n){return cs.encodeFunctionData("executePostHookBySalt",[t,n])}function Za(e,t,n,r,s){const i=s?.preHookGasLimit??"800000",o=s?.postHookGasLimit??"1750000",a=Ga(e,t,n),c=ja(e,t,n);let u,l;if(s?.flashLoan){const B=yr(r);if(B){const C=Ja(s.flashLoan.token,e,s.flashLoan.amount);u=[{target:B,callData:C,gasLimit:"100000",dappId:"kapan://flashloans/adapter/fund"},{target:e,callData:a,gasLimit:i,dappId:"kapan://flashloans/pre-hook"}],l=[{target:e,callData:c,gasLimit:o,dappId:"kapan://flashloans/post-hook"}]}else{const C=Ar(s.flashLoan.lender,r);console.warn(`[buildKapanAppData] KapanCowAdapter not deployed on chain ${r}. Using standard borrower ${C}. Flash loan may not work correctly.`),u=[{target:C,callData:a,gasLimit:i,dappId:"kapan://flashloans/aave/v3/leverage"}],l=[{target:e,callData:c,gasLimit:o,dappId:"kapan://flashloans/aave/v3/leverage"}]}}else u=[{target:e,callData:a,gasLimit:i}],l=[{target:e,callData:c,gasLimit:o}];const h={version:"1.10.0",appCode:"KapanFinance",metadata:{hooks:{pre:u,post:l}}};if(s?.flashLoan){const B=yr(r),C=B||Ar(s.flashLoan.lender,r),X=s.flashLoan.amount,L=s.flashLoan.token;console.log("[buildKapanAppData] Flash loan metadata:",{liquidityProvider:s.flashLoan.lender,protocolAdapter:C,receiver:C,token:L,amount:X.toString(),usingKapanAdapter:!!B}),h.metadata.flashloan={liquidityProvider:s.flashLoan.lender,protocolAdapter:C,receiver:C,token:L,amount:X.toString()}}return s?.partnerFeeBps&&s?.partnerFeeRecipient&&(h.metadata.partnerFee={bps:s.partnerFeeBps,recipient:s.partnerFeeRecipient}),s?.slippageBps&&(h.metadata.quote={slippageBps:s.slippageBps}),h}function Ya(e){const t=as(e);return St(Je(t))}async function Xa(e,t,n){if(!Ba(e))return{success:!1,error:`Chain ${e} not supported by CoW Protocol`};console.log("[registerAppData] Chain ID:",e);const s=as(n);console.log("[registerAppData] Registering appData:"),console.log("[registerAppData] Full JSON:",s),n.metadata.flashloan&&console.log("[registerAppData] Flash loan config:",JSON.stringify(n.metadata.flashloan,null,2)),n.metadata.hooks&&(console.log("[registerAppData] Pre-hooks:",n.metadata.hooks.pre?.length||0),console.log("[registerAppData] Post-hooks:",n.metadata.hooks.post?.length||0));const i=JSON.stringify({fullAppData:s});console.log("[registerAppData] Request body:",i);const o=`/api/cow/${e}/app-data`;console.log("[registerAppData] Using proxy:",o);try{return await Fa(async()=>{const a=await fetch(o,{method:"PUT",headers:{"Content-Type":"application/json"},body:i});if(a.status===429)throw new Error("CoW API rate limit exceeded");if(a.ok||a.status===200||a.status===201){const l=await a.json(),h=l.appDataHash||l;return console.log("[registerAppData] Success! Computed hash:",h),{success:!0,computedHash:typeof h=="string"?h:void 0}}if(a.status===409)return{success:!0};const c=await a.text();console.error("[registerAppData] API error response:",c),console.error("[registerAppData] Request body was:",s),console.error("[registerAppData] Full appData document:",JSON.stringify(n,null,2));let u=c;try{const l=JSON.parse(c);l.description?u=l.description:l.errorType&&(u=`${l.errorType}: ${l.description||c}`)}catch{}if(a.status>=400&&a.status<500)return{success:!1,error:`API error ${a.status}: ${u}`};throw new Error(`API error ${a.status}: ${u}`)},{retries:2,baseDelay:1e3,isRetryable:a=>!!($a(a)||Ma(a)||a instanceof Error&&a.message.startsWith("API error 5")),onRetry:(a,c,u)=>{console.warn(`[registerAppData] Retry ${a}, waiting ${u}ms`,c)}})}catch(a){return console.error("[registerAppData] All retries failed:",a),{success:!1,error:`Network error: ${a}`}}}async function $c(e,t,n,r,s){const i=Za(t,n,r,e,s),o=await Xa(e,"",i),a=o.computedHash||Ya(i);return o.computedHash?console.log("[buildAndRegisterAppData] Using API-computed hash:",o.computedHash):console.log("[buildAndRegisterAppData] Using locally-computed hash:",a),{appDataDoc:i,appDataHash:a,registered:o.success,error:o.error}}var Qa=(e=>(e[e.TargetLTV=0]="TargetLTV",e[e.TargetBalance=1]="TargetBalance",e[e.Iterations=2]="Iterations",e[e.UntilCancelled=3]="UntilCancelled",e))(Qa||{}),tc=(e=>(e[e.None=0]="None",e[e.Active=1]="Active",e[e.Completed=2]="Completed",e[e.Cancelled=3]="Cancelled",e))(tc||{});const Er=Mt.defaultAbiCoder();function ec(e){return!e||e.length===0?Er.encode(["tuple(string protocolName, bytes data)[]"],[[]]):Er.encode(["tuple(string protocolName, bytes data)[]"],[e.map(t=>({protocolName:t.protocolName,data:t.data}))])}function nc(e){return!e||e.length===0?!1:Array.isArray(e[0])}function rc(e){return!e||e.length===0?[[]]:nc(e)?e:[e]}function Cr(e){return rc(e).map(n=>ec(n))}function ln(e,t){return typeof e=="bigint"?e:xn(e,t)}function Mc(e){const t=e.preTotalAmountDecimals??18,n=e.chunkSizeDecimals??18,r=e.minBuyPerChunkDecimals??18;return{user:e.user,preInstructionsPerIteration:Cr(e.preInstructions),preTotalAmount:ln(e.preTotalAmount,t),sellToken:e.sellToken,buyToken:e.buyToken,chunkSize:ln(e.chunkSize,n),minBuyPerChunk:ln(e.minBuyPerChunk,r),postInstructionsPerIteration:Cr(e.postInstructions),completion:e.completion??2,targetValue:BigInt(e.targetValue??1),minHealthFactor:xn(e.minHealthFactor??"1.1",18),appDataHash:e.appDataHash??St(Je("kapan-order")),isFlashLoanOrder:e.isFlashLoanOrder??!1,isKindBuy:e.isKindBuy??!1}}function Hc(){const e=new Uint8Array(32);return crypto.getRandomValues(e),"0x"+Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}function zc(e){return{params:{user:e.params.user,preInstructionsPerIteration:e.params.preInstructionsPerIteration||[],preTotalAmount:BigInt(e.params.preTotalAmount),sellToken:e.params.sellToken,buyToken:e.params.buyToken,chunkSize:BigInt(e.params.chunkSize),minBuyPerChunk:BigInt(e.params.minBuyPerChunk),postInstructionsPerIteration:e.params.postInstructionsPerIteration||[],completion:Number(e.params.completion),targetValue:BigInt(e.params.targetValue),minHealthFactor:BigInt(e.params.minHealthFactor),appDataHash:e.params.appDataHash,isFlashLoanOrder:!!e.params.isFlashLoanOrder,isKindBuy:!!e.params.isKindBuy},status:Number(e.status),executedAmount:BigInt(e.executedAmount),iterationCount:BigInt(e.iterationCount),createdAt:BigInt(e.createdAt)}}const sc=["function createOrder(tuple(address user, bytes[] preInstructionsPerIteration, uint256 preTotalAmount, address sellToken, address buyToken, uint256 chunkSize, uint256 minBuyPerChunk, bytes[] postInstructionsPerIteration, uint8 completion, uint256 targetValue, uint256 minHealthFactor, bytes32 appDataHash, bool isFlashLoanOrder) params, bytes32 salt, uint256 seedAmount) returns (bytes32)","function getOrder(bytes32 orderHash) view returns (tuple(tuple(address user, bytes[] preInstructionsPerIteration, uint256 preTotalAmount, address sellToken, address buyToken, uint256 chunkSize, uint256 minBuyPerChunk, bytes[] postInstructionsPerIteration, uint8 completion, uint256 targetValue, uint256 minHealthFactor, bytes32 appDataHash, bool isFlashLoanOrder) params, uint8 status, uint256 executedAmount, uint256 iterationCount, uint256 createdAt))","function orderSalts(bytes32 orderHash) view returns (bytes32)","event OrderCreated(bytes32 indexed orderHash, address indexed user, address sellToken, address buyToken, uint256 totalAmount, uint256 chunkSize)"];new wt(sc);Mt.defaultAbiCoder();function ic(e){return"entrypoint"in e}const Kc=({calls:e,options:t})=>{const{targetNetwork:n}=Ks(),{chain:r}=Zs(),s=qs();return{...Ys({}),sendAsync:async()=>{if(!r?.id){console.error("Please connect your wallet");return}if(r?.id!==n.id){console.error("You are on the wrong network");return}try{const a=e?(console.log("calls",e),e.map(c=>{if(ic(c))return c;const u=c.functionName,l=c.contractName,h=c.args,B=Ws?.[n.network]?.[l],C=new Xs({abi:B.abi,address:B.address});return console.log("unparsed args",h),C.populate(u,h)})):[];return await s(a)}catch(a){throw a}}}};export{st as A,mt as B,Mc as C,te as D,_c as E,H as F,Rc as G,Bc as H,Ic as I,ki as J,kc as K,Q as L,tn as M,_ as N,K as O,R as P,k as Q,Qa as R,Vc as S,ve as T,na as U,zc as V,tc as W,Ec as X,Cc as Y,vc as Z,ga as a,ya as b,Sc as c,Uc as d,Dc as e,Fc as f,Tc as g,Hn as h,Oc as i,Lc as j,Nc as k,Kc as l,$a as m,Ma as n,ss as o,is as p,Pc as q,Hc as r,Ac as s,$c as t,gr as u,yr as v,Fa as w,Ar as x,N as y,dt as z};
