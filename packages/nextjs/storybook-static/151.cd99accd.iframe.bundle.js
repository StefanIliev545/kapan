/*! For license information please see 151.cd99accd.iframe.bundle.js.LICENSE.txt */
(self.webpackChunk_se_2_nextjs=self.webpackChunk_se_2_nextjs||[]).push([[151],{"./node_modules/@wagmi/connectors/node_modules/@walletconnect/ethereum-provider/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{EthereumProvider:()=>ethereum_provider_dist_index_es_Y});var events=__webpack_require__("./node_modules/events/events.js"),events_default=__webpack_require__.n(events),es=__webpack_require__("./node_modules/detect-browser/es/index.js"),cjs=__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/index.js"),dist_cjs=__webpack_require__("./node_modules/@walletconnect/window-getters/dist/cjs/index.js"),window_metadata_dist_cjs=__webpack_require__("./node_modules/@walletconnect/window-metadata/dist/cjs/index.js");let errorConfig={getDocsUrl:({docsBaseUrl,docsPath="",docsSlug})=>docsPath?`${docsBaseUrl??"https://viem.sh"}${docsPath}${docsSlug?`#${docsSlug}`:""}`:void 0,version:"viem@2.23.2"};class BaseError extends Error{constructor(shortMessage,args={}){const details=args.cause instanceof BaseError?args.cause.details:args.cause?.message?args.cause.message:args.details,docsPath=args.cause instanceof BaseError&&args.cause.docsPath||args.docsPath,docsUrl=errorConfig.getDocsUrl?.({...args,docsPath});super([shortMessage||"An error occurred.","",...args.metaMessages?[...args.metaMessages,""]:[],...docsUrl?[`Docs: ${docsUrl}`]:[],...details?[`Details: ${details}`]:[],...errorConfig.version?[`Version: ${errorConfig.version}`]:[]].join("\n"),args.cause?{cause:args.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=details,this.docsPath=docsPath,this.metaMessages=args.metaMessages,this.name=args.name??this.name,this.shortMessage=shortMessage,this.version="2.23.2"}walk(fn){return walk(this,fn)}}function walk(err,fn){return fn?.(err)?err:err&&"object"==typeof err&&"cause"in err&&void 0!==err.cause?walk(err.cause,fn):fn?null:err}function isHex(value,{strict=!0}={}){return!!value&&("string"==typeof value&&(strict?/^0x[0-9a-fA-F]*$/.test(value):value.startsWith("0x")))}class SizeExceedsPaddingSizeError extends BaseError{constructor({size,targetSize,type}){super(`${type.charAt(0).toUpperCase()}${type.slice(1).toLowerCase()} size (${size}) exceeds padding size (${targetSize}).`,{name:"SizeExceedsPaddingSizeError"})}}function pad(hexOrBytes,{dir,size=32}={}){return"string"==typeof hexOrBytes?function padHex(hex_,{dir,size=32}={}){if(null===size)return hex_;const hex=hex_.replace("0x","");if(hex.length>2*size)throw new SizeExceedsPaddingSizeError({size:Math.ceil(hex.length/2),targetSize:size,type:"hex"});return`0x${hex["right"===dir?"padEnd":"padStart"](2*size,"0")}`}(hexOrBytes,{dir,size}):function padBytes(bytes,{dir,size=32}={}){if(null===size)return bytes;if(bytes.length>size)throw new SizeExceedsPaddingSizeError({size:bytes.length,targetSize:size,type:"bytes"});const paddedBytes=new Uint8Array(size);for(let i=0;i<size;i++){const padEnd="right"===dir;paddedBytes[padEnd?i:size-i-1]=bytes[padEnd?i:bytes.length-i-1]}return paddedBytes}(hexOrBytes,{dir,size})}class IntegerOutOfRangeError extends BaseError{constructor({max,min,signed,size,value}){super(`Number "${value}" is not in safe ${size?`${8*size}-bit ${signed?"signed":"unsigned"} `:""}integer range ${max?`(${min} to ${max})`:`(above ${min})`}`,{name:"IntegerOutOfRangeError"})}}class SizeOverflowError extends BaseError{constructor({givenSize,maxSize}){super(`Size cannot exceed ${maxSize} bytes. Given size: ${givenSize} bytes.`,{name:"SizeOverflowError"})}}function size_size(value){return isHex(value,{strict:!1})?Math.ceil((value.length-2)/2):value.length}function assertSize(hexOrBytes,{size}){if(size_size(hexOrBytes)>size)throw new SizeOverflowError({givenSize:size_size(hexOrBytes),maxSize:size})}function hexToBigInt(hex,opts={}){const{signed}=opts;opts.size&&assertSize(hex,{size:opts.size});const value=BigInt(hex);if(!signed)return value;const size=(hex.length-2)/2;return value<=(1n<<8n*BigInt(size)-1n)-1n?value:value-BigInt(`0x${"f".padStart(2*size,"f")}`)-1n}function hexToNumber(hex,opts={}){return Number(hexToBigInt(hex,opts))}const hexes=Array.from({length:256},(_v,i)=>i.toString(16).padStart(2,"0"));function toHex(value,opts={}){return"number"==typeof value||"bigint"==typeof value?numberToHex(value,opts):"string"==typeof value?function stringToHex(value_,opts={}){const value=encoder.encode(value_);return bytesToHex(value,opts)}(value,opts):"boolean"==typeof value?function boolToHex(value,opts={}){const hex=`0x${Number(value)}`;if("number"==typeof opts.size)return assertSize(hex,{size:opts.size}),pad(hex,{size:opts.size});return hex}(value,opts):bytesToHex(value,opts)}function bytesToHex(value,opts={}){let string="";for(let i=0;i<value.length;i++)string+=hexes[value[i]];const hex=`0x${string}`;return"number"==typeof opts.size?(assertSize(hex,{size:opts.size}),pad(hex,{dir:"right",size:opts.size})):hex}function numberToHex(value_,opts={}){const{signed,size}=opts,value=BigInt(value_);let maxValue;size?maxValue=signed?(1n<<8n*BigInt(size)-1n)-1n:2n**(8n*BigInt(size))-1n:"number"==typeof value_&&(maxValue=BigInt(Number.MAX_SAFE_INTEGER));const minValue="bigint"==typeof maxValue&&signed?-maxValue-1n:0;if(maxValue&&value>maxValue||value<minValue){const suffix="bigint"==typeof value_?"n":"";throw new IntegerOutOfRangeError({max:maxValue?`${maxValue}${suffix}`:void 0,min:`${minValue}${suffix}`,signed,size,value:`${value_}${suffix}`})}const hex=`0x${(signed&&value<0?(1n<<BigInt(8*size))+BigInt(value):value).toString(16)}`;return size?pad(hex,{size}):hex}const encoder=new TextEncoder;const toBytes_encoder=new TextEncoder;function toBytes(value,opts={}){return"number"==typeof value||"bigint"==typeof value?function numberToBytes(value,opts){const hex=numberToHex(value,opts);return toBytes_hexToBytes(hex)}(value,opts):"boolean"==typeof value?function boolToBytes(value,opts={}){const bytes=new Uint8Array(1);if(bytes[0]=Number(value),"number"==typeof opts.size)return assertSize(bytes,{size:opts.size}),pad(bytes,{size:opts.size});return bytes}(value,opts):isHex(value)?toBytes_hexToBytes(value,opts):stringToBytes(value,opts)}const charCodeMap={zero:48,nine:57,A:65,F:70,a:97,f:102};function charCodeToBase16(char){return char>=charCodeMap.zero&&char<=charCodeMap.nine?char-charCodeMap.zero:char>=charCodeMap.A&&char<=charCodeMap.F?char-(charCodeMap.A-10):char>=charCodeMap.a&&char<=charCodeMap.f?char-(charCodeMap.a-10):void 0}function toBytes_hexToBytes(hex_,opts={}){let hex=hex_;opts.size&&(assertSize(hex,{size:opts.size}),hex=pad(hex,{dir:"right",size:opts.size}));let hexString=hex.slice(2);hexString.length%2&&(hexString=`0${hexString}`);const length=hexString.length/2,bytes=new Uint8Array(length);for(let index=0,j=0;index<length;index++){const nibbleLeft=charCodeToBase16(hexString.charCodeAt(j++)),nibbleRight=charCodeToBase16(hexString.charCodeAt(j++));if(void 0===nibbleLeft||void 0===nibbleRight)throw new BaseError(`Invalid byte sequence ("${hexString[j-2]}${hexString[j-1]}" in "${hexString}").`);bytes[index]=16*nibbleLeft+nibbleRight}return bytes}function stringToBytes(value,opts={}){const bytes=toBytes_encoder.encode(value);return"number"==typeof opts.size?(assertSize(bytes,{size:opts.size}),pad(bytes,{dir:"right",size:opts.size})):bytes}function anumber(n){if(!Number.isSafeInteger(n)||n<0)throw new Error("positive integer expected, got "+n)}function _assert_abytes(b,...lengths){if(!function isBytes(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}(b))throw new Error("Uint8Array expected");if(lengths.length>0&&!lengths.includes(b.length))throw new Error("Uint8Array expected of length "+lengths+", got length="+b.length)}function aexists(instance,checkFinished=!0){if(instance.destroyed)throw new Error("Hash instance has been destroyed");if(checkFinished&&instance.finished)throw new Error("Hash#digest() has already been called")}const U32_MASK64=BigInt(2**32-1),_32n=BigInt(32);function fromBig(n,le=!1){return le?{h:Number(n&U32_MASK64),l:Number(n>>_32n&U32_MASK64)}:{h:0|Number(n>>_32n&U32_MASK64),l:0|Number(n&U32_MASK64)}}function split(lst,le=!1){let Ah=new Uint32Array(lst.length),Al=new Uint32Array(lst.length);for(let i=0;i<lst.length;i++){const{h,l}=fromBig(lst[i],le);[Ah[i],Al[i]]=[h,l]}return[Ah,Al]}const rotlSH=(h,l,s)=>h<<s|l>>>32-s,rotlSL=(h,l,s)=>l<<s|h>>>32-s,rotlBH=(h,l,s)=>l<<s-32|h>>>64-s,rotlBL=(h,l,s)=>h<<s-32|l>>>64-s;const isLE=(()=>68===new Uint8Array(new Uint32Array([287454020]).buffer)[0])();function byteSwap(word){return word<<24&4278190080|word<<8&16711680|word>>>8&65280|word>>>24&255}function byteSwap32(arr){for(let i=0;i<arr.length;i++)arr[i]=byteSwap(arr[i])}function utils_toBytes(data){return"string"==typeof data&&(data=function utf8ToBytes(str){if("string"!=typeof str)throw new Error("utf8ToBytes expected string, got "+typeof str);return new Uint8Array((new TextEncoder).encode(str))}(data)),_assert_abytes(data),data}class Hash{clone(){return this._cloneInto()}}const SHA3_PI=[],SHA3_ROTL=[],_SHA3_IOTA=[],_0n=BigInt(0),_1n=BigInt(1),_2n=BigInt(2),_7n=BigInt(7),_256n=BigInt(256),_0x71n=BigInt(113);for(let round=0,R=_1n,x=1,y=0;round<24;round++){[x,y]=[y,(2*x+3*y)%5],SHA3_PI.push(2*(5*y+x)),SHA3_ROTL.push((round+1)*(round+2)/2%64);let t=_0n;for(let j=0;j<7;j++)R=(R<<_1n^(R>>_7n)*_0x71n)%_256n,R&_2n&&(t^=_1n<<(_1n<<BigInt(j))-_1n);_SHA3_IOTA.push(t)}const[SHA3_IOTA_H,SHA3_IOTA_L]=split(_SHA3_IOTA,!0),rotlH=(h,l,s)=>s>32?rotlBH(h,l,s):rotlSH(h,l,s),rotlL=(h,l,s)=>s>32?rotlBL(h,l,s):rotlSL(h,l,s);class Keccak extends Hash{constructor(blockLen,suffix,outputLen,enableXOF=!1,rounds=24){if(super(),this.blockLen=blockLen,this.suffix=suffix,this.outputLen=outputLen,this.enableXOF=enableXOF,this.rounds=rounds,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,anumber(outputLen),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=function u32(arr){return new Uint32Array(arr.buffer,arr.byteOffset,Math.floor(arr.byteLength/4))}(this.state)}keccak(){isLE||byteSwap32(this.state32),function keccakP(s,rounds=24){const B=new Uint32Array(10);for(let round=24-rounds;round<24;round++){for(let x=0;x<10;x++)B[x]=s[x]^s[x+10]^s[x+20]^s[x+30]^s[x+40];for(let x=0;x<10;x+=2){const idx1=(x+8)%10,idx0=(x+2)%10,B0=B[idx0],B1=B[idx0+1],Th=rotlH(B0,B1,1)^B[idx1],Tl=rotlL(B0,B1,1)^B[idx1+1];for(let y=0;y<50;y+=10)s[x+y]^=Th,s[x+y+1]^=Tl}let curH=s[2],curL=s[3];for(let t=0;t<24;t++){const shift=SHA3_ROTL[t],Th=rotlH(curH,curL,shift),Tl=rotlL(curH,curL,shift),PI=SHA3_PI[t];curH=s[PI],curL=s[PI+1],s[PI]=Th,s[PI+1]=Tl}for(let y=0;y<50;y+=10){for(let x=0;x<10;x++)B[x]=s[y+x];for(let x=0;x<10;x++)s[y+x]^=~B[(x+2)%10]&B[(x+4)%10]}s[0]^=SHA3_IOTA_H[round],s[1]^=SHA3_IOTA_L[round]}B.fill(0)}(this.state32,this.rounds),isLE||byteSwap32(this.state32),this.posOut=0,this.pos=0}update(data){aexists(this);const{blockLen,state}=this,len=(data=utils_toBytes(data)).length;for(let pos=0;pos<len;){const take=Math.min(blockLen-this.pos,len-pos);for(let i=0;i<take;i++)state[this.pos++]^=data[pos++];this.pos===blockLen&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state,suffix,pos,blockLen}=this;state[pos]^=suffix,128&suffix&&pos===blockLen-1&&this.keccak(),state[blockLen-1]^=128,this.keccak()}writeInto(out){aexists(this,!1),_assert_abytes(out),this.finish();const bufferOut=this.state,{blockLen}=this;for(let pos=0,len=out.length;pos<len;){this.posOut>=blockLen&&this.keccak();const take=Math.min(blockLen-this.posOut,len-pos);out.set(bufferOut.subarray(this.posOut,this.posOut+take),pos),this.posOut+=take,pos+=take}return out}xofInto(out){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(out)}xof(bytes){return anumber(bytes),this.xofInto(new Uint8Array(bytes))}digestInto(out){if(function aoutput(out,instance){_assert_abytes(out);const min=instance.outputLen;if(out.length<min)throw new Error("digestInto() expects output buffer of length at least "+min)}(out,this),this.finished)throw new Error("digest() was already called");return this.writeInto(out),this.destroy(),out}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(to){const{blockLen,suffix,outputLen,rounds,enableXOF}=this;return to||(to=new Keccak(blockLen,suffix,outputLen,enableXOF,rounds)),to.state32.set(this.state32),to.pos=this.pos,to.posOut=this.posOut,to.finished=this.finished,to.rounds=rounds,to.suffix=suffix,to.outputLen=outputLen,to.enableXOF=enableXOF,to.destroyed=this.destroyed,to}}const gen=(suffix,blockLen,outputLen)=>function wrapConstructor(hashCons){const hashC=msg=>hashCons().update(utils_toBytes(msg)).digest(),tmp=hashCons();return hashC.outputLen=tmp.outputLen,hashC.blockLen=tmp.blockLen,hashC.create=()=>hashCons(),hashC}(()=>new Keccak(blockLen,suffix,outputLen)),keccak_256=gen(1,136,32);function keccak256(value,to_){const to=to_||"hex",bytes=keccak_256(isHex(value,{strict:!1})?toBytes(value):value);return"bytes"===to?bytes:toHex(bytes)}class LruMap extends Map{constructor(size){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=size}get(key){const value=super.get(key);return super.has(key)&&void 0!==value&&(this.delete(key),super.set(key,value)),value}set(key,value){if(super.set(key,value),this.maxSize&&this.size>this.maxSize){const firstKey=this.keys().next().value;firstKey&&this.delete(firstKey)}return this}}const checksumAddressCache=new LruMap(8192);function checksumAddress(address_,chainId){if(checksumAddressCache.has(`${address_}.${chainId}`))return checksumAddressCache.get(`${address_}.${chainId}`);const hexAddress=chainId?`${chainId}${address_.toLowerCase()}`:address_.substring(2).toLowerCase(),hash=keccak256(stringToBytes(hexAddress),"bytes"),address=(chainId?hexAddress.substring(`${chainId}0x`.length):hexAddress).split("");for(let i=0;i<40;i+=2)hash[i>>1]>>4>=8&&address[i]&&(address[i]=address[i].toUpperCase()),(15&hash[i>>1])>=8&&address[i+1]&&(address[i+1]=address[i+1].toUpperCase());const result=`0x${address.join("")}`;return checksumAddressCache.set(`${address_}.${chainId}`,result),result}function toRecoveryBit(yParityOrV){if(0===yParityOrV||1===yParityOrV)return yParityOrV;if(27===yParityOrV)return 0;if(28===yParityOrV)return 1;throw new Error("Invalid yParityOrV value")}async function recoverAddress({hash,signature}){return function publicKeyToAddress(publicKey){return checksumAddress(`0x${keccak256(`0x${publicKey.substring(4)}`).substring(26)}`)}(await async function recoverPublicKey({hash,signature}){const hashHex=isHex(hash)?hash:toHex(hash),{secp256k1}=await __webpack_require__.e(2519).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@wagmi/connectors/node_modules/@noble/curves/esm/secp256k1.js")),signature_=(()=>{if("object"==typeof signature&&"r"in signature&&"s"in signature){const{r,s,v,yParity}=signature,recoveryBit=toRecoveryBit(Number(yParity??v));return new secp256k1.Signature(hexToBigInt(r),hexToBigInt(s)).addRecoveryBit(recoveryBit)}const signatureHex=isHex(signature)?signature:toHex(signature),recoveryBit=toRecoveryBit(hexToNumber(`0x${signatureHex.slice(130)}`));return secp256k1.Signature.fromCompact(signatureHex.substring(2,130)).addRecoveryBit(recoveryBit)})();return`0x${signature_.recoverPublicKey(hashHex.substring(2)).toHex(!1)}`}({hash,signature}))}var esm=__webpack_require__("./node_modules/bs58/src/esm/index.js"),index_es=__webpack_require__("./node_modules/@walletconnect/relay-auth/dist/index.es.js"),src=__webpack_require__("./node_modules/uint8arrays/esm/src/index.js"),dist_index_es=__webpack_require__("./node_modules/@walletconnect/relay-api/dist/index.es.js"),process=__webpack_require__("./node_modules/process/browser.js"),console=__webpack_require__("./node_modules/console-browserify/index.js"),Buffer=__webpack_require__("./node_modules/buffer/index.js").Buffer;function Ne(t){const[e,n]=t.split(":");return{namespace:e,reference:n}}function Ko(t,e=[]){const n=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;const o=t[r];n.push(...o.accounts)}),n}function ue(t,e){return t.includes(":")?[t]:e.chains||[]}var Zo=Object.defineProperty,Yo=Object.defineProperties,Go=Object.getOwnPropertyDescriptors,Tn=Object.getOwnPropertySymbols,Wo=Object.prototype.hasOwnProperty,Xo=Object.prototype.propertyIsEnumerable,Rn=(t,e,n)=>e in t?Zo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_n=(t,e)=>{for(var n in e||(e={}))Wo.call(e,n)&&Rn(t,n,e[n]);if(Tn)for(var n of Tn(e))Xo.call(e,n)&&Rn(t,n,e[n]);return t};const Y_reactNative="react-native",Y_node="node",Y_browser="browser",Y_unknown="unknown",jn="js";function _e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function pt(){return!(0,dist_cjs.getDocument)()&&!!(0,dist_cjs.getNavigator)()&&"ReactNative"===navigator.product}function Tt(){return!_e()&&!!(0,dist_cjs.getNavigator)()&&!!(0,dist_cjs.getDocument)()}function xt(){return pt()?Y_reactNative:_e()?Y_node:Tt()?Y_browser:Y_unknown}function ri(){var t;try{return pt()&&typeof __webpack_require__.g<"u"&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Application)<"u"?null==(t=__webpack_require__.g.Application)?void 0:t.applicationId:void 0}catch{return}}function oi(t){var e,n;const r=Pn();try{return null!=t&&t.url&&r.url&&new URL(t.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),t.url=r.url),null!=(e=t?.icons)&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(o=>""!==o)),((t,e)=>Yo(t,Go(e)))(_n(_n({},r),t),{url:t?.url||r.url,name:t?.name||r.name,description:t?.description||r.description,icons:null!=(n=t?.icons)&&n.length&&t.icons.length>0?t.icons:r.icons})}catch(o){return console.warn("Error populating app metadata",o),t||r}}function Pn(){return(0,window_metadata_dist_cjs.g)()||{name:"",description:"",url:"",icons:[""]}}function Mn(t,e,n){const r=function kn(){if(xt()===Y_reactNative&&typeof __webpack_require__.g<"u"&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Platform)<"u"){const{OS:n,Version:r}=__webpack_require__.g.Platform;return[n,r].join("-")}const t=(0,es.o0)();if(null===t)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return"browser"===t.type?[e,t.name,t.version].join("-"):[e,t.version].join("-")}(),o=function Vn(){var t;const e=xt();return e===Y_browser?[e,(null==(t=(0,dist_cjs.getLocation)())?void 0:t.host)||"unknown"].join(":"):e}();return[[t,e].join("-"),[jn,n].join("-"),r,o].join("/")}function si({protocol:t,version:e,relayUrl:n,sdkVersion:r,auth:o,projectId:i,useOnCloseEvent:s,bundleId:c,packageName:a}){const u=n.split("?"),f={auth:o,ua:Mn(t,e,r),projectId:i,useOnCloseEvent:s||void 0,packageName:a||void 0,bundleId:c||void 0},h=function Cn(t,e){const n=new URLSearchParams(t);for(const r of Object.keys(e).sort())if(e.hasOwnProperty(r)){const o=e[r];void 0!==o&&n.set(r,o)}return n.toString()}(u[1]||"",f);return u[0]+"?"+h}function gt(t,e){return t.filter(n=>e.includes(n)).length===t.length}function fi(t){return Object.fromEntries(t.entries())}function li(t){return new Map(Object.entries(t))}function gi(t=cjs.FIVE_MINUTES,e){const n=(0,cjs.toMiliseconds)(t||cjs.FIVE_MINUTES);let r,o,i,s;return{resolve:c=>{i&&r&&(clearTimeout(i),r(c),s=Promise.resolve(c))},reject:c=>{i&&o&&(clearTimeout(i),o(c))},done:()=>new Promise((c,a)=>{if(s)return c(s);i=setTimeout(()=>{const u=new Error(e);s=Promise.reject(u),a(u)},n),r=c,o=a})}}function yi(t,e,n){return new Promise(async(r,o)=>{const i=setTimeout(()=>o(new Error(n)),e);try{r(await t)}catch(s){o(s)}clearTimeout(i)})}function $e(t,e){if("string"==typeof e&&e.startsWith(`${t}:`))return e;if("topic"===t.toLowerCase()){if("string"!=typeof e)throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}if("id"===t.toLowerCase()){if("number"!=typeof e)throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function bi(t){const[e,n]=t.split(":"),r={id:void 0,topic:void 0};if("topic"===e&&"string"==typeof n)r.topic=n;else{if("id"!==e||!Number.isInteger(Number(n)))throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${n}`);r.id=Number(n)}return r}function Ei(t,e){return(0,cjs.fromMiliseconds)((e||Date.now())+(0,cjs.toMiliseconds)(t))}function vi(t){return Date.now()>=(0,cjs.toMiliseconds)(t)}function xi(t,e){return`${t}${e?`:${e}`:""}`}function ot(t=[],e=[]){return[...new Set([...t,...e])]}async function Si({id:t,topic:e,wcDeepLink:n}){var r;try{if(!n)return;const o="string"==typeof n?JSON.parse(n):n,i=o?.href;if("string"!=typeof i)return;const s=function Kn(t,e,n){const r=`requestId=${e}&sessionTopic=${n}`;t.endsWith("/")&&(t=t.slice(0,-1));let o=`${t}`;if(t.startsWith("https://t.me")){o=`${o}${t.includes("?")?"&startapp=":"?startapp="}${function Yn(t,e=!1){const n=Buffer.from(t).toString("base64");return e?n.replace(/[=]/g,""):n}(r,!0)}`}else o=`${o}/wc?${r}`;return o}(i,t,e),c=xt();if(c===Y_browser){if(null==(r=(0,dist_cjs.getDocument)())||!r.hasFocus())return void console.warn("Document does not have focus, skipping deeplink.");!function Fn(t){let e="_self";!function Zn(){try{return window.self!==window.top}catch{return!1}}()?(function zn(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"):e="_top",window.open(t,e,"noreferrer noopener")}(s)}else c===Y_reactNative&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Linking)<"u"&&await __webpack_require__.g.Linking.openURL(s)}catch(o){console.error(o)}}function Ai(t,e){if(!t.includes(e))return null;const n=t.split(/([&,?,=])/),r=n.indexOf(e);return n[r+2]}function index_es_Bi(){return typeof crypto<"u"&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}function Ii(){return typeof process<"u"&&"true"===process.env.IS_VITEST}function je(t){return Buffer.from(t,"base64").toString("utf-8")}function Wt(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Xt(t,...e){if(!function Ui(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function index_es_Ce(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Wt(t.outputLen),Wt(t.blockLen)}function Rt(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Gn(t,e){Xt(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const le=BigInt(2**32-1),Wn=BigInt(32);function Ti(t,e=!1){return e?{h:Number(t&le),l:Number(t>>Wn&le)}:{h:0|Number(t>>Wn&le),l:0|Number(t&le)}}const _t="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function Pe(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ct(t,e){return t<<32-e|t>>>e}const Xn=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function Pi(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Jn(t){for(let e=0;e<t.length;e++)t[e]=Pi(t[e])}function $t(t){return"string"==typeof t&&(t=function ki(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),Xt(t),t}class ke{clone(){return this._cloneInto()}}function Qn(t){const e=r=>t().update($t(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Lt(t=32){if(_t&&"function"==typeof _t.getRandomValues)return _t.getRandomValues(new Uint8Array(t));if(_t&&"function"==typeof _t.randomBytes)return _t.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const tr=[],er=[],nr=[],Mi=BigInt(0),Jt=BigInt(1),Di=BigInt(2),Hi=BigInt(7),qi=BigInt(256),Ki=BigInt(113);for(let t=0,e=Jt,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],tr.push(2*(5*r+n)),er.push((t+1)*(t+2)/2%64);let o=Mi;for(let i=0;i<7;i++)e=(e<<Jt^(e>>Hi)*Ki)%qi,e&Di&&(o^=Jt<<(Jt<<BigInt(i))-Jt);nr.push(o)}const[Fi,zi]=function Ri(t,e=!1){let n=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let o=0;o<t.length;o++){const{h:i,l:s}=Ti(t[o],e);[n[o],r[o]]=[i,s]}return[n,r]}(nr,!0),rr=(t,e,n)=>n>32?((t,e,n)=>e<<n-32|t>>>64-n)(t,e,n):((t,e,n)=>t<<n|e>>>32-n)(t,e,n),or=(t,e,n)=>n>32?((t,e,n)=>t<<n-32|e>>>64-n)(t,e,n):((t,e,n)=>e<<n|t>>>32-n)(t,e,n);class En extends ke{constructor(e,n,r,o=!1,i=24){if(super(),this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=o,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Wt(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=function Ci(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}(this.state)}keccak(){Xn||Jn(this.state32),function Zi(t,e=24){const n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let s=0;s<10;s++)n[s]=t[s]^t[s+10]^t[s+20]^t[s+30]^t[s+40];for(let s=0;s<10;s+=2){const c=(s+8)%10,a=(s+2)%10,u=n[a],l=n[a+1],f=rr(u,l,1)^n[c],h=or(u,l,1)^n[c+1];for(let y=0;y<50;y+=10)t[s+y]^=f,t[s+y+1]^=h}let o=t[2],i=t[3];for(let s=0;s<24;s++){const c=er[s],a=rr(o,i,c),u=or(o,i,c),l=tr[s];o=t[l],i=t[l+1],t[l]=a,t[l+1]=u}for(let s=0;s<50;s+=10){for(let c=0;c<10;c++)n[c]=t[s+c];for(let c=0;c<10;c++)t[s+c]^=~n[(c+2)%10]&n[(c+4)%10]}t[0]^=Fi[r],t[1]^=zi[r]}n.fill(0)}(this.state32,this.rounds),Xn||Jn(this.state32),this.posOut=0,this.pos=0}update(e){Rt(this);const{blockLen:n,state:r}=this,o=(e=$t(e)).length;for(let i=0;i<o;){const s=Math.min(n-this.pos,o-i);for(let c=0;c<s;c++)r[this.pos++]^=e[i++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:r,blockLen:o}=this;e[r]^=n,!!(128&n)&&r===o-1&&this.keccak(),e[o-1]^=128,this.keccak()}writeInto(e){Rt(this,!1),Xt(e),this.finish();const n=this.state,{blockLen:r}=this;for(let o=0,i=e.length;o<i;){this.posOut>=r&&this.keccak();const s=Math.min(r-this.posOut,i-o);e.set(n.subarray(this.posOut,this.posOut+s),o),this.posOut+=s,o+=s}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Wt(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Gn(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:n,suffix:r,outputLen:o,rounds:i,enableXOF:s}=this;return e||(e=new En(n,r,o,s,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=r,e.outputLen=o,e.enableXOF=s,e.destroyed=this.destroyed,e}}const Gi=(t=1,e=136,n=32,Qn(()=>new En(e,t,n))),Wi="https://rpc.walletconnect.org/v1";var t,e,n;function Ve(t){const e=`Ethereum Signed Message:\n${t.length}`,n=(new TextEncoder).encode(e+t);return"0x"+Buffer.from(Gi(n)).toString("hex")}async function ir(t,e,n,r,o,i){switch(n.t){case"eip191":return await async function sr(t,e,n){return(await recoverAddress({hash:Ve(e),signature:n})).toLowerCase()===t.toLowerCase()}(t,e,n.s);case"eip1271":return await async function cr(t,e,n,r,o,i){const s=Ne(r);if(!s.namespace||!s.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const c="0x1626ba7e",a="0000000000000000000000000000000000000000000000000000000000000040",u="0000000000000000000000000000000000000000000000000000000000000041",l=n.substring(2),h=c+Ve(e).substring(2)+a+u+l,y=await fetch(`${i||Wi}/?chainId=${r}&projectId=${o}`,{method:"POST",body:JSON.stringify({id:Xi(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:h},"latest"]})}),{result:E}=await y.json();return!!E&&E.slice(0,c.length).toLowerCase()===c.toLowerCase()}catch(c){return console.error("isValidEip1271Signature: ",c),!1}}(t,e,n.s,r,o,i);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}function Xi(){return Date.now()+Math.floor(1e3*Math.random())}var Qi=Object.defineProperty,ts=Object.defineProperties,index_es_es=Object.getOwnPropertyDescriptors,ar=Object.getOwnPropertySymbols,ns=Object.prototype.hasOwnProperty,rs=Object.prototype.propertyIsEnumerable,ur=(t,e,n)=>e in t?Qi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Me=(t,e)=>{for(var n in e||(e={}))ns.call(e,n)&&ur(t,n,e[n]);if(ar)for(var n of ar(e))rs.call(e,n)&&ur(t,n,e[n]);return t},fr=(t,e)=>ts(t,index_es_es(e));const de=t=>t?.split(":"),dr=t=>{const e=t&&de(t);if(e)return e[2]+":"+e[3]},De=t=>{const e=t&&de(t);if(e)return e.pop()};async function is(t){const{cacao:e,projectId:n}=t,{s:r,p:o}=e,i=hr(o,o.iss),s=De(o.iss);return await ir(s,i,r,dr(o.iss),n)}const hr=(t,e)=>{const n=`${t.domain} wants you to sign in with your Ethereum account:`,r=De(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let o=t.statement||void 0;const i=`URI: ${t.aud||t.uri}`,s=`Version: ${t.version}`,c=`Chain ID: ${(t=>{const e=t&&de(t);if(e)return t.includes("did:pkh:")?e[3]:e[1]})(e)}`,a=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,l=t.exp?`Expiration Time: ${t.exp}`:void 0,f=t.nbf?`Not Before: ${t.nbf}`:void 0,h=t.requestId?`Request ID: ${t.requestId}`:void 0,y=t.resources?`Resources:${t.resources.map(p=>`\n- ${p}`).join("")}`:void 0,E=index_es_pe(t.resources);if(E){o=Ke(o,yt(E))}return[n,r,"",o,"",i,s,c,a,u,l,f,h,y].filter(p=>null!=p).join("\n")};function at(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(null==e||!e.length)throw new Error("No resources found in `att` property");e.forEach(n=>{const r=t.att[n];if(Array.isArray(r))throw new Error(`Resource must be an object: ${n}`);if("object"!=typeof r)throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(r).forEach(o=>{const i=r[o];if(!Array.isArray(i))throw new Error(`Ability limits ${o} must be an array of objects, found: ${i}`);if(!i.length)throw new Error(`Value of ${o} is empty array, must be an array with objects`);i.forEach(s=>{if("object"!=typeof s)throw new Error(`Ability limits (${o}) must be an array of objects, found: ${s}`)})})})}function He(t,e,n={}){e=e?.sort((o,i)=>o.localeCompare(i));const r=e.map(o=>({[`${t}/${o}`]:[n]}));return Object.assign({},...r)}function he(t){return at(t),`urn:recap:${function mr(t){return Buffer.from(JSON.stringify(t)).toString("base64")}(t).replace(/=/g,"")}`}function yt(t){const e=function wr(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}(t.replace("urn:recap:",""));return at(e),e}function fs(t,e,n){const r=function br(t,e,n,r={}){return n?.sort((o,i)=>o.localeCompare(i)),{att:{[t]:He(e,n,r)}}}(t,e,n);return he(r)}function qe(t){return t&&t.includes("urn:recap:")}function ls(t,e){const o=function vr(t,e){at(t),at(e);const n=Object.keys(t.att).concat(Object.keys(e.att)).sort((o,i)=>o.localeCompare(i)),r={att:{}};return n.forEach(o=>{var i,s;Object.keys((null==(i=t.att)?void 0:i[o])||{}).concat(Object.keys((null==(s=e.att)?void 0:s[o])||{})).sort((c,a)=>c.localeCompare(a)).forEach(c=>{var a,u;r.att[o]=fr(Me({},r.att[o]),{[c]:(null==(a=t.att[o])?void 0:a[c])||(null==(u=e.att[o])?void 0:u[c])})})}),r}(yt(t),yt(e));return he(o)}function Ke(t="",e){at(e);const n="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(n))return t;const r=[];let o=0;Object.keys(e.att).forEach(c=>{const a=Object.keys(e.att[c]).map(f=>({ability:f.split("/")[0],action:f.split("/")[1]}));a.sort((f,h)=>f.action.localeCompare(h.action));const u={};a.forEach(f=>{u[f.ability]||(u[f.ability]=[]),u[f.ability].push(f.action)});const l=Object.keys(u).map(f=>(o++,`(${o}) '${f}': '${u[f].join("', '")}' for '${c}'.`));r.push(l.join(", ").replace(".,","."))});return`${t?t+" ":""}${`${n}${r.join(" ")}`}`}function ds(t){var e;const n=yt(t);at(n);const r=null==(e=n.att)?void 0:e.eip155;return r?Object.keys(r).map(o=>o.split("/")[1]):[]}function hs(t){const e=yt(t);at(e);const n=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(o=>{var i;null!=(i=o?.[0])&&i.chains&&n.push(o[0].chains)})}),[...new Set(n.flat())]}function index_es_pe(t){if(!t)return;const e=t?.[t.length-1];return qe(e)?e:void 0}function Fe(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Sr(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}function tt(t,...e){if(!Sr(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Or(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ar(t){if("boolean"!=typeof t)throw new Error(`boolean expected, not ${t}`)}const mt=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4));if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function ze(t){if("string"==typeof t)t=function ms(t){if("string"!=typeof t)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(t))}(t);else{if(!Sr(t))throw new Error("Uint8Array expected, got "+typeof t);t=Ze(t)}return t}function Br(t,e,n=!0){if(void 0===e)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(n&&!function vs(t){return t.byteOffset%4==0}(e))throw new Error("invalid output, must be aligned");return e}function Ir(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,u=r?0:4;t.setUint32(e+a,s,r),t.setUint32(e+u,c,r)}function Ze(t){return Uint8Array.from(t)}function jt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const Nr=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),xs=Nr("expand 16-byte k"),Ss=Nr("expand 32-byte k"),Os=mt(xs),As=mt(Ss);function V(t,e){return t<<e|t>>>32-e}function Ye(t){return t.byteOffset%4==0}const Ur=2**32-1,Tr=new Uint32Array;const F=(t,e)=>255&t[e++]|(255&t[e++])<<8;class Us{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,tt(e=ze(e),32);const n=F(e,0),r=F(e,2),o=F(e,4),i=F(e,6),s=F(e,8),c=F(e,10),a=F(e,12),u=F(e,14);this.r[0]=8191&n,this.r[1]=8191&(n>>>13|r<<3),this.r[2]=7939&(r>>>10|o<<6),this.r[3]=8191&(o>>>7|i<<9),this.r[4]=255&(i>>>4|s<<12),this.r[5]=s>>>1&8190,this.r[6]=8191&(s>>>14|c<<2),this.r[7]=8065&(c>>>11|a<<5),this.r[8]=8191&(a>>>8|u<<8),this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=F(e,16+2*l)}process(e,n,r=!1){const o=r?0:2048,{h:i,r:s}=this,c=s[0],a=s[1],u=s[2],l=s[3],f=s[4],h=s[5],y=s[6],E=s[7],p=s[8],d=s[9],v=F(e,n+0),m=F(e,n+2),O=F(e,n+4),N=F(e,n+6),$=F(e,n+8),B=F(e,n+10),A=F(e,n+12),T=F(e,n+14);let S=i[0]+(8191&v),L=i[1]+(8191&(v>>>13|m<<3)),U=i[2]+(8191&(m>>>10|O<<6)),_=i[3]+(8191&(O>>>7|N<<9)),j=i[4]+(8191&(N>>>4|$<<12)),g=i[5]+($>>>1&8191),w=i[6]+(8191&($>>>14|B<<2)),b=i[7]+(8191&(B>>>11|A<<5)),I=i[8]+(8191&(A>>>8|T<<8)),R=i[9]+(T>>>5|o),x=0,C=x+S*c+L*(5*d)+U*(5*p)+_*(5*E)+j*(5*y);x=C>>>13,C&=8191,C+=g*(5*h)+w*(5*f)+b*(5*l)+I*(5*u)+R*(5*a),x+=C>>>13,C&=8191;let P=x+S*a+L*c+U*(5*d)+_*(5*p)+j*(5*E);x=P>>>13,P&=8191,P+=g*(5*y)+w*(5*h)+b*(5*f)+I*(5*l)+R*(5*u),x+=P>>>13,P&=8191;let k=x+S*u+L*a+U*c+_*(5*d)+j*(5*p);x=k>>>13,k&=8191,k+=g*(5*E)+w*(5*y)+b*(5*h)+I*(5*f)+R*(5*l),x+=k>>>13,k&=8191;let M=x+S*l+L*u+U*a+_*c+j*(5*d);x=M>>>13,M&=8191,M+=g*(5*p)+w*(5*E)+b*(5*y)+I*(5*h)+R*(5*f),x+=M>>>13,M&=8191;let D=x+S*f+L*l+U*u+_*a+j*c;x=D>>>13,D&=8191,D+=g*(5*d)+w*(5*p)+b*(5*E)+I*(5*y)+R*(5*h),x+=D>>>13,D&=8191;let z=x+S*h+L*f+U*l+_*u+j*a;x=z>>>13,z&=8191,z+=g*c+w*(5*d)+b*(5*p)+I*(5*E)+R*(5*y),x+=z>>>13,z&=8191;let Z=x+S*y+L*h+U*f+_*l+j*u;x=Z>>>13,Z&=8191,Z+=g*a+w*c+b*(5*d)+I*(5*p)+R*(5*E),x+=Z>>>13,Z&=8191;let st=x+S*E+L*y+U*h+_*f+j*l;x=st>>>13,st&=8191,st+=g*u+w*a+b*c+I*(5*d)+R*(5*p),x+=st>>>13,st&=8191;let W=x+S*p+L*E+U*y+_*h+j*f;x=W>>>13,W&=8191,W+=g*l+w*u+b*a+I*c+R*(5*d),x+=W>>>13,W&=8191;let J=x+S*d+L*p+U*E+_*y+j*h;x=J>>>13,J&=8191,J+=g*f+w*l+b*u+I*a+R*c,x+=J>>>13,J&=8191,x=(x<<2)+x|0,x=x+C|0,C=8191&x,x>>>=13,P+=x,i[0]=C,i[1]=P,i[2]=k,i[3]=M,i[4]=D,i[5]=z,i[6]=Z,i[7]=st,i[8]=W,i[9]=J}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let o=e[1]>>>13;e[1]&=8191;for(let c=2;c<10;c++)e[c]+=o,o=e[c]>>>13,e[c]&=8191;e[0]+=5*o,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,r[0]=e[0]+5,o=r[0]>>>13,r[0]&=8191;for(let c=1;c<10;c++)r[c]=e[c]+o,o=r[c]>>>13,r[c]&=8191;r[9]-=8192;let i=(1^o)-1;for(let c=0;c<10;c++)r[c]&=i;i=~i;for(let c=0;c<10;c++)e[c]=e[c]&i|r[c];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let s=e[0]+n[0];e[0]=65535&s;for(let c=1;c<8;c++)s=(e[c]+n[c]|0)+(s>>>16)|0,e[c]=65535&s;jt(r)}update(e){Or(this);const{buffer:n,blockLen:r}=this,o=(e=ze(e)).length;for(let i=0;i<o;){const s=Math.min(r-this.pos,o-i);if(s!==r)n.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===r&&(this.process(n,0,!1),this.pos=0);else for(;r<=o-i;i+=r)this.process(e,i)}return this}destroy(){jt(this.h,this.r,this.buffer,this.pad)}digestInto(e){Or(this),function ps(t,e){tt(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let i=0;for(let s=0;s<8;s++)e[i++]=r[s]>>>0,e[i++]=r[s]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}const Rs=function Ts(t){const e=(r,o)=>t(o).update(ze(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}(t=>new Us(t));const $s=function Ns(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:i,rounds:s}=function ws(t,e){if(null==e||"object"!=typeof e)throw new Error("options must be defined");return Object.assign(t,e)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if("function"!=typeof t)throw new Error("core must be a function");return Fe(o),Fe(s),Ar(i),Ar(n),(c,a,u,l,f=0)=>{tt(c),tt(a),tt(u);const h=u.length;if(void 0===l&&(l=new Uint8Array(h)),tt(l),Fe(f),f<0||f>=Ur)throw new Error("arx: counter overflow");if(l.length<h)throw new Error(`arx: output (${l.length}) is shorter than data (${h})`);const y=[];let p,d,E=c.length;if(32===E)y.push(p=Ze(c)),d=As;else{if(16!==E||!n)throw new Error(`arx: invalid 32-byte key, got length=${E}`);p=new Uint8Array(32),p.set(c),p.set(c,16),d=Os,y.push(p)}Ye(a)||y.push(a=Ze(a));const v=mt(p);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(d,v,mt(a.subarray(0,16)),v),a=a.subarray(16)}const m=16-o;if(m!==a.length)throw new Error(`arx: nonce must be ${m} or 16 bytes`);if(12!==m){const N=new Uint8Array(12);N.set(a,i?0:12-a.length),a=N,y.push(a)}const O=mt(a);return function Is(t,e,n,r,o,i,s,c){const a=o.length,u=new Uint8Array(64),l=mt(u),f=Ye(o)&&Ye(i),h=f?mt(o):Tr,y=f?mt(i):Tr;for(let E=0;E<a;s++){if(t(e,n,r,l,s,c),s>=Ur)throw new Error("arx: counter overflow");const p=Math.min(64,a-E);if(f&&64===p){const d=E/4;if(E%4!=0)throw new Error("arx: invalid block position");for(let m,v=0;v<16;v++)m=d+v,y[m]=h[m]^l[v];E+=64;continue}for(let v,d=0;d<p;d++)v=E+d,i[v]=o[v]^u[d];E+=p}}(t,d,v,O,u,l,f,s),jt(...y),l}}(function _s(t,e,n,r,o,i=20){let s=t[0],c=t[1],a=t[2],u=t[3],l=e[0],f=e[1],h=e[2],y=e[3],E=e[4],p=e[5],d=e[6],v=e[7],m=o,O=n[0],N=n[1],$=n[2],B=s,A=c,T=a,S=u,L=l,U=f,_=h,j=y,g=E,w=p,b=d,I=v,R=m,x=O,C=N,P=$;for(let M=0;M<i;M+=2)B=B+L|0,R=V(R^B,16),g=g+R|0,L=V(L^g,12),B=B+L|0,R=V(R^B,8),g=g+R|0,L=V(L^g,7),A=A+U|0,x=V(x^A,16),w=w+x|0,U=V(U^w,12),A=A+U|0,x=V(x^A,8),w=w+x|0,U=V(U^w,7),T=T+_|0,C=V(C^T,16),b=b+C|0,_=V(_^b,12),T=T+_|0,C=V(C^T,8),b=b+C|0,_=V(_^b,7),S=S+j|0,P=V(P^S,16),I=I+P|0,j=V(j^I,12),S=S+j|0,P=V(P^S,8),I=I+P|0,j=V(j^I,7),B=B+U|0,P=V(P^B,16),b=b+P|0,U=V(U^b,12),B=B+U|0,P=V(P^B,8),b=b+P|0,U=V(U^b,7),A=A+_|0,R=V(R^A,16),I=I+R|0,_=V(_^I,12),A=A+_|0,R=V(R^A,8),I=I+R|0,_=V(_^I,7),T=T+j|0,x=V(x^T,16),g=g+x|0,j=V(j^g,12),T=T+j|0,x=V(x^T,8),g=g+x|0,j=V(j^g,7),S=S+L|0,C=V(C^S,16),w=w+C|0,L=V(L^w,12),S=S+L|0,C=V(C^S,8),w=w+C|0,L=V(L^w,7);let k=0;r[k++]=s+B|0,r[k++]=c+A|0,r[k++]=a+T|0,r[k++]=u+S|0,r[k++]=l+L|0,r[k++]=f+U|0,r[k++]=h+_|0,r[k++]=y+j|0,r[k++]=E+g|0,r[k++]=p+w|0,r[k++]=d+b|0,r[k++]=v+I|0,r[k++]=m+R|0,r[k++]=O+x|0,r[k++]=N+C|0,r[k++]=$+P|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),Ls=new Uint8Array(16),Rr=(t,e)=>{t.update(e);const n=e.length%16;n&&t.update(Ls.subarray(n))},js=new Uint8Array(32);function _r(t,e,n,r,o){const i=t(e,n,js),s=Rs.create(i);o&&Rr(s,o),Rr(s,r);const c=new Uint8Array(16),a=(t=>new DataView(t.buffer,t.byteOffset,t.byteLength))(c);Ir(a,0,BigInt(o?o.length:0),!0),Ir(a,8,BigInt(r.length),!0),s.update(c);const u=s.digest();return jt(i,c),u}const $r=((t,e)=>{function n(r,...o){if(tt(r),void 0!==t.nonceLength){const l=o[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?tt(l):tt(l,t.nonceLength)}const i=t.tagLength;i&&void 0!==o[1]&&tt(o[1]);const s=e(r,...o),c=(l,f)=>{if(void 0!==f){if(2!==l)throw new Error("cipher output not supported");tt(f)}};let a=!1;return{encrypt(l,f){if(a)throw new Error("cannot encrypt() twice with same key + nonce");return a=!0,tt(l),c(s.encrypt.length,f),s.encrypt(l,f)},decrypt(l,f){if(tt(l),i&&l.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return c(s.decrypt.length,f),s.decrypt(l,f)}}}return Object.assign(n,t),n})({blockSize:64,nonceLength:12,tagLength:16},(t=>(e,n,r)=>({encrypt(i,s){const c=i.length;(s=Br(c+16,s,!1)).set(i);const a=s.subarray(0,-16);t(e,n,a,a,1);const u=_r(t,e,n,a,r);return s.set(u,c),jt(u),s},decrypt(i,s){s=Br(i.length-16,s,!1);const c=i.subarray(0,-16),a=i.subarray(-16),u=_r(t,e,n,c,r);if(!function bs(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return 0===n}(a,u))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,n,s,s,1),jt(u),s}}))($s));class Lr extends ke{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,index_es_Ce(e);const r=$t(n);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?e.create().update(r).digest():r);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=e.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(e){return Rt(this),this.iHash.update(e),this}digestInto(e){Rt(this),Xt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:i,blockLen:s,outputLen:c}=this;return e.finished=o,e.destroyed=i,e.blockLen=s,e.outputLen=c,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ye=(t,e,n)=>new Lr(t,e).update(n).digest();ye.create=(t,e)=>new Lr(t,e);const Ge=new Uint8Array([0]),jr=new Uint8Array;const Vs=(t,e,n,r,o)=>function ks(t,e,n,r=32){if(index_es_Ce(t),Wt(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(r/t.outputLen);void 0===n&&(n=jr);const i=new Uint8Array(o*t.outputLen),s=ye.create(t,e),c=s._cloneInto(),a=new Uint8Array(s.outputLen);for(let u=0;u<o;u++)Ge[0]=u+1,c.update(0===u?jr:a).update(n).update(Ge).digestInto(a),i.set(a,t.outputLen*u),s._cloneInto(c);return s.destroy(),c.destroy(),a.fill(0),Ge.fill(0),i.slice(0,r)}(t,function Ps(t,e,n){return index_es_Ce(t),void 0===n&&(n=new Uint8Array(t.outputLen)),ye(t,$t(n),$t(e))}(t,e,n),r,o);function Ds(t,e,n){return t&e^~t&n}function Hs(t,e,n){return t&e^t&n^e&n}class qs extends ke{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Pe(this.buffer)}update(e){Rt(this);const{view:n,buffer:r,blockLen:o}=this,i=(e=$t(e)).length;for(let s=0;s<i;){const c=Math.min(o-this.pos,i-s);if(c===o){const a=Pe(e);for(;o<=i-s;s+=o)this.process(a,s);continue}r.set(e.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Rt(this),Gn(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:i}=this;let{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let f=s;f<o;f++)n[f]=0;(function Ms(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,u=r?0:4;t.setUint32(e+a,s,r),t.setUint32(e+u,c,r)})(r,o-8,BigInt(8*this.length),i),this.process(r,0);const c=Pe(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=a/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)c.setUint32(4*f,l[f],i)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:c}=this;return e.length=o,e.pos=c,e.finished=i,e.destroyed=s,o%n&&e.buffer.set(r),e}}const Ks=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),wt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),bt=new Uint32Array(64);class Fs extends qs{constructor(){super(64,32,8,!1),this.A=0|wt[0],this.B=0|wt[1],this.C=0|wt[2],this.D=0|wt[3],this.E=0|wt[4],this.F=0|wt[5],this.G=0|wt[6],this.H=0|wt[7]}get(){const{A:e,B:n,C:r,D:o,E:i,F:s,G:c,H:a}=this;return[e,n,r,o,i,s,c,a]}set(e,n,r,o,i,s,c,a){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|o,this.E=0|i,this.F=0|s,this.G=0|c,this.H=0|a}process(e,n){for(let f=0;f<16;f++,n+=4)bt[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=bt[f-15],y=bt[f-2],E=ct(h,7)^ct(h,18)^h>>>3,p=ct(y,17)^ct(y,19)^y>>>10;bt[f]=p+bt[f-7]+E+bt[f-16]|0}let{A:r,B:o,C:i,D:s,E:c,F:a,G:u,H:l}=this;for(let f=0;f<64;f++){const y=l+(ct(c,6)^ct(c,11)^ct(c,25))+Ds(c,a,u)+Ks[f]+bt[f]|0,p=(ct(r,2)^ct(r,13)^ct(r,22))+Hs(r,o,i)|0;l=u,u=a,a=c,c=s+y|0,s=i,i=o,o=r,r=y+p|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(r,o,i,s,c,a,u,l)}roundClean(){bt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Qt=Qn(()=>new Fs),me=BigInt(0),we=BigInt(1),zs=BigInt(2);function St(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}function te(t){if(!St(t))throw new Error("Uint8Array expected")}function Ct(t,e){if("boolean"!=typeof e)throw new Error(t+" boolean expected, got "+e)}const Zs=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Pt(t){te(t);let e="";for(let n=0;n<t.length;n++)e+=Zs[t[n]];return e}function index_es_kt(t){const e=t.toString(16);return 1&e.length?"0"+e:e}function We(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return""===t?me:BigInt("0x"+t)}const ut__0=48,ut__9=57,ut_A=65,ut_F=70,ut_a=97,ut_f=102;function Cr(t){return t>=ut__0&&t<=ut__9?t-ut__0:t>=ut_A&&t<=ut_F?t-(ut_A-10):t>=ut_a&&t<=ut_f?t-(ut_a-10):void 0}function Vt(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let o=0,i=0;o<n;o++,i+=2){const s=Cr(t.charCodeAt(i)),c=Cr(t.charCodeAt(i+1));if(void 0===s||void 0===c){const a=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+i)}r[o]=16*s+c}return r}function Ot(t){return We(Pt(t))}function ee(t){return te(t),We(Pt(Uint8Array.from(t).reverse()))}function Mt(t,e){return Vt(t.toString(16).padStart(2*e,"0"))}function be(t,e){return Mt(t,e).reverse()}function et(t,e,n){let r;if("string"==typeof e)try{r=Vt(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else{if(!St(e))throw new Error(t+" must be hex string or Uint8Array");r=Uint8Array.from(e)}const o=r.length;if("number"==typeof n&&o!==n)throw new Error(t+" of length "+n+" expected, got "+o);return r}function ne(...t){let e=0;for(let r=0;r<t.length;r++){const o=t[r];te(o),e+=o.length}const n=new Uint8Array(e);for(let r=0,o=0;r<t.length;r++){const i=t[r];n.set(i,o),o+=i.length}return n}const Xe=t=>"bigint"==typeof t&&me<=t;function Ee(t,e,n){return Xe(t)&&Xe(e)&&Xe(n)&&e<=t&&t<n}function ft(t,e,n,r){if(!Ee(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function Pr(t){let e;for(e=0;t>me;t>>=we,e+=1);return e}const Je=t=>(zs<<BigInt(t-1))-we,Qe=t=>new Uint8Array(t),kr=t=>Uint8Array.from(t);function Vr(t,e,n){if("number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=Qe(t),o=Qe(t),i=0;const s=()=>{r.fill(1),o.fill(0),i=0},c=(...f)=>n(o,r,...f),a=(f=Qe())=>{o=c(kr([0]),f),r=c(),0!==f.length&&(o=c(kr([1]),f),r=c())},u=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const h=[];for(;f<e;){r=c();const y=r.slice();h.push(y),f+=r.length}return ne(...h)};return(f,h)=>{let y;for(s(),a(f);!(y=h(u()));)a();return s(),y}}const Qs={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||St(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};function Dt(t,e,n={}){const r=(o,i,s)=>{const c=Qs[i];if("function"!=typeof c)throw new Error("invalid validator function");const a=t[o];if(!(s&&void 0===a||c(a,t)))throw new Error("param "+String(o)+" is invalid. Expected "+i+", got "+a)};for(const[o,i]of Object.entries(e))r(o,i,!1);for(const[o,i]of Object.entries(n))r(o,i,!0);return t}function tn(t){const e=new WeakMap;return(n,...r)=>{const o=e.get(n);if(void 0!==o)return o;const i=t(n,...r);return e.set(n,i),i}}var ec=Object.freeze({__proto__:null,isBytes:St,abytes:te,abool:Ct,bytesToHex:Pt,numberToHexUnpadded:index_es_kt,hexToNumber:We,hexToBytes:Vt,bytesToNumberBE:Ot,bytesToNumberLE:ee,numberToBytesBE:Mt,numberToBytesLE:be,numberToVarBytesBE:function Ys(t){return Vt(index_es_kt(t))},ensureBytes:et,concatBytes:ne,equalBytes:function Gs(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return 0===n},utf8ToBytes:function Ws(t){if("string"!=typeof t)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(t))},inRange:Ee,aInRange:ft,bitLen:Pr,bitGet:function Xs(t,e){return t>>BigInt(e)&we},bitSet:function Js(t,e,n){return t|(n?we:me)<<BigInt(e)},bitMask:Je,createHmacDrbg:Vr,validateObject:Dt,notImplemented:()=>{throw new Error("not implemented")},memoized:tn});const q=BigInt(0),H=BigInt(1),At=BigInt(2),nc=BigInt(3),en=BigInt(4),Mr=BigInt(5),Dr=BigInt(8);function X(t,e){const n=t%e;return n>=q?n:e+n}function Hr(t,e,n){if(e<q)throw new Error("invalid exponent, negatives unsupported");if(n<=q)throw new Error("invalid modulus");if(n===H)return q;let r=H;for(;e>q;)e&H&&(r=r*t%n),t=t*t%n,e>>=H;return r}function it(t,e,n){let r=t;for(;e-- >q;)r*=r,r%=n;return r}function nn(t,e){if(t===q)throw new Error("invert: expected non-zero number");if(e<=q)throw new Error("invert: expected positive modulus, got "+e);let n=X(t,e),r=e,o=q,i=H;for(;n!==q;){const a=r%n,u=o-i*(r/n);r=n,n=a,o=i,i=u}if(r!==H)throw new Error("invert: does not exist");return X(o,e)}function oc(t){if(t%en===nc){const e=(t+H)/en;return function(r,o){const i=r.pow(o,e);if(!r.eql(r.sqr(i),o))throw new Error("Cannot find square root");return i}}if(t%Dr===Mr){const e=(t-Mr)/Dr;return function(r,o){const i=r.mul(o,At),s=r.pow(i,e),c=r.mul(o,s),a=r.mul(r.mul(c,At),s),u=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(u),o))throw new Error("Cannot find square root");return u}}return function rc(t){const e=(t-H)/At;let n,r,o;for(n=t-H,r=0;n%At===q;n/=At,r++);for(o=At;o<t&&Hr(o,e,t)!==t-H;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(1===r){const s=(t+H)/en;return function(a,u){const l=a.pow(u,s);if(!a.eql(a.sqr(l),u))throw new Error("Cannot find square root");return l}}const i=(n+H)/At;return function(c,a){if(c.pow(a,e)===c.neg(c.ONE))throw new Error("Cannot find square root");let u=r,l=c.pow(c.mul(c.ONE,o),n),f=c.pow(a,i),h=c.pow(a,n);for(;!c.eql(h,c.ONE);){if(c.eql(h,c.ZERO))return c.ZERO;let y=1;for(let p=c.sqr(h);y<u&&!c.eql(p,c.ONE);y++)p=c.sqr(p);const E=c.pow(l,H<<BigInt(u-y-1));l=c.sqr(E),f=c.mul(f,E),h=c.mul(h,l),u=y}return f}}(t)}const ic=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function qr(t,e){const n=void 0!==e?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function Kr(t,e,n=!1,r={}){if(t<=q)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:o,nByteLength:i}=qr(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let s;const c=Object.freeze({ORDER:t,isLE:n,BITS:o,BYTES:i,MASK:Je(o),ZERO:q,ONE:H,create:a=>X(a,t),isValid:a=>{if("bigint"!=typeof a)throw new Error("invalid field element: expected bigint, got "+typeof a);return q<=a&&a<t},is0:a=>a===q,isOdd:a=>(a&H)===H,neg:a=>X(-a,t),eql:(a,u)=>a===u,sqr:a=>X(a*a,t),add:(a,u)=>X(a+u,t),sub:(a,u)=>X(a-u,t),mul:(a,u)=>X(a*u,t),pow:(a,u)=>function cc(t,e,n){if(n<q)throw new Error("invalid exponent, negatives unsupported");if(n===q)return t.ONE;if(n===H)return e;let r=t.ONE,o=e;for(;n>q;)n&H&&(r=t.mul(r,o)),o=t.sqr(o),n>>=H;return r}(c,a,u),div:(a,u)=>X(a*nn(u,t),t),sqrN:a=>a*a,addN:(a,u)=>a+u,subN:(a,u)=>a-u,mulN:(a,u)=>a*u,inv:a=>nn(a,t),sqrt:r.sqrt||(a=>(s||(s=oc(t)),s(c,a))),invertBatch:a=>function ac(t,e){const n=new Array(e.length),r=e.reduce((i,s,c)=>t.is0(s)?i:(n[c]=i,t.mul(i,s)),t.ONE),o=t.inv(r);return e.reduceRight((i,s,c)=>t.is0(s)?i:(n[c]=t.mul(i,n[c]),t.mul(i,s)),o),n}(c,a),cmov:(a,u,l)=>l?u:a,toBytes:a=>n?be(a,i):Mt(a,i),fromBytes:a=>{if(a.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+a.length);return n?ee(a):Ot(a)}});return Object.freeze(c)}function Fr(t){if("bigint"!=typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function zr(t){const e=Fr(t);return e+Math.ceil(e/2)}const Zr=BigInt(0),ve=BigInt(1);function rn(t,e){const n=e.negate();return t?n:e}function Yr(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function on(t,e){Yr(t,e);return{windows:Math.ceil(e/t)+1,windowSize:2**(t-1)}}const sn=new WeakMap,Gr=new WeakMap;function cn(t){return Gr.get(t)||1}function hc(t,e,n,r){if(function fc(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}(n,t),function lc(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}(r,e),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,i=Pr(BigInt(n.length)),s=i>12?i-3:i>4?i-2:i?2:1,c=(1<<s)-1,a=new Array(c+1).fill(o);let l=o;for(let f=Math.floor((e.BITS-1)/s)*s;f>=0;f-=s){a.fill(o);for(let y=0;y<r.length;y++){const E=r[y],p=Number(E>>BigInt(f)&BigInt(c));a[p]=a[p].add(n[y])}let h=o;for(let y=a.length-1,E=o;y>0;y--)E=E.add(a[y]),h=h.add(E);if(l=l.add(h),0!==f)for(let y=0;y<s;y++)l=l.double()}return l}function Wr(t){return function sc(t){return Dt(t,ic.reduce((r,o)=>(r[o]="function",r),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}(t.Fp),Dt(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...qr(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Ht=BigInt(0),an=BigInt(1);const un=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const yc=BigInt(1),Xr=BigInt(2),mc=BigInt(3),wc=BigInt(5);BigInt(8);const fn=function gc(t){const e=function pc(t){return Dt(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...t})}(t),{P:n}=e,r=m=>X(m,n),o=e.montgomeryBits,i=Math.ceil(o/8),s=e.nByteLength,c=e.adjustScalarBytes||(m=>m),a=e.powPminus2||(m=>Hr(m,n-BigInt(2),n));function u(m,O,N){const $=r(m*(O-N));return[O=r(O-$),N=r(N+$)]}const l=(e.a-BigInt(2))/BigInt(4);function h(m){return be(r(m),i)}function p(m,O){const N=function y(m){const O=et("u coordinate",m,i);return 32===s&&(O[31]&=127),ee(O)}(O),$=function E(m){const O=et("scalar",m),N=O.length;if(N!==i&&N!==s)throw new Error("invalid scalar, expected "+i+" or "+s+" bytes, got "+N);return ee(c(O))}(m),B=function f(m,O){ft("u",m,Ht,n),ft("scalar",O,Ht,n);const N=O,$=m;let U,B=an,A=Ht,T=m,S=an,L=Ht;for(let j=BigInt(o-1);j>=Ht;j--){const g=N>>j&an;L^=g,U=u(L,B,T),B=U[0],T=U[1],U=u(L,A,S),A=U[0],S=U[1],L=g;const w=B+A,b=r(w*w),I=B-A,R=r(I*I),x=b-R,C=T+S,k=r((T-S)*w),M=r(C*I),D=k+M,z=k-M;T=r(D*D),S=r($*r(z*z)),B=r(b*R),A=r(x*(b+r(l*x)))}U=u(L,B,T),B=U[0],T=U[1],U=u(L,A,S),A=U[0],S=U[1];const _=a(A);return r(B*_)}(N,$);if(B===Ht)throw new Error("invalid private or public key received");return h(B)}const d=h(e.Gu);function v(m){return p(m,d)}return{scalarMult:p,scalarMultBase:v,getSharedSecret:(m,O)=>p(m,O),getPublicKey:m=>v(m),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:d}}({P:un,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=un,{pow_p_5_8:n,b2:r}=function bc(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),o=BigInt(80),i=un,c=t*t%i*t%i,a=it(c,Xr,i)*c%i,u=it(a,yc,i)*t%i,l=it(u,wc,i)*u%i,f=it(l,e,i)*l%i,h=it(f,n,i)*f%i,y=it(h,r,i)*h%i,E=it(y,o,i)*y%i,p=it(E,o,i)*y%i,d=it(p,e,i)*l%i;return{pow_p_5_8:it(d,Xr,i)*t%i,b2:c}}(t);return X(it(n,mc,e)*r,e)},adjustScalarBytes:function Ec(t){return t[0]&=248,t[31]&=127,t[31]|=64,t},randomBytes:Lt});function Jr(t){void 0!==t.lowS&&Ct("lowS",t.lowS),void 0!==t.prehash&&Ct("prehash",t.prehash)}const{bytesToNumberBE:xc,hexToBytes:Sc}=ec;class Oc extends Error{constructor(e=""){super(e)}}const lt={Err:Oc,_tlv:{encode:(t,e)=>{const{Err:n}=lt;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(1&e.length)throw new n("tlv.encode: unpadded data");const r=e.length/2,o=index_es_kt(r);if(o.length/2&128)throw new n("tlv.encode: long form length too big");const i=r>127?index_es_kt(o.length/2|128):"";return index_es_kt(t)+i+o+e},decode(t,e){const{Err:n}=lt;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const o=e[r++];let s=0;if(!!(128&o)){const a=127&o;if(!a)throw new n("tlv.decode(long): indefinite length not supported");if(a>4)throw new n("tlv.decode(long): byte length is too big");const u=e.subarray(r,r+a);if(u.length!==a)throw new n("tlv.decode: length bytes not complete");if(0===u[0])throw new n("tlv.decode(long): zero leftmost byte");for(const l of u)s=s<<8|l;if(r+=a,s<128)throw new n("tlv.decode(long): not minimal encoding")}else s=o;const c=e.subarray(r,r+s);if(c.length!==s)throw new n("tlv.decode: wrong value length");return{v:c,l:e.subarray(r+s)}}},_int:{encode(t){const{Err:e}=lt;if(t<dt)throw new e("integer: negative integers are not allowed");let n=index_es_kt(t);if(8&Number.parseInt(n[0],16)&&(n="00"+n),1&n.length)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=lt;if(128&t[0])throw new e("invalid signature integer: negative");if(0===t[0]&&!(128&t[1]))throw new e("invalid signature integer: unnecessary leading zero");return xc(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=lt,o="string"==typeof t?Sc(t):t;te(o);const{v:i,l:s}=r.decode(48,o);if(s.length)throw new e("invalid signature: left bytes after parsing");const{v:c,l:a}=r.decode(2,i),{v:u,l}=r.decode(2,a);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(c),s:n.decode(u)}},hexFromSig(t){const{_tlv:e,_int:n}=lt,i=e.encode(2,n.encode(t.r))+e.encode(2,n.encode(t.s));return e.encode(48,i)}},dt=BigInt(0),K=BigInt(1);BigInt(2);const Qr=BigInt(3);function Ac(t){const e=function vc(t){const e=Wr(t);Dt(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=e;if(n){if(!r.eql(o,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}(t),{Fp:n}=e,r=Kr(e.n,e.nBitLength),o=e.toBytes||((p,d,v)=>{const m=d.toAffine();return ne(Uint8Array.from([4]),n.toBytes(m.x),n.toBytes(m.y))}),i=e.fromBytes||(p=>{const d=p.subarray(1);return{x:n.fromBytes(d.subarray(0,n.BYTES)),y:n.fromBytes(d.subarray(n.BYTES,2*n.BYTES))}});function s(p){const{a:d,b:v}=e,m=n.sqr(p),O=n.mul(m,p);return n.add(n.add(O,n.mul(p,d)),v)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function a(p){const{allowedPrivateKeyLengths:d,nByteLength:v,wrapPrivateKey:m,n:O}=e;if(d&&"bigint"!=typeof p){if(St(p)&&(p=Pt(p)),"string"!=typeof p||!d.includes(p.length))throw new Error("invalid private key");p=p.padStart(2*v,"0")}let N;try{N="bigint"==typeof p?p:Ot(et("private key",p,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof p)}return m&&(N=X(N,O)),ft("private key",N,K,O),N}function u(p){if(!(p instanceof h))throw new Error("ProjectivePoint expected")}const l=tn((p,d)=>{const{px:v,py:m,pz:O}=p;if(n.eql(O,n.ONE))return{x:v,y:m};const N=p.is0();null==d&&(d=N?n.ONE:n.inv(O));const $=n.mul(v,d),B=n.mul(m,d),A=n.mul(O,d);if(N)return{x:n.ZERO,y:n.ZERO};if(!n.eql(A,n.ONE))throw new Error("invZ was invalid");return{x:$,y:B}}),f=tn(p=>{if(p.is0()){if(e.allowInfinityPoint&&!n.is0(p.py))return;throw new Error("bad point: ZERO")}const{x:d,y:v}=p.toAffine();if(!n.isValid(d)||!n.isValid(v))throw new Error("bad point: x or y not FE");const m=n.sqr(v),O=s(d);if(!n.eql(m,O))throw new Error("bad point: equation left != right");if(!p.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class h{constructor(d,v,m){if(this.px=d,this.py=v,this.pz=m,null==d||!n.isValid(d))throw new Error("x required");if(null==v||!n.isValid(v))throw new Error("y required");if(null==m||!n.isValid(m))throw new Error("z required");Object.freeze(this)}static fromAffine(d){const{x:v,y:m}=d||{};if(!d||!n.isValid(v)||!n.isValid(m))throw new Error("invalid affine point");if(d instanceof h)throw new Error("projective point not allowed");const O=N=>n.eql(N,n.ZERO);return O(v)&&O(m)?h.ZERO:new h(v,m,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const v=n.invertBatch(d.map(m=>m.pz));return d.map((m,O)=>m.toAffine(v[O])).map(h.fromAffine)}static fromHex(d){const v=h.fromAffine(i(et("pointHex",d)));return v.assertValidity(),v}static fromPrivateKey(d){return h.BASE.multiply(a(d))}static msm(d,v){return hc(h,r,d,v)}_setWindowSize(d){E.setWindowSize(this,d)}assertValidity(){f(this)}hasEvenY(){const{y:d}=this.toAffine();if(n.isOdd)return!n.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){u(d);const{px:v,py:m,pz:O}=this,{px:N,py:$,pz:B}=d,A=n.eql(n.mul(v,B),n.mul(N,O)),T=n.eql(n.mul(m,B),n.mul($,O));return A&&T}negate(){return new h(this.px,n.neg(this.py),this.pz)}double(){const{a:d,b:v}=e,m=n.mul(v,Qr),{px:O,py:N,pz:$}=this;let B=n.ZERO,A=n.ZERO,T=n.ZERO,S=n.mul(O,O),L=n.mul(N,N),U=n.mul($,$),_=n.mul(O,N);return _=n.add(_,_),T=n.mul(O,$),T=n.add(T,T),B=n.mul(d,T),A=n.mul(m,U),A=n.add(B,A),B=n.sub(L,A),A=n.add(L,A),A=n.mul(B,A),B=n.mul(_,B),T=n.mul(m,T),U=n.mul(d,U),_=n.sub(S,U),_=n.mul(d,_),_=n.add(_,T),T=n.add(S,S),S=n.add(T,S),S=n.add(S,U),S=n.mul(S,_),A=n.add(A,S),U=n.mul(N,$),U=n.add(U,U),S=n.mul(U,_),B=n.sub(B,S),T=n.mul(U,L),T=n.add(T,T),T=n.add(T,T),new h(B,A,T)}add(d){u(d);const{px:v,py:m,pz:O}=this,{px:N,py:$,pz:B}=d;let A=n.ZERO,T=n.ZERO,S=n.ZERO;const L=e.a,U=n.mul(e.b,Qr);let _=n.mul(v,N),j=n.mul(m,$),g=n.mul(O,B),w=n.add(v,m),b=n.add(N,$);w=n.mul(w,b),b=n.add(_,j),w=n.sub(w,b),b=n.add(v,O);let I=n.add(N,B);return b=n.mul(b,I),I=n.add(_,g),b=n.sub(b,I),I=n.add(m,O),A=n.add($,B),I=n.mul(I,A),A=n.add(j,g),I=n.sub(I,A),S=n.mul(L,b),A=n.mul(U,g),S=n.add(A,S),A=n.sub(j,S),S=n.add(j,S),T=n.mul(A,S),j=n.add(_,_),j=n.add(j,_),g=n.mul(L,g),b=n.mul(U,b),j=n.add(j,g),g=n.sub(_,g),g=n.mul(L,g),b=n.add(b,g),_=n.mul(j,b),T=n.add(T,_),_=n.mul(I,b),A=n.mul(w,A),A=n.sub(A,_),_=n.mul(w,j),S=n.mul(I,S),S=n.add(S,_),new h(A,T,S)}subtract(d){return this.add(d.negate())}is0(){return this.equals(h.ZERO)}wNAF(d){return E.wNAFCached(this,d,h.normalizeZ)}multiplyUnsafe(d){const{endo:v,n:m}=e;ft("scalar",d,dt,m);const O=h.ZERO;if(d===dt)return O;if(this.is0()||d===K)return this;if(!v||E.hasPrecomputes(this))return E.wNAFCachedUnsafe(this,d,h.normalizeZ);let{k1neg:N,k1:$,k2neg:B,k2:A}=v.splitScalar(d),T=O,S=O,L=this;for(;$>dt||A>dt;)$&K&&(T=T.add(L)),A&K&&(S=S.add(L)),L=L.double(),$>>=K,A>>=K;return N&&(T=T.negate()),B&&(S=S.negate()),S=new h(n.mul(S.px,v.beta),S.py,S.pz),T.add(S)}multiply(d){const{endo:v,n:m}=e;let O,N;if(ft("scalar",d,K,m),v){const{k1neg:$,k1:B,k2neg:A,k2:T}=v.splitScalar(d);let{p:S,f:L}=this.wNAF(B),{p:U,f:_}=this.wNAF(T);S=E.constTimeNegate($,S),U=E.constTimeNegate(A,U),U=new h(n.mul(U.px,v.beta),U.py,U.pz),O=S.add(U),N=L.add(_)}else{const{p:$,f:B}=this.wNAF(d);O=$,N=B}return h.normalizeZ([O,N])[0]}multiplyAndAddUnsafe(d,v,m){const O=h.BASE,N=(B,A)=>A!==dt&&A!==K&&B.equals(O)?B.multiply(A):B.multiplyUnsafe(A),$=N(this,v).add(N(d,m));return $.is0()?void 0:$}toAffine(d){return l(this,d)}isTorsionFree(){const{h:d,isTorsionFree:v}=e;if(d===K)return!0;if(v)return v(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:v}=e;return d===K?this:v?v(h,this):this.multiplyUnsafe(e.h)}toRawBytes(d=!0){return Ct("isCompressed",d),this.assertValidity(),o(h,this,d)}toHex(d=!0){return Ct("isCompressed",d),Pt(this.toRawBytes(d))}}h.BASE=new h(e.Gx,e.Gy,n.ONE),h.ZERO=new h(n.ZERO,n.ONE,n.ZERO);const y=e.nBitLength,E=function dc(t,e){return{constTimeNegate:rn,hasPrecomputes:n=>1!==cn(n),unsafeLadder(n,r,o=t.ZERO){let i=n;for(;r>Zr;)r&ve&&(o=o.add(i)),i=i.double(),r>>=ve;return o},precomputeWindow(n,r){const{windows:o,windowSize:i}=on(r,e),s=[];let c=n,a=c;for(let u=0;u<o;u++){a=c,s.push(a);for(let l=1;l<i;l++)a=a.add(c),s.push(a);c=a.double()}return s},wNAF(n,r,o){const{windows:i,windowSize:s}=on(n,e);let c=t.ZERO,a=t.BASE;const u=BigInt(2**n-1),l=2**n,f=BigInt(n);for(let h=0;h<i;h++){const y=h*s;let E=Number(o&u);o>>=f,E>s&&(E-=l,o+=ve);const p=y,d=y+Math.abs(E)-1,v=h%2!=0,m=E<0;0===E?a=a.add(rn(v,r[p])):c=c.add(rn(m,r[d]))}return{p:c,f:a}},wNAFUnsafe(n,r,o,i=t.ZERO){const{windows:s,windowSize:c}=on(n,e),a=BigInt(2**n-1),u=2**n,l=BigInt(n);for(let f=0;f<s;f++){const h=f*c;if(o===Zr)break;let y=Number(o&a);if(o>>=l,y>c&&(y-=u,o+=ve),0===y)continue;let E=r[h+Math.abs(y)-1];y<0&&(E=E.negate()),i=i.add(E)}return i},getPrecomputes(n,r,o){let i=sn.get(r);return i||(i=this.precomputeWindow(r,n),1!==n&&sn.set(r,o(i))),i},wNAFCached(n,r,o){const i=cn(n);return this.wNAF(i,this.getPrecomputes(i,n,o),r)},wNAFCachedUnsafe(n,r,o,i){const s=cn(n);return 1===s?this.unsafeLadder(n,r,i):this.wNAFUnsafe(s,this.getPrecomputes(s,n,o),r,i)},setWindowSize(n,r){Yr(r,e),Gr.set(n,r),sn.delete(n)}}}(h,e.endo?Math.ceil(y/2):y);return{CURVE:e,ProjectivePoint:h,normPrivateKeyToScalar:a,weierstrassEquation:s,isWithinCurveOrder:function c(p){return Ee(p,K,e.n)}}}function Ic(t){const e=function Bc(t){const e=Wr(t);return Dt(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(t),{Fp:n,n:r}=e,o=n.BYTES+1,i=2*n.BYTES+1;function s(g){return X(g,r)}function c(g){return nn(g,r)}const{ProjectivePoint:a,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:f}=Ac({...e,toBytes(g,w,b){const I=w.toAffine(),R=n.toBytes(I.x),x=ne;return Ct("isCompressed",b),b?x(Uint8Array.from([w.hasEvenY()?2:3]),R):x(Uint8Array.from([4]),R,n.toBytes(I.y))},fromBytes(g){const w=g.length,b=g[0],I=g.subarray(1);if(w!==o||2!==b&&3!==b){if(w===i&&4===b){return{x:n.fromBytes(I.subarray(0,n.BYTES)),y:n.fromBytes(I.subarray(n.BYTES,2*n.BYTES))}}throw new Error("invalid Point, expected length of "+o+", or uncompressed "+i+", got "+w)}{const R=Ot(I);if(!Ee(R,K,n.ORDER))throw new Error("Point is not on curve");const x=l(R);let C;try{C=n.sqrt(x)}catch(M){const D=M instanceof Error?": "+M.message:"";throw new Error("Point is not on curve"+D)}return!(1&~b)!==((C&K)===K)&&(C=n.neg(C)),{x:R,y:C}}}}),h=g=>Pt(Mt(g,e.nByteLength));function y(g){return g>r>>K}const p=(g,w,b)=>Ot(g.slice(w,b));class d{constructor(w,b,I){this.r=w,this.s=b,this.recovery=I,this.assertValidity()}static fromCompact(w){const b=e.nByteLength;return w=et("compactSignature",w,2*b),new d(p(w,0,b),p(w,b,2*b))}static fromDER(w){const{r:b,s:I}=lt.toSig(et("DER",w));return new d(b,I)}assertValidity(){ft("r",this.r,K,r),ft("s",this.s,K,r)}addRecoveryBit(w){return new d(this.r,this.s,w)}recoverPublicKey(w){const{r:b,s:I,recovery:R}=this,x=B(et("msgHash",w));if(null==R||![0,1,2,3].includes(R))throw new Error("recovery id invalid");const C=2===R||3===R?b+e.n:b;if(C>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const P=1&R?"03":"02",k=a.fromHex(P+h(C)),M=c(C),D=s(-x*M),z=s(I*M),Z=a.BASE.multiplyAndAddUnsafe(k,D,z);if(!Z)throw new Error("point at infinify");return Z.assertValidity(),Z}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new d(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return Vt(this.toDERHex())}toDERHex(){return lt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Vt(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const v={isValidPrivateKey(g){try{return u(g),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const g=zr(e.n);return function uc(t,e,n=!1){const r=t.length,o=Fr(e),i=zr(e);if(r<16||r<i||r>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+r);const c=X(n?ee(t):Ot(t),e-H)+H;return n?be(c,o):Mt(c,o)}(e.randomBytes(g),e.n)},precompute:(g=8,w=a.BASE)=>(w._setWindowSize(g),w.multiply(BigInt(3)),w)};function O(g){const w=St(g),b="string"==typeof g,I=(w||b)&&g.length;return w?I===o||I===i:b?I===2*o||I===2*i:g instanceof a}const $=e.bits2int||function(g){if(g.length>8192)throw new Error("input is too large");const w=Ot(g),b=8*g.length-e.nBitLength;return b>0?w>>BigInt(b):w},B=e.bits2int_modN||function(g){return s($(g))},A=Je(e.nBitLength);function T(g){return ft("num < 2^"+e.nBitLength,g,dt,A),Mt(g,e.nByteLength)}function S(g,w,b=L){if(["recovered","canonical"].some(W=>W in b))throw new Error("sign() legacy options not supported");const{hash:I,randomBytes:R}=e;let{lowS:x,prehash:C,extraEntropy:P}=b;null==x&&(x=!0),g=et("msgHash",g),Jr(b),C&&(g=et("prehashed msgHash",I(g)));const k=B(g),M=u(w),D=[T(M),T(k)];if(null!=P&&!1!==P){const W=!0===P?R(n.BYTES):P;D.push(et("extraEntropy",W))}const z=ne(...D),Z=k;return{seed:z,k2sig:function st(W){const J=$(W);if(!f(J))return;const Be=c(J),zt=a.BASE.multiply(J).toAffine(),vt=s(zt.x);if(vt===dt)return;const Zt=s(Be*s(Z+vt*M));if(Zt===dt)return;let Ut=(zt.x===vt?0:2)|Number(zt.y&K),vn=Zt;return x&&y(Zt)&&(vn=function E(g){return y(g)?s(-g):g}(Zt),Ut^=1),new d(vt,vn,Ut)}}}const L={lowS:e.lowS,prehash:!1},U={lowS:e.lowS,prehash:!1};return a.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function m(g,w=!0){return a.fromPrivateKey(g).toRawBytes(w)},getSharedSecret:function N(g,w,b=!0){if(O(g))throw new Error("first arg must be private key");if(!O(w))throw new Error("second arg must be public key");return a.fromHex(w).multiply(u(g)).toRawBytes(b)},sign:function _(g,w,b=L){const{seed:I,k2sig:R}=S(g,w,b),x=e;return Vr(x.hash.outputLen,x.nByteLength,x.hmac)(I,R)},verify:function j(g,w,b,I=U){const R=g;w=et("msgHash",w),b=et("publicKey",b);const{lowS:x,prehash:C,format:P}=I;if(Jr(I),"strict"in I)throw new Error("options.strict was renamed to lowS");if(void 0!==P&&"compact"!==P&&"der"!==P)throw new Error("format must be compact or der");const k="string"==typeof R||St(R),M=!k&&!P&&"object"==typeof R&&null!==R&&"bigint"==typeof R.r&&"bigint"==typeof R.s;if(!k&&!M)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let D,z;try{if(M&&(D=new d(R.r,R.s)),k){try{"compact"!==P&&(D=d.fromDER(R))}catch(Ut){if(!(Ut instanceof lt.Err))throw Ut}!D&&"der"!==P&&(D=d.fromCompact(R))}z=a.fromHex(b)}catch{return!1}if(!D||x&&D.hasHighS())return!1;C&&(w=e.hash(w));const{r:Z,s:st}=D,W=B(w),J=c(st),Be=s(W*J),zt=s(Z*J),vt=a.BASE.multiplyAndAddUnsafe(z,Be,zt)?.toAffine();return!!vt&&s(vt.x)===Z},ProjectivePoint:a,Signature:d,utils:v}}function Nc(t){return{hash:t,hmac:(e,...n)=>ye(t,e,function Vi(...t){let e=0;for(let r=0;r<t.length;r++){const o=t[r];Xt(o),e+=o.length}const n=new Uint8Array(e);for(let r=0,o=0;r<t.length;r++){const i=t[r];n.set(i,o),o+=i.length}return n}(...n)),randomBytes:Lt}}BigInt(4);const to=Kr(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),_c=function Uc(t,e){const n=r=>Ic({...t,...Nc(r)});return{...n(e),create:n}}({a:to.create(BigInt("-3")),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Fp:to,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Qt),G="base16",qt="base64pad",xe="base64url",Kt="utf8";function jc(){const t=Lt(32);return(0,src.dI)(t,G)}function Pc(t){const e=Qt((0,src.sH)(t,G));return(0,src.dI)(e,G)}function kc(t){const e=Qt((0,src.sH)(t,Kt));return(0,src.dI)(e,G)}function pn(t){return(0,src.sH)(`${t}`,"base10")}function Bt(t){return Number((0,src.dI)(t,"base10"))}function no(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function ro(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4;return e+"=".repeat(n)}function gn(t){if(2===Bt(t.type))return(0,src.dI)((0,src.xW)([t.type,t.sealed]),qt);if(1===Bt(t.type)){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return(0,src.dI)((0,src.xW)([t.type,t.senderPublicKey,t.iv,t.sealed]),qt)}return(0,src.dI)((0,src.xW)([t.type,t.iv,t.sealed]),qt)}function Se(t){const e=(t.encoding||qt)===xe?ro(t.encoded):t.encoded,n=(0,src.sH)(e,qt),r=n.slice(0,1);if(1===Bt(r)){const a=33,u=a+12,l=n.slice(1,a),f=n.slice(a,u);return{type:r,sealed:n.slice(u),iv:f,senderPublicKey:l}}if(2===Bt(r)){return{type:r,sealed:n.slice(1),iv:Lt(12)}}const s=n.slice(1,13);return{type:r,sealed:n.slice(13),iv:s}}function oo(t){const e=t?.type||0;if(1===e){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Kc(t){return 1===t.type&&"string"==typeof t.senderPublicKey&&"string"==typeof t.receiverPublicKey}function Fc(t){return 2===t.type}function zc(t,e){const[n,r,o]=t.split("."),i=Buffer.from(ro(o),"base64");if(64!==i.length)throw new Error("Invalid signature length");const s=i.slice(0,32),c=i.slice(32,64),u=Qt(`${n}.${r}`),l=function io(t){const e=Buffer.from(t.x,"base64"),n=Buffer.from(t.y,"base64");return(0,src.xW)([new Uint8Array([4]),e,n])}(e);if(!_c.verify((0,src.xW)([s,c]),u,l))throw new Error("Invalid signature");return(0,index_es.Cq)(t).payload}function Zc(t){return t?.relay||{protocol:"irn"}}function Yc(t){const e=dist_index_es.CG[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function co(t,e="-"){const n={},r="relay"+e;return Object.keys(t).forEach(o=>{if(o.startsWith(r)){const i=o.replace(r,""),s=t[o];n[i]=s}}),n}function Gc(t){if(!t.includes("wc:")){const u=je(t);null!=u&&u.includes("wc:")&&(t=u)}const e=(t=(t=t.includes("wc://")?t.replace("wc://",""):t).includes("wc:")?t.replace("wc:",""):t).indexOf(":"),n=-1!==t.indexOf("?")?t.indexOf("?"):void 0,r=t.substring(0,e),o=t.substring(e+1,n).split("@"),i=typeof n<"u"?t.substring(n):"",s=new URLSearchParams(i),c={};s.forEach((u,l)=>{c[l]=u});const a="string"==typeof c.methods?c.methods.split(","):void 0;return{protocol:r,topic:ao(o[0]),version:parseInt(o[1],10),symKey:c.symKey,relay:co(c),methods:a,expiryTimestamp:c.expiryTimestamp?parseInt(c.expiryTimestamp,10):void 0}}function ao(t){return t.startsWith("//")?t.substring(2):t}function Wc(t){const e=new URLSearchParams,n=function uo(t,e="-"){const r={};return Object.keys(t).forEach(o=>{const i=o,s="relay"+e+i;t[i]&&(r[s]=t[i])}),r}(t.relay);Object.keys(n).sort().forEach(o=>{e.set(o,n[o])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const r=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${r}`}function Xc(t,e,n){return`${t}?wc_ev=${n}&topic=${e}`}var Jc=Object.defineProperty,Qc=Object.defineProperties,ta=Object.getOwnPropertyDescriptors,fo=Object.getOwnPropertySymbols,ea=Object.prototype.hasOwnProperty,na=Object.prototype.propertyIsEnumerable,lo=(t,e,n)=>e in t?Jc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ra=(t,e)=>{for(var n in e||(e={}))ea.call(e,n)&&lo(t,n,e[n]);if(fo)for(var n of fo(e))na.call(e,n)&&lo(t,n,e[n]);return t},oa=(t,e)=>Qc(t,ta(e));function It(t){const e=[];return t.forEach(n=>{const[r,o]=n.split(":");e.push(`${r}:${o}`)}),e}function yn(t){return t.includes(":")}function yo(t){return yn(t)?t.split(":")[0]:t}function index_es_ie(t){var e,n,r;const o={};if(!Oe(t))return o;for(const[i,s]of Object.entries(t)){const c=yn(i)?[i]:s.chains,a=s.methods||[],u=s.events||[],l=yo(i);o[l]=oa(ra({},o[l]),{chains:ot(c,null==(e=o[l])?void 0:e.chains),methods:ot(a,null==(n=o[l])?void 0:n.methods),events:ot(u,null==(r=o[l])?void 0:r.events)})}return o}function ca(t,e){const n=function mo(t){const e={};return t?.forEach(n=>{var r;const[o,i]=n.split(":");e[o]||(e[o]={accounts:[],chains:[],events:[],methods:[]}),e[o].accounts.push(n),null==(r=e[o].chains)||r.push(`${o}:${i}`)}),e}(e=e.map(r=>r.replace("did:pkh:","")));for(const[r,o]of Object.entries(n))o.methods?o.methods=ot(o.methods,t):o.methods=t,o.events=["chainChanged","accountsChanged"];return n}const wo={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},bo={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ht(t,e){const{message:n,code:r}=bo[t];return{message:e?`${n} ${e}`:n,code:r}}function Nt(t,e){const{message:n,code:r}=wo[t];return{message:e?`${n} ${e}`:n,code:r}}function se(t,e){return!!Array.isArray(t)&&(!(typeof e<"u"&&t.length)||t.every(e))}function Oe(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Et(t){return typeof t>"u"}function nt(t,e){return!(!e||!Et(t))||"string"==typeof t&&!!t.trim().length}function Ae(t,e){return!(!e||!Et(t))||"number"==typeof t&&!isNaN(t)}function ce(t){return!(!nt(t,!1)||!t.includes(":"))&&2===t.split(":").length}function mn(t){let e=!0;return se(t)?t.length&&(e=t.every(n=>nt(n,!1))):e=!1,e}function xo(t,e,n){let r=null;return Object.entries(t).forEach(([o,i])=>{if(r)return;const s=function vo(t,e,n){let r=null;return se(e)&&e.length?e.forEach(o=>{r||ce(o)||(r=Nt("UNSUPPORTED_CHAINS",`${n}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):ce(t)||(r=Nt("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}(o,ue(o,i),`${e} ${n}`);s&&(r=s)}),r}function So(t,e){let n=null;return se(t)?t.forEach(r=>{n||function Eo(t){if(nt(t,!1)&&t.includes(":")){const e=t.split(":");if(3===e.length){const n=e[0]+":"+e[1];return!!e[2]&&ce(n)}}return!1}(r)||(n=Nt("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):n=Nt("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function wn(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;const o=function Ao(t,e){let n=null;return mn(t?.methods)?mn(t?.events)||(n=Nt("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):n=Nt("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),n}(r,`${e}, namespace`);o&&(n=o)}),n}function Bo(t,e){let n=null;if(t&&Oe(t)){const r=wn(t,e);r&&(n=r);const o=function Oo(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;const o=So(r?.accounts,`${e} namespace`);o&&(n=o)}),n}(t,e);o&&(n=o)}else n=ht("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return n}function Io(t){return nt(t.protocol,!0)}function ma(t){return typeof t<"u"&&null!==typeof t}function xa(t,e){return!(!ce(e)||!function ho(t){const e=[];return Object.values(t).forEach(n=>{e.push(...It(n.accounts))}),e}(t).includes(e))}function Sa(t,e,n){return!!nt(n,!1)&&function po(t,e){const n=[];return Object.values(t).forEach(r=>{It(r.accounts).includes(e)&&n.push(...r.methods)}),n}(t,e).includes(n)}function Oa(t,e,n){return!!nt(n,!1)&&function go(t,e){const n=[];return Object.values(t).forEach(r=>{It(r.accounts).includes(e)&&n.push(...r.events)}),n}(t,e).includes(n)}function No(t,e,n){let r=null;const o=function Aa(t){const e={};return Object.keys(t).forEach(n=>{var r;n.includes(":")?e[n]=t[n]:null==(r=t[n].chains)||r.forEach(o=>{e[o]={methods:t[n].methods,events:t[n].events}})}),e}(t),i=function Ba(t){const e={};return Object.keys(t).forEach(n=>{if(n.includes(":"))e[n]=t[n];else{const r=It(t[n].accounts);r?.forEach(o=>{e[o]={accounts:t[n].accounts.filter(i=>i.includes(`${o}:`)),methods:t[n].methods,events:t[n].events}})}}),e}(e),s=Object.keys(o),c=Object.keys(i),a=Uo(Object.keys(t)),u=Uo(Object.keys(e)),l=a.filter(f=>!u.includes(f));return l.length&&(r=ht("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.\n      Required: ${l.toString()}\n      Received: ${Object.keys(e).toString()}`)),gt(s,c)||(r=ht("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.\n      Required: ${s.toString()}\n      Approved: ${c.toString()}`)),Object.keys(e).forEach(f=>{if(!f.includes(":")||r)return;const h=It(e[f].accounts);h.includes(f)||(r=ht("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${f}\n        Required: ${f}\n        Approved: ${h.toString()}`))}),s.forEach(f=>{r||(gt(o[f].methods,i[f].methods)?gt(o[f].events,i[f].events)||(r=ht("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${f}`)):r=ht("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${f}`))}),r}function Uo(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Na(){const t=xt();return new Promise(e=>{switch(t){case Y_browser:e(function To(){return Tt()&&navigator?.onLine}());break;case Y_reactNative:e(async function Ro(){if(pt()&&typeof __webpack_require__.g<"u"&&null!=__webpack_require__.g&&__webpack_require__.g.NetInfo){const t=await(null==__webpack_require__.g?void 0:__webpack_require__.g.NetInfo.fetch());return t?.isConnected}return!0}());break;default:e(!0)}})}function Ua(t){switch(xt()){case Y_browser:!function $o(t){!pt()&&Tt()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}(t);break;case Y_reactNative:!function Lo(t){pt()&&typeof __webpack_require__.g<"u"&&null!=__webpack_require__.g&&__webpack_require__.g.NetInfo&&__webpack_require__.g?.NetInfo.addEventListener(e=>t(e?.isConnected))}(t)}}const bn={};class Ra{static get(e){return bn[e]}static set(e,n){bn[e]=n}static delete(e){delete bn[e]}}var heartbeat_dist_index_es=__webpack_require__("./node_modules/@walletconnect/heartbeat/dist/index.es.js"),keyvaluestorage_dist_index_es=__webpack_require__("./node_modules/@walletconnect/keyvaluestorage/dist/index.es.js"),logger_dist_index_es=__webpack_require__("./node_modules/@walletconnect/logger/dist/index.es.js"),esm_events=__webpack_require__("./node_modules/@walletconnect/events/dist/esm/events.js"),a=Object.defineProperty,c=(e,s,r)=>((e,s,r)=>s in e?a(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r)(e,"symbol"!=typeof s?s+"":s,r);class h extends esm_events.H{constructor(s){super(),this.opts=s,c(this,"protocol","wc"),c(this,"version",2)}}var p=Object.defineProperty,v=(e,s,r)=>((e,s,r)=>s in e?p(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r)(e,"symbol"!=typeof s?s+"":s,r);class I extends esm_events.H{constructor(s,r){super(),this.core=s,this.logger=r,v(this,"records",new Map)}}class y{constructor(s,r){this.logger=s,this.core=r}}class m extends esm_events.H{constructor(s,r){super(),this.relayer=s,this.logger=r}}class d extends esm_events.H{constructor(s){super()}}class f{constructor(s,r,t,q){this.core=s,this.logger=r,this.name=t}}Object.defineProperty;class P extends esm_events.H{constructor(s,r){super(),this.relayer=s,this.logger=r}}class S extends esm_events.H{constructor(s,r){super(),this.core=s,this.logger=r}}class M{constructor(s,r,t){this.core=s,this.logger=r,this.store=t}}class O{constructor(s,r){this.projectId=s,this.logger=r}}class R{constructor(s,r,t){this.core=s,this.logger=r,this.telemetryEnabled=t}}var T=Object.defineProperty,i=(e,s,r)=>((e,s,r)=>s in e?T(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r)(e,"symbol"!=typeof s?s+"":s,r);events_default();class J{constructor(s){this.opts=s,i(this,"protocol","wc"),i(this,"version",2)}}events.EventEmitter;class index_es_V{constructor(s){this.client=s}}var dist_esm=__webpack_require__("./node_modules/@walletconnect/safe-json/dist/esm/index.js"),jsonrpc_provider_dist_index_es=__webpack_require__("./node_modules/@walletconnect/jsonrpc-provider/dist/index.es.js"),jsonrpc_utils_dist_esm=__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/index.js"),jsonrpc_ws_connection_dist_index_es=__webpack_require__("./node_modules/@walletconnect/jsonrpc-ws-connection/dist/index.es.js"),index_es_Buffer=__webpack_require__("./node_modules/buffer/index.js").Buffer,index_es_console=__webpack_require__("./node_modules/console-browserify/index.js"),index_es_process=__webpack_require__("./node_modules/process/browser.js");const B="wc@2:core:",index_es_Et_logger="error",index_es_It={database:":memory:"},index_es_Ct=cjs.ONE_DAY,index_es_je=cjs.SIX_HOURS,index_es_C_message="relayer_message",index_es_C_message_ack="relayer_message_ack",index_es_C_connect="relayer_connect",index_es_C_disconnect="relayer_disconnect",index_es_C_error="relayer_error",index_es_C_connection_stalled="relayer_connection_stalled",index_es_C_publish="relayer_publish",L_payload="payload",L_connect="connect",L_disconnect="disconnect",L_error="error",index_es_Q={link_mode:"link_mode",relay:"relay"},index_es_le_inbound="inbound",index_es_le_outbound="outbound",index_es_$_created="subscription_created",index_es_$_deleted="subscription_deleted",index_es_$_sync="subscription_sync",index_es_$_resubscribed="subscription_resubscribed",index_es_se=(cjs.FIVE_SECONDS,{wc_pairingDelete:{req:{ttl:cjs.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:cjs.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:cjs.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:cjs.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:cjs.ONE_DAY,prompt:!1,tag:0},res:{ttl:cjs.ONE_DAY,prompt:!1,tag:0}}}),index_es_re_create="pairing_create",index_es_re_expire="pairing_expire",index_es_re_delete="pairing_delete",index_es_re_ping="pairing_ping",index_es_F_created="history_created",index_es_F_updated="history_updated",index_es_F_deleted="history_deleted",index_es_F_sync="history_sync",index_es_M_created="expirer_created",index_es_M_deleted="expirer_deleted",index_es_M_expired="expirer_expired",index_es_M_sync="expirer_sync",index_es_ue="https://verify.walletconnect.org",Yt=`${index_es_ue}/v3`,index_es_Jt=["https://verify.walletconnect.com","https://verify.walletconnect.org"],index_es_G_pairing_started="pairing_started",index_es_G_pairing_uri_validation_success="pairing_uri_validation_success",index_es_G_pairing_uri_not_expired="pairing_uri_not_expired",index_es_G_store_new_pairing="store_new_pairing",index_es_G_subscribing_pairing_topic="subscribing_pairing_topic",index_es_G_subscribe_pairing_topic_success="subscribe_pairing_topic_success",index_es_G_existing_pairing="existing_pairing",index_es_G_pairing_not_expired="pairing_not_expired",index_es_G_emit_inactive_pairing="emit_inactive_pairing",index_es_G_emit_session_proposal="emit_session_proposal",index_es_Y_no_internet_connection="no_internet_connection",index_es_Y_malformed_pairing_uri="malformed_pairing_uri",index_es_Y_active_pairing_already_exists="active_pairing_already_exists",index_es_Y_subscribe_pairing_topic_failure="subscribe_pairing_topic_failure",index_es_Y_pairing_expired="pairing_expired",index_es_Y_proposal_listener_not_found="proposal_listener_not_found",index_es_er_session_approve_started="session_approve_started",index_es_er_session_namespaces_validation_success="session_namespaces_validation_success",index_es_er_subscribing_session_topic="subscribing_session_topic",index_es_er_subscribe_session_topic_success="subscribe_session_topic_success",index_es_er_publishing_session_approve="publishing_session_approve",index_es_er_session_approve_publish_success="session_approve_publish_success",index_es_er_store_session="store_session",index_es_er_publishing_session_settle="publishing_session_settle",index_es_er_session_settle_publish_success="session_settle_publish_success",index_es_tr_no_internet_connection="no_internet_connection",index_es_tr_proposal_expired="proposal_expired",index_es_tr_subscribe_session_topic_failure="subscribe_session_topic_failure",index_es_tr_session_approve_publish_failure="session_approve_publish_failure",index_es_tr_session_settle_publish_failure="session_settle_publish_failure",index_es_tr_session_approve_namespace_validation_failure="session_approve_namespace_validation_failure",index_es_tr_proposal_not_found="proposal_not_found",index_es_ir_authenticated_session_approve_started="authenticated_session_approve_started",index_es_ir_create_authenticated_session_topic="create_authenticated_session_topic",index_es_ir_cacaos_verified="cacaos_verified",index_es_ir_store_authenticated_session="store_authenticated_session",index_es_ir_subscribing_authenticated_session_topic="subscribing_authenticated_session_topic",index_es_ir_subscribe_authenticated_session_topic_success="subscribe_authenticated_session_topic_success",index_es_ir_publishing_authenticated_session_approve="publishing_authenticated_session_approve",index_es_sr_no_internet_connection="no_internet_connection",index_es_sr_invalid_cacao="invalid_cacao",index_es_sr_subscribe_authenticated_session_topic_failure="subscribe_authenticated_session_topic_failure",index_es_sr_authenticated_session_approve_publish_failure="authenticated_session_approve_publish_failure",index_es_sr_authenticated_session_pending_request_not_found="authenticated_session_pending_request_not_found";var index_es_nr=function index_es_rr(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),o=n.charCodeAt(0);if(255!==t[o])throw new TypeError(n+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),h=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function g(u){if("string"!=typeof u)throw new TypeError("Expected String");if(0===u.length)return new Uint8Array;var b=0;if(" "!==u[b]){for(var x=0,I=0;u[b]===c;)x++,b++;for(var D=(u.length-b)*h+1>>>0,j=new Uint8Array(D);u[b];){var T=t[u.charCodeAt(b)];if(255===T)return;for(var q=0,J=D-1;(0!==T||q<I)&&-1!==J;J--,q++)T+=a*j[J]>>>0,j[J]=T%256>>>0,T=T/256>>>0;if(0!==T)throw new Error("Non-zero carry");I=q,b++}if(" "!==u[b]){for(var K=D-I;K!==D&&0===j[K];)K++;for(var H=new Uint8Array(x+(D-K)),me=x;K!==D;)H[me++]=j[K++];return H}}}return{encode:function d(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===u.length)return"";for(var b=0,x=0,I=0,D=u.length;I!==D&&0===u[I];)I++,b++;for(var j=(D-I)*l+1>>>0,T=new Uint8Array(j);I!==D;){for(var q=u[I],J=0,K=j-1;(0!==q||J<x)&&-1!==K;K--,J++)q+=256*T[K]>>>0,T[K]=q%a>>>0,q=q/a>>>0;if(0!==q)throw new Error("Non-zero carry");x=J,I++}for(var H=j-x;H!==j&&0===T[H];)H++;for(var me=c.repeat(b);H<j;++H)me+=r.charAt(T[H]);return me},decodeUnsafe:g,decode:function _(u){var b=g(u);if(b)return b;throw new Error(`Non-${e} character`)}}},index_es_or=index_es_nr;const index_es_si=r=>{if(r instanceof Uint8Array&&"Uint8Array"===r.constructor.name)return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};class index_es_hr{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class index_es_lr{constructor(e,t,i){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return index_es_ri(this,e)}}class index_es_ur{constructor(e){this.decoders=e}or(e){return index_es_ri(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const index_es_ri=(r,e)=>new index_es_ur({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class index_es_dr{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new index_es_hr(e,t,i),this.decoder=new index_es_lr(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const index_es_Ee=({name:r,prefix:e,encode:t,decode:i})=>new index_es_dr(r,e,t,i),index_es_de=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=index_es_or(t,e);return index_es_Ee({prefix:r,name:e,encode:i,decode:n=>index_es_si(s(n))})},index_es_P=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>index_es_Ee({prefix:e,name:r,encode:s=>((r,e,t)=>{const i="="===e[e.length-1],s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),i)for(;n.length*t&7;)n+="=";return n})(s,i,t),decode:s=>((r,e,t,i)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let n=r.length;for(;"="===r[n-1];)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,h=0;for(let l=0;l<n;++l){const d=s[r[l]];if(void 0===d)throw new SyntaxError(`Non-${i} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(s,i,t,r)}),index_es_yr=index_es_Ee({prefix:"\0",name:"identity",encode:r=>(r=>(new TextDecoder).decode(r))(r),decode:r=>(r=>(new TextEncoder).encode(r))(r)});var index_es_br=Object.freeze({__proto__:null,identity:index_es_yr});const index_es_mr=index_es_P({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var index_es_fr=Object.freeze({__proto__:null,base2:index_es_mr});const index_es_Dr=index_es_P({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var index_es_vr=Object.freeze({__proto__:null,base8:index_es_Dr});const index_es_wr=index_es_de({prefix:"9",name:"base10",alphabet:"0123456789"});var index_es_r=Object.freeze({__proto__:null,base10:index_es_wr});const index_es_Er=index_es_P({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),index_es_Ir=index_es_P({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var index_es_Tr=Object.freeze({__proto__:null,base16:index_es_Er,base16upper:index_es_Ir});const index_es_Cr=index_es_P({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),index_es_Pr=index_es_P({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),index_es_Sr=index_es_P({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),index_es_Or=index_es_P({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),index_es_Rr=index_es_P({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),index_es_Ar=index_es_P({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),index_es_xr=index_es_P({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),index_es_Nr=index_es_P({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),index_es_$r=index_es_P({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var index_es_zr=Object.freeze({__proto__:null,base32:index_es_Cr,base32upper:index_es_Pr,base32pad:index_es_Sr,base32padupper:index_es_Or,base32hex:index_es_Rr,base32hexupper:index_es_Ar,base32hexpad:index_es_xr,base32hexpadupper:index_es_Nr,base32z:index_es_$r});const index_es_Lr=index_es_de({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),index_es_kr=index_es_de({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var index_es_jr=Object.freeze({__proto__:null,base36:index_es_Lr,base36upper:index_es_kr});const index_es_Ur=index_es_de({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),index_es_Fr=index_es_de({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var index_es_Mr=Object.freeze({__proto__:null,base58btc:index_es_Ur,base58flickr:index_es_Fr});const index_es_Kr=index_es_P({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),index_es_Br=index_es_P({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),index_es_Vr=index_es_P({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),index_es_qr=index_es_P({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var index_es_Gr=Object.freeze({__proto__:null,base64:index_es_Kr,base64pad:index_es_Br,base64url:index_es_Vr,base64urlpad:index_es_qr});const index_es_ni=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),index_es_Wr=index_es_ni.reduce((r,e,t)=>(r[t]=e,r),[]),index_es_Hr=index_es_ni.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);const index_es_Xr=index_es_Ee({prefix:"🚀",name:"base256emoji",encode:function index_es_Yr(r){return r.reduce((e,t)=>e+=index_es_Wr[t],"")},decode:function index_es_Jr(r){const e=[];for(const t of r){const i=index_es_Hr[t.codePointAt(0)];if(void 0===i)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}});var index_es_Zr=Object.freeze({__proto__:null,base256emoji:index_es_Xr}),index_es_Qr=function index_es_ai(r,e,t){e=e||[];for(var i=t=t||0;r>=index_es_sn;)e[t++]=255&r|index_es_oi,r/=128;for(;r&index_es_tn;)e[t++]=255&r|index_es_oi,r>>>=7;return e[t]=0|r,index_es_ai.bytes=t-i+1,e},index_es_oi=128,index_es_tn=-128,index_es_sn=Math.pow(2,31);var index_es_rn=function index_es_Me(r,i){var o,t=0,s=(i=i||0,0),n=i,a=r.length;do{if(n>=a)throw index_es_Me.bytes=0,new RangeError("Could not decode varint");o=r[n++],t+=s<28?(o&index_es_ci)<<s:(o&index_es_ci)*Math.pow(2,s),s+=7}while(o>=index_es_nn);return index_es_Me.bytes=n-i,t},index_es_nn=128,index_es_ci=127;var index_es_on=Math.pow(2,7),index_es_an=Math.pow(2,14),index_es_cn=Math.pow(2,21),index_es_hn=Math.pow(2,28),index_es_ln=Math.pow(2,35),index_es_un=Math.pow(2,42),index_es_dn=Math.pow(2,49),index_es_gn=Math.pow(2,56),index_es_pn=Math.pow(2,63),index_es_hi={encode:index_es_Qr,decode:index_es_rn,encodingLength:function(r){return r<index_es_on?1:r<index_es_an?2:r<index_es_cn?3:r<index_es_hn?4:r<index_es_ln?5:r<index_es_un?6:r<index_es_dn?7:r<index_es_gn?8:r<index_es_pn?9:10}};const index_es_li=(r,e,t=0)=>(index_es_hi.encode(r,e,t),e),index_es_ui=r=>index_es_hi.encodingLength(r),index_es_Ke=(r,e)=>{const t=e.byteLength,i=index_es_ui(r),s=i+index_es_ui(t),n=new Uint8Array(s+t);return index_es_li(r,n,0),index_es_li(t,n,i),n.set(e,s),new index_es_mn(r,t,e,n)};class index_es_mn{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const index_es_di=({name:r,code:e,encode:t})=>new index_es_fn(r,e,t);class index_es_fn{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?index_es_Ke(this.code,t):t.then(i=>index_es_Ke(this.code,i))}throw Error("Unknown type, must be binary type")}}const index_es_gi=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),index_es_Dn=index_es_di({name:"sha2-256",code:18,encode:index_es_gi("SHA-256")}),vn=index_es_di({name:"sha2-512",code:19,encode:index_es_gi("SHA-512")});Object.freeze({__proto__:null,sha256:index_es_Dn,sha512:vn});const index_es_yi=index_es_si,index_es_In={code:0,name:"identity",encode:index_es_yi,digest:r=>index_es_Ke(0,index_es_yi(r))};Object.freeze({__proto__:null,identity:index_es_In});new TextEncoder,new TextDecoder;const index_es_bi={...index_es_br,...index_es_fr,...index_es_vr,...index_es_r,...index_es_Tr,...index_es_zr,...index_es_jr,...index_es_Mr,...index_es_Gr,...index_es_Zr};function index_es_mi(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const index_es_fi=index_es_mi("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>(new TextEncoder).encode(r.substring(1))),Be=index_es_mi("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{const e=function index_es_Cn(r=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}((r=r.substring(1)).length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),index_es_Pn={utf8:index_es_fi,"utf-8":index_es_fi,hex:index_es_bi.base16,latin1:Be,ascii:Be,binary:Be,...index_es_bi};var index_es_On=Object.defineProperty,W=(r,e,t)=>((r,e,t)=>e in r?index_es_On(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class index_es_Di{constructor(e,t){this.core=e,this.logger=t,W(this,"keychain",new Map),W(this,"name","keychain"),W(this,"version","0.3"),W(this,"initialized",!1),W(this,"storagePrefix",B),W(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),W(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),W(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),W(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=ht("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),W(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=(0,logger_dist_index_es.U5)(t,this.name)}get context(){return(0,logger_dist_index_es.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,fi(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?li(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=ht("NOT_INITIALIZED",this.name);throw new Error(e)}}}var index_es_An=Object.defineProperty,index_es_S=(r,e,t)=>((r,e,t)=>e in r?index_es_An(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class index_es_vi{constructor(e,t,i){this.core=e,this.logger=t,index_es_S(this,"name","crypto"),index_es_S(this,"keychain"),index_es_S(this,"randomSessionIdentifier",jc()),index_es_S(this,"initialized",!1),index_es_S(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),index_es_S(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),index_es_S(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=index_es.TZ(s);return index_es.UF(n.publicKey)}),index_es_S(this,"generateKeyPair",()=>{this.isInitialized();const s=function Lc(){const t=fn.utils.randomPrivateKey(),e=fn.getPublicKey(t);return{privateKey:(0,src.dI)(t,G),publicKey:(0,src.dI)(e,G)}}();return this.setPrivateKey(s.publicKey,s.privateKey)}),index_es_S(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),o=index_es.TZ(n),a=this.randomSessionIdentifier,c=index_es_Ct;return await index_es.FA(a,s,c,o)}),index_es_S(this,"generateSharedKey",(s,n,o)=>{this.isInitialized();const c=function Cc(t,e){const n=fn.getSharedSecret((0,src.sH)(t,G),(0,src.sH)(e,G)),r=Vs(Qt,n,void 0,void 0,32);return(0,src.dI)(r,G)}(this.getPrivateKey(s),n);return this.setSymKey(c,o)}),index_es_S(this,"setSymKey",async(s,n)=>{this.isInitialized();const o=n||Pc(s);return await this.keychain.set(o,s),o}),index_es_S(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),index_es_S(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),index_es_S(this,"encode",async(s,n,o)=>{this.isInitialized();const a=oo(o),c=(0,dist_esm.h)(n);if(Fc(a))return function Dc(t,e){const n=pn(2),r=Lt(12),i=gn({type:n,sealed:(0,src.sH)(t,Kt),iv:r});return e===xe?no(i):i}(c,o?.encoding);if(Kc(a)){const g=a.senderPublicKey,_=a.receiverPublicKey;s=await this.generateSharedKey(g,_)}const h=this.getSymKey(s),{type:l,senderPublicKey:d}=a;return function Vc(t){const e=pn(typeof t.type<"u"?t.type:0);if(1===Bt(e)&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof t.senderPublicKey<"u"?(0,src.sH)(t.senderPublicKey,G):void 0,r=typeof t.iv<"u"?(0,src.sH)(t.iv,G):Lt(12),o=(0,src.sH)(t.symKey,G),s=gn({type:e,sealed:$r(o,r).encrypt((0,src.sH)(t.message,Kt)),iv:r,senderPublicKey:n});return t.encoding===xe?no(s):s}({type:l,symKey:h,message:c,senderPublicKey:d,encoding:o?.encoding})}),index_es_S(this,"decode",async(s,n,o)=>{this.isInitialized();const a=function qc(t,e){const n=Se({encoded:t,encoding:e?.encoding});return oo({type:Bt(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?(0,src.dI)(n.senderPublicKey,G):void 0,receiverPublicKey:e?.receiverPublicKey})}(n,o);if(Fc(a)){const c=function Hc(t,e){const{sealed:n}=Se({encoded:t,encoding:e});return(0,src.dI)(n,Kt)}(n,o?.encoding);return(0,dist_esm.j)(c)}if(Kc(a)){const c=a.receiverPublicKey,h=a.senderPublicKey;s=await this.generateSharedKey(c,h)}try{const h=function Mc(t){const e=(0,src.sH)(t.symKey,G),{sealed:n,iv:r}=Se({encoded:t.encoded,encoding:t.encoding}),o=$r(e,r).decrypt(n);if(null===o)throw new Error("Failed to decrypt");return(0,src.dI)(o,Kt)}({symKey:this.getSymKey(s),encoded:n,encoding:o?.encoding});return(0,dist_esm.j)(h)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),index_es_S(this,"getPayloadType",(s,n=qt)=>Bt(Se({encoded:s,encoding:n}).type)),index_es_S(this,"getPayloadSenderPublicKey",(s,n=qt)=>{const o=Se({encoded:s,encoding:n});return o.senderPublicKey?(0,src.dI)(o.senderPublicKey,G):void 0}),this.core=e,this.logger=(0,logger_dist_index_es.U5)(t,this.name),this.keychain=i||new index_es_Di(this.core,this.logger)}get context(){return(0,logger_dist_index_es.oI)(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get("client_ed25519_seed")}catch{e=jc(),await this.keychain.set("client_ed25519_seed",e)}return function Sn(r,e="utf8"){const t=index_es_Pn[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.decoder.decode(`${t.prefix}${r}`):globalThis.Buffer.from(r,"utf8")}(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=ht("NOT_INITIALIZED",this.name);throw new Error(e)}}}var index_es_Nn=Object.defineProperty,index_es_$n=Object.defineProperties,index_es_zn=Object.getOwnPropertyDescriptors,index_es_wi=Object.getOwnPropertySymbols,index_es_Ln=Object.prototype.hasOwnProperty,index_es_kn=Object.prototype.propertyIsEnumerable,index_es_Ve=(r,e,t)=>e in r?index_es_Nn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,index_es_k=(r,e,t)=>index_es_Ve(r,"symbol"!=typeof e?e+"":e,t);class index_es_i extends y{constructor(e,t){super(e,t),this.logger=e,this.core=t,index_es_k(this,"messages",new Map),index_es_k(this,"messagesWithoutClientAck",new Map),index_es_k(this,"name","messages"),index_es_k(this,"version","0.3"),index_es_k(this,"initialized",!1),index_es_k(this,"storagePrefix",B),index_es_k(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),index_es_k(this,"set",async(i,s,n)=>{this.isInitialized();const o=kc(s);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(i,a),n===index_es_le_inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,((r,e)=>index_es_$n(r,index_es_zn(e)))(((r,e)=>{for(var t in e||(e={}))index_es_Ln.call(e,t)&&index_es_Ve(r,t,e[t]);if(index_es_wi)for(var t of index_es_wi(e))index_es_kn.call(e,t)&&index_es_Ve(r,t,e[t]);return r})({},c),{[o]:s}))}return await this.persist(),o}),index_es_k(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),index_es_k(this,"getWithoutAck",i=>{this.isInitialized();const s={};for(const n of i){const o=this.messagesWithoutClientAck.get(n)||{};s[n]=Object.values(o)}return s}),index_es_k(this,"has",(i,s)=>{this.isInitialized();return typeof this.get(i)[kc(s)]<"u"}),index_es_k(this,"ack",async(i,s)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(i);if(typeof n>"u")return;delete n[kc(s)],0===Object.keys(n).length?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,n),await this.persist()}),index_es_k(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=(0,logger_dist_index_es.U5)(e,this.name),this.core=t}get context(){return(0,logger_dist_index_es.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,fi(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,fi(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?li(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?li(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=ht("NOT_INITIALIZED",this.name);throw new Error(e)}}}var index_es_Fn=Object.defineProperty,index_es_Mn=Object.defineProperties,index_es_Kn=Object.getOwnPropertyDescriptors,index_es_Ei=Object.getOwnPropertySymbols,index_es_Bn=Object.prototype.hasOwnProperty,index_es_Vn=Object.prototype.propertyIsEnumerable,index_es_qe=(r,e,t)=>e in r?index_es_Fn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ie=(r,e)=>{for(var t in e||(e={}))index_es_Bn.call(e,t)&&index_es_qe(r,t,e[t]);if(index_es_Ei)for(var t of index_es_Ei(e))index_es_Vn.call(e,t)&&index_es_qe(r,t,e[t]);return r},index_es_Ge=(r,e)=>index_es_Mn(r,index_es_Kn(e)),dist_index_es_V=(r,e,t)=>index_es_qe(r,"symbol"!=typeof e?e+"":e,t);class index_es_qn extends m{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,dist_index_es_V(this,"events",new events.EventEmitter),dist_index_es_V(this,"name","publisher"),dist_index_es_V(this,"queue",new Map),dist_index_es_V(this,"publishTimeout",(0,cjs.toMiliseconds)(cjs.ONE_MINUTE)),dist_index_es_V(this,"initialPublishTimeout",(0,cjs.toMiliseconds)(15*cjs.ONE_SECOND)),dist_index_es_V(this,"needsTransportRestart",!1),dist_index_es_V(this,"publish",async(i,s,n)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const a=n?.ttl||index_es_je,c=Zc(n),h=n?.prompt||!1,l=n?.tag||0,d=n?.id||(0,jsonrpc_utils_dist_esm.getBigIntRpcId)().toString(),g={topic:i,message:s,opts:{ttl:a,relay:c,prompt:h,tag:l,id:d,attestation:n?.attestation,tvf:n?.tvf}},_=`Failed to publish payload, please try again. id:${d} tag:${l}`;try{const u=new Promise(async b=>{const x=({id:D})=>{g.opts.id===D&&(this.removeRequestFromQueue(D),this.relayer.events.removeListener(index_es_C_publish,x),b(g))};this.relayer.events.on(index_es_C_publish,x);const I=yi(new Promise((D,j)=>{this.rpcPublish({topic:i,message:s,ttl:a,prompt:h,tag:l,id:d,attestation:n?.attestation,tvf:n?.tvf}).then(D).catch(T=>{this.logger.warn(T,T?.message),j(T)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${l}`);try{await I,this.events.removeListener(index_es_C_publish,x)}catch(D){this.queue.set(d,index_es_Ge(Ie({},g),{attempt:1})),this.logger.warn(D,D?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:i,message:s,opts:n}}),await yi(u,this.publishTimeout,_)}catch(u){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(u),null!=(o=n?.internal)&&o.throwOnFailedPublish)throw u}finally{this.queue.delete(d)}}),dist_index_es_V(this,"on",(i,s)=>{this.events.on(i,s)}),dist_index_es_V(this,"once",(i,s)=>{this.events.once(i,s)}),dist_index_es_V(this,"off",(i,s)=>{this.events.off(i,s)}),dist_index_es_V(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=(0,logger_dist_index_es.U5)(t,this.name),this.registerEventListeners()}get context(){return(0,logger_dist_index_es.oI)(this.logger)}async rpcPublish(e){var t,i,s,n;const{topic:o,message:a,ttl:c=index_es_je,prompt:h,tag:l,id:d,attestation:g,tvf:_}=e,u={method:Yc(Zc().protocol).publish,params:Ie({topic:o,message:a,ttl:c,prompt:h,tag:l,attestation:g},_),id:d};Et(null==(t=u.params)?void 0:t.prompt)&&(null==(i=u.params)||delete i.prompt),Et(null==(s=u.params)?void 0:s.tag)&&(null==(n=u.params)||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:u});const b=await this.relayer.request(u);return this.relayer.events.emit(index_es_C_publish,e),this.logger.debug("Successfully Published Payload"),b}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{const i=e.attempt+1;this.queue.set(t,index_es_Ge(Ie({},e),{attempt:i}));const{topic:s,message:n,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${i}`),await this.rpcPublish(index_es_Ge(Ie({},e),{topic:s,message:n,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(heartbeat_dist_index_es.li.pulse,()=>{if(this.needsTransportRestart)return this.needsTransportRestart=!1,void this.relayer.events.emit(index_es_C_connection_stalled);this.checkQueue()}),this.relayer.on(index_es_C_message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var index_es_Gn=Object.defineProperty,index_es_ne=(r,e,t)=>((r,e,t)=>e in r?index_es_Gn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class index_es_Hn{constructor(){index_es_ne(this,"map",new Map),index_es_ne(this,"set",(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),index_es_ne(this,"get",e=>this.map.get(e)||[]),index_es_ne(this,"exists",(e,t)=>this.get(e).includes(t)),index_es_ne(this,"delete",(e,t)=>{if(typeof t>"u")return void this.map.delete(e);if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(n=>n!==t);s.length?this.map.set(e,s):this.map.delete(e)}),index_es_ne(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var index_es_Yn=Object.defineProperty,index_es_Jn=Object.defineProperties,index_es_Xn=Object.getOwnPropertyDescriptors,index_es_Ii=Object.getOwnPropertySymbols,index_es_Zn=Object.prototype.hasOwnProperty,index_es_Qn=Object.prototype.propertyIsEnumerable,index_es_We=(r,e,t)=>e in r?index_es_Yn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,index_es_ge=(r,e)=>{for(var t in e||(e={}))index_es_Zn.call(e,t)&&index_es_We(r,t,e[t]);if(index_es_Ii)for(var t of index_es_Ii(e))index_es_Qn.call(e,t)&&index_es_We(r,t,e[t]);return r},index_es_He=(r,e)=>index_es_Jn(r,index_es_Xn(e)),index_es_f=(r,e,t)=>index_es_We(r,"symbol"!=typeof e?e+"":e,t);class index_es_Ti extends P{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,index_es_f(this,"subscriptions",new Map),index_es_f(this,"topicMap",new index_es_Hn),index_es_f(this,"events",new events.EventEmitter),index_es_f(this,"name","subscription"),index_es_f(this,"version","0.3"),index_es_f(this,"pending",new Map),index_es_f(this,"cached",[]),index_es_f(this,"initialized",!1),index_es_f(this,"storagePrefix",B),index_es_f(this,"subscribeTimeout",(0,cjs.toMiliseconds)(cjs.ONE_MINUTE)),index_es_f(this,"initialSubscribeTimeout",(0,cjs.toMiliseconds)(15*cjs.ONE_SECOND)),index_es_f(this,"clientId"),index_es_f(this,"batchSubscribeTopicsLimit",500),index_es_f(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),index_es_f(this,"subscribe",async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const n=Zc(s),o={topic:i,relay:n,transportType:s?.transportType};this.pending.set(i,o);const a=await this.rpcSubscribe(i,n,s);return"string"==typeof a&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),index_es_f(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof s?.id<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),index_es_f(this,"isSubscribed",i=>new Promise(s=>{s(this.topicMap.topics.includes(i))})),index_es_f(this,"isKnownTopic",i=>new Promise(s=>{s(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(n=>n.topic===i))})),index_es_f(this,"on",(i,s)=>{this.events.on(i,s)}),index_es_f(this,"once",(i,s)=>{this.events.once(i,s)}),index_es_f(this,"off",(i,s)=>{this.events.off(i,s)}),index_es_f(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),index_es_f(this,"start",async()=>{await this.onConnect()}),index_es_f(this,"stop",async()=>{await this.onDisconnect()}),index_es_f(this,"restart",async()=>{await this.restore(),await this.onRestart()}),index_es_f(this,"checkPending",async()=>{if(!(0!==this.pending.size||this.initialized&&this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),index_es_f(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(heartbeat_dist_index_es.li.pulse,async()=>{await this.checkPending()}),this.events.on(index_es_$_created,async i=>{const s=index_es_$_created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(index_es_$_deleted,async i=>{const s=index_es_$_deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=(0,logger_dist_index_es.U5)(t,this.name),this.clientId=""}get context(){return(0,logger_dist_index_es.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const s=Zc(i);await this.restartToComplete({topic:e,id:t,relay:s}),await this.rpcUnsubscribe(e,t,s);const n=Nt("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t,i){var s;(!i||i?.transportType===index_es_Q.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const n={method:Yc(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const o=null==(s=i?.internal)?void 0:s.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if(i?.transportType===index_es_Q.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(l=>this.logger.warn(l))},(0,cjs.toMiliseconds)(cjs.ONE_SECOND)),a;const c=new Promise(async l=>{const d=g=>{g.topic===e&&(this.events.removeListener(index_es_$_created,d),l(g.id))};this.events.on(index_es_$_created,d);try{const g=await yi(new Promise((_,u)=>{this.relayer.request(n).catch(b=>{this.logger.warn(b,b?.message),u(b)}).then(_)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(index_es_$_created,d),l(g)}catch{}}),h=await yi(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!h&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return h?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(index_es_C_connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const i={method:Yc(e[0].relay.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await yi(new Promise(s=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(index_es_C_connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const i={method:Yc(e[0].relay.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};let s;this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{s=await await yi(new Promise((n,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(index_es_C_connection_stalled)}return s}rpcUnsubscribe(e,t,i){const s={method:Yc(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,index_es_He(index_es_ge({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,index_es_ge({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,index_es_ge({},t)),this.topicMap.set(t.topic,e),this.events.emit(index_es_$_created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=ht("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(index_es_$_deleted,index_es_He(index_es_ge({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(index_es_$_sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<t;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(index_es_$_resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=ht("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>index_es_He(index_es_ge({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await function Ni(t){return new Promise(e=>setTimeout(e,t))}((0,cjs.toMiliseconds)(cjs.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=ht("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return kc(e+await this.getClientId())}}var index_es_eo=Object.defineProperty,index_es_Ci=Object.getOwnPropertySymbols,index_es_to=Object.prototype.hasOwnProperty,index_es_io=Object.prototype.propertyIsEnumerable,index_es_Ye=(r,e,t)=>e in r?index_es_eo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,index_es_Pi=(r,e)=>{for(var t in e||(e={}))index_es_to.call(e,t)&&index_es_Ye(r,t,e[t]);if(index_es_Ci)for(var t of index_es_Ci(e))index_es_io.call(e,t)&&index_es_Ye(r,t,e[t]);return r},index_es_y=(r,e,t)=>index_es_Ye(r,"symbol"!=typeof e?e+"":e,t);class index_es_Si extends d{constructor(e){super(e),index_es_y(this,"protocol","wc"),index_es_y(this,"version",2),index_es_y(this,"core"),index_es_y(this,"logger"),index_es_y(this,"events",new events.EventEmitter),index_es_y(this,"provider"),index_es_y(this,"messages"),index_es_y(this,"subscriber"),index_es_y(this,"publisher"),index_es_y(this,"name","relayer"),index_es_y(this,"transportExplicitlyClosed",!1),index_es_y(this,"initialized",!1),index_es_y(this,"connectionAttemptInProgress",!1),index_es_y(this,"relayUrl"),index_es_y(this,"projectId"),index_es_y(this,"packageName"),index_es_y(this,"bundleId"),index_es_y(this,"hasExperiencedNetworkDisruption",!1),index_es_y(this,"pingTimeout"),index_es_y(this,"heartBeatTimeout",(0,cjs.toMiliseconds)(cjs.THIRTY_SECONDS+cjs.FIVE_SECONDS)),index_es_y(this,"reconnectTimeout"),index_es_y(this,"connectPromise"),index_es_y(this,"reconnectInProgress",!1),index_es_y(this,"requestsInFlight",[]),index_es_y(this,"connectTimeout",(0,cjs.toMiliseconds)(15*cjs.ONE_SECOND)),index_es_y(this,"request",async t=>{var i,s;this.logger.debug("Publishing Request Payload");const n=t.id||(0,jsonrpc_utils_dist_esm.getBigIntRpcId)().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:t.method,topic:null==(i=t.params)?void 0:i.topic},"relayer.request - publishing...");const o=`${n}:${(null==(s=t.params)?void 0:s.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),index_es_y(this,"resetPingTimeout",()=>{_e()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,i,s,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(n=null==(s=null==(i=null==(t=this.provider)?void 0:t.connection)?void 0:i.socket)?void 0:s.terminate)||n.call(s)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),index_es_y(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),index_es_y(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit(index_es_C_connect)}),index_es_y(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()}),index_es_y(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(index_es_C_error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),index_es_y(this,"registerProviderListeners",()=>{this.provider.on(L_payload,this.onPayloadHandler),this.provider.on(L_connect,this.onConnectHandler),this.provider.on(L_disconnect,this.onDisconnectHandler),this.provider.on(L_error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&"string"!=typeof e.logger?(0,logger_dist_index_es.U5)(e.logger,this.name):(0,logger_dist_index_es.h6)((0,logger_dist_index_es.iP)({level:e.logger||"error"})),this.messages=new index_es_i(this.logger,e.core),this.subscriber=new index_es_Ti(this,this.logger),this.publisher=new index_es_qn(this,this.logger),this.relayUrl=e?.relayUrl||"wss://relay.walletconnect.org",this.projectId=e.projectId,function ei(){return pt()&&typeof __webpack_require__.g<"u"&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Platform)<"u"&&"android"===(null==__webpack_require__.g?void 0:__webpack_require__.g.Platform.OS)}()?this.packageName=ri():function ni(){return pt()&&typeof __webpack_require__.g<"u"&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Platform)<"u"&&"ios"===(null==__webpack_require__.g?void 0:__webpack_require__.g.Platform.OS)}()&&(this.bundleId=ri()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return(0,logger_dist_index_es.oI)(this.logger)}get connected(){var e,t,i;return 1===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||!1}get connecting(){var e,t,i;return 0===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||void 0!==this.connectPromise||!1}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:index_es_Q.relay},index_es_le_outbound)}async subscribe(e,t){var i,s,n;this.isInitialized(),(null==t||!t.transportType||"relay"===t?.transportType)&&await this.toEstablishConnection();const o=typeof(null==(i=t?.internal)?void 0:i.throwOnFailedPublish)>"u"||(null==(s=t?.internal)?void 0:s.throwOnFailedPublish);let c,a=(null==(n=this.subscriber.topicMap.get(e))?void 0:n[0])||"";const h=l=>{l.topic===e&&(this.subscriber.off(index_es_$_created,h),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(index_es_$_created,h)}),new Promise(async(l,d)=>{a=await this.subscriber.subscribe(e,index_es_Pi({internal:{throwOnFailedPublish:o}},t)).catch(g=>{o&&d(g)})||a,l()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await yi(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(this.subscriber.hasAnyTopics){if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,i)=>{await this.connect(e).then(t).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}else this.logger.warn("Starting WS connection skipped because the client has no topics to work with.")}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Na())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(0===e?.length)return void this.logger.trace("Batch message events is empty. Ignoring...");const t=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(const i of t)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+s?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:i}=e;if(!t.sessionExists){const n={topic:i,expiry:Ei(cjs.FIVE_MINUTES),relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(index_es_C_message,e),await this.recordMessageEvent(e,index_es_le_inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(L_disconnect,n),await yi(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(L_disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(L_disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(L_disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(i=>setTimeout(i,(0,cjs.toMiliseconds)(1*t))),t++}}startPingTimeout(){var e,t,i,s,n;if(_e())try{null!=(t=null==(e=this.provider)?void 0:e.connection)&&t.socket&&(null==(n=null==(s=null==(i=this.provider)?void 0:i.connection)?void 0:s.socket)||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new jsonrpc_provider_dist_index_es.F(new jsonrpc_ws_connection_dist_index_es.A(si({sdkVersion:"2.21.1",protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){const{topic:i,message:s}=e;await this.messages.set(i,s,t)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;if(!i||0===i.length)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;const s=this.messages.has(t,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),(0,jsonrpc_utils_dist_esm.isJsonRpcRequest)(e)){if(!e.method.endsWith("_subscription"))return;const t=e.params,{topic:i,message:s,publishedAt:n,attestation:o}=t.data,a={topic:i,message:s,publishedAt:n,transportType:index_es_Q.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(index_es_Pi({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else(0,jsonrpc_utils_dist_esm.isJsonRpcResponse)(e)&&this.events.emit(index_es_C_message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,index_es_le_inbound),this.events.emit(index_es_C_message,e))}async acknowledgePayload(e){const t=(0,jsonrpc_utils_dist_esm.formatJsonRpcResult)(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(L_payload,this.onPayloadHandler),this.provider.off(L_connect,this.onConnectHandler),this.provider.off(L_disconnect,this.onDisconnectHandler),this.provider.off(L_error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Na();Ua(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(i=>this.logger.error(i,i?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(heartbeat_dist_index_es.li.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&function Ta(){var t;return!Tt()||!(0,dist_cjs.getDocument)()||"visible"===(null==(t=(0,dist_cjs.getDocument)())?void 0:t.visibilityState)}())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(t){this.logger.warn(t,t?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(index_es_C_disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,cjs.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){const{message:e}=ht("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void await this.connectPromise;await this.connect()}}}function index_es_so(){}function index_es_Oi(r){if(!r||"object"!=typeof r)return!1;const e=Object.getPrototypeOf(r);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&"[object Object]"===Object.prototype.toString.call(r)}function index_es_Ri(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function index_es_Ai(r){return null==r?void 0===r?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}function pe(r,e,t,i,s,n,o){const a=o(r,e,t,i,s,n);if(void 0!==a)return a;if(typeof r==typeof e)switch(typeof r){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return r===e;case"number":return r===e||Object.is(r,e);case"object":return index_es_ye(r,e,n,o)}return index_es_ye(r,e,n,o)}function index_es_ye(r,e,t,i){if(Object.is(r,e))return!0;let s=index_es_Ai(r),n=index_es_Ai(e);if("[object Arguments]"===s&&(s="[object Object]"),"[object Arguments]"===n&&(n="[object Object]"),s!==n)return!1;switch(s){case"[object String]":return r.toString()===e.toString();case"[object Number]":return function index_es_Oo(r,e){return r===e||Number.isNaN(r)&&Number.isNaN(e)}(r.valueOf(),e.valueOf());case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(r.valueOf(),e.valueOf());case"[object RegExp]":return r.source===e.source&&r.flags===e.flags;case"[object Function]":return r===e}const o=(t=t??new Map).get(r),a=t.get(e);if(null!=o&&null!=a)return o===e;t.set(r,e),t.set(e,r);try{switch(s){case"[object Map]":if(r.size!==e.size)return!1;for(const[c,h]of r.entries())if(!e.has(c)||!pe(h,e.get(c),c,r,e,t,i))return!1;return!0;case"[object Set]":{if(r.size!==e.size)return!1;const c=Array.from(r.values()),h=Array.from(e.values());for(let l=0;l<c.length;l++){const d=c[l],g=h.findIndex(_=>pe(d,_,void 0,r,e,t,i));if(-1===g)return!1;h.splice(g,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if(typeof index_es_Buffer<"u"&&index_es_Buffer.isBuffer(r)!==index_es_Buffer.isBuffer(e)||r.length!==e.length)return!1;for(let c=0;c<r.length;c++)if(!pe(r[c],e[c],c,r,e,t,i))return!1;return!0;case"[object ArrayBuffer]":return r.byteLength===e.byteLength&&index_es_ye(new Uint8Array(r),new Uint8Array(e),t,i);case"[object DataView]":return r.byteLength===e.byteLength&&r.byteOffset===e.byteOffset&&index_es_ye(new Uint8Array(r),new Uint8Array(e),t,i);case"[object Error]":return r.name===e.name&&r.message===e.message;case"[object Object]":{if(!(index_es_ye(r.constructor,e.constructor,t,i)||index_es_Oi(r)&&index_es_Oi(e)))return!1;const h=[...Object.keys(r),...index_es_Ri(r)],l=[...Object.keys(e),...index_es_Ri(e)];if(h.length!==l.length)return!1;for(let d=0;d<h.length;d++){const g=h[d],_=r[g];if(!Object.hasOwn(e,g))return!1;if(!pe(_,e[g],g,r,e,t,i))return!1}return!0}default:return!1}}finally{t.delete(r),t.delete(e)}}function index_es_Ao(r,e){return function index_es_Ro(r,e,t){return pe(r,e,void 0,void 0,void 0,void 0,t)}(r,e,index_es_so)}var index_es_xo=Object.defineProperty,index_es_Ni=Object.getOwnPropertySymbols,index_es_No=Object.prototype.hasOwnProperty,index_es_$o=Object.prototype.propertyIsEnumerable,index_es_Xe=(r,e,t)=>e in r?index_es_xo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,index_es_$i=(r,e)=>{for(var t in e||(e={}))index_es_No.call(e,t)&&index_es_Xe(r,t,e[t]);if(index_es_Ni)for(var t of index_es_Ni(e))index_es_$o.call(e,t)&&index_es_Xe(r,t,e[t]);return r},z=(r,e,t)=>index_es_Xe(r,"symbol"!=typeof e?e+"":e,t);class index_es_zi extends f{constructor(e,t,i,s=B,n=void 0){super(e,t,i,s),this.core=e,this.logger=t,this.name=i,z(this,"map",new Map),z(this,"version","0.3"),z(this,"cached",[]),z(this,"initialized",!1),z(this,"getKey"),z(this,"storagePrefix",B),z(this,"recentlyDeleted",[]),z(this,"recentlyDeletedLimit",200),z(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&null!==o&&!Et(o)?this.map.set(this.getKey(o),o):function la(t){var e;return null==(e=t?.proposer)?void 0:e.publicKey}(o)?this.map.set(o.id,o):function da(t){return t?.topic}(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),z(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),z(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),z(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>index_es_Ao(a[c],o[c]))):this.values)),z(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=index_es_$i(index_es_$i({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),z(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=(0,logger_dist_index_es.U5)(t,this.name),this.storagePrefix=s,this.getKey=n}get context(){return(0,logger_dist_index_es.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:s}=ht("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=ht("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=ht("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=ht("NOT_INITIALIZED",this.name);throw new Error(e)}}}var index_es_zo=Object.defineProperty,index_es_p=(r,e,t)=>((r,e,t)=>e in r?index_es_zo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class index_es_Li{constructor(e,t){this.core=e,this.logger=t,index_es_p(this,"name","pairing"),index_es_p(this,"version","0.3"),index_es_p(this,"events",new(events_default())),index_es_p(this,"pairings"),index_es_p(this,"initialized",!1),index_es_p(this,"storagePrefix",B),index_es_p(this,"ignoredPayloadTypes",[1]),index_es_p(this,"registeredMethods",[]),index_es_p(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),index_es_p(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),index_es_p(this,"create",async i=>{this.isInitialized();const s=jc(),n=await this.core.crypto.setSymKey(s),o=Ei(cjs.FIVE_MINUTES),a={protocol:"irn"},c={topic:n,expiry:o,relay:a,active:!1,methods:i?.methods},h=Wc({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:i?.methods});return this.events.emit(index_es_re_create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:i?.transportType}),{topic:n,uri:h}}),index_es_p(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i?.uri,trace:[index_es_G_pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:h}=Gc(i.uri);let l;if(s.props.properties.topic=n,s.addTrace(index_es_G_pairing_uri_validation_success),s.addTrace(index_es_G_pairing_uri_not_expired),this.pairings.keys.includes(n)){if(l=this.pairings.get(n),s.addTrace(index_es_G_existing_pairing),l.active)throw s.setError(index_es_Y_active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(index_es_G_pairing_not_expired)}const d=c||Ei(cjs.FIVE_MINUTES),g={topic:n,relay:a,expiry:d,active:!1,methods:h};this.core.expirer.set(n,d),await this.pairings.set(n,g),s.addTrace(index_es_G_store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(index_es_re_create,g),s.addTrace(index_es_G_emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(index_es_G_subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(index_es_Y_no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(_){throw s.setError(index_es_Y_subscribe_pairing_topic_failure),_}return s.addTrace(index_es_G_subscribe_pairing_topic_success),g}),index_es_p(this,"activate",async({topic:i})=>{this.isInitialized();const s=Ei(cjs.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),index_es_p(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=gi();this.events.once(xi("pairing_ping",n),({error:h})=>{h?c(h):a()}),await o()}}),index_es_p(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),index_es_p(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),index_es_p(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),index_es_p(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Nt("USER_DISCONNECTED")),await this.deletePairing(s))}),index_es_p(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(s);return Wc({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),index_es_p(this,"sendRequest",async(i,s,n)=>{const o=(0,jsonrpc_utils_dist_esm.formatJsonRpcRequest)(s,n),a=await this.core.crypto.encode(i,o),c=index_es_se[s].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),index_es_p(this,"sendResult",async(i,s,n)=>{const o=(0,jsonrpc_utils_dist_esm.formatJsonRpcResult)(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,h=index_es_se[c].res;await this.core.relayer.publish(s,a,h),await this.core.history.resolve(o)}),index_es_p(this,"sendError",async(i,s,n)=>{const o=(0,jsonrpc_utils_dist_esm.formatJsonRpcError)(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,h=index_es_se[c]?index_es_se[c].res:index_es_se.unregistered_method.res;await this.core.relayer.publish(s,a,h),await this.core.history.resolve(o)}),index_es_p(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Nt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),index_es_p(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>vi(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),index_es_p(this,"onRelayEventRequest",async i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,n);default:return await this.onUnknownRpcMethodRequest(s,n)}}),index_es_p(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,o=(await this.core.history.get(s,n.id)).request.method;return"wc_pairingPing"===o?this.onPairingPingResponse(s,n):this.onUnknownRpcMethodResponse(o)}),index_es_p(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(index_es_re_ping,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),index_es_p(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{(0,jsonrpc_utils_dist_esm.isJsonRpcResult)(s)?this.events.emit(xi("pairing_ping",n),{}):(0,jsonrpc_utils_dist_esm.isJsonRpcError)(s)&&this.events.emit(xi("pairing_ping",n),{error:s.error})},500)}),index_es_p(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(index_es_re_delete,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),index_es_p(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=Nt("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,i,a),this.logger.error(a)}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),index_es_p(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(Nt("WC_METHOD_UNSUPPORTED",i))}),index_es_p(this,"isValidPair",(i,s)=>{var n;if(!ma(i)){const{message:a}=ht("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(index_es_Y_malformed_pairing_uri),new Error(a)}if(!function fa(t){function e(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(nt(t,!1))return!!e(t)||e(je(t))}catch{}return!1}(i.uri)){const{message:a}=ht("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(index_es_Y_malformed_pairing_uri),new Error(a)}const o=Gc(i?.uri);if(null==(n=o?.relay)||!n.protocol){const{message:a}=ht("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(index_es_Y_malformed_pairing_uri),new Error(a)}if(null==o||!o.symKey){const{message:a}=ht("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(index_es_Y_malformed_pairing_uri),new Error(a)}if(null!=o&&o.expiryTimestamp&&(0,cjs.toMiliseconds)(o?.expiryTimestamp)<Date.now()){s.setError(index_es_Y_pairing_expired);const{message:a}=ht("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),index_es_p(this,"isValidPing",async i=>{if(!ma(i)){const{message:n}=ht("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),index_es_p(this,"isValidDisconnect",async i=>{if(!ma(i)){const{message:n}=ht("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),index_es_p(this,"isValidPairingTopic",async i=>{if(!nt(i,!1)){const{message:s}=ht("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=ht("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(vi(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=ht("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=(0,logger_dist_index_es.U5)(t,this.name),this.pairings=new index_es_zi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,logger_dist_index_es.oI)(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=ht("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(index_es_C_message,async e=>{const{topic:t,message:i,transportType:s}=e;if(this.pairings.keys.includes(t)&&s!==index_es_Q.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const n=await this.core.crypto.decode(t,i);(0,jsonrpc_utils_dist_esm.isJsonRpcRequest)(n)?(this.core.history.set(t,n),await this.onRelayEventRequest({topic:t,payload:n})):(0,jsonrpc_utils_dist_esm.isJsonRpcResponse)(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id)),await this.core.relayer.messages.ack(t,i)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(index_es_M_expired,async e=>{const{topic:t}=bi(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(index_es_re_expire,{topic:t}))})}}var ko=Object.defineProperty,index_es_O=(r,e,t)=>((r,e,t)=>e in r?ko(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class index_es_ki extends I{constructor(e,t){super(e,t),this.core=e,this.logger=t,index_es_O(this,"records",new Map),index_es_O(this,"events",new events.EventEmitter),index_es_O(this,"name","history"),index_es_O(this,"version","0.3"),index_es_O(this,"cached",[]),index_es_O(this,"initialized",!1),index_es_O(this,"storagePrefix",B),index_es_O(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),index_es_O(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const o={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:Ei(cjs.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(index_es_F_created,o)}),index_es_O(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=(0,jsonrpc_utils_dist_esm.isJsonRpcError)(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(index_es_F_updated,s))}),index_es_O(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),index_es_O(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(index_es_F_deleted,n)}}),this.persist()}),index_es_O(this,"exists",async(i,s)=>(this.isInitialized(),!!this.records.has(s)&&(await this.getRecord(s)).topic===i)),index_es_O(this,"on",(i,s)=>{this.events.on(i,s)}),index_es_O(this,"once",(i,s)=>{this.events.once(i,s)}),index_es_O(this,"off",(i,s)=>{this.events.off(i,s)}),index_es_O(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=(0,logger_dist_index_es.U5)(t,this.name)}get context(){return(0,logger_dist_index_es.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:(0,jsonrpc_utils_dist_esm.formatJsonRpcRequest)(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=ht("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(index_es_F_sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=ht("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(index_es_F_created,e=>{const t=index_es_F_created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(index_es_F_updated,e=>{const t=index_es_F_updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(index_es_F_deleted,e=>{const t=index_es_F_deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(heartbeat_dist_index_es.li.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,cjs.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(index_es_F_deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=ht("NOT_INITIALIZED",this.name);throw new Error(e)}}}var index_es_Uo=Object.defineProperty,A=(r,e,t)=>((r,e,t)=>e in r?index_es_Uo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class index_es_ji extends S{constructor(e,t){super(e,t),this.core=e,this.logger=t,A(this,"expirations",new Map),A(this,"events",new events.EventEmitter),A(this,"name","expirer"),A(this,"version","0.3"),A(this,"cached",[]),A(this,"initialized",!1),A(this,"storagePrefix",B),A(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),A(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),A(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(index_es_M_created,{target:n,expiration:o})}),A(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),A(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(index_es_M_deleted,{target:s,expiration:n})}}),A(this,"on",(i,s)=>{this.events.on(i,s)}),A(this,"once",(i,s)=>{this.events.once(i,s)}),A(this,"off",(i,s)=>{this.events.off(i,s)}),A(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=(0,logger_dist_index_es.U5)(t,this.name)}get context(){return(0,logger_dist_index_es.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return function mi(t){return $e("topic",t)}(e);if("number"==typeof e)return function wi(t){return $e("id",t)}(e);const{message:t}=ht("UNKNOWN_TYPE","Target type: "+typeof e);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(index_es_M_sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=ht("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=ht("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;(0,cjs.toMiliseconds)(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(index_es_M_expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(heartbeat_dist_index_es.li.pulse,()=>this.checkExpirations()),this.events.on(index_es_M_created,e=>{const t=index_es_M_created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(index_es_M_expired,e=>{const t=index_es_M_expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(index_es_M_deleted,e=>{const t=index_es_M_deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=ht("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Mo=Object.defineProperty,index_es_w=(r,e,t)=>((r,e,t)=>e in r?Mo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class index_es_Ui extends M{constructor(e,t,i){super(e,t,i),this.core=e,this.logger=t,this.store=i,index_es_w(this,"name","verify-api"),index_es_w(this,"abortController"),index_es_w(this,"isDevEnv"),index_es_w(this,"verifyUrlV3",Yt),index_es_w(this,"storagePrefix",B),index_es_w(this,"version",2),index_es_w(this,"publicKey"),index_es_w(this,"fetchPromise"),index_es_w(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,cjs.toMiliseconds)(null==(s=this.publicKey)?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),index_es_w(this,"register",async s=>{if(!Tt()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const h=(0,dist_cjs.getDocument)(),l=this.startAbortTimer(5*cjs.ONE_SECOND),d=await new Promise((g,_)=>{const u=()=>{window.removeEventListener("message",x),h.body.removeChild(b),_("attestation aborted")};this.abortController.signal.addEventListener("abort",u);const b=h.createElement("iframe");b.src=c,b.style.display="none",b.addEventListener("error",u,{signal:this.abortController.signal});const x=I=>{if(I.data&&"string"==typeof I.data)try{const D=JSON.parse(I.data);if("verify_attestation"===D.type){if((0,index_es.Cq)(D.attestation).payload.id!==o)return;clearInterval(l),h.body.removeChild(b),this.abortController.signal.removeEventListener("abort",u),window.removeEventListener("message",x),g(null===D.attestation?"":D.attestation)}}catch(D){this.logger.warn(D)}};h.body.appendChild(b),window.addEventListener("message",x,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",d),d}catch(h){this.logger.warn(h)}return""}),index_es_w(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=s;if(""===n)return void this.logger.debug("resolve: attestationId is empty, skipping");if(n){if((0,index_es.Cq)(n).payload.id!==a)return;const h=await this.isValidJwtAttestation(n);if(h)return h.isVerified?h:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!o)return;const c=this.getVerifyUrl(s?.verifyUrl);return this.fetchAttestation(o,c)}),index_es_w(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const o=this.startAbortTimer(5*cjs.ONE_SECOND),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),200===a.status?await a.json():void 0}),index_es_w(this,"getVerifyUrl",s=>{let n=s||index_es_ue;return index_es_Jt.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${index_es_ue}`),n=index_es_ue),n}),index_es_w(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(cjs.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),index_es_w(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),index_es_w(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),index_es_w(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),index_es_w(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),index_es_w(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),index_es_w(this,"validateAttestation",(s,n)=>{const o=zc(s,n.publicKey),a={hasExpired:(0,cjs.toMiliseconds)(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=(0,logger_dist_index_es.U5)(t,this.name),this.abortController=new AbortController,this.isDevEnv=Ii(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return(0,logger_dist_index_es.oI)(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,cjs.toMiliseconds)(e))}}var index_es_Bo=Object.defineProperty,index_es_Fi=(r,e,t)=>((r,e,t)=>e in r?index_es_Bo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class index_es_Mi extends O{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,index_es_Fi(this,"context","echo"),index_es_Fi(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=i,c=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})}),this.logger=(0,logger_dist_index_es.U5)(t,this.context)}}var index_es_qo=Object.defineProperty,index_es_Ki=Object.getOwnPropertySymbols,index_es_Go=Object.prototype.hasOwnProperty,index_es_Wo=Object.prototype.propertyIsEnumerable,index_es_Ze=(r,e,t)=>e in r?index_es_qo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,index_es_be=(r,e)=>{for(var t in e||(e={}))index_es_Go.call(e,t)&&index_es_Ze(r,t,e[t]);if(index_es_Ki)for(var t of index_es_Ki(e))index_es_Wo.call(e,t)&&index_es_Ze(r,t,e[t]);return r},index_es_E=(r,e,t)=>index_es_Ze(r,"symbol"!=typeof e?e+"":e,t);class Bi extends R{constructor(e,t,i=!0){super(e,t,i),this.core=e,this.logger=t,index_es_E(this,"context","event-client"),index_es_E(this,"storagePrefix",B),index_es_E(this,"storageVersion",.1),index_es_E(this,"events",new Map),index_es_E(this,"shouldPersist",!1),index_es_E(this,"init",async()=>{if(!Ii())try{const s={eventId:index_es_Bi(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Mn(this.core.relayer.protocol,this.core.relayer.version,"2.21.1")}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),index_es_E(this,"createEvent",s=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,h=index_es_Bi(),l=this.core.projectId||"",d=Date.now(),g=index_es_be({eventId:h,timestamp:d,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(h));return this.telemetryEnabled&&(this.events.set(h,g),this.shouldPersist=!0),g}),index_es_E(this,"getEvent",s=>{const{eventId:n,topic:o}=s;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);return a?index_es_be(index_es_be({},a),this.setMethods(a.eventId)):void 0}),index_es_E(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),index_es_E(this,"setEventListeners",()=>{this.core.heartbeat.on(heartbeat_dist_index_es.li.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{(0,cjs.fromMiliseconds)(Date.now())-(0,cjs.fromMiliseconds)(s.timestamp)>86400&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),index_es_E(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),index_es_E(this,"addTrace",(s,n)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)}),index_es_E(this,"setError",(s,n)=>{const o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),index_es_E(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),index_es_E(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,index_es_be(index_es_be({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),index_es_E(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;const s=[];for(const[n,o]of this.events)o.props.type&&s.push(o);if(0!==s.length)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),index_es_E(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-2.21.1${n}`,{method:"POST",body:JSON.stringify(s)})}),index_es_E(this,"getAppDomain",()=>Pn().url),this.logger=(0,logger_dist_index_es.U5)(t,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var index_es_Ho=Object.defineProperty,index_es_Vi=Object.getOwnPropertySymbols,index_es_Yo=Object.prototype.hasOwnProperty,index_es_Jo=Object.prototype.propertyIsEnumerable,index_es_Qe=(r,e,t)=>e in r?index_es_Ho(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,index_es_qi=(r,e)=>{for(var t in e||(e={}))index_es_Yo.call(e,t)&&index_es_Qe(r,t,e[t]);if(index_es_Vi)for(var t of index_es_Vi(e))index_es_Jo.call(e,t)&&index_es_Qe(r,t,e[t]);return r},index_es_v=(r,e,t)=>index_es_Qe(r,"symbol"!=typeof e?e+"":e,t);class index_es_Te extends h{constructor(e){var t;super(e),index_es_v(this,"protocol","wc"),index_es_v(this,"version",2),index_es_v(this,"name","core"),index_es_v(this,"relayUrl"),index_es_v(this,"projectId"),index_es_v(this,"customStoragePrefix"),index_es_v(this,"events",new events.EventEmitter),index_es_v(this,"logger"),index_es_v(this,"heartbeat"),index_es_v(this,"relayer"),index_es_v(this,"crypto"),index_es_v(this,"storage"),index_es_v(this,"history"),index_es_v(this,"expirer"),index_es_v(this,"pairing"),index_es_v(this,"verify"),index_es_v(this,"echoClient"),index_es_v(this,"linkModeSupportedApps"),index_es_v(this,"eventClient"),index_es_v(this,"initialized",!1),index_es_v(this,"logChunkController"),index_es_v(this,"on",(a,c)=>this.events.on(a,c)),index_es_v(this,"once",(a,c)=>this.events.once(a,c)),index_es_v(this,"off",(a,c)=>this.events.off(a,c)),index_es_v(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),index_es_v(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:h})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:index_es_Q.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:h})});const i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){index_es_console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||"wss://relay.walletconnect.org",this.customStoragePrefix=null!=e&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=(0,logger_dist_index_es.iP)({level:"string"==typeof e?.logger&&e.logger?e.logger:index_es_Et_logger,name:"core"}),{logger:n,chunkLoggerController:o}=(0,logger_dist_index_es.D5)({opts:s,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,null!=(t=this.logChunkController)&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;null!=(a=this.logChunkController)&&a.downloadLogsBlobInBrowser&&(null==(c=this.logChunkController)||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=(0,logger_dist_index_es.U5)(n,this.name),this.heartbeat=new heartbeat_dist_index_es.VH,this.crypto=new index_es_vi(this,this.logger,e?.keychain),this.history=new index_es_ki(this,this.logger),this.expirer=new index_es_ji(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new keyvaluestorage_dist_index_es.A(index_es_qi(index_es_qi({},index_es_It),e?.storageOptions)),this.relayer=new index_es_Si({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new index_es_Li(this,this.logger),this.verify=new index_es_Ui(this,this.logger,this.storage),this.echoClient=new index_es_Mi(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Bi(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const t=new index_es_Te(e);await t.initialize();const i=await t.crypto.getClientId();return await t.storage.setItem("WALLETCONNECT_CLIENT_ID",i),t}get context(){return(0,logger_dist_index_es.oI)(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return null==(e=this.logChunkController)?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem("WALLETCONNECT_LINK_MODE_APPS",this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem("WALLETCONNECT_LINK_MODE_APPS")||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,i=`${t}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&index_es_console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[t]}catch(t){return void index_es_console.warn("Failed to get global WalletConnect core",t)}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${(null==(t=e.opts)?void 0:t.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){index_es_console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof index_es_process<"u"&&"true"===index_es_process.env.DISABLE_GLOBAL_CORE}catch{return!0}}}const index_es_Xo=index_es_Te;var dist_index_es_console=__webpack_require__("./node_modules/console-browserify/index.js");const index_es_me_name="client",index_es_me_logger="error",index_es_J=cjs.SEVEN_DAYS,N={wc_sessionPropose:{req:{ttl:cjs.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:cjs.ONE_DAY,prompt:!1,tag:1104},res:{ttl:cjs.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:cjs.ONE_DAY,prompt:!1,tag:1106},res:{ttl:cjs.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:cjs.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:cjs.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:cjs.ONE_DAY,prompt:!1,tag:1112},res:{ttl:cjs.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:cjs.ONE_DAY,prompt:!1,tag:1114},res:{ttl:cjs.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:cjs.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:cjs.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1119}}},dist_index_es_e={min:cjs.FIVE_MINUTES,max:cjs.SEVEN_DAYS},dist_index_es_$_idle="IDLE",dist_index_es_$_active="ACTIVE",dist_index_es_Ke={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},index_es_gt=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],index_es_ce="wc@1.5:auth::PUB_KEY";var index_es_vs=Object.defineProperty,index_es_Is=Object.defineProperties,index_es_Ts=Object.getOwnPropertyDescriptors,index_es_ft=Object.getOwnPropertySymbols,index_es_qs=Object.prototype.hasOwnProperty,index_es_Ps=Object.prototype.propertyIsEnumerable,dist_index_es_Ue=(S,n,e)=>n in S?index_es_vs(S,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):S[n]=e,dist_index_es_v=(S,n)=>{for(var e in n||(n={}))index_es_qs.call(n,e)&&dist_index_es_Ue(S,e,n[e]);if(index_es_ft)for(var e of index_es_ft(n))index_es_Ps.call(n,e)&&dist_index_es_Ue(S,e,n[e]);return S},index_es_b=(S,n)=>index_es_Is(S,index_es_Ts(n)),index_es_c=(S,n,e)=>dist_index_es_Ue(S,"symbol"!=typeof n?n+"":n,e);class index_es_Ns extends index_es_V{constructor(n){super(n),index_es_c(this,"name","engine"),index_es_c(this,"events",new(events_default())),index_es_c(this,"initialized",!1),index_es_c(this,"requestQueue",{state:dist_index_es_$_idle,queue:[]}),index_es_c(this,"sessionRequestQueue",{state:dist_index_es_$_idle,queue:[]}),index_es_c(this,"requestQueueDelay",cjs.ONE_SECOND),index_es_c(this,"expectedPairingMethodMap",new Map),index_es_c(this,"recentlyDeletedMap",new Map),index_es_c(this,"recentlyDeletedLimit",200),index_es_c(this,"relayMessageCache",[]),index_es_c(this,"pendingSessions",new Map),index_es_c(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(N)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,cjs.toMiliseconds)(this.requestQueueDelay)))}),index_es_c(this,"connect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const t=index_es_b(dist_index_es_v({},e),{requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}});await this.isValidConnect(t),t.optionalNamespaces=function aa(t,e){var n,r,o,i,s,c;const a=index_es_ie(t),u=index_es_ie(e),l={},f=Object.keys(a).concat(Object.keys(u));for(const h of f)l[h]={chains:ot(null==(n=a[h])?void 0:n.chains,null==(r=u[h])?void 0:r.chains),methods:ot(null==(o=a[h])?void 0:o.methods,null==(i=u[h])?void 0:i.methods),events:ot(null==(s=a[h])?void 0:s.events,null==(c=u[h])?void 0:c.events)};return l}(t.requiredNamespaces,t.optionalNamespaces),t.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:i,optionalNamespaces:r,sessionProperties:o,scopedProperties:a,relays:l}=t;let h,p=s,u=!1;try{if(p){const T=this.client.core.pairing.pairings.get(p);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),u=T.active}}catch(T){throw this.client.logger.error(`connect() -> pairing.get(${p}) failed`),T}if(!p||!u){const{topic:T,uri:K}=await this.client.core.pairing.create();p=T,h=K}if(!p){const{message:T}=ht("NO_MATCHING_KEY",`connect() pairing topic: ${p}`);throw new Error(T)}const d=await this.client.core.crypto.generateKeyPair(),w=N.wc_sessionPropose.req.ttl||cjs.FIVE_MINUTES,m=Ei(w),f=index_es_b(dist_index_es_v(dist_index_es_v({requiredNamespaces:i,optionalNamespaces:r,relays:l??[{protocol:"irn"}],proposer:{publicKey:d,metadata:this.client.metadata},expiryTimestamp:m,pairingTopic:p},o&&{sessionProperties:o}),a&&{scopedProperties:a}),{id:(0,jsonrpc_utils_dist_esm.payloadId)()}),_=xi("session_connect",f.id),{reject:g,resolve:A,done:D}=gi(w,"Proposal expired"),I=({id:T})=>{T===f.id&&(this.client.events.off("proposal_expire",I),this.pendingSessions.delete(f.id),this.events.emit(_,{error:{message:"Proposal expired",code:0}}))};return this.client.events.on("proposal_expire",I),this.events.once(_,({error:T,session:K})=>{this.client.events.off("proposal_expire",I),T?g(T):K&&A(K)}),await this.sendRequest({topic:p,method:"wc_sessionPropose",params:f,throwOnFailedPublish:!0,clientRpcId:f.id}),await this.setProposal(f.id,f),{uri:h,approval:D}}),index_es_c(this,"pair",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(e)}catch(t){throw this.client.logger.error("pair() failed"),t}}),index_es_c(this,"approve",async e=>{var t,s,i;const r=this.client.core.eventClient.createEvent({properties:{topic:null==(t=e?.id)?void 0:t.toString(),trace:[index_es_er_session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(q){throw r.setError(index_es_tr_no_internet_connection),q}try{await this.isValidProposalId(e?.id)}catch(q){throw this.client.logger.error(`approve() -> proposal.get(${e?.id}) failed`),r.setError(index_es_tr_proposal_not_found),q}try{await this.isValidApprove(e)}catch(q){throw this.client.logger.error("approve() -> isValidApprove() failed"),r.setError(index_es_tr_session_approve_namespace_validation_failure),q}const{id:o,relayProtocol:a,namespaces:l,sessionProperties:p,scopedProperties:h,sessionConfig:u}=e,d=this.client.proposal.get(o);this.client.core.eventClient.deleteEvent({eventId:r.eventId});const{pairingTopic:w,proposer:m,requiredNamespaces:f,optionalNamespaces:_}=d;let g=null==(s=this.client.core.eventClient)?void 0:s.getEvent({topic:w});g||(g=null==(i=this.client.core.eventClient)?void 0:i.createEvent({type:index_es_er_session_approve_started,properties:{topic:w,trace:[index_es_er_session_approve_started,index_es_er_session_namespaces_validation_success]}}));const A=await this.client.core.crypto.generateKeyPair(),D=m.publicKey,I=await this.client.core.crypto.generateSharedKey(A,D),T=dist_index_es_v(dist_index_es_v(dist_index_es_v({relay:{protocol:a??"irn"},namespaces:l,controller:{publicKey:A,metadata:this.client.metadata},expiry:Ei(index_es_J)},p&&{sessionProperties:p}),h&&{scopedProperties:h}),u&&{sessionConfig:u}),K=index_es_Q.relay;g.addTrace(index_es_er_subscribing_session_topic);try{await this.client.core.relayer.subscribe(I,{transportType:K})}catch(q){throw g.setError(index_es_tr_subscribe_session_topic_failure),q}g.addTrace(index_es_er_subscribe_session_topic_success);const fe=index_es_b(dist_index_es_v({},T),{topic:I,requiredNamespaces:f,optionalNamespaces:_,pairingTopic:w,acknowledged:!1,self:T.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:A,transportType:index_es_Q.relay});await this.client.session.set(I,fe),g.addTrace(index_es_er_store_session);try{g.addTrace(index_es_er_publishing_session_settle),await this.sendRequest({topic:I,method:"wc_sessionSettle",params:T,throwOnFailedPublish:!0}).catch(q=>{throw g?.setError(index_es_tr_session_settle_publish_failure),q}),g.addTrace(index_es_er_session_settle_publish_success),g.addTrace(index_es_er_publishing_session_approve),await this.sendResult({id:o,topic:w,result:{relay:{protocol:a??"irn"},responderPublicKey:A},throwOnFailedPublish:!0}).catch(q=>{throw g?.setError(index_es_tr_session_approve_publish_failure),q}),g.addTrace(index_es_er_session_approve_publish_success)}catch(q){throw this.client.logger.error(q),this.client.session.delete(I,Nt("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(I),q}return this.client.core.eventClient.deleteEvent({eventId:g.eventId}),await this.client.core.pairing.updateMetadata({topic:w,metadata:m.metadata}),await this.client.proposal.delete(o,Nt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}),await this.setExpiry(I,Ei(index_es_J)),{topic:I,acknowledged:()=>Promise.resolve(this.client.session.get(I))}}),index_es_c(this,"reject",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(e)}catch(r){throw this.client.logger.error("reject() -> isValidReject() failed"),r}const{id:t,reason:s}=e;let i;try{i=this.client.proposal.get(t).pairingTopic}catch(r){throw this.client.logger.error(`reject() -> proposal.get(${t}) failed`),r}i&&(await this.sendError({id:t,topic:i,error:s,rpcOpts:N.wc_sessionPropose.reject}),await this.client.proposal.delete(t,Nt("USER_DISCONNECTED")))}),index_es_c(this,"update",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(e)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:t,namespaces:s}=e,{done:i,resolve:r,reject:o}=gi(),a=(0,jsonrpc_utils_dist_esm.payloadId)(),l=(0,jsonrpc_utils_dist_esm.getBigIntRpcId)().toString(),p=this.client.session.get(t).namespaces;return this.events.once(xi("session_update",a),({error:h})=>{h?o(h):r()}),await this.client.session.update(t,{namespaces:s}),await this.sendRequest({topic:t,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(t,{namespaces:p}),o(h)}),{acknowledged:i}}),index_es_c(this,"extend",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(e)}catch(a){throw this.client.logger.error("extend() -> isValidExtend() failed"),a}const{topic:t}=e,s=(0,jsonrpc_utils_dist_esm.payloadId)(),{done:i,resolve:r,reject:o}=gi();return this.events.once(xi("session_extend",s),({error:a})=>{a?o(a):r()}),await this.setExpiry(t,Ei(index_es_J)),this.sendRequest({topic:t,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(a=>{o(a)}),{acknowledged:i}}),index_es_c(this,"request",async e=>{this.isInitialized();try{await this.isValidRequest(e)}catch(_){throw this.client.logger.error("request() -> isValidRequest() failed"),_}const{chainId:t,request:s,topic:i,expiry:r=N.wc_sessionRequest.req.ttl}=e,o=this.client.session.get(i);o?.transportType===index_es_Q.relay&&await this.confirmOnlineStateOrThrow();const a=(0,jsonrpc_utils_dist_esm.payloadId)(),l=(0,jsonrpc_utils_dist_esm.getBigIntRpcId)().toString(),{done:p,resolve:h,reject:u}=gi(r,"Request expired. Please try again.");this.events.once(xi("session_request",a),({error:_,result:g})=>{_?u(_):h(g)});const d="wc_sessionRequest",w=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);if(w)return await this.sendRequest({clientRpcId:a,relayRpcId:l,topic:i,method:d,params:{request:index_es_b(dist_index_es_v({},s),{expiryTimestamp:Ei(r)}),chainId:t},expiry:r,throwOnFailedPublish:!0,appLink:w}).catch(_=>u(_)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:t,id:a}),await p();const m={request:index_es_b(dist_index_es_v({},s),{expiryTimestamp:Ei(r)}),chainId:t},f=this.shouldSetTVF(d,m);return await Promise.all([new Promise(async _=>{await this.sendRequest(dist_index_es_v({clientRpcId:a,relayRpcId:l,topic:i,method:d,params:m,expiry:r,throwOnFailedPublish:!0},f&&{tvf:this.getTVFParams(a,m)})).catch(g=>u(g)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:t,id:a}),_()}),new Promise(async _=>{var g;if(null==(g=o.sessionConfig)||!g.disableDeepLink){const A=await async function Oi(t,e){let n="";try{if(Tt()&&(n=localStorage.getItem(e),n))return n;n=await t.getItem(e)}catch(r){console.error(r)}return n}(this.client.core.storage,"WALLETCONNECT_DEEPLINK_CHOICE");await Si({id:a,topic:i,wcDeepLink:A})}_()}),p()]).then(_=>_[2])}),index_es_c(this,"respond",async e=>{this.isInitialized(),await this.isValidRespond(e);const{topic:t,response:s}=e,{id:i}=s,r=this.client.session.get(t);r.transportType===index_es_Q.relay&&await this.confirmOnlineStateOrThrow();const o=this.getAppLinkIfEnabled(r.peer.metadata,r.transportType);(0,jsonrpc_utils_dist_esm.isJsonRpcResult)(s)?await this.sendResult({id:i,topic:t,result:s.result,throwOnFailedPublish:!0,appLink:o}):(0,jsonrpc_utils_dist_esm.isJsonRpcError)(s)&&await this.sendError({id:i,topic:t,error:s.error,appLink:o}),this.cleanupAfterResponse(e)}),index_es_c(this,"ping",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(e)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:t}=e;if(this.client.session.keys.includes(t)){const s=(0,jsonrpc_utils_dist_esm.payloadId)(),i=(0,jsonrpc_utils_dist_esm.getBigIntRpcId)().toString(),{done:r,resolve:o,reject:a}=gi();this.events.once(xi("session_ping",s),({error:l})=>{l?a(l):o()}),await Promise.all([this.sendRequest({topic:t,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:i}),r()])}else this.client.core.pairing.pairings.keys.includes(t)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:t}))}),index_es_c(this,"emit",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(e);const{topic:t,event:s,chainId:i}=e,r=(0,jsonrpc_utils_dist_esm.getBigIntRpcId)().toString(),o=(0,jsonrpc_utils_dist_esm.payloadId)();await this.sendRequest({topic:t,method:"wc_sessionEvent",params:{event:s,chainId:i},throwOnFailedPublish:!0,relayRpcId:r,clientRpcId:o})}),index_es_c(this,"disconnect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(e);const{topic:t}=e;if(this.client.session.keys.includes(t))await this.sendRequest({topic:t,method:"wc_sessionDelete",params:Nt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:t,emitEvent:!1});else{if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:s}=ht("MISMATCHED_TOPIC",`Session or pairing topic not found: ${t}`);throw new Error(s)}await this.client.core.pairing.disconnect({topic:t})}}),index_es_c(this,"find",e=>(this.isInitialized(),this.client.session.getAll().filter(t=>function ua(t,e){const{requiredNamespaces:n}=e,r=Object.keys(t.namespaces),o=Object.keys(n);let i=!0;return!!gt(o,r)&&(r.forEach(s=>{const{accounts:c,methods:a,events:u}=t.namespaces[s],l=It(c),f=n[s];gt(ue(s,f),l)&&gt(f.methods,a)&&gt(f.events,u)||(i=!1)}),i)}(t,e)))),index_es_c(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),index_es_c(this,"authenticate",async(e,t)=>{var s;this.isInitialized(),this.isValidAuthenticate(e);const i=t&&this.client.core.linkModeSupportedApps.includes(t)&&(null==(s=this.client.metadata.redirect)?void 0:s.linkMode),r=i?index_es_Q.link_mode:index_es_Q.relay;r===index_es_Q.relay&&await this.confirmOnlineStateOrThrow();const{chains:o,statement:a="",uri:l,domain:p,nonce:h,type:u,exp:d,nbf:w,methods:m=[],expiry:f}=e,_=[...e.resources||[]],{topic:g,uri:A}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:r});this.client.logger.info({message:"Generated new pairing",pairing:{topic:g,uri:A}});const D=await this.client.core.crypto.generateKeyPair(),I=Pc(D);if(await Promise.all([this.client.auth.authKeys.set(index_es_ce,{responseTopic:I,publicKey:D}),this.client.auth.pairingTopics.set(I,{topic:I,pairingTopic:g})]),await this.client.core.relayer.subscribe(I,{transportType:r}),this.client.logger.info(`sending request to new pairing topic: ${g}`),m.length>0){const{namespace:x}=Ne(o[0]);let L=fs(x,"request",m);index_es_pe(_)&&(L=ls(L,_.pop())),_.push(L)}const T=f&&f>N.wc_sessionAuthenticate.req.ttl?f:N.wc_sessionAuthenticate.req.ttl,K={authPayload:{type:u??"caip122",chains:o,statement:a,aud:l,domain:p,version:"1",nonce:h,iat:(new Date).toISOString(),exp:d,nbf:w,resources:_},requester:{publicKey:D,metadata:this.client.metadata},expiryTimestamp:Ei(T)},q={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:o,methods:[...new Set(["personal_sign",...m])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:g,proposer:{publicKey:D,metadata:this.client.metadata},expiryTimestamp:Ei(N.wc_sessionPropose.req.ttl),id:(0,jsonrpc_utils_dist_esm.payloadId)()},{done:Rt,resolve:je,reject:Se}=gi(T,"Request expired"),te=(0,jsonrpc_utils_dist_esm.payloadId)(),le=xi("session_connect",q.id),Re=xi("session_request",te),pe=async({error:x,session:L})=>{this.events.off(Re,ve),x?Se(x):L&&je({session:L})},ve=async x=>{var L,Fe,Qe;if(await this.deletePendingAuthRequest(te,{message:"fulfilled",code:0}),x.error){const ie=Nt("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return x.error.code===ie.code?void 0:(this.events.off(le,pe),Se(x.error.message))}await this.deleteProposal(q.id),this.events.off(le,pe);const{cacaos:He,responder:Q}=x.result,Te=[],ze=[];for(const ie of He){await is({cacao:ie,projectId:this.client.core.projectId})||(this.client.logger.error(ie,"Signature verification failed"),Se(Nt("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:qe}=ie,Pe=index_es_pe(qe.resources),Ye=[dr(qe.iss)],vt=De(qe.iss);if(Pe){const Ne=ds(Pe),It=hs(Pe);Te.push(...Ne),Ye.push(...It)}for(const Ne of Ye)ze.push(`${Ne}:${vt}`)}const se=await this.client.core.crypto.generateSharedKey(D,Q.publicKey);let he;Te.length>0&&(he={topic:se,acknowledged:!0,self:{publicKey:D,metadata:this.client.metadata},peer:Q,controller:Q.publicKey,expiry:Ei(index_es_J),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:g,namespaces:ca([...new Set(Te)],[...new Set(ze)]),transportType:r},await this.client.core.relayer.subscribe(se,{transportType:r}),await this.client.session.set(se,he),g&&await this.client.core.pairing.updateMetadata({topic:g,metadata:Q.metadata}),he=this.client.session.get(se)),null!=(L=this.client.metadata.redirect)&&L.linkMode&&null!=(Fe=Q.metadata.redirect)&&Fe.linkMode&&null!=(Qe=Q.metadata.redirect)&&Qe.universal&&t&&(this.client.core.addLinkModeSupportedApp(Q.metadata.redirect.universal),this.client.session.update(se,{transportType:index_es_Q.link_mode})),je({auths:He,session:he})};let Ie;this.events.once(le,pe),this.events.once(Re,ve);try{if(i){const x=(0,jsonrpc_utils_dist_esm.formatJsonRpcRequest)("wc_sessionAuthenticate",K,te);this.client.core.history.set(g,x);const L=await this.client.core.crypto.encode("",x,{type:2,encoding:xe});Ie=Xc(t,g,L)}else await Promise.all([this.sendRequest({topic:g,method:"wc_sessionAuthenticate",params:K,expiry:e.expiry,throwOnFailedPublish:!0,clientRpcId:te}),this.sendRequest({topic:g,method:"wc_sessionPropose",params:q,expiry:N.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:q.id})])}catch(x){throw this.events.off(le,pe),this.events.off(Re,ve),x}return await this.setProposal(q.id,q),await this.setAuthRequest(te,{request:index_es_b(dist_index_es_v({},K),{verifyContext:{}}),pairingTopic:g,transportType:r}),{uri:Ie??A,response:Rt}}),index_es_c(this,"approveSessionAuthenticate",async e=>{const{id:t,auths:s}=e,i=this.client.core.eventClient.createEvent({properties:{topic:t.toString(),trace:[index_es_ir_authenticated_session_approve_started]}});try{this.isInitialized()}catch(f){throw i.setError(index_es_sr_no_internet_connection),f}const r=this.getPendingAuthRequest(t);if(!r)throw i.setError(index_es_sr_authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${t}`);const o=r.transportType||index_es_Q.relay;o===index_es_Q.relay&&await this.confirmOnlineStateOrThrow();const a=r.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),p=Pc(a),h={type:1,receiverPublicKey:a,senderPublicKey:l},u=[],d=[];for(const f of s){if(!await is({cacao:f,projectId:this.client.core.projectId})){i.setError(index_es_sr_invalid_cacao);const I=Nt("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:t,topic:p,error:I,encodeOpts:h}),new Error(I.message)}i.addTrace(index_es_ir_cacaos_verified);const{p:_}=f,g=index_es_pe(_.resources),A=[dr(_.iss)],D=De(_.iss);if(g){const I=ds(g),T=hs(g);u.push(...I),A.push(...T)}for(const I of A)d.push(`${I}:${D}`)}const w=await this.client.core.crypto.generateSharedKey(l,a);let m;if(i.addTrace(index_es_ir_create_authenticated_session_topic),u?.length>0){m={topic:w,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:a,metadata:r.requester.metadata},controller:a,expiry:Ei(index_es_J),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:r.pairingTopic,namespaces:ca([...new Set(u)],[...new Set(d)]),transportType:o},i.addTrace(index_es_ir_subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(w,{transportType:o})}catch(f){throw i.setError(index_es_sr_subscribe_authenticated_session_topic_failure),f}i.addTrace(index_es_ir_subscribe_authenticated_session_topic_success),await this.client.session.set(w,m),i.addTrace(index_es_ir_store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:r.pairingTopic,metadata:r.requester.metadata})}i.addTrace(index_es_ir_publishing_authenticated_session_approve);try{await this.sendResult({topic:p,id:t,result:{cacaos:s,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(r.requester.metadata,o)})}catch(f){throw i.setError(index_es_sr_authenticated_session_approve_publish_failure),f}return await this.client.auth.requests.delete(t,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:r.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:i.eventId}),{session:m}}),index_es_c(this,"rejectSessionAuthenticate",async e=>{this.isInitialized();const{id:t,reason:s}=e,i=this.getPendingAuthRequest(t);if(!i)throw new Error(`Could not find pending auth request with id ${t}`);i.transportType===index_es_Q.relay&&await this.confirmOnlineStateOrThrow();const r=i.requester.publicKey,o=await this.client.core.crypto.generateKeyPair(),a=Pc(r),l={type:1,receiverPublicKey:r,senderPublicKey:o};await this.sendError({id:t,topic:a,error:s,encodeOpts:l,rpcOpts:N.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(t,{message:"rejected",code:0}),await this.client.proposal.delete(t,Nt("USER_DISCONNECTED"))}),index_es_c(this,"formatAuthMessage",e=>{this.isInitialized();const{request:t,iss:s}=e;return hr(t,s)}),index_es_c(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{const e=this.relayMessageCache.shift();e&&await this.onRelayMessage(e)}catch(e){this.client.logger.error(e)}},50)}),index_es_c(this,"cleanupDuplicatePairings",async e=>{if(e.pairingTopic)try{const t=this.client.core.pairing.pairings.get(e.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(i=>{var r,o;return(null==(r=i.peerMetadata)?void 0:r.url)&&(null==(o=i.peerMetadata)?void 0:o.url)===e.peer.metadata.url&&i.topic&&i.topic!==t.topic});if(0===s.length)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(i=>this.client.core.pairing.disconnect({topic:i.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(t){this.client.logger.error(t)}}),index_es_c(this,"deleteSession",async e=>{var t;const{topic:s,expirerHasDeleted:i=!1,emitEvent:r=!0,id:o=0}=e,{self:a}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,Nt("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),i||this.client.core.expirer.del(s),this.client.core.storage.removeItem("WALLETCONNECT_DEEPLINK_CHOICE").catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===s&&this.deletePendingSessionRequest(l.id,Nt("USER_DISCONNECTED"))}),s===(null==(t=this.sessionRequestQueue.queue[0])?void 0:t.topic)&&(this.sessionRequestQueue.state=dist_index_es_$_idle),r&&this.client.events.emit("session_delete",{id:o,topic:s})}),index_es_c(this,"deleteProposal",async(e,t)=>{if(t)try{const s=this.client.proposal.get(e),i=this.client.core.eventClient.getEvent({topic:s.pairingTopic});i?.setError(index_es_tr_proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(e,Nt("USER_DISCONNECTED")),t?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"proposal")}),index_es_c(this,"deletePendingSessionRequest",async(e,t,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,t),s?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(i=>i.id!==e),s&&(this.sessionRequestQueue.state=dist_index_es_$_idle,this.client.events.emit("session_request_expire",{id:e}))}),index_es_c(this,"deletePendingAuthRequest",async(e,t,s=!1)=>{await Promise.all([this.client.auth.requests.delete(e,t),s?Promise.resolve():this.client.core.expirer.del(e)])}),index_es_c(this,"setExpiry",async(e,t)=>{this.client.session.keys.includes(e)&&(this.client.core.expirer.set(e,t),await this.client.session.update(e,{expiry:t}))}),index_es_c(this,"setProposal",async(e,t)=>{this.client.core.expirer.set(e,Ei(N.wc_sessionPropose.req.ttl)),await this.client.proposal.set(e,t)}),index_es_c(this,"setAuthRequest",async(e,t)=>{const{request:s,pairingTopic:i,transportType:r=index_es_Q.relay}=t;this.client.core.expirer.set(e,s.expiryTimestamp),await this.client.auth.requests.set(e,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:e,pairingTopic:i,verifyContext:s.verifyContext,transportType:r})}),index_es_c(this,"setPendingSessionRequest",async e=>{const{id:t,topic:s,params:i,verifyContext:r}=e,o=i.request.expiryTimestamp||Ei(N.wc_sessionRequest.req.ttl);this.client.core.expirer.set(t,o),await this.client.pendingRequest.set(t,{id:t,topic:s,params:i,verifyContext:r})}),index_es_c(this,"sendRequest",async e=>{const{topic:t,method:s,params:i,expiry:r,relayRpcId:o,clientRpcId:a,throwOnFailedPublish:l,appLink:p,tvf:h}=e,u=(0,jsonrpc_utils_dist_esm.formatJsonRpcRequest)(s,i,a);let d;const w=!!p;try{const _=w?xe:qt;d=await this.client.core.crypto.encode(t,u,{encoding:_})}catch(_){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${t} failed`),_}let m;if(index_es_gt.includes(s)){const _=kc(JSON.stringify(u)),g=kc(d);m=await this.client.core.verify.register({id:g,decryptedId:_})}const f=N[s].req;if(f.attestation=m,r&&(f.ttl=r),o&&(f.id=o),this.client.core.history.set(t,u),w){const _=Xc(p,t,d);await __webpack_require__.g.Linking.openURL(_,this.client.name)}else{const _=N[s].req;r&&(_.ttl=r),o&&(_.id=o),_.tvf=index_es_b(dist_index_es_v({},h),{correlationId:u.id}),l?(_.internal=index_es_b(dist_index_es_v({},_.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(t,d,_)):this.client.core.relayer.publish(t,d,_).catch(g=>this.client.logger.error(g))}return u.id}),index_es_c(this,"sendResult",async e=>{const{id:t,topic:s,result:i,throwOnFailedPublish:r,encodeOpts:o,appLink:a}=e,l=(0,jsonrpc_utils_dist_esm.formatJsonRpcResult)(t,i);let p;const h=a&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Linking)<"u";try{const w=h?xe:qt;p=await this.client.core.crypto.encode(s,l,index_es_b(dist_index_es_v({},o||{}),{encoding:w}))}catch(w){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),w}let u,d;try{u=await this.client.core.history.get(s,t);const w=u.request;try{this.shouldSetTVF(w.method,w.params)&&(d=this.getTVFParams(t,w.params,i))}catch(m){this.client.logger.warn("sendResult() -> getTVFParams() failed",m)}}catch(w){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${t}) failed`),w}if(h){const w=Xc(a,s,p);await __webpack_require__.g.Linking.openURL(w,this.client.name)}else{const w=u.request.method,m=N[w].res;m.tvf=index_es_b(dist_index_es_v({},d),{correlationId:t}),r?(m.internal=index_es_b(dist_index_es_v({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,p,m)):this.client.core.relayer.publish(s,p,m).catch(f=>this.client.logger.error(f))}await this.client.core.history.resolve(l)}),index_es_c(this,"sendError",async e=>{const{id:t,topic:s,error:i,encodeOpts:r,rpcOpts:o,appLink:a}=e,l=(0,jsonrpc_utils_dist_esm.formatJsonRpcError)(t,i);let p;const h=a&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Linking)<"u";try{const d=h?xe:qt;p=await this.client.core.crypto.encode(s,l,index_es_b(dist_index_es_v({},r||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),d}let u;try{u=await this.client.core.history.get(s,t)}catch(d){throw this.client.logger.error(`sendError() -> history.get(${s}, ${t}) failed`),d}if(h){const d=Xc(a,s,p);await __webpack_require__.g.Linking.openURL(d,this.client.name)}else{const d=u.request.method,w=o||N[d].res;this.client.core.relayer.publish(s,p,w)}await this.client.core.history.resolve(l)}),index_es_c(this,"cleanup",async()=>{const e=[],t=[];this.client.session.getAll().forEach(s=>{let i=!1;vi(s.expiry)&&(i=!0),this.client.core.crypto.keychain.has(s.topic)||(i=!0),i&&e.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{vi(s.expiryTimestamp)&&t.push(s.id)}),await Promise.all([...e.map(s=>this.deleteSession({topic:s})),...t.map(s=>this.deleteProposal(s))])}),index_es_c(this,"onProviderMessageEvent",async e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):await this.onRelayMessage(e)}),index_es_c(this,"onRelayEventRequest",async e=>{this.requestQueue.queue.push(e),await this.processRequestsQueue()}),index_es_c(this,"processRequestsQueue",async()=>{if(this.requestQueue.state!==dist_index_es_$_active){for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=dist_index_es_$_active;const e=this.requestQueue.queue.shift();if(e)try{await this.processRequest(e)}catch(t){this.client.logger.warn(t)}}this.requestQueue.state=dist_index_es_$_idle}else this.client.logger.info("Request queue already active, skipping...")}),index_es_c(this,"processRequest",async e=>{const{topic:t,payload:s,attestation:i,transportType:r,encryptedId:o}=e,a=s.method;if(!this.shouldIgnorePairingRequest({topic:t,requestMethod:a}))switch(a){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:t,payload:s,attestation:i,encryptedId:o});case"wc_sessionSettle":return await this.onSessionSettleRequest(t,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(t,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(t,s);case"wc_sessionPing":return await this.onSessionPingRequest(t,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(t,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:t,payload:s,attestation:i,encryptedId:o,transportType:r});case"wc_sessionEvent":return await this.onSessionEventRequest(t,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:t,payload:s,attestation:i,encryptedId:o,transportType:r});default:return this.client.logger.info(`Unsupported request method ${a}`)}}),index_es_c(this,"onRelayEventResponse",async e=>{const{topic:t,payload:s,transportType:i}=e,r=(await this.client.core.history.get(t,s.id)).request.method;switch(r){case"wc_sessionPropose":return this.onSessionProposeResponse(t,s,i);case"wc_sessionSettle":return this.onSessionSettleResponse(t,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(t,s);case"wc_sessionExtend":return this.onSessionExtendResponse(t,s);case"wc_sessionPing":return this.onSessionPingResponse(t,s);case"wc_sessionRequest":return this.onSessionRequestResponse(t,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(t,s);default:return this.client.logger.info(`Unsupported response method ${r}`)}}),index_es_c(this,"onRelayEventUnknownPayload",e=>{const{topic:t}=e,{message:s}=ht("MISSING_OR_INVALID",`Decoded payload on topic ${t} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),index_es_c(this,"shouldIgnorePairingRequest",e=>{const{topic:t,requestMethod:s}=e,i=this.expectedPairingMethodMap.get(t);return!(!i||i.includes(s))&&!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),index_es_c(this,"onSessionProposeRequest",async e=>{const{topic:t,payload:s,attestation:i,encryptedId:r}=e,{params:o,id:a}=s;try{const l=this.client.core.eventClient.getEvent({topic:t});0===this.client.events.listenerCount("session_proposal")&&(dist_index_es_console.warn("No listener for session_proposal event"),l?.setError(index_es_Y_proposal_listener_not_found)),this.isValidConnect(dist_index_es_v({},s.params));const p=o.expiryTimestamp||Ei(N.wc_sessionPropose.req.ttl),h=dist_index_es_v({id:a,pairingTopic:t,expiryTimestamp:p},o);await this.setProposal(a,h);const u=await this.getVerifyContext({attestationId:i,hash:kc(JSON.stringify(s)),encryptedId:r,metadata:h.proposer.metadata});l?.addTrace(index_es_G_emit_session_proposal),this.client.events.emit("session_proposal",{id:a,params:h,verifyContext:u})}catch(l){await this.sendError({id:a,topic:t,error:l,rpcOpts:N.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),index_es_c(this,"onSessionProposeResponse",async(e,t,s)=>{const{id:i}=t;if((0,jsonrpc_utils_dist_esm.isJsonRpcResult)(t)){const{result:r}=t;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:r});const o=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:o});const a=o.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:a});const l=r.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const p=await this.client.core.crypto.generateSharedKey(a,l);this.pendingSessions.set(i,{sessionTopic:p,pairingTopic:e,proposalId:i,publicKey:a});const h=await this.client.core.relayer.subscribe(p,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:e})}else if((0,jsonrpc_utils_dist_esm.isJsonRpcError)(t)){await this.client.proposal.delete(i,Nt("USER_DISCONNECTED"));const r=xi("session_connect",i);if(0===this.events.listenerCount(r))throw new Error(`emitting ${r} without any listeners, 954`);this.events.emit(r,{error:t.error})}}),index_es_c(this,"onSessionSettleRequest",async(e,t)=>{const{id:s,params:i}=t;try{this.isValidSessionSettleRequest(i);const{relay:r,controller:o,expiry:a,namespaces:l,sessionProperties:p,scopedProperties:h,sessionConfig:u}=t.params,d=[...this.pendingSessions.values()].find(f=>f.sessionTopic===e);if(!d)return this.client.logger.error(`Pending session not found for topic ${e}`);const w=this.client.proposal.get(d.proposalId),m=index_es_b(dist_index_es_v(dist_index_es_v(dist_index_es_v({topic:e,relay:r,expiry:a,namespaces:l,acknowledged:!0,pairingTopic:d.pairingTopic,requiredNamespaces:w.requiredNamespaces,optionalNamespaces:w.optionalNamespaces,controller:o.publicKey,self:{publicKey:d.publicKey,metadata:this.client.metadata},peer:{publicKey:o.publicKey,metadata:o.metadata}},p&&{sessionProperties:p}),h&&{scopedProperties:h}),u&&{sessionConfig:u}),{transportType:index_es_Q.relay});await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),await this.client.core.pairing.updateMetadata({topic:d.pairingTopic,metadata:m.peer.metadata}),this.client.events.emit("session_connect",{session:m}),this.events.emit(xi("session_connect",d.proposalId),{session:m}),this.pendingSessions.delete(d.proposalId),this.deleteProposal(d.proposalId,!1),this.cleanupDuplicatePairings(m),await this.sendResult({id:t.id,topic:e,result:!0,throwOnFailedPublish:!0})}catch(r){await this.sendError({id:s,topic:e,error:r}),this.client.logger.error(r)}}),index_es_c(this,"onSessionSettleResponse",async(e,t)=>{const{id:s}=t;(0,jsonrpc_utils_dist_esm.isJsonRpcResult)(t)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(xi("session_approve",s),{})):(0,jsonrpc_utils_dist_esm.isJsonRpcError)(t)&&(await this.client.session.delete(e,Nt("USER_DISCONNECTED")),this.events.emit(xi("session_approve",s),{error:t.error}))}),index_es_c(this,"onSessionUpdateRequest",async(e,t)=>{const{params:s,id:i}=t;try{const r=`${e}_session_update`,o=Ra.get(r);if(o&&this.isRequestOutOfSync(o,i))return this.client.logger.warn(`Discarding out of sync request - ${i}`),void this.sendError({id:i,topic:e,error:Nt("INVALID_UPDATE_REQUEST")});this.isValidUpdate(dist_index_es_v({topic:e},s));try{Ra.set(r,i),await this.client.session.update(e,{namespaces:s.namespaces}),await this.sendResult({id:i,topic:e,result:!0,throwOnFailedPublish:!0})}catch(a){throw Ra.delete(r),a}this.client.events.emit("session_update",{id:i,topic:e,params:s})}catch(r){await this.sendError({id:i,topic:e,error:r}),this.client.logger.error(r)}}),index_es_c(this,"isRequestOutOfSync",(e,t)=>t.toString().slice(0,-3)<e.toString().slice(0,-3)),index_es_c(this,"onSessionUpdateResponse",(e,t)=>{const{id:s}=t,i=xi("session_update",s);if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners`);(0,jsonrpc_utils_dist_esm.isJsonRpcResult)(t)?this.events.emit(xi("session_update",s),{}):(0,jsonrpc_utils_dist_esm.isJsonRpcError)(t)&&this.events.emit(xi("session_update",s),{error:t.error})}),index_es_c(this,"onSessionExtendRequest",async(e,t)=>{const{id:s}=t;try{this.isValidExtend({topic:e}),await this.setExpiry(e,Ei(index_es_J)),await this.sendResult({id:s,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:s,topic:e})}catch(i){await this.sendError({id:s,topic:e,error:i}),this.client.logger.error(i)}}),index_es_c(this,"onSessionExtendResponse",(e,t)=>{const{id:s}=t,i=xi("session_extend",s);if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners`);(0,jsonrpc_utils_dist_esm.isJsonRpcResult)(t)?this.events.emit(xi("session_extend",s),{}):(0,jsonrpc_utils_dist_esm.isJsonRpcError)(t)&&this.events.emit(xi("session_extend",s),{error:t.error})}),index_es_c(this,"onSessionPingRequest",async(e,t)=>{const{id:s}=t;try{this.isValidPing({topic:e}),await this.sendResult({id:s,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:e})}catch(i){await this.sendError({id:s,topic:e,error:i}),this.client.logger.error(i)}}),index_es_c(this,"onSessionPingResponse",(e,t)=>{const{id:s}=t,i=xi("session_ping",s);setTimeout(()=>{if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners 2176`);(0,jsonrpc_utils_dist_esm.isJsonRpcResult)(t)?this.events.emit(xi("session_ping",s),{}):(0,jsonrpc_utils_dist_esm.isJsonRpcError)(t)&&this.events.emit(xi("session_ping",s),{error:t.error})},500)}),index_es_c(this,"onSessionDeleteRequest",async(e,t)=>{const{id:s}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),Promise.all([new Promise(i=>{this.client.core.relayer.once(index_es_C_publish,async()=>{i(await this.deleteSession({topic:e,id:s}))})}),this.sendResult({id:s,topic:e,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:e,error:Nt("USER_DISCONNECTED")})]).catch(i=>this.client.logger.error(i))}catch(i){this.client.logger.error(i)}}),index_es_c(this,"onSessionRequest",async e=>{var t,s,i;const{topic:r,payload:o,attestation:a,encryptedId:l,transportType:p}=e,{id:h,params:u}=o;try{await this.isValidRequest(dist_index_es_v({topic:r},u));const d=this.client.session.get(r),m={id:h,topic:r,params:u,verifyContext:await this.getVerifyContext({attestationId:a,hash:kc(JSON.stringify((0,jsonrpc_utils_dist_esm.formatJsonRpcRequest)("wc_sessionRequest",u,h))),encryptedId:l,metadata:d.peer.metadata,transportType:p})};await this.setPendingSessionRequest(m),p===index_es_Q.link_mode&&null!=(t=d.peer.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(null==(s=d.peer.metadata.redirect)?void 0:s.universal),null!=(i=this.client.signConfig)&&i.disableRequestQueue?this.emitSessionRequest(m):(this.addSessionRequestToSessionRequestQueue(m),this.processSessionRequestQueue())}catch(d){await this.sendError({id:h,topic:r,error:d}),this.client.logger.error(d)}}),index_es_c(this,"onSessionRequestResponse",(e,t)=>{const{id:s}=t,i=xi("session_request",s);if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners`);(0,jsonrpc_utils_dist_esm.isJsonRpcResult)(t)?this.events.emit(xi("session_request",s),{result:t.result}):(0,jsonrpc_utils_dist_esm.isJsonRpcError)(t)&&this.events.emit(xi("session_request",s),{error:t.error})}),index_es_c(this,"onSessionEventRequest",async(e,t)=>{const{id:s,params:i}=t;try{const r=`${e}_session_event_${i.event.name}`,o=Ra.get(r);if(o&&this.isRequestOutOfSync(o,s))return void this.client.logger.info(`Discarding out of sync request - ${s}`);this.isValidEmit(dist_index_es_v({topic:e},i)),this.client.events.emit("session_event",{id:s,topic:e,params:i}),Ra.set(r,s)}catch(r){await this.sendError({id:s,topic:e,error:r}),this.client.logger.error(r)}}),index_es_c(this,"onSessionAuthenticateResponse",(e,t)=>{const{id:s}=t;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:e,payload:t}),(0,jsonrpc_utils_dist_esm.isJsonRpcResult)(t)?this.events.emit(xi("session_request",s),{result:t.result}):(0,jsonrpc_utils_dist_esm.isJsonRpcError)(t)&&this.events.emit(xi("session_request",s),{error:t.error})}),index_es_c(this,"onSessionAuthenticateRequest",async e=>{var t;const{topic:s,payload:i,attestation:r,encryptedId:o,transportType:a}=e;try{const{requester:l,authPayload:p,expiryTimestamp:h}=i.params,u=await this.getVerifyContext({attestationId:r,hash:kc(JSON.stringify(i)),encryptedId:o,metadata:l.metadata,transportType:a}),d={requester:l,pairingTopic:s,id:i.id,authPayload:p,verifyContext:u,expiryTimestamp:h};await this.setAuthRequest(i.id,{request:d,pairingTopic:s,transportType:a}),a===index_es_Q.link_mode&&null!=(t=l.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:i.params,id:i.id,verifyContext:u})}catch(l){this.client.logger.error(l);const p=i.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),u=this.getAppLinkIfEnabled(i.params.requester.metadata,a),d={type:1,receiverPublicKey:p,senderPublicKey:h};await this.sendError({id:i.id,topic:s,error:l,encodeOpts:d,rpcOpts:N.wc_sessionAuthenticate.autoReject,appLink:u})}}),index_es_c(this,"addSessionRequestToSessionRequestQueue",e=>{this.sessionRequestQueue.queue.push(e)}),index_es_c(this,"cleanupAfterResponse",e=>{this.deletePendingSessionRequest(e.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=dist_index_es_$_idle,this.processSessionRequestQueue()},(0,cjs.toMiliseconds)(this.requestQueueDelay))}),index_es_c(this,"cleanupPendingSentRequestsForTopic",({topic:e,error:t})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(i=>i.topic===e&&"wc_sessionRequest"===i.request.method).forEach(i=>{const o=xi("session_request",i.request.id);if(0===this.events.listenerCount(o))throw new Error(`emitting ${o} without any listeners`);this.events.emit(xi("session_request",i.request.id),{error:t})})}),index_es_c(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===dist_index_es_$_active)return void this.client.logger.info("session request queue is already active.");const e=this.sessionRequestQueue.queue[0];if(e)try{this.sessionRequestQueue.state=dist_index_es_$_active,this.emitSessionRequest(e)}catch(t){this.client.logger.error(t)}else this.client.logger.info("session request queue is empty.")}),index_es_c(this,"emitSessionRequest",e=>{this.client.events.emit("session_request",e)}),index_es_c(this,"onPairingCreated",e=>{if(e.methods&&this.expectedPairingMethodMap.set(e.topic,e.methods),e.active)return;const t=this.client.proposal.getAll().find(s=>s.pairingTopic===e.topic);t&&this.onSessionProposeRequest({topic:e.topic,payload:(0,jsonrpc_utils_dist_esm.formatJsonRpcRequest)("wc_sessionPropose",index_es_b(dist_index_es_v({},t),{requiredNamespaces:t.requiredNamespaces,optionalNamespaces:t.optionalNamespaces,relays:t.relays,proposer:t.proposer,sessionProperties:t.sessionProperties,scopedProperties:t.scopedProperties}),t.id)})}),index_es_c(this,"isValidConnect",async e=>{if(!ma(e)){const{message:l}=ht("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(e)}`);throw new Error(l)}const{pairingTopic:t,requiredNamespaces:s,optionalNamespaces:i,sessionProperties:r,scopedProperties:o,relays:a}=e;if(Et(t)||await this.isValidPairingTopic(t),!function ga(t,e){let n=!1;return e&&!t?n=!0:t&&se(t)&&t.length&&t.forEach(r=>{n=Io(r)}),n}(a,!0)){const{message:l}=ht("MISSING_OR_INVALID",`connect() relays: ${a}`);throw new Error(l)}if(!Et(s)&&0!==Oe(s)){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?dist_index_es_console.warn(l):this.client.logger.warn(l),this.validateNamespaces(s,"requiredNamespaces")}if(!Et(i)&&0!==Oe(i)&&this.validateNamespaces(i,"optionalNamespaces"),Et(r)||this.validateSessionProps(r,"sessionProperties"),!Et(o)){this.validateSessionProps(o,"scopedProperties");const l=Object.keys(s||{}).concat(Object.keys(i||{}));if(!Object.keys(o).every(p=>l.includes(p)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(o)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),index_es_c(this,"validateNamespaces",(e,t)=>{const s=function pa(t,e,n){let r=null;if(t&&Oe(t)){const o=wn(t,e);o&&(r=o);const i=xo(t,e,n);i&&(r=i)}else r=ht("MISSING_OR_INVALID",`${e}, ${n} should be an object with data`);return r}(e,"connect()",t);if(s)throw new Error(s.message)}),index_es_c(this,"isValidApprove",async e=>{if(!ma(e))throw new Error(ht("MISSING_OR_INVALID",`approve() params: ${e}`).message);const{id:t,namespaces:s,relayProtocol:i,sessionProperties:r,scopedProperties:o}=e;this.checkRecentlyDeleted(t),await this.isValidProposalId(t);const a=this.client.proposal.get(t),l=Bo(s,"approve()");if(l)throw new Error(l.message);const p=No(a.requiredNamespaces,s,"approve()");if(p)throw new Error(p.message);if(!nt(i,!0)){const{message:h}=ht("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(h)}if(Et(r)||this.validateSessionProps(r,"sessionProperties"),!Et(o)){this.validateSessionProps(o,"scopedProperties");const h=new Set(Object.keys(s));if(!Object.keys(o).every(u=>h.has(u)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(o)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),index_es_c(this,"isValidReject",async e=>{if(!ma(e)){const{message:i}=ht("MISSING_OR_INVALID",`reject() params: ${e}`);throw new Error(i)}const{id:t,reason:s}=e;if(this.checkRecentlyDeleted(t),await this.isValidProposalId(t),!function wa(t){return!!(t&&"object"==typeof t&&t.code&&Ae(t.code,!1)&&t.message&&nt(t.message,!1))}(s)){const{message:i}=ht("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(i)}}),index_es_c(this,"isValidSessionSettleRequest",e=>{if(!ma(e)){const{message:l}=ht("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${e}`);throw new Error(l)}const{relay:t,controller:s,namespaces:i,expiry:r}=e;if(!Io(t)){const{message:l}=ht("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const o=function ha(t,e){let n=null;return nt(t?.publicKey,!1)||(n=ht("MISSING_OR_INVALID",`${e} controller public key should be a string`)),n}(s,"onSessionSettleRequest()");if(o)throw new Error(o.message);const a=Bo(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);if(vi(r)){const{message:l}=ht("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),index_es_c(this,"isValidUpdate",async e=>{if(!ma(e)){const{message:a}=ht("MISSING_OR_INVALID",`update() params: ${e}`);throw new Error(a)}const{topic:t,namespaces:s}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);const i=this.client.session.get(t),r=Bo(s,"update()");if(r)throw new Error(r.message);const o=No(i.requiredNamespaces,s,"update()");if(o)throw new Error(o.message)}),index_es_c(this,"isValidExtend",async e=>{if(!ma(e)){const{message:s}=ht("MISSING_OR_INVALID",`extend() params: ${e}`);throw new Error(s)}const{topic:t}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t)}),index_es_c(this,"isValidRequest",async e=>{if(!ma(e)){const{message:a}=ht("MISSING_OR_INVALID",`request() params: ${e}`);throw new Error(a)}const{topic:t,request:s,chainId:i,expiry:r}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);const{namespaces:o}=this.client.session.get(t);if(!xa(o,i)){const{message:a}=ht("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(a)}if(!function ba(t){return!(Et(t)||!nt(t.method,!1))}(s)){const{message:a}=ht("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(a)}if(!Sa(o,i,s.method)){const{message:a}=ht("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(a)}if(r&&!function Ia(t,e){return Ae(t,!1)&&t<=e.max&&t>=e.min}(r,dist_index_es_e)){const{message:a}=ht("MISSING_OR_INVALID",`request() expiry: ${r}. Expiry must be a number (in seconds) between ${dist_index_es_e.min} and ${dist_index_es_e.max}`);throw new Error(a)}}),index_es_c(this,"isValidRespond",async e=>{var t;if(!ma(e)){const{message:r}=ht("MISSING_OR_INVALID",`respond() params: ${e}`);throw new Error(r)}const{topic:s,response:i}=e;try{await this.isValidSessionTopic(s)}catch(r){throw null!=(t=e?.response)&&t.id&&this.cleanupAfterResponse(e),r}if(!function Ea(t){return!(Et(t)||Et(t.result)&&Et(t.error)||!Ae(t.id,!1)||!nt(t.jsonrpc,!1))}(i)){const{message:r}=ht("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(r)}}),index_es_c(this,"isValidPing",async e=>{if(!ma(e)){const{message:s}=ht("MISSING_OR_INVALID",`ping() params: ${e}`);throw new Error(s)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),index_es_c(this,"isValidEmit",async e=>{if(!ma(e)){const{message:o}=ht("MISSING_OR_INVALID",`emit() params: ${e}`);throw new Error(o)}const{topic:t,event:s,chainId:i}=e;await this.isValidSessionTopic(t);const{namespaces:r}=this.client.session.get(t);if(!xa(r,i)){const{message:o}=ht("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(o)}if(!function va(t){return!(Et(t)||!nt(t.name,!1))}(s)){const{message:o}=ht("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(o)}if(!Oa(r,i,s.name)){const{message:o}=ht("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(o)}}),index_es_c(this,"isValidDisconnect",async e=>{if(!ma(e)){const{message:s}=ht("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw new Error(s)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),index_es_c(this,"isValidAuthenticate",e=>{const{chains:t,uri:s,domain:i,nonce:r}=e;if(!Array.isArray(t)||0===t.length)throw new Error("chains is required and must be a non-empty array");if(!nt(s,!1))throw new Error("uri is required parameter");if(!nt(i,!1))throw new Error("domain is required parameter");if(!nt(r,!1))throw new Error("nonce is required parameter");if([...new Set(t.map(a=>Ne(a).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:o}=Ne(t[0]);if("eip155"!==o)throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),index_es_c(this,"getVerifyContext",async e=>{const{attestationId:t,hash:s,encryptedId:i,metadata:r,transportType:o}=e,a={verified:{verifyUrl:r.verifyUrl||index_es_ue,validation:"UNKNOWN",origin:r.url||""}};try{if(o===index_es_Q.link_mode){const p=this.getAppLinkIfEnabled(r,o);return a.verified.validation=p&&new URL(p).origin===new URL(r.url).origin?"VALID":"INVALID",a}const l=await this.client.core.verify.resolve({attestationId:t,hash:s,encryptedId:i,verifyUrl:r.verifyUrl});l&&(a.verified.origin=l.origin,a.verified.isScam=l.isScam,a.verified.validation=l.origin===new URL(r.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(a)}`),a}),index_es_c(this,"validateSessionProps",(e,t)=>{Object.values(e).forEach((s,i)=>{if(null==s){const{message:r}=ht("MISSING_OR_INVALID",`${t} must contain an existing value for each key. Received: ${s} for key ${Object.keys(e)[i]}`);throw new Error(r)}})}),index_es_c(this,"getPendingAuthRequest",e=>{const t=this.client.auth.requests.get(e);return"object"==typeof t?t:void 0}),index_es_c(this,"addToRecentlyDeleted",(e,t)=>{if(this.recentlyDeletedMap.set(e,t),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const i=this.recentlyDeletedLimit/2;for(const r of this.recentlyDeletedMap.keys()){if(s++>=i)break;this.recentlyDeletedMap.delete(r)}}}),index_es_c(this,"checkRecentlyDeleted",e=>{const t=this.recentlyDeletedMap.get(e);if(t){const{message:s}=ht("MISSING_OR_INVALID",`Record was recently deleted - ${t}: ${e}`);throw new Error(s)}}),index_es_c(this,"isLinkModeEnabled",(e,t)=>{var s,i,r,o,a,l,p,h,u;return!(!e||t!==index_es_Q.link_mode)&&(!0===(null==(i=null==(s=this.client.metadata)?void 0:s.redirect)?void 0:i.linkMode)&&void 0!==(null==(o=null==(r=this.client.metadata)?void 0:r.redirect)?void 0:o.universal)&&""!==(null==(l=null==(a=this.client.metadata)?void 0:a.redirect)?void 0:l.universal)&&void 0!==(null==(p=e?.redirect)?void 0:p.universal)&&""!==(null==(h=e?.redirect)?void 0:h.universal)&&!0===(null==(u=e?.redirect)?void 0:u.linkMode)&&this.client.core.linkModeSupportedApps.includes(e.redirect.universal)&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Linking)<"u")}),index_es_c(this,"getAppLinkIfEnabled",(e,t)=>{var s;return this.isLinkModeEnabled(e,t)?null==(s=e?.redirect)?void 0:s.universal:void 0}),index_es_c(this,"handleLinkModeMessage",({url:e})=>{if(!e||!e.includes("wc_ev")||!e.includes("topic"))return;const t=Ai(e,"topic")||"",s=decodeURIComponent(Ai(e,"wc_ev")||""),i=this.client.session.keys.includes(t);i&&this.client.session.update(t,{transportType:index_es_Q.link_mode}),this.client.core.dispatchEnvelope({topic:t,message:s,sessionExists:i})}),index_es_c(this,"registerLinkModeListeners",async()=>{var e;if(Ii()||pt()&&null!=(e=this.client.metadata.redirect)&&e.linkMode){const t=null==__webpack_require__.g?void 0:__webpack_require__.g.Linking;if(typeof t<"u"){t.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await t.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),index_es_c(this,"shouldSetTVF",(e,t)=>{if(!t||"wc_sessionRequest"!==e)return!1;const{request:s}=t;return Object.keys(dist_index_es_Ke).includes(s.method)}),index_es_c(this,"getTVFParams",(e,t,s)=>{var i,r;try{const o=t.request.method,a=this.extractTxHashesFromResult(o,s);return index_es_b(dist_index_es_v({correlationId:e,rpcMethods:[o],chainId:t.chainId},this.isValidContractData(t.request.params)&&{contractAddresses:[null==(r=null==(i=t.request.params)?void 0:i[0])?void 0:r.to]}),{txHashes:a})}catch(o){this.client.logger.warn("Error getting TVF params",o)}return{}}),index_es_c(this,"isValidContractData",e=>{var t;if(!e)return!1;try{const s=e?.data||(null==(t=e?.[0])?void 0:t.data);if(!s.startsWith("0x"))return!1;const i=s.slice(2);return!!/^[0-9a-fA-F]*$/.test(i)&&i.length%2==0}catch{}return!1}),index_es_c(this,"extractTxHashesFromResult",(e,t)=>{try{if("string"==typeof t)return[t];const i=t[dist_index_es_Ke[e].key];if(se(i))return"solana_signAllTransactions"===e?i.map(r=>function Ji(t){const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);const r=n[0];if(0===r)throw new Error("No signatures found");const o=1+64*r;if(n.length<o)throw new Error("Transaction data too short for claimed signature count");if(n.length<100)throw new Error("Transaction too short");const i=Buffer.from(t,"base64").slice(1,65);return esm.A.encode(i)}(r)):i;if("string"==typeof i)return[i]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}async processPendingMessageEvents(){try{const n=this.client.session.keys,e=this.client.core.relayer.messages.getWithoutAck(n);for(const[t,s]of Object.entries(e))for(const i of s)try{await this.onProviderMessageEvent({topic:t,message:i,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${t}, message: ${i}`)}}catch(n){this.client.logger.warn("processPendingMessageEvents failed",n)}}isInitialized(){if(!this.initialized){const{message:n}=ht("NOT_INITIALIZED",this.name);throw new Error(n)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(index_es_C_message,n=>{this.onProviderMessageEvent(n)})}async onRelayMessage(n){const{topic:e,message:t,attestation:s,transportType:i}=n,{publicKey:r}=this.client.auth.authKeys.keys.includes(index_es_ce)?this.client.auth.authKeys.get(index_es_ce):{responseTopic:void 0,publicKey:void 0};try{const o=await this.client.core.crypto.decode(e,t,{receiverPublicKey:r,encoding:i===index_es_Q.link_mode?xe:qt});(0,jsonrpc_utils_dist_esm.isJsonRpcRequest)(o)?(this.client.core.history.set(e,o),await this.onRelayEventRequest({topic:e,payload:o,attestation:s,transportType:i,encryptedId:kc(t)})):(0,jsonrpc_utils_dist_esm.isJsonRpcResponse)(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:e,payload:o,transportType:i}),this.client.core.history.delete(e,o.id)):await this.onRelayEventUnknownPayload({topic:e,payload:o,transportType:i}),await this.client.core.relayer.messages.ack(e,t)}catch(o){this.client.logger.error(o)}}registerExpirerEvents(){this.client.core.expirer.on(index_es_M_expired,async n=>{const{topic:e,id:t}=bi(n.target);return t&&this.client.pendingRequest.keys.includes(t)?await this.deletePendingSessionRequest(t,ht("EXPIRED"),!0):t&&this.client.auth.requests.keys.includes(t)?await this.deletePendingAuthRequest(t,ht("EXPIRED"),!0):void(e?this.client.session.keys.includes(e)&&(await this.deleteSession({topic:e,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:e})):t&&(await this.deleteProposal(t,!0),this.client.events.emit("proposal_expire",{id:t})))})}registerPairingEvents(){this.client.core.pairing.events.on(index_es_re_create,n=>this.onPairingCreated(n)),this.client.core.pairing.events.on(index_es_re_delete,n=>{this.addToRecentlyDeleted(n.topic,"pairing")})}isValidPairingTopic(n){if(!nt(n,!1)){const{message:e}=ht("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(e)}if(!this.client.core.pairing.pairings.keys.includes(n)){const{message:e}=ht("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(e)}if(vi(this.client.core.pairing.pairings.get(n).expiry)){const{message:e}=ht("EXPIRED",`pairing topic: ${n}`);throw new Error(e)}}async isValidSessionTopic(n){if(!nt(n,!1)){const{message:e}=ht("MISSING_OR_INVALID",`session topic should be a string: ${n}`);throw new Error(e)}if(this.checkRecentlyDeleted(n),!this.client.session.keys.includes(n)){const{message:e}=ht("NO_MATCHING_KEY",`session topic doesn't exist: ${n}`);throw new Error(e)}if(vi(this.client.session.get(n).expiry)){await this.deleteSession({topic:n});const{message:e}=ht("EXPIRED",`session topic: ${n}`);throw new Error(e)}if(!this.client.core.crypto.keychain.has(n)){const{message:e}=ht("MISSING_OR_INVALID",`session topic does not exist in keychain: ${n}`);throw await this.deleteSession({topic:n}),new Error(e)}}async isValidSessionOrPairingTopic(n){if(this.checkRecentlyDeleted(n),this.client.session.keys.includes(n))await this.isValidSessionTopic(n);else{if(!this.client.core.pairing.pairings.keys.includes(n)){if(nt(n,!1)){const{message:e}=ht("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${n}`);throw new Error(e)}{const{message:e}=ht("MISSING_OR_INVALID",`session or pairing topic should be a string: ${n}`);throw new Error(e)}}this.isValidPairingTopic(n)}}async isValidProposalId(n){if(!function ya(t){return"number"==typeof t}(n)){const{message:e}=ht("MISSING_OR_INVALID",`proposal id should be a number: ${n}`);throw new Error(e)}if(!this.client.proposal.keys.includes(n)){const{message:e}=ht("NO_MATCHING_KEY",`proposal id doesn't exist: ${n}`);throw new Error(e)}if(vi(this.client.proposal.get(n).expiryTimestamp)){await this.deleteProposal(n);const{message:e}=ht("EXPIRED",`proposal id: ${n}`);throw new Error(e)}}}class index_es_Os extends index_es_zi{constructor(n,e){super(n,e,"proposal","wc@2:client:"),this.core=n,this.logger=e}}class dist_index_es_St extends index_es_zi{constructor(n,e){super(n,e,"session","wc@2:client:"),this.core=n,this.logger=e}}class index_es_bs extends index_es_zi{constructor(n,e){super(n,e,"request","wc@2:client:",t=>t.id),this.core=n,this.logger=e}}class index_es_As extends index_es_zi{constructor(n,e){super(n,e,"authKeys","wc@1.5:auth:",()=>index_es_ce),this.core=n,this.logger=e}}class index_es_xs extends index_es_zi{constructor(n,e){super(n,e,"pairingTopics","wc@1.5:auth:"),this.core=n,this.logger=e}}class index_es_Cs extends index_es_zi{constructor(n,e){super(n,e,"requests","wc@1.5:auth:",t=>t.id),this.core=n,this.logger=e}}var index_es_Vs=Object.defineProperty,dist_index_es_Ge=(S,n,e)=>((S,n,e)=>n in S?index_es_Vs(S,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):S[n]=e)(S,"symbol"!=typeof n?n+"":n,e);class index_es_Ls{constructor(n,e){this.core=n,this.logger=e,dist_index_es_Ge(this,"authKeys"),dist_index_es_Ge(this,"pairingTopics"),dist_index_es_Ge(this,"requests"),this.authKeys=new index_es_As(this.core,this.logger),this.pairingTopics=new index_es_xs(this.core,this.logger),this.requests=new index_es_Cs(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var index_es_ks=Object.defineProperty,dist_index_es_E=(S,n,e)=>((S,n,e)=>n in S?index_es_ks(S,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):S[n]=e)(S,"symbol"!=typeof n?n+"":n,e);class dist_index_es_Ee extends J{constructor(n){super(n),dist_index_es_E(this,"protocol","wc"),dist_index_es_E(this,"version",2),dist_index_es_E(this,"name",index_es_me_name),dist_index_es_E(this,"metadata"),dist_index_es_E(this,"core"),dist_index_es_E(this,"logger"),dist_index_es_E(this,"events",new events.EventEmitter),dist_index_es_E(this,"engine"),dist_index_es_E(this,"session"),dist_index_es_E(this,"proposal"),dist_index_es_E(this,"pendingRequest"),dist_index_es_E(this,"auth"),dist_index_es_E(this,"signConfig"),dist_index_es_E(this,"on",(t,s)=>this.events.on(t,s)),dist_index_es_E(this,"once",(t,s)=>this.events.once(t,s)),dist_index_es_E(this,"off",(t,s)=>this.events.off(t,s)),dist_index_es_E(this,"removeListener",(t,s)=>this.events.removeListener(t,s)),dist_index_es_E(this,"removeAllListeners",t=>this.events.removeAllListeners(t)),dist_index_es_E(this,"connect",async t=>{try{return await this.engine.connect(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"pair",async t=>{try{return await this.engine.pair(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"approve",async t=>{try{return await this.engine.approve(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"reject",async t=>{try{return await this.engine.reject(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"update",async t=>{try{return await this.engine.update(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"extend",async t=>{try{return await this.engine.extend(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"request",async t=>{try{return await this.engine.request(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"respond",async t=>{try{return await this.engine.respond(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"ping",async t=>{try{return await this.engine.ping(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"emit",async t=>{try{return await this.engine.emit(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"disconnect",async t=>{try{return await this.engine.disconnect(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"find",t=>{try{return this.engine.find(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(t){throw this.logger.error(t.message),t}}),dist_index_es_E(this,"authenticate",async(t,s)=>{try{return await this.engine.authenticate(t,s)}catch(i){throw this.logger.error(i.message),i}}),dist_index_es_E(this,"formatAuthMessage",t=>{try{return this.engine.formatAuthMessage(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"approveSessionAuthenticate",async t=>{try{return await this.engine.approveSessionAuthenticate(t)}catch(s){throw this.logger.error(s.message),s}}),dist_index_es_E(this,"rejectSessionAuthenticate",async t=>{try{return await this.engine.rejectSessionAuthenticate(t)}catch(s){throw this.logger.error(s.message),s}}),this.name=n?.name||index_es_me_name,this.metadata=oi(n?.metadata),this.signConfig=n?.signConfig;const e=typeof n?.logger<"u"&&"string"!=typeof n?.logger?n.logger:(0,logger_dist_index_es.h6)((0,logger_dist_index_es.iP)({level:n?.logger||index_es_me_logger}));this.core=n?.core||new index_es_Xo(n),this.logger=(0,logger_dist_index_es.U5)(e,this.name),this.session=new dist_index_es_St(this.core,this.logger),this.proposal=new index_es_Os(this.core,this.logger),this.pendingRequest=new index_es_bs(this.core,this.logger),this.engine=new index_es_Ns(this),this.auth=new index_es_Ls(this.core,this.logger)}static async init(n){const e=new dist_index_es_Ee(n);return await e.initialize(),e}get context(){return(0,logger_dist_index_es.oI)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},(0,cjs.toMiliseconds)(cjs.ONE_SECOND))}catch(n){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(n.message),n}}}var jsonrpc_http_connection_dist_index_es=__webpack_require__("./node_modules/@walletconnect/jsonrpc-http-connection/dist/index.es.js"),dist_index_es_Buffer=__webpack_require__("./node_modules/buffer/index.js").Buffer,universal_provider_dist_index_es_console=__webpack_require__("./node_modules/console-browserify/index.js");const U="wc@2:universal_provider:",st="https://rpc.walletconnect.org/v1/",dist_index_es_jt=`${st}bundler`,index_es_u_DEFAULT_CHAIN_CHANGED="default_chain_changed";function dist_index_es_Rt(){}function dist_index_es_k(s){return null==s||"object"!=typeof s&&"function"!=typeof s}function index_es_W(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function index_es_it(s){return"object"==typeof s&&null!==s}function rt(s){return Object.getOwnPropertySymbols(s).filter(t=>Object.prototype.propertyIsEnumerable.call(s,t))}function index_es_nt(s){return null==s?void 0===s?"[object Undefined]":"[object Null]":Object.prototype.toString.call(s)}function universal_provider_dist_index_es_$(s,t,e,i=new Map,n=void 0){const a=n?.(s,t,e,i);if(null!=a)return a;if(dist_index_es_k(s))return s;if(i.has(s))return i.get(s);if(Array.isArray(s)){const r=new Array(s.length);i.set(s,r);for(let c=0;c<s.length;c++)r[c]=universal_provider_dist_index_es_$(s[c],c,e,i,n);return Object.hasOwn(s,"index")&&(r.index=s.index),Object.hasOwn(s,"input")&&(r.input=s.input),r}if(s instanceof Date)return new Date(s.getTime());if(s instanceof RegExp){const r=new RegExp(s.source,s.flags);return r.lastIndex=s.lastIndex,r}if(s instanceof Map){const r=new Map;i.set(s,r);for(const[c,o]of s)r.set(c,universal_provider_dist_index_es_$(o,c,e,i,n));return r}if(s instanceof Set){const r=new Set;i.set(s,r);for(const c of s)r.add(universal_provider_dist_index_es_$(c,void 0,e,i,n));return r}if(typeof dist_index_es_Buffer<"u"&&dist_index_es_Buffer.isBuffer(s))return s.subarray();if(index_es_W(s)){const r=new(Object.getPrototypeOf(s).constructor)(s.length);i.set(s,r);for(let c=0;c<s.length;c++)r[c]=universal_provider_dist_index_es_$(s[c],c,e,i,n);return r}if(s instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&s instanceof SharedArrayBuffer)return s.slice(0);if(s instanceof DataView){const r=new DataView(s.buffer.slice(0),s.byteOffset,s.byteLength);return i.set(s,r),dist_index_es_y(r,s,e,i,n),r}if(typeof File<"u"&&s instanceof File){const r=new File([s],s.name,{type:s.type});return i.set(s,r),dist_index_es_y(r,s,e,i,n),r}if(s instanceof Blob){const r=new Blob([s],{type:s.type});return i.set(s,r),dist_index_es_y(r,s,e,i,n),r}if(s instanceof Error){const r=new s.constructor;return i.set(s,r),r.message=s.message,r.name=s.name,r.stack=s.stack,r.cause=s.cause,dist_index_es_y(r,s,e,i,n),r}if("object"==typeof s&&function index_es_ee(s){switch(index_es_nt(s)){case"[object Arguments]":case"[object Array]":case"[object ArrayBuffer]":case"[object DataView]":case"[object Boolean]":case"[object Date]":case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Map]":case"[object Number]":case"[object Object]":case"[object RegExp]":case"[object Set]":case"[object String]":case"[object Symbol]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return!0;default:return!1}}(s)){const r=Object.create(Object.getPrototypeOf(s));return i.set(s,r),dist_index_es_y(r,s,e,i,n),r}return s}function dist_index_es_y(s,t,e=s,i,n){const a=[...Object.keys(t),...rt(t)];for(let r=0;r<a.length;r++){const c=a[r],o=Object.getOwnPropertyDescriptor(s,c);(null==o||o.writable)&&(s[c]=universal_provider_dist_index_es_$(t[c],c,e,i,n))}}function dist_index_es_se(s,t){return function index_es_te(s,t){return universal_provider_dist_index_es_$(s,void 0,s,new Map,t)}(s,(e,i,n,a)=>{const r=t?.(e,i,n,a);if(null!=r)return r;if("object"==typeof s)switch(Object.prototype.toString.call(s)){case"[object Number]":case"[object String]":case"[object Boolean]":{const c=new s.constructor(s?.valueOf());return dist_index_es_y(c,s),c}case"[object Arguments]":{const c={};return dist_index_es_y(c,s),c.length=s.length,c[Symbol.iterator]=s[Symbol.iterator],c}default:return}})}function dist_index_es_pt(s){return dist_index_es_se(s)}function dist_index_es_dt(s){return null!==s&&"object"==typeof s&&"[object Arguments]"===index_es_nt(s)}function dist_index_es_ie(s){return index_es_W(s)}function dist_index_es_re(s){if("object"!=typeof s||null==s)return!1;if(null===Object.getPrototypeOf(s))return!0;if("[object Object]"!==Object.prototype.toString.call(s)){const e=s[Symbol.toStringTag];return!(null==e||!Object.getOwnPropertyDescriptor(s,Symbol.toStringTag)?.writable)&&s.toString()===`[object ${e}]`}let t=s;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(s)===t}function dist_index_es_F(s,t,e,i){if(dist_index_es_k(s)&&(s=Object(s)),null==t||"object"!=typeof t)return s;if(i.has(t))return function dist_index_es_t(s){if(dist_index_es_k(s))return s;if(Array.isArray(s)||index_es_W(s)||s instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&s instanceof SharedArrayBuffer)return s.slice(0);const t=Object.getPrototypeOf(s),e=t.constructor;if(s instanceof Date||s instanceof Map||s instanceof Set)return new e(s);if(s instanceof RegExp){const i=new e(s);return i.lastIndex=s.lastIndex,i}if(s instanceof DataView)return new e(s.buffer.slice(0));if(s instanceof Error){const i=new e(s.message);return i.stack=s.stack,i.name=s.name,i.cause=s.cause,i}if(typeof File<"u"&&s instanceof File)return new e([s],s.name,{type:s.type,lastModified:s.lastModified});if("object"==typeof s){const i=Object.create(t);return Object.assign(i,s)}return s}(i.get(t));if(i.set(t,s),Array.isArray(t)){t=t.slice();for(let a=0;a<t.length;a++)t[a]=t[a]??void 0}const n=[...Object.keys(t),...rt(t)];for(let a=0;a<n.length;a++){const r=n[a];let c=t[r],o=s[r];if(dist_index_es_dt(c)&&(c={...c}),dist_index_es_dt(o)&&(o={...o}),typeof dist_index_es_Buffer<"u"&&dist_index_es_Buffer.isBuffer(c)&&(c=dist_index_es_pt(c)),Array.isArray(c))if("object"==typeof o&&null!=o){const w=[],v=Reflect.ownKeys(o);for(let P=0;P<v.length;P++){const p=v[P];w[p]=o[p]}o=w}else o=[];const m=e(o,c,r,s,t,i);null!=m?s[r]=m:Array.isArray(c)||index_es_it(o)&&index_es_it(c)?s[r]=dist_index_es_F(o,c,e,i):null==o&&dist_index_es_re(c)?s[r]=dist_index_es_F({},c,e,i):null==o&&dist_index_es_ie(c)?s[r]=dist_index_es_pt(c):(void 0===o||void 0!==c)&&(s[r]=c)}return s}function dist_index_es_ae(s,...t){return function dist_index_es_ne(s,...t){const e=t.slice(0,-1),i=t[t.length-1];let n=s;for(let a=0;a<e.length;a++)n=dist_index_es_F(n,e[a],i,new Map);return n}(s,...t,dist_index_es_Rt)}var dist_index_es_ce=Object.defineProperty,index_es_oe=Object.defineProperties,dist_index_es_he=Object.getOwnPropertyDescriptors,dist_index_es_ut=Object.getOwnPropertySymbols,dist_index_es_pe=Object.prototype.hasOwnProperty,dist_index_es_de=Object.prototype.propertyIsEnumerable,index_es_lt=(s,t,e)=>t in s?dist_index_es_ce(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,index_es_L=(s,t)=>{for(var e in t||(t={}))dist_index_es_pe.call(t,e)&&index_es_lt(s,e,t[e]);if(dist_index_es_ut)for(var e of dist_index_es_ut(t))dist_index_es_de.call(t,e)&&index_es_lt(s,e,t[e]);return s},dist_index_es_ue=(s,t)=>index_es_oe(s,dist_index_es_he(t));function index_es_d(s,t,e){var i;const n=Ne(s);return(null==(i=t.rpcMap)?void 0:i[n.reference])||`${st}?chainId=${n.namespace}:${n.reference}&projectId=${e}`}function dist_index_es_b(s){return s.includes(":")?s.split(":")[1]:s}function dist_index_es_ft(s){return s.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function dist_index_es_M(s={},t={}){return dist_index_es_ae(dist_index_es_mt(s),dist_index_es_mt(t))}function dist_index_es_mt(s){var t,e,i,n,a;const r={};if(!Oe(s))return r;for(const[c,o]of Object.entries(s)){const m=yn(c)?[c]:o.chains,w=o.methods||[],v=o.events||[],P=o.rpcMap||{},p=yo(c);r[p]=dist_index_es_ue(index_es_L(index_es_L({},r[p]),o),{chains:ot(m,null==(t=r[p])?void 0:t.chains),methods:ot(w,null==(e=r[p])?void 0:e.methods),events:ot(v,null==(i=r[p])?void 0:i.events)}),(Oe(P)||Oe((null==(n=r[p])?void 0:n.rpcMap)||{}))&&(r[p].rpcMap=index_es_L(index_es_L({},P),null==(a=r[p])?void 0:a.rpcMap))}return r}function vt(s){return s.includes(":")?s.split(":")[2]:s}function dist_index_es_gt(s){const t={};for(const[e,i]of Object.entries(s)){const n=i.methods||[],a=i.events||[],r=i.accounts||[],c=yn(e)?[e]:i.chains?i.chains:dist_index_es_ft(i.accounts);t[e]={chains:c,methods:n,events:a,accounts:r}}return t}function dist_index_es_K(s){return"number"==typeof s?s:s.includes("0x")?parseInt(s,16):(s=s.includes(":")?s.split(":")[1]:s,isNaN(Number(s))?s:Number(s))}const dist_index_es_Pt={},index_es_h=s=>dist_index_es_Pt[s],universal_provider_dist_index_es_V=(s,t)=>{dist_index_es_Pt[s]=t};var index_es_fe=Object.defineProperty,dist_index_es_O=(s,t,e)=>((s,t,e)=>t in s?index_es_fe(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e)(s,"symbol"!=typeof t?t+"":t,e);class index_es_ve{constructor(t){dist_index_es_O(this,"name","polkadot"),dist_index_es_O(this,"client"),dist_index_es_O(this,"httpProviders"),dist_index_es_O(this,"events"),dist_index_es_O(this,"namespace"),dist_index_es_O(this,"chainId"),this.namespace=t.namespace,this.events=index_es_h("events"),this.client=index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(index_es_u_DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t&&t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var i;const n=dist_index_es_b(e);t[n]=this.createHttpProvider(n,null==(i=this.namespace.rpcMap)?void 0:i[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProvider(t,e){const i=e||index_es_d(t,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);return new jsonrpc_provider_dist_index_es.F(new jsonrpc_http_connection_dist_index_es.A(i,index_es_h("disableProviderPing")))}}var dist_index_es_ge=Object.defineProperty,index_es_Pe=Object.defineProperties,dist_index_es_we=Object.getOwnPropertyDescriptors,dist_index_es_wt=Object.getOwnPropertySymbols,dist_index_es_ye=Object.prototype.hasOwnProperty,dist_index_es_be=Object.prototype.propertyIsEnumerable,index_es_X=(s,t,e)=>t in s?dist_index_es_ge(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,dist_index_es_yt=(s,t)=>{for(var e in t||(t={}))dist_index_es_ye.call(t,e)&&index_es_X(s,e,t[e]);if(dist_index_es_wt)for(var e of dist_index_es_wt(t))dist_index_es_be.call(t,e)&&index_es_X(s,e,t[e]);return s},index_es_bt=(s,t)=>index_es_Pe(s,dist_index_es_we(t)),index_es_A=(s,t,e)=>index_es_X(s,"symbol"!=typeof t?t+"":t,e);class index_es_Ie{constructor(t){index_es_A(this,"name","eip155"),index_es_A(this,"client"),index_es_A(this,"chainId"),index_es_A(this,"namespace"),index_es_A(this,"httpProviders"),index_es_A(this,"events"),this.namespace=t.namespace,this.events=index_es_h("events"),this.client=index_es_h("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(t);case"wallet_getCallsStatus":return await this.getCallStatus(t)}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(parseInt(t),e),this.chainId=parseInt(t),this.events.emit(index_es_u_DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,e){const i=e||index_es_d(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);return new jsonrpc_provider_dist_index_es.F(new jsonrpc_http_connection_dist_index_es.V(i,index_es_h("disableProviderPing")))}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var i;const n=parseInt(dist_index_es_b(e));t[n]=this.createHttpProvider(n,null==(i=this.namespace.rpcMap)?void 0:i[e])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}async handleSwitchChain(t){var e,i;let n=t.request.params?null==(e=t.request.params[0])?void 0:e.chainId:"0x0";n=n.startsWith("0x")?n:`0x${n}`;const a=parseInt(n,16);if(this.isChainApproved(a))this.setDefaultChain(`${a}`);else{if(!this.namespace.methods.includes("wallet_switchEthereumChain"))throw new Error(`Failed to switch to chain 'eip155:${a}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:n}]},chainId:null==(i=this.namespace.chains)?void 0:i[0]}),this.setDefaultChain(`${a}`)}return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}async getCapabilities(t){var e,i,n,a,r;const c=null==(i=null==(e=t.request)?void 0:e.params)?void 0:i[0],m=`${c}${((null==(a=null==(n=t.request)?void 0:n.params)?void 0:a[1])||[]).join(",")}`;if(!c)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const w=this.client.session.get(t.topic),v=(null==(r=w?.sessionProperties)?void 0:r.capabilities)||{};if(null!=v&&v[m])return v?.[m];const P=await this.client.request(t);try{await this.client.session.update(t.topic,{sessionProperties:index_es_bt(dist_index_es_yt({},w.sessionProperties||{}),{capabilities:index_es_bt(dist_index_es_yt({},v||{}),{[m]:P})})})}catch(p){universal_provider_dist_index_es_console.warn("Failed to update session with capabilities",p)}return P}async getCallStatus(t){var e,i;const n=this.client.session.get(t.topic),a=null==(e=n.sessionProperties)?void 0:e.bundler_name;if(a){const c=this.getBundlerUrl(t.chainId,a);try{return await this.getUserOperationReceipt(c,t)}catch(o){universal_provider_dist_index_es_console.warn("Failed to fetch call status from bundler",o,c)}}const r=null==(i=n.sessionProperties)?void 0:i.bundler_url;if(r)try{return await this.getUserOperationReceipt(r,t)}catch(c){universal_provider_dist_index_es_console.warn("Failed to fetch call status from custom bundler",c,r)}if(this.namespace.methods.includes(t.request.method))return await this.client.request(t);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(t,e){var i;const n=new URL(t),a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,jsonrpc_utils_dist_esm.formatJsonRpcRequest)("eth_getUserOperationReceipt",[null==(i=e.request.params)?void 0:i[0]]))});if(!a.ok)throw new Error(`Failed to fetch user operation receipt - ${a.status}`);return await a.json()}getBundlerUrl(t,e){return`${dist_index_es_jt}?projectId=${this.client.core.projectId}&chainId=${t}&bundler=${e}`}}var dist_index_es_$e=Object.defineProperty,dist_index_es_C=(s,t,e)=>((s,t,e)=>t in s?dist_index_es_$e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e)(s,"symbol"!=typeof t?t+"":t,e);class index_es_Ae{constructor(t){dist_index_es_C(this,"name","solana"),dist_index_es_C(this,"client"),dist_index_es_C(this,"httpProviders"),dist_index_es_C(this,"events"),dist_index_es_C(this,"namespace"),dist_index_es_C(this,"chainId"),this.namespace=t.namespace,this.events=index_es_h("events"),this.client=index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(index_es_u_DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var i;const n=dist_index_es_b(e);t[n]=this.createHttpProvider(n,null==(i=this.namespace.rpcMap)?void 0:i[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProvider(t,e){const i=e||index_es_d(t,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);return new jsonrpc_provider_dist_index_es.F(new jsonrpc_http_connection_dist_index_es.A(i,index_es_h("disableProviderPing")))}}var dist_index_es_Ce=Object.defineProperty,dist_index_es_H=(s,t,e)=>((s,t,e)=>t in s?dist_index_es_Ce(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e)(s,"symbol"!=typeof t?t+"":t,e);class universal_provider_dist_index_es_Ee{constructor(t){dist_index_es_H(this,"name","cosmos"),dist_index_es_H(this,"client"),dist_index_es_H(this,"httpProviders"),dist_index_es_H(this,"events"),dist_index_es_H(this,"namespace"),dist_index_es_H(this,"chainId"),this.namespace=t.namespace,this.events=index_es_h("events"),this.client=index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(index_es_u_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var i;const n=dist_index_es_b(e);t[n]=this.createHttpProvider(n,null==(i=this.namespace.rpcMap)?void 0:i[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProvider(t,e){const i=e||index_es_d(t,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);return new jsonrpc_provider_dist_index_es.F(new jsonrpc_http_connection_dist_index_es.A(i,index_es_h("disableProviderPing")))}}var index_es_Ne=Object.defineProperty,universal_provider_dist_index_es_E=(s,t,e)=>((s,t,e)=>t in s?index_es_Ne(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e)(s,"symbol"!=typeof t?t+"":t,e);class dist_index_es_De{constructor(t){universal_provider_dist_index_es_E(this,"name","algorand"),universal_provider_dist_index_es_E(this,"client"),universal_provider_dist_index_es_E(this,"httpProviders"),universal_provider_dist_index_es_E(this,"events"),universal_provider_dist_index_es_E(this,"namespace"),universal_provider_dist_index_es_E(this,"chainId"),this.namespace=t.namespace,this.events=index_es_h("events"),this.client=index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){if(!this.httpProviders[t]){const i=e||index_es_d(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,i)}this.chainId=t,this.events.emit(index_es_u_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var i;t[e]=this.createHttpProvider(e,null==(i=this.namespace.rpcMap)?void 0:i[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProvider(t,e){const i=e||index_es_d(t,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new jsonrpc_provider_dist_index_es.F(new jsonrpc_http_connection_dist_index_es.A(i,index_es_h("disableProviderPing")))}}var dist_index_es_qe=Object.defineProperty,index_es_N=(s,t,e)=>((s,t,e)=>t in s?dist_index_es_qe(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e)(s,"symbol"!=typeof t?t+"":t,e);class index_es_Re{constructor(t){index_es_N(this,"name","cip34"),index_es_N(this,"client"),index_es_N(this,"httpProviders"),index_es_N(this,"events"),index_es_N(this,"namespace"),index_es_N(this,"chainId"),this.namespace=t.namespace,this.events=index_es_h("events"),this.client=index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(index_es_u_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{const i=this.getCardanoRPCUrl(e),n=dist_index_es_b(e);t[n]=this.createHttpProvider(n,i)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}getCardanoRPCUrl(t){const e=this.namespace.rpcMap;if(e)return e[t]}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProvider(t,e){const i=e||this.getCardanoRPCUrl(t);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);return new jsonrpc_provider_dist_index_es.F(new jsonrpc_http_connection_dist_index_es.A(i,index_es_h("disableProviderPing")))}}var universal_provider_dist_index_es_e=Object.defineProperty,dist_index_es_S=(s,t,e)=>((s,t,e)=>t in s?universal_provider_dist_index_es_e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e)(s,"symbol"!=typeof t?t+"":t,e);class dist_index_es_Fe{constructor(t){dist_index_es_S(this,"name","elrond"),dist_index_es_S(this,"client"),dist_index_es_S(this,"httpProviders"),dist_index_es_S(this,"events"),dist_index_es_S(this,"namespace"),dist_index_es_S(this,"chainId"),this.namespace=t.namespace,this.events=index_es_h("events"),this.client=index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(index_es_u_DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var i;const n=dist_index_es_b(e);t[n]=this.createHttpProvider(n,null==(i=this.namespace.rpcMap)?void 0:i[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProvider(t,e){const i=e||index_es_d(t,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);return new jsonrpc_provider_dist_index_es.F(new jsonrpc_http_connection_dist_index_es.A(i,index_es_h("disableProviderPing")))}}var universal_provider_dist_index_es_Le=Object.defineProperty,D=(s,t,e)=>((s,t,e)=>t in s?universal_provider_dist_index_es_Le(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e)(s,"symbol"!=typeof t?t+"":t,e);class index_es_xe{constructor(t){D(this,"name","multiversx"),D(this,"client"),D(this,"httpProviders"),D(this,"events"),D(this,"namespace"),D(this,"chainId"),this.namespace=t.namespace,this.events=index_es_h("events"),this.client=index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(index_es_u_DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var i;const n=dist_index_es_b(e);t[n]=this.createHttpProvider(n,null==(i=this.namespace.rpcMap)?void 0:i[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProvider(t,e){const i=e||index_es_d(t,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);return new jsonrpc_provider_dist_index_es.F(new jsonrpc_http_connection_dist_index_es.A(i,index_es_h("disableProviderPing")))}}var index_es_Be=Object.defineProperty,index_es_q=(s,t,e)=>((s,t,e)=>t in s?index_es_Be(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e)(s,"symbol"!=typeof t?t+"":t,e);class dist_index_es_Je{constructor(t){index_es_q(this,"name","near"),index_es_q(this,"client"),index_es_q(this,"httpProviders"),index_es_q(this,"events"),index_es_q(this,"namespace"),index_es_q(this,"chainId"),this.namespace=t.namespace,this.events=index_es_h("events"),this.client=index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){if(this.chainId=t,!this.httpProviders[t]){const i=e||index_es_d(`${this.name}:${t}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,i)}this.events.emit(index_es_u_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t&&t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{var i;t[e]=this.createHttpProvider(e,null==(i=this.namespace.rpcMap)?void 0:i[e])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProvider(t,e){const i=e||index_es_d(t,this.namespace);return typeof i>"u"?void 0:new jsonrpc_provider_dist_index_es.F(new jsonrpc_http_connection_dist_index_es.A(i,index_es_h("disableProviderPing")))}}var dist_index_es_ze=Object.defineProperty,index_es_j=(s,t,e)=>((s,t,e)=>t in s?dist_index_es_ze(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e)(s,"symbol"!=typeof t?t+"":t,e);class dist_index_es_We{constructor(t){index_es_j(this,"name","tezos"),index_es_j(this,"client"),index_es_j(this,"httpProviders"),index_es_j(this,"events"),index_es_j(this,"namespace"),index_es_j(this,"chainId"),this.namespace=t.namespace,this.events=index_es_h("events"),this.client=index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,e){if(this.chainId=t,!this.httpProviders[t]){const i=e||index_es_d(`${this.name}:${t}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,i)}this.events.emit(index_es_u_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t&&t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(e=>{t[e]=this.createHttpProvider(e)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProvider(t,e){const i=e||index_es_d(t,this.namespace);return typeof i>"u"?void 0:new jsonrpc_provider_dist_index_es.F(new jsonrpc_http_connection_dist_index_es.A(i))}}var universal_provider_dist_index_es_Ke=Object.defineProperty,index_es_R=(s,t,e)=>((s,t,e)=>t in s?universal_provider_dist_index_es_Ke(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e)(s,"symbol"!=typeof t?t+"":t,e);class dist_index_es_Xe{constructor(t){index_es_R(this,"name","generic"),index_es_R(this,"client"),index_es_R(this,"httpProviders"),index_es_R(this,"events"),index_es_R(this,"namespace"),index_es_R(this,"chainId"),this.namespace=t.namespace,this.events=index_es_h("events"),this.client=index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(t.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(t.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(t.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(t.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider(t.chainId).request(t.request)}setDefaultChain(t,e){this.httpProviders[t]||this.setHttpProvider(t,e),this.chainId=t,this.events.emit(index_es_u_DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){var t,e;const i={};return null==(e=null==(t=this.namespace)?void 0:t.accounts)||e.forEach(n=>{const a=Ne(n);i[`${a.namespace}:${a.reference}`]=this.createHttpProvider(n)}),i}getHttpProvider(t){const e=this.httpProviders[t];if(typeof e>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return e}setHttpProvider(t,e){const i=this.createHttpProvider(t,e);i&&(this.httpProviders[t]=i)}createHttpProvider(t,e){const i=e||index_es_d(t,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${t}`);return new jsonrpc_provider_dist_index_es.F(new jsonrpc_http_connection_dist_index_es.A(i,index_es_h("disableProviderPing")))}}var dist_index_es_Ye=Object.defineProperty,dist_index_es_Qe=Object.defineProperties,dist_index_es_Ze=Object.getOwnPropertyDescriptors,dist_index_es_It=Object.getOwnPropertySymbols,dist_index_es_Te=Object.prototype.hasOwnProperty,index_es_ts=Object.prototype.propertyIsEnumerable,dist_index_es_Y=(s,t,e)=>t in s?dist_index_es_Ye(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,index_es_x=(s,t)=>{for(var e in t||(t={}))dist_index_es_Te.call(t,e)&&dist_index_es_Y(s,e,t[e]);if(dist_index_es_It)for(var e of dist_index_es_It(t))index_es_ts.call(t,e)&&dist_index_es_Y(s,e,t[e]);return s},Q=(s,t)=>dist_index_es_Qe(s,dist_index_es_Ze(t)),l=(s,t,e)=>dist_index_es_Y(s,"symbol"!=typeof t?t+"":t,e);class index_es_B{constructor(t){l(this,"client"),l(this,"namespaces"),l(this,"optionalNamespaces"),l(this,"sessionProperties"),l(this,"scopedProperties"),l(this,"events",new(events_default())),l(this,"rpcProviders",{}),l(this,"session"),l(this,"providerOpts"),l(this,"logger"),l(this,"uri"),l(this,"disableProviderPing",!1),this.providerOpts=t,this.logger=typeof t?.logger<"u"&&"string"!=typeof t?.logger?t.logger:(0,logger_dist_index_es.h6)((0,logger_dist_index_es.iP)({level:t?.logger||"error"})),this.disableProviderPing=t?.disableProviderPing||!1}static async init(t){const e=new index_es_B(t);return await e.initialize(),e}async request(t,e,i){const[n,a]=this.validateChain(e);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:index_es_x({},t),chainId:`${n}:${a}`,topic:this.session.topic,expiry:i})}sendAsync(t,e,i,n){const a=(new Date).getTime();this.request(t,i,n).then(r=>e(null,(0,jsonrpc_utils_dist_esm.formatJsonRpcResult)(a,r))).catch(r=>e(r,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(t=this.session)?void 0:t.topic,reason:Nt("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}async authenticate(t,e){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(t),await this.cleanupPendingPairings();const{uri:i,response:n}=await this.client.authenticate(t,e);i&&(this.uri=i,this.events.emit("display_uri",i));const a=await n();if(this.session=a.session,this.session){const r=dist_index_es_gt(this.session.namespaces);this.namespaces=dist_index_es_M(this.namespaces,r),await this.persist("namespaces",this.namespaces),this.onConnect()}return a}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}removeListener(t,e){this.events.removeListener(t,e)}off(t,e){this.events.off(t,e)}get isWalletConnect(){return!0}async pair(t){const{uri:e,approval:i}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});e&&(this.uri=e,this.events.emit("display_uri",e));const n=await i();this.session=n;const a=dist_index_es_gt(n.namespaces);return this.namespaces=dist_index_es_M(this.namespaces,a),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(t,e){try{if(!this.session)return;const[i,n]=this.validateChain(t),a=this.getProvider(i);"generic"===a.name?a.setDefaultChain(`${i}:${n}`,e):a.setDefaultChain(n,e)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const e=this.client.pairing.getAll();if(se(e)){for(const i of e)t.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${e.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var t,e;if(this.client=this.providerOpts.client||await dist_index_es_Ee.init({core:this.providerOpts.core,logger:this.providerOpts.logger||"error",relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error("Failed to get session",i),new Error(`The provided session: ${null==(e=null==(t=this.providerOpts)?void 0:t.session)?void 0:e.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(e=>yo(e)))];universal_provider_dist_index_es_V("client",this.client),universal_provider_dist_index_es_V("events",this.events),universal_provider_dist_index_es_V("disableProviderPing",this.disableProviderPing),t.forEach(e=>{if(!this.session)return;const i=function dist_index_es_le(s,t){const e=Object.keys(t.namespaces).filter(n=>n.includes(s));if(!e.length)return[];const i=[];return e.forEach(n=>{const a=t.namespaces[n].accounts;i.push(...a)}),i}(e,this.session),n=dist_index_es_ft(i),a=dist_index_es_M(this.namespaces,this.optionalNamespaces),r=Q(index_es_x({},a[e]),{accounts:i,chains:n});switch(e){case"eip155":this.rpcProviders[e]=new index_es_Ie({namespace:r});break;case"algorand":this.rpcProviders[e]=new dist_index_es_De({namespace:r});break;case"solana":this.rpcProviders[e]=new index_es_Ae({namespace:r});break;case"cosmos":this.rpcProviders[e]=new universal_provider_dist_index_es_Ee({namespace:r});break;case"polkadot":this.rpcProviders[e]=new index_es_ve({namespace:r});break;case"cip34":this.rpcProviders[e]=new index_es_Re({namespace:r});break;case"elrond":this.rpcProviders[e]=new dist_index_es_Fe({namespace:r});break;case"multiversx":this.rpcProviders[e]=new index_es_xe({namespace:r});break;case"near":this.rpcProviders[e]=new dist_index_es_Je({namespace:r});break;case"tezos":this.rpcProviders[e]=new dist_index_es_We({namespace:r});break;default:this.rpcProviders.generic?this.rpcProviders.generic.updateNamespace(r):this.rpcProviders.generic=new dist_index_es_Xe({namespace:r})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{var e;const{topic:i}=t;i===(null==(e=this.session)?void 0:e.topic)&&this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{var e;const{params:i,topic:n}=t;if(n!==(null==(e=this.session)?void 0:e.topic))return;const{event:a}=i;if("accountsChanged"===a.name){const r=a.data;r&&se(r)&&this.events.emit("accountsChanged",r.map(vt))}else if("chainChanged"===a.name){const r=i.chainId,c=i.event.data,o=yo(r),m=dist_index_es_K(r)!==dist_index_es_K(c)?`${o}:${dist_index_es_K(c)}`:r;this.onChainChanged(m)}else this.events.emit(a.name,a.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:e})=>{var i,n;if(t!==(null==(i=this.session)?void 0:i.topic))return;const{namespaces:a}=e,r=null==(n=this.client)?void 0:n.session.get(t);this.session=Q(index_es_x({},r),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:e})}),this.client.on("session_delete",async t=>{var e;t.topic===(null==(e=this.session)?void 0:e.topic)&&(await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",Q(index_es_x({},Nt("USER_DISCONNECTED")),{data:t.topic})))}),this.on(index_es_u_DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){return this.rpcProviders[t]||this.rpcProviders.generic}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var e;this.getProvider(t).updateNamespace(null==(e=this.session)?void 0:e.namespaces[t])})}setNamespaces(t){const{namespaces:e={},optionalNamespaces:i={},sessionProperties:n,scopedProperties:a}=t;this.optionalNamespaces=dist_index_es_M(e,i),this.sessionProperties=n,this.scopedProperties=a}validateChain(t){const[e,i]=t?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[e,i];if(e&&!Object.keys(this.namespaces||{}).map(r=>yo(r)).includes(e))throw new Error(`Namespace '${e}' is not configured. Please call connect() first with namespace config.`);if(e&&i)return[e,i];const n=yo(Object.keys(this.namespaces)[0]);return[n,this.rpcProviders[n].getDefaultChain()]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}async onChainChanged(t,e=!1){if(!this.namespaces)return;const[i,n]=this.validateChain(t);if(!n)return;this.updateNamespaceChain(i,n),this.events.emit("chainChanged",n);const a=this.getProvider(i).getDefaultChain();e||this.getProvider(i).setDefaultChain(n),this.emitAccountsChangedOnChainChange({namespace:i,previousChainId:a,newChainId:t}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:t,previousChainId:e,newChainId:i}){var n,a;try{if(e===i)return;const r=null==(a=null==(n=this.session)?void 0:n.namespaces[t])?void 0:a.accounts;if(!r)return;const c=r.filter(o=>o.includes(`${i}:`)).map(vt);if(!se(c))return;this.events.emit("accountsChanged",c)}catch(r){this.logger.warn("Failed to emit accountsChanged on chain change",r)}}updateNamespaceChain(t,e){if(!this.namespaces)return;const i=this.namespaces[t]?t:`${t}:${e}`,n={chains:[],methods:[],events:[],defaultChain:e};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=e):this.namespaces[i]=n}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(t,e){var i;const n=(null==(i=this.session)?void 0:i.topic)||"";await this.client.core.storage.setItem(`${U}/${t}${n}`,e)}async getFromStore(t){var e;const i=(null==(e=this.session)?void 0:e.topic)||"";return await this.client.core.storage.getItem(`${U}/${t}${i}`)}async deleteFromStore(t){var e;const i=(null==(e=this.session)?void 0:e.topic)||"";await this.client.core.storage.removeItem(`${U}/${t}${i}`)}async cleanupStorage(){var t;try{if((null==(t=this.client)?void 0:t.session.length)>0)return;const e=await this.client.core.storage.getKeys();for(const i of e)i.startsWith(U)&&await this.client.core.storage.removeItem(i)}catch(e){this.logger.warn("Failed to cleanup storage",e)}}}const dist_index_es_es=index_es_B;var ethereum_provider_dist_index_es_console=__webpack_require__("./node_modules/console-browserify/index.js");const dist_index_es_f=["eth_sendTransaction","personal_sign"],dist_index_es_A=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],ethereum_provider_dist_index_es_C=["chainChanged","accountsChanged"],dist_index_es_P=["chainChanged","accountsChanged","message","disconnect","connect"];var index_es_z=Object.defineProperty,dist_index_es_L=Object.defineProperties,ethereum_provider_dist_index_es_K=Object.getOwnPropertyDescriptors,ethereum_provider_dist_index_es_M=Object.getOwnPropertySymbols,dist_index_es_Q=Object.prototype.hasOwnProperty,ethereum_provider_dist_index_es_V=Object.prototype.propertyIsEnumerable,_=(s,t,e)=>t in s?index_es_z(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,ethereum_provider_dist_index_es_v=(s,t)=>{for(var e in t||(t={}))dist_index_es_Q.call(t,e)&&_(s,e,t[e]);if(ethereum_provider_dist_index_es_M)for(var e of ethereum_provider_dist_index_es_M(t))ethereum_provider_dist_index_es_V.call(t,e)&&_(s,e,t[e]);return s},dist_index_es_w=(s,t)=>dist_index_es_L(s,ethereum_provider_dist_index_es_K(t)),dist_index_es_p=(s,t,e)=>_(s,"symbol"!=typeof t?t+"":t,e);function dist_index_es_I(s){return Number(s[0].split(":")[1])}function ethereum_provider_dist_index_es_E(s){return`0x${s.toString(16)}`}class ethereum_provider_dist_index_es_b{constructor(){dist_index_es_p(this,"events",new events.EventEmitter),dist_index_es_p(this,"namespace","eip155"),dist_index_es_p(this,"accounts",[]),dist_index_es_p(this,"signer"),dist_index_es_p(this,"chainId",1),dist_index_es_p(this,"modal"),dist_index_es_p(this,"rpc"),dist_index_es_p(this,"STORAGE_KEY","wc@2:ethereum_provider:"),dist_index_es_p(this,"on",(t,e)=>(this.events.on(t,e),this)),dist_index_es_p(this,"once",(t,e)=>(this.events.once(t,e),this)),dist_index_es_p(this,"removeListener",(t,e)=>(this.events.removeListener(t,e),this)),dist_index_es_p(this,"off",(t,e)=>(this.events.off(t,e),this)),dist_index_es_p(this,"parseAccount",t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t),this.signer={},this.rpc={}}static async init(t){const e=new ethereum_provider_dist_index_es_b;return await e.initialize(t),e}async request(t,e){return await this.signer.request(t,this.formatChainId(this.chainId),e)}sendAsync(t,e,n){this.signer.sendAsync(t,e,this.formatChainId(this.chainId),n)}get connected(){return!!this.signer.client&&this.signer.client.core.relayer.connected}get connecting(){return!!this.signer.client&&this.signer.client.core.relayer.connecting}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){var e;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:n,optional:i}=function dist_index_es_G(s){const{chains:t,optionalChains:e,methods:n,optionalMethods:i,events:a,optionalEvents:o,rpcMap:u}=s;if(!se(t))throw new Error("Invalid chains");const c={chains:t,methods:n||dist_index_es_f,events:a||ethereum_provider_dist_index_es_C,rpcMap:ethereum_provider_dist_index_es_v({},t.length?{[dist_index_es_I(t)]:u[dist_index_es_I(t)]}:{})},l=a?.filter(d=>!ethereum_provider_dist_index_es_C.includes(d)),r=n?.filter(d=>!dist_index_es_f.includes(d));if(!(e||o||i||null!=l&&l.length||null!=r&&r.length))return{required:t.length?c:void 0};const h={chains:[...new Set(l?.length&&r?.length||!e?c.chains.concat(e||[]):e)],methods:[...new Set(c.methods.concat(null!=i&&i.length?i:dist_index_es_A))],events:[...new Set(c.events.concat(null!=o&&o.length?o:dist_index_es_P))],rpcMap:u};return{required:t.length?c:void 0,optional:e.length?h:void 0}}(this.rpc);try{const a=await new Promise(async(u,c)=>{var l,r;this.rpc.showQrModal&&(null==(l=this.modal)||l.open(),null==(r=this.modal)||r.subscribeState(h=>{!h.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const m=null!=t&&t.scopedProperties?{[this.namespace]:t.scopedProperties}:void 0;await this.signer.connect(dist_index_es_w(ethereum_provider_dist_index_es_v({namespaces:ethereum_provider_dist_index_es_v({},n&&{[this.namespace]:n})},i&&{optionalNamespaces:{[this.namespace]:i}}),{pairingTopic:t?.pairingTopic,scopedProperties:m})).then(h=>{u(h)}).catch(h=>{var d;null==(d=this.modal)||d.showErrorMessage("Unable to connect"),c(new Error(h.message))})});if(!a)return;const o=Ko(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:ethereum_provider_dist_index_es_E(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{null==(e=this.modal)||e.close()}}async authenticate(t,e){var n;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:t?.chains});try{const i=await new Promise(async(o,u)=>{var c,l;this.rpc.showQrModal&&(null==(c=this.modal)||c.open(),null==(l=this.modal)||l.subscribeState(r=>{!r.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),u(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(dist_index_es_w(ethereum_provider_dist_index_es_v({},t),{chains:this.rpc.chains}),e).then(r=>{o(r)}).catch(r=>{var m;null==(m=this.modal)||m.showErrorMessage("Unable to connect"),u(new Error(r.message))})}),a=i.session;if(a){const o=Ko(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:ethereum_provider_dist_index_es_E(this.chainId)})}return i}catch(i){throw this.signer.logger.error(i),i}finally{null==(n=this.modal)||n.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:e}=t,{event:n}=e;"accountsChanged"===n.name?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):"chainChanged"===n.name?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",t)}),this.signer.on("accountsChanged",t=>{this.accounts=this.parseAccounts(t),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",t=>{const e=parseInt(t);this.chainId=e,this.events.emit("chainChanged",ethereum_provider_dist_index_es_E(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",dist_index_es_w(ethereum_provider_dist_index_es_v({},Nt("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return"string"==typeof t&&t.startsWith(`${this.namespace}:`)}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const e=t.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));e.length&&(this.chainId=e[0],this.events.emit("chainChanged",ethereum_provider_dist_index_es_E(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const e=this.parseChainId(t);this.chainId=e,this.switchEthereumChain(e)}}parseAccountId(t){const[e,n,i]=t.split(":");return{chainId:`${e}:${n}`,address:i}}setAccounts(t){this.accounts=t.filter(e=>this.parseChainId(this.parseAccountId(e).chainId)===this.chainId).map(e=>this.parseAccountId(e).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var e,n;const i=null!=(e=t?.chains)?e:[],a=null!=(n=t?.optionalChains)?n:[],o=i.concat(a);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const u=i.length?t?.methods||dist_index_es_f:[],c=i.length?t?.events||ethereum_provider_dist_index_es_C:[],l=t?.optionalMethods||[],r=t?.optionalEvents||[],m=t?.rpcMap||this.buildRpcMap(o,t.projectId),h=t?.qrModalOptions||void 0;return{chains:i?.map(d=>this.formatChainId(d)),optionalChains:a.map(d=>this.formatChainId(d)),methods:u,events:c,optionalMethods:l,optionalEvents:r,rpcMap:m,showQrModal:!(null==t||!t.showQrModal),qrModalOptions:h,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,e){const n={};return t.forEach(i=>{n[i]=this.getRpcUrl(i,e)}),n}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?dist_index_es_I(this.rpc.chains):dist_index_es_I(this.rpc.optionalChains),this.signer=await dist_index_es_es.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storage:t.storage,storageOptions:t.storageOptions,customStoragePrefix:t.customStoragePrefix,telemetryEnabled:t.telemetryEnabled,logger:t.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let e;try{const n=await(async()=>{const{createAppKit:s}=await __webpack_require__.e(8400).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@reown/appkit/dist/esm/exports/core.js"));return s})(),{convertWCMToAppKitOptions:i}=await Promise.resolve().then(function(){return dist_index_es_nt}),a=i(dist_index_es_w(ethereum_provider_dist_index_es_v({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!a.networks.length)throw new Error("No networks found for WalletConnect·");e=n(dist_index_es_w(ethereum_provider_dist_index_es_v({},a),{universalProvider:this.signer,manualWCControl:!0}))}catch(n){throw ethereum_provider_dist_index_es_console.warn(n),new Error("To use QR modal, please install @reown/appkit package")}if(e)try{this.modal=e}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:e,optionalChains:n,rpcMap:i}=t;e&&se(e)&&(this.rpc.chains=e.map(a=>this.formatChainId(a)),e.forEach(a=>{this.rpc.rpcMap[a]=i?.[a]||this.getRpcUrl(a)})),n&&se(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n?.map(a=>this.formatChainId(a)),n.forEach(a=>{this.rpc.rpcMap[a]=i?.[a]||this.getRpcUrl(a)}))}getRpcUrl(t,e){var n;return(null==(n=this.rpc.rpcMap)?void 0:n[t])||`https://rpc.walletconnect.org/v1/?chainId=eip155:${t}&projectId=${e||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),e=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:e?.accounts),this.setAccounts(e?.accounts)}catch(t){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(t),await this.disconnect().catch(e=>this.signer.logger.warn(e))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return"string"==typeof t||t instanceof String?[this.parseAccount(t)]:t.map(e=>this.parseAccount(e))}}const ethereum_provider_dist_index_es_Y=ethereum_provider_dist_index_es_b;var ethereum_provider_dist_index_es_H=Object.defineProperty,dist_index_es_B=Object.defineProperties,ethereum_provider_dist_index_es_F=Object.getOwnPropertyDescriptors,ethereum_provider_dist_index_es_S=Object.getOwnPropertySymbols,dist_index_es_X=Object.prototype.hasOwnProperty,dist_index_es_J=Object.prototype.propertyIsEnumerable,index_es_T=(s,t,e)=>t in s?ethereum_provider_dist_index_es_H(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,dist_index_es_R=(s,t)=>{for(var e in t||(t={}))dist_index_es_X.call(t,e)&&index_es_T(s,e,t[e]);if(ethereum_provider_dist_index_es_S)for(var e of ethereum_provider_dist_index_es_S(t))dist_index_es_J.call(t,e)&&index_es_T(s,e,t[e]);return s},Z=(s,t)=>dist_index_es_B(s,ethereum_provider_dist_index_es_F(t));function index_es_tt(s){if(s)return{"--w3m-font-family":s["--wcm-font-family"],"--w3m-accent":s["--wcm-accent-color"],"--w3m-color-mix":s["--wcm-background-color"],"--w3m-z-index":s["--wcm-z-index"]?Number(s["--wcm-z-index"]):void 0,"--w3m-qr-color":s["--wcm-accent-color"],"--w3m-font-size-master":s["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":s["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const dist_index_es_et=s=>{const[t,e]=s.split(":");return dist_index_es_W({id:e,caipNetworkId:s,chainNamespace:t,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function dist_index_es_W(s){return dist_index_es_R({formatters:void 0,fees:void 0,serializers:void 0},s)}var dist_index_es_nt=Object.freeze({__proto__:null,convertWCMToAppKitOptions:function index_es_st(s){var t,e,n,i,a,o,u;const c=null==(t=s.chains)?void 0:t.map(dist_index_es_et).filter(Boolean);if(0===c.length)throw new Error("At least one chain must be specified");const l=c.find(m=>{var h;return m.id===(null==(h=s.defaultChain)?void 0:h.id)}),r={projectId:s.projectId,networks:c,themeMode:s.themeMode,themeVariables:index_es_tt(s.themeVariables),chainImages:s.chainImages,connectorImages:s.walletImages,defaultNetwork:l,metadata:Z(dist_index_es_R({},s.metadata),{name:(null==(e=s.metadata)?void 0:e.name)||"WalletConnect",description:(null==(n=s.metadata)?void 0:n.description)||"Connect to WalletConnect-compatible wallets",url:(null==(i=s.metadata)?void 0:i.url)||"https://walletconnect.org",icons:(null==(a=s.metadata)?void 0:a.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:"NONE"===s.explorerRecommendedWalletIds?[]:Array.isArray(s.explorerRecommendedWalletIds)?s.explorerRecommendedWalletIds:[],excludeWalletIds:"ALL"===s.explorerExcludedWalletIds?[]:Array.isArray(s.explorerExcludedWalletIds)?s.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if(null!=(o=s.mobileWallets)&&o.length||null!=(u=s.desktopWallets)&&u.length){const m=[...(s.mobileWallets||[]).map(g=>({id:g.id,name:g.name,links:g.links})),...(s.desktopWallets||[]).map(g=>({id:g.id,name:g.name,links:{native:g.links.native,universal:g.links.universal}}))],h=[...r.featuredWalletIds||[],...r.excludeWalletIds||[]],d=m.filter(g=>!h.includes(g.id));d.length&&(r.customWallets=d)}return r},defineChain:dist_index_es_W})},"./node_modules/@walletconnect/environment/dist/cjs/crypto.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";function getBrowerCrypto(){return(null===__webpack_require__.g||void 0===__webpack_require__.g?void 0:__webpack_require__.g.crypto)||(null===__webpack_require__.g||void 0===__webpack_require__.g?void 0:__webpack_require__.g.msCrypto)||{}}function getSubtleCrypto(){const browserCrypto=getBrowerCrypto();return browserCrypto.subtle||browserCrypto.webkitSubtle}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isBrowserCryptoAvailable=exports.getSubtleCrypto=exports.getBrowerCrypto=void 0,exports.getBrowerCrypto=getBrowerCrypto,exports.getSubtleCrypto=getSubtleCrypto,exports.isBrowserCryptoAvailable=function isBrowserCryptoAvailable(){return!!getBrowerCrypto()&&!!getSubtleCrypto()}},"./node_modules/@walletconnect/environment/dist/cjs/env.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var process=__webpack_require__("./node_modules/process/browser.js");function isReactNative(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function isNode(){return void 0!==process&&void 0!==process.versions&&void 0!==process.versions.node}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isBrowser=exports.isNode=exports.isReactNative=void 0,exports.isReactNative=isReactNative,exports.isNode=isNode,exports.isBrowser=function isBrowser(){return!isReactNative()&&!isNode()}},"./node_modules/@walletconnect/environment/dist/cjs/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/@walletconnect/environment/node_modules/tslib/tslib.es6.js");tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/environment/dist/cjs/crypto.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/environment/dist/cjs/env.js"),exports)},"./node_modules/@walletconnect/environment/node_modules/tslib/tslib.es6.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{__assign:()=>__assign,__asyncDelegator:()=>__asyncDelegator,__asyncGenerator:()=>__asyncGenerator,__asyncValues:()=>__asyncValues,__await:()=>__await,__awaiter:()=>__awaiter,__classPrivateFieldGet:()=>__classPrivateFieldGet,__classPrivateFieldSet:()=>__classPrivateFieldSet,__createBinding:()=>__createBinding,__decorate:()=>__decorate,__exportStar:()=>__exportStar,__extends:()=>__extends,__generator:()=>__generator,__importDefault:()=>__importDefault,__importStar:()=>__importStar,__makeTemplateObject:()=>__makeTemplateObject,__metadata:()=>__metadata,__param:()=>__param,__read:()=>__read,__rest:()=>__rest,__spread:()=>__spread,__spreadArrays:()=>__spreadArrays,__values:()=>__values});var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},extendStatics(d,b)};function __extends(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return __assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}function __decorate(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r}function __param(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}}function __metadata(metadataKey,metadataValue){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(metadataKey,metadataValue)}function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}function __generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}function __createBinding(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}function __exportStar(m,exports){for(var p in m)"default"===p||exports.hasOwnProperty(p)||(exports[p]=m[p])}function __values(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar}function __spreadArrays(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;var r=Array(s),k=0;for(i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r}function __await(v){return this instanceof __await?(this.v=v,this):new __await(v)}function __asyncGenerator(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,g=generator.apply(thisArg,_arguments||[]),q=[];return i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i;function verb(n){g[n]&&(i[n]=function(v){return new Promise(function(a,b){q.push([n,v,a,b])>1||resume(n,v)})})}function resume(n,v){try{!function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}(g[n](v))}catch(e){settle(q[0][3],e)}}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){f(v),q.shift(),q.length&&resume(q[0][0],q[0][1])}}function __asyncDelegator(o){var i,p;return i={},verb("next"),verb("throw",function(e){throw e}),verb("return"),i[Symbol.iterator]=function(){return this},i;function verb(n,f){i[n]=o[n]?function(v){return(p=!p)?{value:__await(o[n](v)),done:"return"===n}:f?f(v):v}:f}}function __asyncValues(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,m=o[Symbol.asyncIterator];return m?m.call(o):(o=__values(o),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise(function(resolve,reject){(function settle(resolve,reject,d,v){Promise.resolve(v).then(function(v){resolve({value:v,done:d})},reject)})(resolve,reject,(v=o[n](v)).done,v.value)})}}}function __makeTemplateObject(cooked,raw){return Object.defineProperty?Object.defineProperty(cooked,"raw",{value:raw}):cooked.raw=raw,cooked}function __importStar(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result}function __importDefault(mod){return mod&&mod.__esModule?mod:{default:mod}}function __classPrivateFieldGet(receiver,privateMap){if(!privateMap.has(receiver))throw new TypeError("attempted to get private field on non-instance");return privateMap.get(receiver)}function __classPrivateFieldSet(receiver,privateMap,value){if(!privateMap.has(receiver))throw new TypeError("attempted to set private field on non-instance");return privateMap.set(receiver,value),value}},"./node_modules/@walletconnect/events/dist/esm/events.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{H:()=>IEvents});class IEvents{}},"./node_modules/@walletconnect/heartbeat/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{VH:()=>i,li:()=>r});var events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/events/events.js"),_walletconnect_time__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/index.js"),_walletconnect_events__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@walletconnect/events/dist/esm/events.js");class n extends _walletconnect_events__WEBPACK_IMPORTED_MODULE_2__.H{constructor(e){super()}}const s=_walletconnect_time__WEBPACK_IMPORTED_MODULE_1__.FIVE_SECONDS,r={pulse:"heartbeat_pulse"};class i extends n{constructor(e){super(e),this.events=new events__WEBPACK_IMPORTED_MODULE_0__.EventEmitter,this.interval=s,this.interval=e?.interval||s}static async init(e){const t=new i(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),(0,_walletconnect_time__WEBPACK_IMPORTED_MODULE_1__.toMiliseconds)(this.interval))}pulse(){this.events.emit(r.pulse)}}},"./node_modules/@walletconnect/jsonrpc-http-connection/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>f,V:()=>f});var events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/events/events.js"),cross_fetch__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@walletconnect/jsonrpc-http-connection/node_modules/cross-fetch/dist/browser-ponyfill.js"),cross_fetch__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(cross_fetch__WEBPACK_IMPORTED_MODULE_1__),_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@walletconnect/safe-json/dist/esm/index.js"),_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/index.js"),P=Object.defineProperty,w=Object.defineProperties,E=Object.getOwnPropertyDescriptors,c=Object.getOwnPropertySymbols,L=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,l=(r,t,e)=>t in r?P(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,p=(r,t)=>{for(var e in t||(t={}))L.call(t,e)&&l(r,e,t[e]);if(c)for(var e of c(t))O.call(t,e)&&l(r,e,t[e]);return r},v=(r,t)=>w(r,E(t));const d={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"};class f{constructor(t,e=!1){if(this.url=t,this.disableProviderPing=e,this.events=new events__WEBPACK_IMPORTED_MODULE_0__.EventEmitter,this.isAvailable=!1,this.registering=!1,!(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_3__.isHttpUrl)(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=e}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t){this.isAvailable||await this.register();try{const e=(0,_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_2__.h)(t),s=await(await cross_fetch__WEBPACK_IMPORTED_MODULE_1___default()(this.url,v(p({},d),{body:e}))).json();this.onPayload({data:s})}catch(e){this.onError(t.id,e)}}async register(t=this.url){if(!(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_3__.isHttpUrl)(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const e=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=e||this.events.listenerCount("open")>=e)&&this.events.setMaxListeners(e+1),new Promise((s,i)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),i(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return i(new Error("HTTP connection is missing or invalid"));s()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const e=(0,_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_2__.h)({id:1,jsonrpc:"2.0",method:"test",params:[]});await cross_fetch__WEBPACK_IMPORTED_MODULE_1___default()(t,v(p({},d),{body:e}))}this.onOpen()}catch(e){const s=this.parseError(e);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const e="string"==typeof t.data?(0,_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_2__.j)(t.data):t.data;this.events.emit("payload",e)}onError(t,e){const s=this.parseError(e),i=s.message||s.toString(),n=(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_3__.formatJsonRpcError)(t,i);this.events.emit("payload",n)}parseError(t,e=this.url){return(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_3__.parseConnectionError)(t,e,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}}},"./node_modules/@walletconnect/jsonrpc-http-connection/node_modules/cross-fetch/dist/browser-ponyfill.js":(module,exports,__webpack_require__)=>{var console=__webpack_require__("./node_modules/console-browserify/index.js"),__global__="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==__webpack_require__.g&&__webpack_require__.g,__globalThis__=function(){function F(){this.fetch=!1,this.DOMException=__global__.DOMException}return F.prototype=__global__,new F}();!function(globalThis){!function(exports){var g=void 0!==globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==__webpack_require__.g&&__webpack_require__.g||{},support_searchParams="URLSearchParams"in g,support_iterable="Symbol"in g&&"iterator"in Symbol,support_blob="FileReader"in g&&"Blob"in g&&function(){try{return new Blob,!0}catch(e){return!1}}(),support_formData="FormData"in g,support_arrayBuffer="ArrayBuffer"in g;if(support_arrayBuffer)var viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&viewClasses.indexOf(Object.prototype.toString.call(obj))>-1};function normalizeName(name){if("string"!=typeof name&&(name=String(name)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(name)||""===name)throw new TypeError('Invalid character in header field name: "'+name+'"');return name.toLowerCase()}function normalizeValue(value){return"string"!=typeof value&&(value=String(value)),value}function iteratorFor(items){var iterator={next:function(){var value=items.shift();return{done:void 0===value,value}}};return support_iterable&&(iterator[Symbol.iterator]=function(){return iterator}),iterator}function Headers(headers){this.map={},headers instanceof Headers?headers.forEach(function(value,name){this.append(name,value)},this):Array.isArray(headers)?headers.forEach(function(header){if(2!=header.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+header.length);this.append(header[0],header[1])},this):headers&&Object.getOwnPropertyNames(headers).forEach(function(name){this.append(name,headers[name])},this)}function consumed(body){if(!body._noBody)return body.bodyUsed?Promise.reject(new TypeError("Already read")):void(body.bodyUsed=!0)}function fileReaderReady(reader){return new Promise(function(resolve,reject){reader.onload=function(){resolve(reader.result)},reader.onerror=function(){reject(reader.error)}})}function readBlobAsArrayBuffer(blob){var reader=new FileReader,promise=fileReaderReady(reader);return reader.readAsArrayBuffer(blob),promise}function bufferClone(buf){if(buf.slice)return buf.slice(0);var view=new Uint8Array(buf.byteLength);return view.set(new Uint8Array(buf)),view.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(body){this.bodyUsed=this.bodyUsed,this._bodyInit=body,body?"string"==typeof body?this._bodyText=body:support_blob&&Blob.prototype.isPrototypeOf(body)?this._bodyBlob=body:support_formData&&FormData.prototype.isPrototypeOf(body)?this._bodyFormData=body:support_searchParams&&URLSearchParams.prototype.isPrototypeOf(body)?this._bodyText=body.toString():support_arrayBuffer&&support_blob&&function isDataView(obj){return obj&&DataView.prototype.isPrototypeOf(obj)}(body)?(this._bodyArrayBuffer=bufferClone(body.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):support_arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(body)||isArrayBufferView(body))?this._bodyArrayBuffer=bufferClone(body):this._bodyText=body=Object.prototype.toString.call(body):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof body?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):support_searchParams&&URLSearchParams.prototype.isPrototypeOf(body)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},support_blob&&(this.blob=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var isConsumed=consumed(this);return isConsumed||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(support_blob)return this.blob().then(readBlobAsArrayBuffer);throw new Error("could not read as ArrayBuffer")},this.text=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return function readBlobAsText(blob){var reader=new FileReader,promise=fileReaderReady(reader),match=/charset=([A-Za-z0-9_-]+)/.exec(blob.type),encoding=match?match[1]:"utf-8";return reader.readAsText(blob,encoding),promise}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function readArrayBufferAsText(buf){for(var view=new Uint8Array(buf),chars=new Array(view.length),i=0;i<view.length;i++)chars[i]=String.fromCharCode(view[i]);return chars.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},support_formData&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}Headers.prototype.append=function(name,value){name=normalizeName(name),value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+", "+value:value},Headers.prototype.delete=function(name){delete this.map[normalizeName(name)]},Headers.prototype.get=function(name){return name=normalizeName(name),this.has(name)?this.map[name]:null},Headers.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name))},Headers.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value)},Headers.prototype.forEach=function(callback,thisArg){for(var name in this.map)this.map.hasOwnProperty(name)&&callback.call(thisArg,this.map[name],name,this)},Headers.prototype.keys=function(){var items=[];return this.forEach(function(value,name){items.push(name)}),iteratorFor(items)},Headers.prototype.values=function(){var items=[];return this.forEach(function(value){items.push(value)}),iteratorFor(items)},Headers.prototype.entries=function(){var items=[];return this.forEach(function(value,name){items.push([name,value])}),iteratorFor(items)},support_iterable&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);var methods=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function Request(input,options){if(!(this instanceof Request))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var body=(options=options||{}).body;if(input instanceof Request){if(input.bodyUsed)throw new TypeError("Already read");this.url=input.url,this.credentials=input.credentials,options.headers||(this.headers=new Headers(input.headers)),this.method=input.method,this.mode=input.mode,this.signal=input.signal,body||null==input._bodyInit||(body=input._bodyInit,input.bodyUsed=!0)}else this.url=String(input);if(this.credentials=options.credentials||this.credentials||"same-origin",!options.headers&&this.headers||(this.headers=new Headers(options.headers)),this.method=function normalizeMethod(method){var upcased=method.toUpperCase();return methods.indexOf(upcased)>-1?upcased:method}(options.method||this.method||"GET"),this.mode=options.mode||this.mode||null,this.signal=options.signal||this.signal||function(){if("AbortController"in g)return(new AbortController).signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&body)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(body),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==options.cache&&"no-cache"!==options.cache)){var reParamSearch=/([?&])_=[^&]*/;if(reParamSearch.test(this.url))this.url=this.url.replace(reParamSearch,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function decode(body){var form=new FormData;return body.trim().split("&").forEach(function(bytes){if(bytes){var split=bytes.split("="),name=split.shift().replace(/\+/g," "),value=split.join("=").replace(/\+/g," ");form.append(decodeURIComponent(name),decodeURIComponent(value))}}),form}function Response(bodyInit,options){if(!(this instanceof Response))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(options||(options={}),this.type="default",this.status=void 0===options.status?200:options.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===options.statusText?"":""+options.statusText,this.headers=new Headers(options.headers),this.url=options.url||"",this._initBody(bodyInit)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})},Body.call(Request.prototype),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})},Response.error=function(){var response=new Response(null,{status:200,statusText:""});return response.ok=!1,response.status=0,response.type="error",response};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(-1===redirectStatuses.indexOf(status))throw new RangeError("Invalid status code");return new Response(null,{status,headers:{location:url}})},exports.DOMException=g.DOMException;try{new exports.DOMException}catch(err){exports.DOMException=function(message,name){this.message=message,this.name=name;var error=Error(message);this.stack=error.stack},exports.DOMException.prototype=Object.create(Error.prototype),exports.DOMException.prototype.constructor=exports.DOMException}function fetch(input,init){return new Promise(function(resolve,reject){var request=new Request(input,init);if(request.signal&&request.signal.aborted)return reject(new exports.DOMException("Aborted","AbortError"));var xhr=new XMLHttpRequest;function abortXhr(){xhr.abort()}if(xhr.onload=function(){var rawHeaders,headers,options={statusText:xhr.statusText,headers:(rawHeaders=xhr.getAllResponseHeaders()||"",headers=new Headers,rawHeaders.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(header){return 0===header.indexOf("\n")?header.substr(1,header.length):header}).forEach(function(line){var parts=line.split(":"),key=parts.shift().trim();if(key){var value=parts.join(":").trim();try{headers.append(key,value)}catch(error){console.warn("Response "+error.message)}}}),headers)};0===request.url.indexOf("file://")&&(xhr.status<200||xhr.status>599)?options.status=200:options.status=xhr.status,options.url="responseURL"in xhr?xhr.responseURL:options.headers.get("X-Request-URL");var body="response"in xhr?xhr.response:xhr.responseText;setTimeout(function(){resolve(new Response(body,options))},0)},xhr.onerror=function(){setTimeout(function(){reject(new TypeError("Network request failed"))},0)},xhr.ontimeout=function(){setTimeout(function(){reject(new TypeError("Network request timed out"))},0)},xhr.onabort=function(){setTimeout(function(){reject(new exports.DOMException("Aborted","AbortError"))},0)},xhr.open(request.method,function fixUrl(url){try{return""===url&&g.location.href?g.location.href:url}catch(e){return url}}(request.url),!0),"include"===request.credentials?xhr.withCredentials=!0:"omit"===request.credentials&&(xhr.withCredentials=!1),"responseType"in xhr&&(support_blob?xhr.responseType="blob":support_arrayBuffer&&(xhr.responseType="arraybuffer")),init&&"object"==typeof init.headers&&!(init.headers instanceof Headers||g.Headers&&init.headers instanceof g.Headers)){var names=[];Object.getOwnPropertyNames(init.headers).forEach(function(name){names.push(normalizeName(name)),xhr.setRequestHeader(name,normalizeValue(init.headers[name]))}),request.headers.forEach(function(value,name){-1===names.indexOf(name)&&xhr.setRequestHeader(name,value)})}else request.headers.forEach(function(value,name){xhr.setRequestHeader(name,value)});request.signal&&(request.signal.addEventListener("abort",abortXhr),xhr.onreadystatechange=function(){4===xhr.readyState&&request.signal.removeEventListener("abort",abortXhr)}),xhr.send(void 0===request._bodyInit?null:request._bodyInit)})}fetch.polyfill=!0,g.fetch||(g.fetch=fetch,g.Headers=Headers,g.Request=Request,g.Response=Response),exports.Headers=Headers,exports.Request=Request,exports.Response=Response,exports.fetch=fetch,Object.defineProperty(exports,"__esModule",{value:!0})}({})}(__globalThis__),__globalThis__.fetch.ponyfill=!0,delete __globalThis__.fetch.polyfill;var ctx=__global__.fetch?__global__:__globalThis__;(exports=ctx.fetch).default=ctx.fetch,exports.fetch=ctx.fetch,exports.Headers=ctx.Headers,exports.Request=ctx.Request,exports.Response=ctx.Response,module.exports=exports},"./node_modules/@walletconnect/jsonrpc-provider/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{F:()=>o});var events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/events/events.js"),_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/index.js");class o extends _walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_1__.IJsonRpcProvider{constructor(t){super(t),this.events=new events__WEBPACK_IMPORTED_MODULE_0__.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async request(t,e){return this.requestStrict((0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_1__.formatJsonRpcRequest)(t.method,t.params||[],t.id||(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_1__.getBigIntRpcId)().toString()),e)}async requestStrict(t,e){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${t.id}`,n=>{(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_1__.isJsonRpcError)(n)?s(n.error):i(n.result)});try{await this.connection.send(t,e)}catch(n){s(n)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_1__.isJsonRpcResponse)(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&3e3===t.code&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),"string"==typeof t&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}},"./node_modules/@walletconnect/jsonrpc-utils/dist/esm/constants.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Uf:()=>STANDARD_ERROR_MAP,XW:()=>DEFAULT_ERROR,fO:()=>SERVER_ERROR,jf:()=>RESERVED_ERROR_CODES,zR:()=>INTERNAL_ERROR});const PARSE_ERROR="PARSE_ERROR",INVALID_REQUEST="INVALID_REQUEST",METHOD_NOT_FOUND="METHOD_NOT_FOUND",INVALID_PARAMS="INVALID_PARAMS",INTERNAL_ERROR="INTERNAL_ERROR",SERVER_ERROR="SERVER_ERROR",RESERVED_ERROR_CODES=[-32700,-32600,-32601,-32602,-32603],STANDARD_ERROR_MAP={[PARSE_ERROR]:{code:-32700,message:"Parse error"},[INVALID_REQUEST]:{code:-32600,message:"Invalid Request"},[METHOD_NOT_FOUND]:{code:-32601,message:"Method not found"},[INVALID_PARAMS]:{code:-32602,message:"Invalid params"},[INTERNAL_ERROR]:{code:-32603,message:"Internal error"},[SERVER_ERROR]:{code:-32e3,message:"Server error"}},DEFAULT_ERROR=SERVER_ERROR},"./node_modules/@walletconnect/jsonrpc-utils/dist/esm/env.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";var _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@walletconnect/environment/dist/cjs/index.js");__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"IJsonRpcProvider")&&__webpack_require__.d(__webpack_exports__,{IJsonRpcProvider:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.IJsonRpcProvider}}),__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"formatJsonRpcError")&&__webpack_require__.d(__webpack_exports__,{formatJsonRpcError:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.formatJsonRpcError}}),__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"formatJsonRpcRequest")&&__webpack_require__.d(__webpack_exports__,{formatJsonRpcRequest:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.formatJsonRpcRequest}}),__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"formatJsonRpcResult")&&__webpack_require__.d(__webpack_exports__,{formatJsonRpcResult:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.formatJsonRpcResult}}),__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"getBigIntRpcId")&&__webpack_require__.d(__webpack_exports__,{getBigIntRpcId:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.getBigIntRpcId}}),__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"isHttpUrl")&&__webpack_require__.d(__webpack_exports__,{isHttpUrl:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.isHttpUrl}}),__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"isJsonRpcError")&&__webpack_require__.d(__webpack_exports__,{isJsonRpcError:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.isJsonRpcError}}),__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"isJsonRpcRequest")&&__webpack_require__.d(__webpack_exports__,{isJsonRpcRequest:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.isJsonRpcRequest}}),__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"isJsonRpcResponse")&&__webpack_require__.d(__webpack_exports__,{isJsonRpcResponse:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.isJsonRpcResponse}}),__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"isJsonRpcResult")&&__webpack_require__.d(__webpack_exports__,{isJsonRpcResult:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.isJsonRpcResult}}),__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"isLocalhostUrl")&&__webpack_require__.d(__webpack_exports__,{isLocalhostUrl:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.isLocalhostUrl}}),__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"isReactNative")&&__webpack_require__.d(__webpack_exports__,{isReactNative:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.isReactNative}}),__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"isWsUrl")&&__webpack_require__.d(__webpack_exports__,{isWsUrl:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.isWsUrl}}),__webpack_require__.o(_walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__,"payloadId")&&__webpack_require__.d(__webpack_exports__,{payloadId:function(){return _walletconnect_environment__WEBPACK_IMPORTED_MODULE_0__.payloadId}})},"./node_modules/@walletconnect/jsonrpc-utils/dist/esm/error.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{eF:()=>parseConnectionError,mE:()=>isReservedErrorCode,rI:()=>getErrorByCode,vG:()=>getError});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/constants.js");function isReservedErrorCode(code){return _constants__WEBPACK_IMPORTED_MODULE_0__.jf.includes(code)}function getError(type){return Object.keys(_constants__WEBPACK_IMPORTED_MODULE_0__.Uf).includes(type)?_constants__WEBPACK_IMPORTED_MODULE_0__.Uf[type]:_constants__WEBPACK_IMPORTED_MODULE_0__.Uf[_constants__WEBPACK_IMPORTED_MODULE_0__.XW]}function getErrorByCode(code){const match=Object.values(_constants__WEBPACK_IMPORTED_MODULE_0__.Uf).find(e=>e.code===code);return match||_constants__WEBPACK_IMPORTED_MODULE_0__.Uf[_constants__WEBPACK_IMPORTED_MODULE_0__.XW]}function parseConnectionError(e,url,type){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${type} RPC url at ${url}`):e}},"./node_modules/@walletconnect/jsonrpc-utils/dist/esm/format.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{ER:()=>payloadId,Im:()=>formatJsonRpcResult,dZ:()=>formatJsonRpcError,eX:()=>getBigIntRpcId,e_:()=>formatJsonRpcRequest});var _error__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/error.js"),_constants__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/constants.js");function payloadId(entropy=3){return Date.now()*Math.pow(10,entropy)+Math.floor(Math.random()*Math.pow(10,entropy))}function getBigIntRpcId(entropy=6){return BigInt(payloadId(entropy))}function formatJsonRpcRequest(method,params,id){return{id:id||payloadId(),jsonrpc:"2.0",method,params}}function formatJsonRpcResult(id,result){return{id,jsonrpc:"2.0",result}}function formatJsonRpcError(id,error,data){return{id,jsonrpc:"2.0",error:formatErrorMessage(error,data)}}function formatErrorMessage(error,data){return void 0===error?(0,_error__WEBPACK_IMPORTED_MODULE_0__.vG)(_constants__WEBPACK_IMPORTED_MODULE_1__.zR):("string"==typeof error&&(error=Object.assign(Object.assign({},(0,_error__WEBPACK_IMPORTED_MODULE_0__.vG)(_constants__WEBPACK_IMPORTED_MODULE_1__.fO)),{message:error})),void 0!==data&&(error.data=data),(0,_error__WEBPACK_IMPORTED_MODULE_0__.mE)(error.code)&&(error=(0,_error__WEBPACK_IMPORTED_MODULE_0__.rI)(error.code)),error)}},"./node_modules/@walletconnect/jsonrpc-utils/dist/esm/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{IJsonRpcProvider:()=>_types__WEBPACK_IMPORTED_MODULE_4__.kF,formatJsonRpcError:()=>_format__WEBPACK_IMPORTED_MODULE_3__.dZ,formatJsonRpcRequest:()=>_format__WEBPACK_IMPORTED_MODULE_3__.e_,formatJsonRpcResult:()=>_format__WEBPACK_IMPORTED_MODULE_3__.Im,getBigIntRpcId:()=>_format__WEBPACK_IMPORTED_MODULE_3__.eX,isHttpUrl:()=>_url__WEBPACK_IMPORTED_MODULE_5__.q$,isJsonRpcError:()=>_validators__WEBPACK_IMPORTED_MODULE_6__.U$,isJsonRpcRequest:()=>_validators__WEBPACK_IMPORTED_MODULE_6__.p3,isJsonRpcResponse:()=>_validators__WEBPACK_IMPORTED_MODULE_6__.tq,isJsonRpcResult:()=>_validators__WEBPACK_IMPORTED_MODULE_6__.xT,isLocalhostUrl:()=>_url__WEBPACK_IMPORTED_MODULE_5__.z,isWsUrl:()=>_url__WEBPACK_IMPORTED_MODULE_5__.A1,parseConnectionError:()=>_error__WEBPACK_IMPORTED_MODULE_1__.eF,payloadId:()=>_format__WEBPACK_IMPORTED_MODULE_3__.ER});__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/constants.js");var _error__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/error.js"),_env__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/env.js");__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"IJsonRpcProvider")&&__webpack_require__.d(__webpack_exports__,{IJsonRpcProvider:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.IJsonRpcProvider}}),__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"formatJsonRpcError")&&__webpack_require__.d(__webpack_exports__,{formatJsonRpcError:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.formatJsonRpcError}}),__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"formatJsonRpcRequest")&&__webpack_require__.d(__webpack_exports__,{formatJsonRpcRequest:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.formatJsonRpcRequest}}),__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"formatJsonRpcResult")&&__webpack_require__.d(__webpack_exports__,{formatJsonRpcResult:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.formatJsonRpcResult}}),__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"getBigIntRpcId")&&__webpack_require__.d(__webpack_exports__,{getBigIntRpcId:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.getBigIntRpcId}}),__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"isHttpUrl")&&__webpack_require__.d(__webpack_exports__,{isHttpUrl:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.isHttpUrl}}),__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"isJsonRpcError")&&__webpack_require__.d(__webpack_exports__,{isJsonRpcError:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.isJsonRpcError}}),__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"isJsonRpcRequest")&&__webpack_require__.d(__webpack_exports__,{isJsonRpcRequest:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.isJsonRpcRequest}}),__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"isJsonRpcResponse")&&__webpack_require__.d(__webpack_exports__,{isJsonRpcResponse:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.isJsonRpcResponse}}),__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"isJsonRpcResult")&&__webpack_require__.d(__webpack_exports__,{isJsonRpcResult:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.isJsonRpcResult}}),__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"isLocalhostUrl")&&__webpack_require__.d(__webpack_exports__,{isLocalhostUrl:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.isLocalhostUrl}}),__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"isReactNative")&&__webpack_require__.d(__webpack_exports__,{isReactNative:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.isReactNative}}),__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"isWsUrl")&&__webpack_require__.d(__webpack_exports__,{isWsUrl:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.isWsUrl}}),__webpack_require__.o(_env__WEBPACK_IMPORTED_MODULE_2__,"payloadId")&&__webpack_require__.d(__webpack_exports__,{payloadId:function(){return _env__WEBPACK_IMPORTED_MODULE_2__.payloadId}});var _format__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/format.js"),_types__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/types.js"),_url__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/url.js"),_validators__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/validators.js")},"./node_modules/@walletconnect/jsonrpc-utils/dist/esm/types.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{kF:()=>r});class e{}class n extends e{constructor(){super()}}class r extends n{constructor(c){super()}}},"./node_modules/@walletconnect/jsonrpc-utils/dist/esm/url.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A1:()=>isWsUrl,q$:()=>isHttpUrl,z:()=>isLocalhostUrl});const HTTP_REGEX="^https?:",WS_REGEX="^wss?:";function matchRegexProtocol(url,regex){const protocol=function getUrlProtocol(url){const matches=url.match(new RegExp(/^\w+:/,"gi"));if(matches&&matches.length)return matches[0]}(url);return void 0!==protocol&&new RegExp(regex).test(protocol)}function isHttpUrl(url){return matchRegexProtocol(url,HTTP_REGEX)}function isWsUrl(url){return matchRegexProtocol(url,WS_REGEX)}function isLocalhostUrl(url){return new RegExp("wss?://localhost(:d{2,5})?").test(url)}},"./node_modules/@walletconnect/jsonrpc-utils/dist/esm/validators.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function isJsonRpcPayload(payload){return"object"==typeof payload&&"id"in payload&&"jsonrpc"in payload&&"2.0"===payload.jsonrpc}function isJsonRpcRequest(payload){return isJsonRpcPayload(payload)&&"method"in payload}function isJsonRpcResponse(payload){return isJsonRpcPayload(payload)&&(isJsonRpcResult(payload)||isJsonRpcError(payload))}function isJsonRpcResult(payload){return"result"in payload}function isJsonRpcError(payload){return"error"in payload}__webpack_require__.d(__webpack_exports__,{U$:()=>isJsonRpcError,p3:()=>isJsonRpcRequest,tq:()=>isJsonRpcResponse,xT:()=>isJsonRpcResult})},"./node_modules/@walletconnect/jsonrpc-ws-connection/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>f});var events__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/events/events.js"),_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@walletconnect/safe-json/dist/esm/index.js"),_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@walletconnect/jsonrpc-utils/dist/esm/index.js");const d=r=>r.split("?")[0],b=typeof WebSocket<"u"?WebSocket:typeof __webpack_require__.g<"u"&&typeof __webpack_require__.g.WebSocket<"u"?__webpack_require__.g.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:__webpack_require__("./node_modules/@walletconnect/jsonrpc-ws-connection/node_modules/ws/browser.js");class f{constructor(e){if(this.url=e,this.events=new events__WEBPACK_IMPORTED_MODULE_0__.EventEmitter,this.registering=!1,!(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_2__.isWsUrl)(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{typeof this.socket>"u"?t(new Error("Connection already closed")):(this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close())})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send((0,_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__.h)(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_2__.isWsUrl)(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((n,s)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),s(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,n)=>{const s=(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_2__.isReactNative)()?void 0:{rejectUnauthorized:!(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_2__.isLocalhostUrl)(e)},o=new b(e,[],s);typeof WebSocket<"u"||typeof __webpack_require__.g<"u"&&typeof __webpack_require__.g.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u"?o.onerror=i=>{const a=i;n(this.emitError(a.error))}:o.on("error",i=>{n(this.emitError(i))}),o.onopen=()=>{this.onOpen(o),t(o)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t="string"==typeof e.data?(0,_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__.j)(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const n=this.parseError(t),s=n.message||n.toString(),o=(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_2__.formatJsonRpcError)(e,s);this.events.emit("payload",o)}parseError(e,t=this.url){return(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_2__.parseConnectionError)(e,d(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}emitError(e){const t=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${d(this.url)}`));return this.events.emit("register_error",t),t}}},"./node_modules/@walletconnect/jsonrpc-ws-connection/node_modules/ws/browser.js":module=>{"use strict";module.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},"./node_modules/@walletconnect/keyvaluestorage/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>h});var console=__webpack_require__("./node_modules/console-browserify/index.js");const suspectProtoRx=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,suspectConstructorRx=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,JsonSigRx=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function jsonParseTransform(key,value){if(!("__proto__"===key||"constructor"===key&&value&&"object"==typeof value&&"prototype"in value))return value;(function warnKeyDropped(key){console.warn(`[destr] Dropping "${key}" key to prevent prototype pollution.`)})(key)}function destr(value,options={}){if("string"!=typeof value)return value;if('"'===value[0]&&'"'===value[value.length-1]&&-1===value.indexOf("\\"))return value.slice(1,-1);const _value=value.trim();if(_value.length<=9)switch(_value.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!JsonSigRx.test(value)){if(options.strict)throw new SyntaxError("[destr] Invalid JSON");return value}try{if(suspectProtoRx.test(value)||suspectConstructorRx.test(value)){if(options.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(value,jsonParseTransform)}return JSON.parse(value)}catch(error){if(options.strict)throw error;return value}}var Buffer=__webpack_require__("./node_modules/buffer/index.js").Buffer;function asyncCall(function_,...arguments_){try{return function wrapToPromise(value){return value&&"function"==typeof value.then?value:Promise.resolve(value)}(function_(...arguments_))}catch(error){return Promise.reject(error)}}function stringify(value){if(function isPrimitive(value){const type=typeof value;return null===value||"object"!==type&&"function"!==type}(value))return String(value);if(function isPureObject(value){const proto=Object.getPrototypeOf(value);return!proto||proto.isPrototypeOf(Object)}(value)||Array.isArray(value))return JSON.stringify(value);if("function"==typeof value.toJSON)return stringify(value.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function serializeRaw(value){return"string"==typeof value?value:"base64:"+function base64Encode(input){if(globalThis.Buffer)return Buffer.from(input).toString("base64");return globalThis.btoa(String.fromCodePoint(...input))}(value)}function deserializeRaw(value){return"string"!=typeof value?value:value.startsWith("base64:")?function base64Decode(input){if(globalThis.Buffer)return Buffer.from(input,"base64");return Uint8Array.from(globalThis.atob(input),c=>c.codePointAt(0))}(value.slice(7)):value}function normalizeKey(key){return key&&key.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function joinKeys(...keys){return normalizeKey(keys.join(":"))}function unstorage_CoCt7NXC_normalizeBaseKey(base){return(base=normalizeKey(base))?base+":":""}var dist_console=__webpack_require__("./node_modules/console-browserify/index.js");const memory=()=>{const data=new Map;return{name:"memory",getInstance:()=>data,hasItem:key=>data.has(key),getItem:key=>data.get(key)??null,getItemRaw:key=>data.get(key)??null,setItem(key,value){data.set(key,value)},setItemRaw(key,value){data.set(key,value)},removeItem(key){data.delete(key)},getKeys:()=>[...data.keys()],clear(){data.clear()},dispose(){data.clear()}}};function createStorage(options={}){const context={mounts:{"":options.driver||memory()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},getMount=key=>{for(const base of context.mountpoints)if(key.startsWith(base))return{base,relativeKey:key.slice(base.length),driver:context.mounts[base]};return{base:"",relativeKey:key,driver:context.mounts[""]}},getMounts=(base,includeParent)=>context.mountpoints.filter(mountpoint=>mountpoint.startsWith(base)||includeParent&&base.startsWith(mountpoint)).map(mountpoint=>({relativeBase:base.length>mountpoint.length?base.slice(mountpoint.length):void 0,mountpoint,driver:context.mounts[mountpoint]})),onChange=(event,key)=>{if(context.watching){key=normalizeKey(key);for(const listener of context.watchListeners)listener(event,key)}},stopWatch=async()=>{if(context.watching){for(const mountpoint in context.unwatch)await context.unwatch[mountpoint]();context.unwatch={},context.watching=!1}},runBatch=(items,commonOptions,cb)=>{const batches=new Map,getBatch=mount=>{let batch=batches.get(mount.base);return batch||(batch={driver:mount.driver,base:mount.base,items:[]},batches.set(mount.base,batch)),batch};for(const item of items){const isStringItem="string"==typeof item,key=normalizeKey(isStringItem?item:item.key),value=isStringItem?void 0:item.value,options2=isStringItem||!item.options?commonOptions:{...commonOptions,...item.options},mount=getMount(key);getBatch(mount).items.push({key,value,relativeKey:mount.relativeKey,options:options2})}return Promise.all([...batches.values()].map(batch=>cb(batch))).then(r=>r.flat())},storage={hasItem(key,opts={}){key=normalizeKey(key);const{relativeKey,driver}=getMount(key);return asyncCall(driver.hasItem,relativeKey,opts)},getItem(key,opts={}){key=normalizeKey(key);const{relativeKey,driver}=getMount(key);return asyncCall(driver.getItem,relativeKey,opts).then(value=>destr(value))},getItems:(items,commonOptions={})=>runBatch(items,commonOptions,batch=>batch.driver.getItems?asyncCall(batch.driver.getItems,batch.items.map(item=>({key:item.relativeKey,options:item.options})),commonOptions).then(r=>r.map(item=>({key:joinKeys(batch.base,item.key),value:destr(item.value)}))):Promise.all(batch.items.map(item=>asyncCall(batch.driver.getItem,item.relativeKey,item.options).then(value=>({key:item.key,value:destr(value)}))))),getItemRaw(key,opts={}){key=normalizeKey(key);const{relativeKey,driver}=getMount(key);return driver.getItemRaw?asyncCall(driver.getItemRaw,relativeKey,opts):asyncCall(driver.getItem,relativeKey,opts).then(value=>deserializeRaw(value))},async setItem(key,value,opts={}){if(void 0===value)return storage.removeItem(key);key=normalizeKey(key);const{relativeKey,driver}=getMount(key);driver.setItem&&(await asyncCall(driver.setItem,relativeKey,stringify(value),opts),driver.watch||onChange("update",key))},async setItems(items,commonOptions){await runBatch(items,commonOptions,async batch=>{if(batch.driver.setItems)return asyncCall(batch.driver.setItems,batch.items.map(item=>({key:item.relativeKey,value:stringify(item.value),options:item.options})),commonOptions);batch.driver.setItem&&await Promise.all(batch.items.map(item=>asyncCall(batch.driver.setItem,item.relativeKey,stringify(item.value),item.options)))})},async setItemRaw(key,value,opts={}){if(void 0===value)return storage.removeItem(key,opts);key=normalizeKey(key);const{relativeKey,driver}=getMount(key);if(driver.setItemRaw)await asyncCall(driver.setItemRaw,relativeKey,value,opts);else{if(!driver.setItem)return;await asyncCall(driver.setItem,relativeKey,serializeRaw(value),opts)}driver.watch||onChange("update",key)},async removeItem(key,opts={}){"boolean"==typeof opts&&(opts={removeMeta:opts}),key=normalizeKey(key);const{relativeKey,driver}=getMount(key);driver.removeItem&&(await asyncCall(driver.removeItem,relativeKey,opts),(opts.removeMeta||opts.removeMata)&&await asyncCall(driver.removeItem,relativeKey+"$",opts),driver.watch||onChange("remove",key))},async getMeta(key,opts={}){"boolean"==typeof opts&&(opts={nativeOnly:opts}),key=normalizeKey(key);const{relativeKey,driver}=getMount(key),meta=Object.create(null);if(driver.getMeta&&Object.assign(meta,await asyncCall(driver.getMeta,relativeKey,opts)),!opts.nativeOnly){const value=await asyncCall(driver.getItem,relativeKey+"$",opts).then(value_=>destr(value_));value&&"object"==typeof value&&("string"==typeof value.atime&&(value.atime=new Date(value.atime)),"string"==typeof value.mtime&&(value.mtime=new Date(value.mtime)),Object.assign(meta,value))}return meta},setMeta(key,value,opts={}){return this.setItem(key+"$",value,opts)},removeMeta(key,opts={}){return this.removeItem(key+"$",opts)},async getKeys(base,opts={}){base=unstorage_CoCt7NXC_normalizeBaseKey(base);const mounts=getMounts(base,!0);let maskedMounts=[];const allKeys=[];let allMountsSupportMaxDepth=!0;for(const mount of mounts){mount.driver.flags?.maxDepth||(allMountsSupportMaxDepth=!1);const rawKeys=await asyncCall(mount.driver.getKeys,mount.relativeBase,opts);for(const key of rawKeys){const fullKey=mount.mountpoint+normalizeKey(key);maskedMounts.some(p=>fullKey.startsWith(p))||allKeys.push(fullKey)}maskedMounts=[mount.mountpoint,...maskedMounts.filter(p=>!p.startsWith(mount.mountpoint))]}const shouldFilterByDepth=void 0!==opts.maxDepth&&!allMountsSupportMaxDepth;return allKeys.filter(key=>(!shouldFilterByDepth||function filterKeyByDepth(key,depth){if(void 0===depth)return!0;let substrCount=0,index=key.indexOf(":");for(;index>-1;)substrCount++,index=key.indexOf(":",index+1);return substrCount<=depth}(key,opts.maxDepth))&&function filterKeyByBase(key,base){return base?key.startsWith(base)&&"$"!==key[key.length-1]:"$"!==key[key.length-1]}(key,base))},async clear(base,opts={}){base=unstorage_CoCt7NXC_normalizeBaseKey(base),await Promise.all(getMounts(base,!1).map(async m=>{if(m.driver.clear)return asyncCall(m.driver.clear,m.relativeBase,opts);if(m.driver.removeItem){const keys=await m.driver.getKeys(m.relativeBase||"",opts);return Promise.all(keys.map(key=>m.driver.removeItem(key,opts)))}}))},async dispose(){await Promise.all(Object.values(context.mounts).map(driver=>dispose(driver)))},watch:async callback=>(await(async()=>{if(!context.watching){context.watching=!0;for(const mountpoint in context.mounts)context.unwatch[mountpoint]=await watch(context.mounts[mountpoint],onChange,mountpoint)}})(),context.watchListeners.push(callback),async()=>{context.watchListeners=context.watchListeners.filter(listener=>listener!==callback),0===context.watchListeners.length&&await stopWatch()}),async unwatch(){context.watchListeners=[],await stopWatch()},mount(base,driver){if((base=unstorage_CoCt7NXC_normalizeBaseKey(base))&&context.mounts[base])throw new Error(`already mounted at ${base}`);return base&&(context.mountpoints.push(base),context.mountpoints.sort((a,b)=>b.length-a.length)),context.mounts[base]=driver,context.watching&&Promise.resolve(watch(driver,onChange,base)).then(unwatcher=>{context.unwatch[base]=unwatcher}).catch(dist_console.error),storage},async unmount(base,_dispose=!0){(base=unstorage_CoCt7NXC_normalizeBaseKey(base))&&context.mounts[base]&&(context.watching&&base in context.unwatch&&(context.unwatch[base]?.(),delete context.unwatch[base]),_dispose&&await dispose(context.mounts[base]),context.mountpoints=context.mountpoints.filter(key=>key!==base),delete context.mounts[base])},getMount(key=""){key=normalizeKey(key)+":";const m=getMount(key);return{driver:m.driver,base:m.base}},getMounts(base="",opts={}){base=normalizeKey(base);return getMounts(base,opts.parents).map(m=>({driver:m.driver,base:m.mountpoint}))},keys:(base,opts={})=>storage.getKeys(base,opts),get:(key,opts={})=>storage.getItem(key,opts),set:(key,value,opts={})=>storage.setItem(key,value,opts),has:(key,opts={})=>storage.hasItem(key,opts),del:(key,opts={})=>storage.removeItem(key,opts),remove:(key,opts={})=>storage.removeItem(key,opts)};return storage}function watch(driver,onChange,base){return driver.watch?driver.watch((event,key)=>onChange(event,base+key)):()=>{}}async function dispose(driver){"function"==typeof driver.dispose&&await asyncCall(driver.dispose)}function promisifyRequest(request){return new Promise((resolve,reject)=>{request.oncomplete=request.onsuccess=()=>resolve(request.result),request.onabort=request.onerror=()=>reject(request.error)})}function createStore(dbName,storeName){let dbp;return(txMode,callback)=>(()=>{if(dbp)return dbp;const request=indexedDB.open(dbName);return request.onupgradeneeded=()=>request.result.createObjectStore(storeName),dbp=promisifyRequest(request),dbp.then(db=>{db.onclose=()=>dbp=void 0},()=>{}),dbp})().then(db=>callback(db.transaction(storeName,txMode).objectStore(storeName)))}let defaultGetStoreFunc;function defaultGetStore(){return defaultGetStoreFunc||(defaultGetStoreFunc=createStore("keyval-store","keyval")),defaultGetStoreFunc}function get(key,customStore=defaultGetStore()){return customStore("readonly",store=>promisifyRequest(store.get(key)))}function eachCursor(store,callback){return store.openCursor().onsuccess=function(){this.result&&(callback(this.result),this.result.continue())},promisifyRequest(store.transaction)}var esm=__webpack_require__("./node_modules/@walletconnect/safe-json/dist/esm/index.js");var z=(i={})=>{const t=i.base&&i.base.length>0?`${i.base}:`:"",e=s=>t+s;let n;return i.dbName&&i.storeName&&(n=createStore(i.dbName,i.storeName)),{name:"idb-keyval",options:i,hasItem:async s=>!(typeof await get(e(s),n)>"u"),getItem:async s=>await get(e(s),n)??null,setItem:(s,a)=>function set(key,value,customStore=defaultGetStore()){return customStore("readwrite",store=>(store.put(value,key),promisifyRequest(store.transaction)))}(e(s),a,n),removeItem:s=>function del(key,customStore=defaultGetStore()){return customStore("readwrite",store=>(store.delete(key),promisifyRequest(store.transaction)))}(e(s),n),getKeys:()=>function keys(customStore=defaultGetStore()){return customStore("readonly",store=>{if(store.getAllKeys)return promisifyRequest(store.getAllKeys());const items=[];return eachCursor(store,cursor=>items.push(cursor.key)).then(()=>items)})}(n),clear:()=>function clear(customStore=defaultGetStore()){return customStore("readwrite",store=>(store.clear(),promisifyRequest(store.transaction)))}(n)}};class _{constructor(){this.indexedDb=createStorage({driver:z({dbName:"WALLET_CONNECT_V2_INDEXED_DB",storeName:"keyvaluestorage"})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const e=await this.indexedDb.getItem(t);if(null!==e)return e}async setItem(t,e){await this.indexedDb.setItem(t,(0,esm.h)(e))}async removeItem(t){await this.indexedDb.removeItem(t)}}var l=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof __webpack_require__.g<"u"?__webpack_require__.g:typeof self<"u"?self:{},c={exports:{}};function k(i){var t;return[i[0],(0,esm.j)(null!=(t=i[1])?t:"")]}!function(){let i;function t(){}i=t,i.prototype.getItem=function(e){return this.hasOwnProperty(e)?String(this[e]):null},i.prototype.setItem=function(e,n){this[e]=String(n)},i.prototype.removeItem=function(e){delete this[e]},i.prototype.clear=function(){const e=this;Object.keys(e).forEach(function(n){e[n]=void 0,delete e[n]})},i.prototype.key=function(e){return e=e||0,Object.keys(this)[e]},i.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof l<"u"&&l.localStorage?c.exports=l.localStorage:typeof window<"u"&&window.localStorage?c.exports=window.localStorage:c.exports=new t}();class K{constructor(){this.localStorage=c.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(k)}async getItem(t){const e=this.localStorage.getItem(t);if(null!==e)return(0,esm.j)(e)}async setItem(t,e){this.localStorage.setItem(t,(0,esm.h)(e))}async removeItem(t){this.localStorage.removeItem(t)}}const j=async(i,t)=>{t.length&&t.forEach(async e=>{await i.removeItem(e)})};class h{constructor(){this.initialized=!1,this.setInitialized=e=>{this.storage=e,this.initialized=!0};const t=new K;this.storage=t;try{(async(i,t,e)=>{const n="wc_storage_version",s=await t.getItem(n);if(s&&s>=1)return void e(t);const a=await i.getKeys();if(!a.length)return void e(t);const m=[];for(;a.length;){const r=a.shift();if(!r)continue;const o=r.toLowerCase();if(o.includes("wc@")||o.includes("walletconnect")||o.includes("wc_")||o.includes("wallet_connect")){const f=await i.getItem(r);await t.setItem(r,f),m.push(r)}}await t.setItem(n,1),e(t),j(i,m)})(t,new _,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,e){return await this.initialize(),this.storage.setItem(t,e)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const e=setInterval(()=>{this.initialized&&(clearInterval(e),t())},20)})}}},"./node_modules/@walletconnect/logger/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{D5:()=>A,U5:()=>E,h6:()=>pino__WEBPACK_IMPORTED_MODULE_0___default.a,iP:()=>k,oI:()=>y});var pino__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/pino/browser.js"),pino__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(pino__WEBPACK_IMPORTED_MODULE_0__),_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@walletconnect/safe-json/dist/esm/index.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");const c={level:"info"},n="custom_context",l=1024e3;class O{constructor(e){this.nodeValue=e,this.sizeInBytes=(new TextEncoder).encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class d{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const t=new O(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let t=this.head;for(;null!==t;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const t=e.value;return e=e.next,{done:!1,value:t}}}}}class L{constructor(e,t=l){this.level=e??"error",this.levelValue=pino__WEBPACK_IMPORTED_MODULE_0__.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new d(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===pino__WEBPACK_IMPORTED_MODULE_0__.levels.values.error?console.error(e):t===pino__WEBPACK_IMPORTED_MODULE_0__.levels.values.warn?console.warn(e):t===pino__WEBPACK_IMPORTED_MODULE_0__.levels.values.debug?console.debug(e):t===pino__WEBPACK_IMPORTED_MODULE_0__.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append((0,_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__.h)({timestamp:(new Date).toISOString(),log:e}));const t="string"==typeof e?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new d(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const t=this.getLogArray();return t.push((0,_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__.h)({extraMetadata:e})),new Blob(t,{type:"application/json"})}}class m{constructor(e,t=l){this.baseChunkLogger=new L(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const t=URL.createObjectURL(this.logsToBlob(e)),o=document.createElement("a");o.href=t,o.download=`walletconnect-logs-${(new Date).toISOString()}.txt`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t)}}class B{constructor(e,t=l){this.baseChunkLogger=new L(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var x=Object.defineProperty,S=Object.defineProperties,_=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,T=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable,f=(r,e,t)=>e in r?x(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,i=(r,e)=>{for(var t in e||(e={}))T.call(e,t)&&f(r,t,e[t]);if(p)for(var t of p(e))z.call(e,t)&&f(r,t,e[t]);return r},g=(r,e)=>S(r,_(e));function k(r){return g(i({},r),{level:r?.level||c.level})}function y(r,e=n){let t="";return t=typeof r.bindings>"u"?function v(r,e=n){return r[e]||""}(r,e):r.bindings().context||"",t}function E(r,e,t=n){const o=function w(r,e,t=n){const o=y(r,t);return o.trim()?`${o}/${e}`:e}(r,e,t);return function b(r,e,t=n){return r[t]=e,r}(r.child({context:o}),o,t)}function A(r){return typeof r.loggerOverride<"u"&&"string"!=typeof r.loggerOverride?{logger:r.loggerOverride,chunkLoggerController:null}:typeof window<"u"?function C(r){var e,t;const o=new m(null==(e=r.opts)?void 0:e.level,r.maxSizeInBytes);return{logger:pino__WEBPACK_IMPORTED_MODULE_0___default()(g(i({},r.opts),{level:"trace",browser:g(i({},null==(t=r.opts)?void 0:t.browser),{write:a=>o.write(a)})})),chunkLoggerController:o}}(r):function I(r){var e;const t=new B(null==(e=r.opts)?void 0:e.level,r.maxSizeInBytes);return{logger:pino__WEBPACK_IMPORTED_MODULE_0___default()(g(i({},r.opts),{level:"trace"}),t),chunkLoggerController:t}}(r)}},"./node_modules/@walletconnect/relay-api/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{CG:()=>C});const C={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}}},"./node_modules/@walletconnect/relay-auth/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Cq:()=>sn,FA:()=>Qo,TZ:()=>Po,UF:()=>Qe});var _walletconnect_time__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/index.js"),_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@walletconnect/safe-json/dist/esm/index.js");function fe(t,...e){if(!function En(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function De(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}const it="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,_t=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function de(t){return"string"==typeof t&&(t=function yn(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),fe(t),t}class xn{clone(){return this._cloneInto()}}function he(t=32){if(it&&"function"==typeof it.getRandomValues)return it.getRandomValues(new Uint8Array(t));if(it&&"function"==typeof it.randomBytes)return it.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}class An extends xn{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=_t(this.buffer)}update(e){De(this);const{view:n,buffer:r,blockLen:o}=this,s=(e=de(e)).length;for(let a=0;a<s;){const u=Math.min(o-this.pos,s-a);if(u===o){const i=_t(e);for(;o<=s-a;a+=o)this.process(i,a);continue}r.set(e.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){De(this),function gn(t,e){fe(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:a}=this;n[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(r,0),a=0);for(let l=a;l<o;l++)n[l]=0;(function Cn(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const o=BigInt(32),s=BigInt(4294967295),a=Number(n>>o&s),u=Number(n&s),i=r?4:0,D=r?0:4;t.setUint32(e+i,a,r),t.setUint32(e+D,u,r)})(r,o-8,BigInt(8*this.length),s),this.process(r,0);const u=_t(e),i=this.outputLen;if(i%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const D=i/4,c=this.get();if(D>c.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<D;l++)u.setUint32(4*l,c[l],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:a,pos:u}=this;return e.length=o,e.pos=u,e.finished=s,e.destroyed=a,o%n&&e.buffer.set(r),e}}const wt=BigInt(2**32-1),St=BigInt(32);function le(t,e=!1){return e?{h:Number(t&wt),l:Number(t>>St&wt)}:{h:0|Number(t>>St&wt),l:0|Number(t&wt)}}const x={fromBig:le,split:function mn(t,e=!1){let n=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let o=0;o<t.length;o++){const{h:s,l:a}=le(t[o],e);[n[o],r[o]]=[s,a]}return[n,r]},toBig:(t,e)=>BigInt(t>>>0)<<St|BigInt(e>>>0),shrSH:(t,e,n)=>t>>>n,shrSL:(t,e,n)=>t<<32-n|e>>>n,rotrSH:(t,e,n)=>t>>>n|e<<32-n,rotrSL:(t,e,n)=>t<<32-n|e>>>n,rotrBH:(t,e,n)=>t<<64-n|e>>>n-32,rotrBL:(t,e,n)=>t>>>n-32|e<<64-n,rotr32H:(t,e)=>e,rotr32L:(t,e)=>t,rotlSH:(t,e,n)=>t<<n|e>>>32-n,rotlSL:(t,e,n)=>e<<n|t>>>32-n,rotlBH:(t,e,n)=>e<<n-32|t>>>64-n,rotlBL:(t,e,n)=>t<<n-32|e>>>64-n,add:function qn(t,e,n,r){const o=(e>>>0)+(r>>>0);return{h:t+n+(o/2**32|0)|0,l:0|o}},add3L:(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),add3H:(t,e,n,r)=>e+n+r+(t/2**32|0)|0,add4L:(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),add4H:(t,e,n,r,o)=>e+n+r+o+(t/2**32|0)|0,add5H:(t,e,n,r,o,s)=>e+n+r+o+s+(t/2**32|0)|0,add5L:(t,e,n,r,o)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(o>>>0)},[Vn,Yn]=x.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),P=new Uint32Array(80),Q=new Uint32Array(80);class Jn extends An{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:n,Bh:r,Bl:o,Ch:s,Cl:a,Dh:u,Dl:i,Eh:D,El:c,Fh:l,Fl:p,Gh:w,Gl:h,Hh:g,Hl:S}=this;return[e,n,r,o,s,a,u,i,D,c,l,p,w,h,g,S]}set(e,n,r,o,s,a,u,i,D,c,l,p,w,h,g,S){this.Ah=0|e,this.Al=0|n,this.Bh=0|r,this.Bl=0|o,this.Ch=0|s,this.Cl=0|a,this.Dh=0|u,this.Dl=0|i,this.Eh=0|D,this.El=0|c,this.Fh=0|l,this.Fl=0|p,this.Gh=0|w,this.Gl=0|h,this.Hh=0|g,this.Hl=0|S}process(e,n){for(let d=0;d<16;d++,n+=4)P[d]=e.getUint32(n),Q[d]=e.getUint32(n+=4);for(let d=16;d<80;d++){const m=0|P[d-15],F=0|Q[d-15],q=x.rotrSH(m,F,1)^x.rotrSH(m,F,8)^x.shrSH(m,F,7),z=x.rotrSL(m,F,1)^x.rotrSL(m,F,8)^x.shrSL(m,F,7),I=0|P[d-2],O=0|Q[d-2],ot=x.rotrSH(I,O,19)^x.rotrBH(I,O,61)^x.shrSH(I,O,6),tt=x.rotrSL(I,O,19)^x.rotrBL(I,O,61)^x.shrSL(I,O,6),st=x.add4L(z,tt,Q[d-7],Q[d-16]),at=x.add4H(st,q,ot,P[d-7],P[d-16]);P[d]=0|at,Q[d]=0|st}let{Ah:r,Al:o,Bh:s,Bl:a,Ch:u,Cl:i,Dh:D,Dl:c,Eh:l,El:p,Fh:w,Fl:h,Gh:g,Gl:S,Hh:v,Hl:L}=this;for(let d=0;d<80;d++){const m=x.rotrSH(l,p,14)^x.rotrSH(l,p,18)^x.rotrBH(l,p,41),F=x.rotrSL(l,p,14)^x.rotrSL(l,p,18)^x.rotrBL(l,p,41),q=l&w^~l&g,z=p&h^~p&S,I=x.add5L(L,F,z,Yn[d],Q[d]),O=x.add5H(I,v,m,q,Vn[d],P[d]),ot=0|I,tt=x.rotrSH(r,o,28)^x.rotrBH(r,o,34)^x.rotrBH(r,o,39),st=x.rotrSL(r,o,28)^x.rotrBL(r,o,34)^x.rotrBL(r,o,39),at=r&s^r&u^s&u,Ct=o&a^o&i^a&i;v=0|g,L=0|S,g=0|w,S=0|h,w=0|l,h=0|p,({h:l,l:p}=x.add(0|D,0|c,0|O,0|ot)),D=0|u,c=0|i,u=0|s,i=0|a,s=0|r,a=0|o;const At=x.add3L(ot,st,Ct);r=x.add3H(At,O,tt,at),o=0|At}({h:r,l:o}=x.add(0|this.Ah,0|this.Al,0|r,0|o)),({h:s,l:a}=x.add(0|this.Bh,0|this.Bl,0|s,0|a)),({h:u,l:i}=x.add(0|this.Ch,0|this.Cl,0|u,0|i)),({h:D,l:c}=x.add(0|this.Dh,0|this.Dl,0|D,0|c)),({h:l,l:p}=x.add(0|this.Eh,0|this.El,0|l,0|p)),({h:w,l:h}=x.add(0|this.Fh,0|this.Fl,0|w,0|h)),({h:g,l:S}=x.add(0|this.Gh,0|this.Gl,0|g,0|S)),({h:v,l:L}=x.add(0|this.Hh,0|this.Hl,0|v,0|L)),this.set(r,o,s,a,u,i,D,c,l,p,w,h,g,S,v,L)}roundClean(){P.fill(0),Q.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Kn=function Bn(t){const e=r=>t().update(de(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}(()=>new Jn),vt=BigInt(0),be=BigInt(1),Wn=BigInt(2);function It(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}function Ut(t){if(!It(t))throw new Error("Uint8Array expected")}function Tt(t,e){if("boolean"!=typeof e)throw new Error(t+" boolean expected, got "+e)}const Xn=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ft(t){Ut(t);let e="";for(let n=0;n<t.length;n++)e+=Xn[t[n]];return e}function pe(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return""===t?vt:BigInt("0x"+t)}const K__0=48,K__9=57,K_A=65,K_F=70,K_a=97,K_f=102;function we(t){return t>=K__0&&t<=K__9?t-K__0:t>=K_A&&t<=K_F?t-(K_A-10):t>=K_a&&t<=K_f?t-(K_a-10):void 0}function Ee(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let o=0,s=0;o<n;o++,s+=2){const a=we(t.charCodeAt(s)),u=we(t.charCodeAt(s+1));if(void 0===a||void 0===u){const i=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+i+'" at index '+s)}r[o]=16*a+u}return r}function Et(t){return Ut(t),pe(Ft(Uint8Array.from(t).reverse()))}function ge(t,e){return Ee(t.toString(16).padStart(2*e,"0"))}function Nt(t,e){return ge(t,e).reverse()}function W(t,e,n){let r;if("string"==typeof e)try{r=Ee(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else{if(!It(e))throw new Error(t+" must be hex string or Uint8Array");r=Uint8Array.from(e)}const o=r.length;if("number"==typeof n&&o!==n)throw new Error(t+" of length "+n+" expected, got "+o);return r}function ye(...t){let e=0;for(let r=0;r<t.length;r++){const o=t[r];Ut(o),e+=o.length}const n=new Uint8Array(e);for(let r=0,o=0;r<t.length;r++){const s=t[r];n.set(s,o),o+=s.length}return n}const Lt=t=>"bigint"==typeof t&&vt<=t;function ft(t,e,n,r){if(!function Qn(t,e,n){return Lt(t)&&Lt(e)&&Lt(n)&&e<=t&&t<n}(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}const er=t=>(Wn<<BigInt(t-1))-be,nr={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||It(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};function Ot(t,e,n={}){const r=(o,s,a)=>{const u=nr[s];if("function"!=typeof u)throw new Error("invalid validator function");const i=t[o];if(!(a&&void 0===i||u(i,t)))throw new Error("param "+String(o)+" is invalid. Expected "+s+", got "+i)};for(const[o,s]of Object.entries(e))r(o,s,!1);for(const[o,s]of Object.entries(n))r(o,s,!0);return t}function xe(t){const e=new WeakMap;return(n,...r)=>{const o=e.get(n);if(void 0!==o)return o;const s=t(n,...r);return e.set(n,s),s}}const M=BigInt(0),N=BigInt(1),nt=BigInt(2),rr=BigInt(3),Ht=BigInt(4),Be=BigInt(5),Ce=BigInt(8);function H(t,e){const n=t%e;return n>=M?n:e+n}function or(t,e,n){if(e<M)throw new Error("invalid exponent, negatives unsupported");if(n<=M)throw new Error("invalid modulus");if(n===N)return M;let r=N;for(;e>M;)e&N&&(r=r*t%n),t=t*t%n,e>>=N;return r}function J(t,e,n){let r=t;for(;e-- >M;)r*=r,r%=n;return r}function Ae(t,e){if(t===M)throw new Error("invert: expected non-zero number");if(e<=M)throw new Error("invert: expected positive modulus, got "+e);let n=H(t,e),r=e,o=M,s=N;for(;n!==M;){const i=r%n,D=o-s*(r/n);r=n,n=i,o=s,s=D}if(r!==N)throw new Error("invert: does not exist");return H(o,e)}function ir(t){if(t%Ht===rr){const e=(t+N)/Ht;return function(r,o){const s=r.pow(o,e);if(!r.eql(r.sqr(s),o))throw new Error("Cannot find square root");return s}}if(t%Ce===Be){const e=(t-Be)/Ce;return function(r,o){const s=r.mul(o,nt),a=r.pow(s,e),u=r.mul(o,a),i=r.mul(r.mul(u,nt),a),D=r.mul(u,r.sub(i,r.ONE));if(!r.eql(r.sqr(D),o))throw new Error("Cannot find square root");return D}}return function sr(t){const e=(t-N)/nt;let n,r,o;for(n=t-N,r=0;n%nt===M;n/=nt,r++);for(o=nt;o<t&&or(o,e,t)!==t-N;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(1===r){const a=(t+N)/Ht;return function(i,D){const c=i.pow(D,a);if(!i.eql(i.sqr(c),D))throw new Error("Cannot find square root");return c}}const s=(n+N)/nt;return function(u,i){if(u.pow(i,e)===u.neg(u.ONE))throw new Error("Cannot find square root");let D=r,c=u.pow(u.mul(u.ONE,o),n),l=u.pow(i,s),p=u.pow(i,n);for(;!u.eql(p,u.ONE);){if(u.eql(p,u.ZERO))return u.ZERO;let w=1;for(let g=u.sqr(p);w<D&&!u.eql(g,u.ONE);w++)g=u.sqr(g);const h=u.pow(c,N<<BigInt(D-w-1));c=u.sqr(h),l=u.mul(l,h),p=u.mul(p,c),D=w}return l}}(t)}const cr=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function me(t,e){const n=void 0!==e?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function _e(t,e,n=!1,r={}){if(t<=M)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:o,nByteLength:s}=me(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let a;const u=Object.freeze({ORDER:t,isLE:n,BITS:o,BYTES:s,MASK:er(o),ZERO:M,ONE:N,create:i=>H(i,t),isValid:i=>{if("bigint"!=typeof i)throw new Error("invalid field element: expected bigint, got "+typeof i);return M<=i&&i<t},is0:i=>i===M,isOdd:i=>(i&N)===N,neg:i=>H(-i,t),eql:(i,D)=>i===D,sqr:i=>H(i*i,t),add:(i,D)=>H(i+D,t),sub:(i,D)=>H(i-D,t),mul:(i,D)=>H(i*D,t),pow:(i,D)=>function fr(t,e,n){if(n<M)throw new Error("invalid exponent, negatives unsupported");if(n===M)return t.ONE;if(n===N)return e;let r=t.ONE,o=e;for(;n>M;)n&N&&(r=t.mul(r,o)),o=t.sqr(o),n>>=N;return r}(u,i,D),div:(i,D)=>H(i*Ae(D,t),t),sqrN:i=>i*i,addN:(i,D)=>i+D,subN:(i,D)=>i-D,mulN:(i,D)=>i*D,inv:i=>Ae(i,t),sqrt:r.sqrt||(i=>(a||(a=ir(t)),a(u,i))),invertBatch:i=>function Dr(t,e){const n=new Array(e.length),r=e.reduce((s,a,u)=>t.is0(a)?s:(n[u]=s,t.mul(s,a)),t.ONE),o=t.inv(r);return e.reduceRight((s,a,u)=>t.is0(a)?s:(n[u]=t.mul(s,n[u]),t.mul(s,a)),o),n}(u,i),cmov:(i,D,c)=>c?D:i,toBytes:i=>n?Nt(i,s):ge(i,s),fromBytes:i=>{if(i.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+i.length);return n?Et(i):function Pn(t){return pe(Ft(t))}(i)}});return Object.freeze(u)}const Se=BigInt(0),gt=BigInt(1);function zt(t,e){const n=e.negate();return t?n:e}function ve(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Mt(t,e){ve(t,e);return{windows:Math.ceil(e/t)+1,windowSize:2**(t-1)}}const qt=new WeakMap,Ie=new WeakMap;function $t(t){return Ie.get(t)||1}function br(t,e,n,r){if(function dr(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}(n,t),function hr(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}(r,e),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,s=function tr(t){let e;for(e=0;t>vt;t>>=be,e+=1);return e}(BigInt(n.length)),a=s>12?s-3:s>4?s-2:s?2:1,u=(1<<a)-1,i=new Array(u+1).fill(o);let c=o;for(let l=Math.floor((e.BITS-1)/a)*a;l>=0;l-=a){i.fill(o);for(let w=0;w<r.length;w++){const h=r[w],g=Number(h>>BigInt(l)&BigInt(u));i[g]=i[g].add(n[w])}let p=o;for(let w=i.length-1,h=o;w>0;w--)h=h.add(i[w]),p=p.add(h);if(c=c.add(p),0!==l)for(let w=0;w<a;w++)c=c.double()}return c}function pr(t){return function ar(t){return Ot(t,cr.reduce((r,o)=>(r[o]="function",r),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}(t.Fp),Ot(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...me(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const G=BigInt(0),j=BigInt(1),yt=BigInt(2),wr=BigInt(8),Er={zip215:!0};function yr(t){const e=function gr(t){const e=pr(t);return Ot(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}(t),{Fp:n,n:r,prehash:o,hash:s,randomBytes:a,nByteLength:u,h:i}=e,D=yt<<BigInt(8*u)-j,c=n.create,l=_e(e.n,e.nBitLength),p=e.uvRatio||((y,f)=>{try{return{isValid:!0,value:n.sqrt(y*n.inv(f))}}catch{return{isValid:!1,value:G}}}),w=e.adjustScalarBytes||(y=>y),h=e.domain||((y,f,b)=>{if(Tt("phflag",b),f.length||b)throw new Error("Contexts/pre-hash are not supported");return y});function g(y,f){ft("coordinate "+y,f,G,D)}function S(y){if(!(y instanceof d))throw new Error("ExtendedPoint expected")}const v=xe((y,f)=>{const{ex:b,ey:E,ez:B}=y,C=y.is0();null==f&&(f=C?wr:n.inv(B));const A=c(b*f),U=c(E*f),_=c(B*f);if(C)return{x:G,y:j};if(_!==j)throw new Error("invZ was invalid");return{x:A,y:U}}),L=xe(y=>{const{a:f,d:b}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:E,ey:B,ez:C,et:A}=y,U=c(E*E),_=c(B*B),T=c(C*C),$=c(T*T),R=c(U*f);if(c(T*c(R+_))!==c($+c(b*c(U*_))))throw new Error("bad point: equation left != right (1)");if(c(E*B)!==c(C*A))throw new Error("bad point: equation left != right (2)");return!0});class d{constructor(f,b,E,B){this.ex=f,this.ey=b,this.ez=E,this.et=B,g("x",f),g("y",b),g("z",E),g("t",B),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(f){if(f instanceof d)throw new Error("extended point not allowed");const{x:b,y:E}=f||{};return g("x",b),g("y",E),new d(b,E,j,c(b*E))}static normalizeZ(f){const b=n.invertBatch(f.map(E=>E.ez));return f.map((E,B)=>E.toAffine(b[B])).map(d.fromAffine)}static msm(f,b){return br(d,l,f,b)}_setWindowSize(f){q.setWindowSize(this,f)}assertValidity(){L(this)}equals(f){S(f);const{ex:b,ey:E,ez:B}=this,{ex:C,ey:A,ez:U}=f,_=c(b*U),T=c(C*B),$=c(E*U),R=c(A*B);return _===T&&$===R}is0(){return this.equals(d.ZERO)}negate(){return new d(c(-this.ex),this.ey,this.ez,c(-this.et))}double(){const{a:f}=e,{ex:b,ey:E,ez:B}=this,C=c(b*b),A=c(E*E),U=c(yt*c(B*B)),_=c(f*C),T=b+E,$=c(c(T*T)-C-A),R=_+A,V=R-U,Y=_-A,Z=c($*V),X=c(R*Y),et=c($*Y),pt=c(V*R);return new d(Z,X,pt,et)}add(f){S(f);const{a:b,d:E}=e,{ex:B,ey:C,ez:A,et:U}=this,{ex:_,ey:T,ez:$,et:R}=f;if(b===BigInt(-1)){const re=c((C-B)*(T+_)),oe=c((C+B)*(T-_)),mt=c(oe-re);if(mt===G)return this.double();const se=c(A*yt*R),ie=c(U*yt*$),ue=ie+se,ce=oe+re,ae=ie-se,Dn=c(ue*mt),dn=c(ce*ae),hn=c(ue*ae),ln=c(mt*ce);return new d(Dn,dn,ln,hn)}const V=c(B*_),Y=c(C*T),Z=c(U*E*R),X=c(A*$),et=c((B+C)*(_+T)-V-Y),pt=X-Z,ee=X+Z,ne=c(Y-b*V),un=c(et*pt),cn=c(ee*ne),an=c(et*ne),fn=c(pt*ee);return new d(un,cn,fn,an)}subtract(f){return this.add(f.negate())}wNAF(f){return q.wNAFCached(this,f,d.normalizeZ)}multiply(f){const b=f;ft("scalar",b,j,r);const{p:E,f:B}=this.wNAF(b);return d.normalizeZ([E,B])[0]}multiplyUnsafe(f,b=d.ZERO){const E=f;return ft("scalar",E,G,r),E===G?F:this.is0()||E===j?this:q.wNAFCachedUnsafe(this,E,d.normalizeZ,b)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return q.unsafeLadder(this,r).is0()}toAffine(f){return v(this,f)}clearCofactor(){const{h:f}=e;return f===j?this:this.multiplyUnsafe(f)}static fromHex(f,b=!1){const{d:E,a:B}=e,C=n.BYTES;f=W("pointHex",f,C),Tt("zip215",b);const A=f.slice(),U=f[C-1];A[C-1]=-129&U;const _=Et(A),T=b?D:n.ORDER;ft("pointHex.y",_,G,T);const $=c(_*_),R=c($-j),V=c(E*$-B);let{isValid:Y,value:Z}=p(R,V);if(!Y)throw new Error("Point.fromHex: invalid y coordinate");const X=(Z&j)===j,et=!!(128&U);if(!b&&Z===G&&et)throw new Error("Point.fromHex: x=0 and x_0=1");return et!==X&&(Z=c(-Z)),d.fromAffine({x:Z,y:_})}static fromPrivateKey(f){return O(f).point}toRawBytes(){const{x:f,y:b}=this.toAffine(),E=Nt(b,n.BYTES);return E[E.length-1]|=f&j?128:0,E}toHex(){return Ft(this.toRawBytes())}}d.BASE=new d(e.Gx,e.Gy,j,c(e.Gx*e.Gy)),d.ZERO=new d(G,j,j,G);const{BASE:m,ZERO:F}=d,q=function lr(t,e){return{constTimeNegate:zt,hasPrecomputes:n=>1!==$t(n),unsafeLadder(n,r,o=t.ZERO){let s=n;for(;r>Se;)r&gt&&(o=o.add(s)),s=s.double(),r>>=gt;return o},precomputeWindow(n,r){const{windows:o,windowSize:s}=Mt(r,e),a=[];let u=n,i=u;for(let D=0;D<o;D++){i=u,a.push(i);for(let c=1;c<s;c++)i=i.add(u),a.push(i);u=i.double()}return a},wNAF(n,r,o){const{windows:s,windowSize:a}=Mt(n,e);let u=t.ZERO,i=t.BASE;const D=BigInt(2**n-1),c=2**n,l=BigInt(n);for(let p=0;p<s;p++){const w=p*a;let h=Number(o&D);o>>=l,h>a&&(h-=c,o+=gt);const g=w,S=w+Math.abs(h)-1,v=p%2!=0,L=h<0;0===h?i=i.add(zt(v,r[g])):u=u.add(zt(L,r[S]))}return{p:u,f:i}},wNAFUnsafe(n,r,o,s=t.ZERO){const{windows:a,windowSize:u}=Mt(n,e),i=BigInt(2**n-1),D=2**n,c=BigInt(n);for(let l=0;l<a;l++){const p=l*u;if(o===Se)break;let w=Number(o&i);if(o>>=c,w>u&&(w-=D,o+=gt),0===w)continue;let h=r[p+Math.abs(w)-1];w<0&&(h=h.negate()),s=s.add(h)}return s},getPrecomputes(n,r,o){let s=qt.get(r);return s||(s=this.precomputeWindow(r,n),1!==n&&qt.set(r,o(s))),s},wNAFCached(n,r,o){const s=$t(n);return this.wNAF(s,this.getPrecomputes(s,n,o),r)},wNAFCachedUnsafe(n,r,o,s){const a=$t(n);return 1===a?this.unsafeLadder(n,r,s):this.wNAFUnsafe(a,this.getPrecomputes(a,n,o),r,s)},setWindowSize(n,r){ve(r,e),Ie.set(n,r),qt.delete(n)}}}(d,8*u);function z(y){return H(y,r)}function I(y){return z(Et(y))}function O(y){const f=n.BYTES;y=W("private key",y,f);const b=W("hashed private key",s(y),2*f),E=w(b.slice(0,f)),B=b.slice(f,2*f),C=I(E),A=m.multiply(C),U=A.toRawBytes();return{head:E,prefix:B,scalar:C,point:A,pointBytes:U}}function tt(y=new Uint8Array,...f){const b=ye(...f);return I(s(h(b,W("context",y),!!o)))}const at=Er;return m._setWindowSize(8),{CURVE:e,getPublicKey:function ot(y){return O(y).pointBytes},sign:function st(y,f,b={}){y=W("message",y),o&&(y=o(y));const{prefix:E,scalar:B,pointBytes:C}=O(f),A=tt(b.context,E,y),U=m.multiply(A).toRawBytes(),T=z(A+tt(b.context,U,C,y)*B);return ft("signature.s",T,G,r),W("result",ye(U,Nt(T,n.BYTES)),2*n.BYTES)},verify:function Ct(y,f,b,E=at){const{context:B,zip215:C}=E,A=n.BYTES;y=W("signature",y,2*A),f=W("message",f),b=W("publicKey",b,A),void 0!==C&&Tt("zip215",C),o&&(f=o(f));const U=Et(y.slice(A,2*A));let _,T,$;try{_=d.fromHex(b,C),T=d.fromHex(y.slice(0,A),C),$=m.multiplyUnsafe(U)}catch{return!1}if(!C&&_.isSmallOrder())return!1;const R=tt(B,T.toRawBytes(),_.toRawBytes(),f);return T.add(_.multiplyUnsafe(R)).subtract($).clearCofactor().equals(d.ZERO)},ExtendedPoint:d,utils:{getExtendedPublicKey:O,randomPrivateKey:()=>a(n.BYTES),precompute:(y=8,f=d.BASE)=>(f._setWindowSize(y),f.multiply(BigInt(3)),f)}}}BigInt(0),BigInt(1);const kt=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Ue=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const xr=BigInt(1),Te=BigInt(2);BigInt(3);const Br=BigInt(5),Cr=BigInt(8);function mr(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function _r(t,e){const n=kt,r=H(e*e*e,n),s=function Ar(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),o=BigInt(80),s=kt,u=t*t%s*t%s,i=J(u,Te,s)*u%s,D=J(i,xr,s)*t%s,c=J(D,Br,s)*D%s,l=J(c,e,s)*c%s,p=J(l,n,s)*l%s,w=J(p,r,s)*p%s,h=J(w,o,s)*w%s,g=J(h,o,s)*w%s,S=J(g,e,s)*c%s;return{pow_p_5_8:J(S,Te,s)*t%s,b2:u}}(t*H(r*r*e,n)).pow_p_5_8;let a=H(t*r*s,n);const u=H(e*a*a,n),i=a,D=H(a*Ue,n),c=u===t,l=u===H(-t,n),p=u===H(-t*Ue,n);return c&&(a=i),(l||p)&&(a=D),((t,e)=>(H(t,e)&N)===N)(a,n)&&(a=H(-a,n)),{isValid:c||l,value:a}}const Sr=_e(kt,void 0,!0),Rt=yr({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Sr,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Cr,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Kn,randomBytes:he,adjustScalarBytes:mr,uvRatio:_r}),jt="EdDSA",Zt="JWT",ut=".",Dt="base64url",Gt="utf8",xt="utf8",Vt=":",Yt="did",Jt="key",dt="base58btc",Kt="z",Wt="K36",Ne=32;function Xt(t){return null!=globalThis.Buffer?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Le(t=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?Xt(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Oe(t,e){e||(e=t.reduce((o,s)=>o+s.length,0));const n=Le(e);let r=0;for(const o of t)n.set(o,r),r+=o.length;return Xt(n)}var Tr=function Ir(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var o=0;o<t.length;o++){var s=t.charAt(o),a=s.charCodeAt(0);if(255!==n[a])throw new TypeError(s+" is ambiguous");n[a]=o}var u=t.length,i=t.charAt(0),D=Math.log(u)/Math.log(256),c=Math.log(256)/Math.log(u);function p(h){if("string"!=typeof h)throw new TypeError("Expected String");if(0===h.length)return new Uint8Array;var g=0;if(" "!==h[g]){for(var S=0,v=0;h[g]===i;)S++,g++;for(var L=(h.length-g)*D+1>>>0,d=new Uint8Array(L);h[g];){var m=n[h.charCodeAt(g)];if(255===m)return;for(var F=0,q=L-1;(0!==m||F<v)&&-1!==q;q--,F++)m+=u*d[q]>>>0,d[q]=m%256>>>0,m=m/256>>>0;if(0!==m)throw new Error("Non-zero carry");v=F,g++}if(" "!==h[g]){for(var z=L-v;z!==L&&0===d[z];)z++;for(var I=new Uint8Array(S+(L-z)),O=S;z!==L;)I[O++]=d[z++];return I}}}return{encode:function l(h){if(h instanceof Uint8Array||(ArrayBuffer.isView(h)?h=new Uint8Array(h.buffer,h.byteOffset,h.byteLength):Array.isArray(h)&&(h=Uint8Array.from(h))),!(h instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===h.length)return"";for(var g=0,S=0,v=0,L=h.length;v!==L&&0===h[v];)v++,g++;for(var d=(L-v)*c+1>>>0,m=new Uint8Array(d);v!==L;){for(var F=h[v],q=0,z=d-1;(0!==F||q<S)&&-1!==z;z--,q++)F+=256*m[z]>>>0,m[z]=F%u>>>0,F=F/u>>>0;if(0!==F)throw new Error("Non-zero carry");S=q,v++}for(var I=d-S;I!==d&&0===m[I];)I++;for(var O=i.repeat(g);I<d;++I)O+=t.charAt(m[I]);return O},decodeUnsafe:p,decode:function w(h){var g=p(h);if(g)return g;throw new Error(`Non-${e} character`)}}};const He=t=>{if(t instanceof Uint8Array&&"Uint8Array"===t.constructor.name)return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")};class Lr{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Or{constructor(e,n,r){if(this.name=e,this.prefix=n,void 0===n.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return ze(this,e)}}class Hr{constructor(e){this.decoders=e}or(e){return ze(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ze=(t,e)=>new Hr({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class zr{constructor(e,n,r,o){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=o,this.encoder=new Lr(e,n,r),this.decoder=new Or(e,n,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Bt=({name:t,prefix:e,encode:n,decode:r})=>new zr(t,e,n,r),ht=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:o}=Tr(n,e);return Bt({prefix:t,name:e,encode:r,decode:s=>He(o(s))})},k=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>Bt({prefix:e,name:t,encode:o=>((t,e,n)=>{const r="="===e[e.length-1],o=(1<<n)-1;let s="",a=0,u=0;for(let i=0;i<t.length;++i)for(u=u<<8|t[i],a+=8;a>n;)a-=n,s+=e[o&u>>a];if(a&&(s+=e[o&u<<n-a]),r)for(;s.length*n&7;)s+="=";return s})(o,r,n),decode:o=>((t,e,n,r)=>{const o={};for(let c=0;c<e.length;++c)o[e[c]]=c;let s=t.length;for(;"="===t[s-1];)--s;const a=new Uint8Array(s*n/8|0);let u=0,i=0,D=0;for(let c=0;c<s;++c){const l=o[t[c]];if(void 0===l)throw new SyntaxError(`Non-${r} character`);i=i<<n|l,u+=n,u>=8&&(u-=8,a[D++]=255&i>>u)}if(u>=n||255&i<<8-u)throw new SyntaxError("Unexpected end of data");return a})(o,r,n,t)}),$r=Bt({prefix:"\0",name:"identity",encode:t=>(t=>(new TextDecoder).decode(t))(t),decode:t=>(t=>(new TextEncoder).encode(t))(t)});var kr=Object.freeze({__proto__:null,identity:$r});const Rr=k({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var jr=Object.freeze({__proto__:null,base2:Rr});const Zr=k({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Gr=Object.freeze({__proto__:null,base8:Zr});const Vr=ht({prefix:"9",name:"base10",alphabet:"0123456789"});var Yr=Object.freeze({__proto__:null,base10:Vr});const Jr=k({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Kr=k({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Wr=Object.freeze({__proto__:null,base16:Jr,base16upper:Kr});const Xr=k({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Pr=k({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Qr=k({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),to=k({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),eo=k({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),no=k({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ro=k({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),oo=k({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),so=k({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var io=Object.freeze({__proto__:null,base32:Xr,base32upper:Pr,base32pad:Qr,base32padupper:to,base32hex:eo,base32hexupper:no,base32hexpad:ro,base32hexpadupper:oo,base32z:so});const uo=ht({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),co=ht({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ao=Object.freeze({__proto__:null,base36:uo,base36upper:co});const fo=ht({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Do=ht({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ho=Object.freeze({__proto__:null,base58btc:fo,base58flickr:Do});const lo=k({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),bo=k({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),po=k({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),wo=k({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Eo=Object.freeze({__proto__:null,base64:lo,base64pad:bo,base64url:po,base64urlpad:wo});const Me=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),go=Me.reduce((t,e,n)=>(t[n]=e,t),[]),yo=Me.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);const Co=Bt({prefix:"🚀",name:"base256emoji",encode:function xo(t){return t.reduce((e,n)=>e+=go[n],"")},decode:function Bo(t){const e=[];for(const n of t){const r=yo[n.codePointAt(0)];if(void 0===r)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}});var Ao=Object.freeze({__proto__:null,base256emoji:Co}),mo=function $e(t,e,n){e=e||[];for(var r=n=n||0;t>=vo;)e[n++]=255&t|qe,t/=128;for(;t&So;)e[n++]=255&t|qe,t>>>=7;return e[n]=0|t,$e.bytes=n-r+1,e},qe=128,So=-128,vo=Math.pow(2,31);var Io=function Pt(t,r){var a,n=0,o=0,s=r=r||0,u=t.length;do{if(s>=u)throw Pt.bytes=0,new RangeError("Could not decode varint");a=t[s++],n+=o<28?(a&ke)<<o:(a&ke)*Math.pow(2,o),o+=7}while(a>=Uo);return Pt.bytes=s-r,n},Uo=128,ke=127;var To=Math.pow(2,7),Fo=Math.pow(2,14),No=Math.pow(2,21),Lo=Math.pow(2,28),Oo=Math.pow(2,35),Ho=Math.pow(2,42),zo=Math.pow(2,49),Mo=Math.pow(2,56),qo=Math.pow(2,63),Re={encode:mo,decode:Io,encodingLength:function(t){return t<To?1:t<Fo?2:t<No?3:t<Lo?4:t<Oo?5:t<Ho?6:t<zo?7:t<Mo?8:t<qo?9:10}};const je=(t,e,n=0)=>(Re.encode(t,e,n),e),Ze=t=>Re.encodingLength(t),Qt=(t,e)=>{const n=e.byteLength,r=Ze(t),o=r+Ze(n),s=new Uint8Array(o+n);return je(t,s,0),je(n,s,r),s.set(e,o),new Ro(t,n,e,s)};class Ro{constructor(e,n,r,o){this.code=e,this.size=n,this.digest=r,this.bytes=o}}const Ge=({name:t,code:e,encode:n})=>new jo(t,e,n);class jo{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?Qt(this.code,n):n.then(r=>Qt(this.code,r))}throw Error("Unknown type, must be binary type")}}const Ve=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Zo=Ge({name:"sha2-256",code:18,encode:Ve("SHA-256")}),Go=Ge({name:"sha2-512",code:19,encode:Ve("SHA-512")});Object.freeze({__proto__:null,sha256:Zo,sha512:Go});const Je=He,Ko={code:0,name:"identity",encode:Je,digest:t=>Qt(0,Je(t))};Object.freeze({__proto__:null,identity:Ko});new TextEncoder,new TextDecoder;const Ke={...kr,...jr,...Gr,...Yr,...Wr,...io,...ao,...ho,...Eo,...Ao};function We(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const Xe=We("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>(new TextEncoder).encode(t.substring(1))),te=We("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{const e=Le((t=t.substring(1)).length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),Pe={utf8:Xe,"utf-8":Xe,hex:Ke.base16,latin1:te,ascii:te,binary:te,...Ke};function ct(t,e="utf8"){const n=Pe[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?n.encoder.encode(t).substring(1):globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8")}function rt(t,e="utf8"){const n=Pe[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?n.decoder.decode(`${n.prefix}${t}`):Xt(globalThis.Buffer.from(t,"utf-8"))}function lt(t){return(0,_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__.j)(ct(rt(t,Dt),Gt))}function bt(t){return ct(rt((0,_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__.h)(t),Gt),Dt)}function Qe(t){const e=rt(Wt,dt),n=Kt+ct(Oe([e,t]),dt);return[Yt,Jt,n].join(Vt)}function en(t){return ct(t,Dt)}function sn(t){const e=t.split(ut),n=lt(e[0]),r=lt(e[1]),o=function nn(t){return rt(t,Dt)}(e[2]);return{header:n,payload:r,signature:o,data:rt(e.slice(0,2).join(ut),xt)}}function Po(t=he(Ne)){const e=Rt.getPublicKey(t);return{secretKey:Oe([t,e]),publicKey:e}}async function Qo(t,e,n,r,o=(0,_walletconnect_time__WEBPACK_IMPORTED_MODULE_0__.fromMiliseconds)(Date.now())){const s={alg:jt,typ:Zt},i={iss:Qe(r.publicKey),sub:t,aud:e,iat:o,exp:o+n},D=function rn(t){return rt([bt(t.header),bt(t.payload)].join(ut),xt)}({header:s,payload:i});return function on(t){return[bt(t.header),bt(t.payload),en(t.signature)].join(ut)}({header:s,payload:i,signature:Rt.sign(D,r.secretKey.slice(0,32))})}},"./node_modules/@walletconnect/safe-json/dist/esm/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{h:()=>safeJsonStringify,j:()=>safeJsonParse});const JSONStringify=data=>JSON.stringify(data,(_,value)=>"bigint"==typeof value?value.toString()+"n":value),JSONParse=json=>{const serializedData=json.replace(/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,'$1"$2n"$3');return JSON.parse(serializedData,(_,value)=>"string"==typeof value&&value.match(/^\d+n$/)?BigInt(value.substring(0,value.length-1)):value)};function safeJsonParse(value){if("string"!=typeof value)throw new Error("Cannot safe json parse value of type "+typeof value);try{return JSONParse(value)}catch(_a){return value}}function safeJsonStringify(value){return"string"==typeof value?value:JSONStringify(value)||""}},"./node_modules/@walletconnect/time/dist/cjs/constants/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/@walletconnect/time/node_modules/tslib/tslib.es6.js");tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/constants/misc.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/constants/time.js"),exports)},"./node_modules/@walletconnect/time/dist/cjs/constants/misc.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ONE_THOUSAND=exports.ONE_HUNDRED=void 0,exports.ONE_HUNDRED=100,exports.ONE_THOUSAND=1e3},"./node_modules/@walletconnect/time/dist/cjs/constants/time.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ONE_YEAR=exports.FOUR_WEEKS=exports.THREE_WEEKS=exports.TWO_WEEKS=exports.ONE_WEEK=exports.THIRTY_DAYS=exports.SEVEN_DAYS=exports.FIVE_DAYS=exports.THREE_DAYS=exports.ONE_DAY=exports.TWENTY_FOUR_HOURS=exports.TWELVE_HOURS=exports.SIX_HOURS=exports.THREE_HOURS=exports.ONE_HOUR=exports.SIXTY_MINUTES=exports.THIRTY_MINUTES=exports.TEN_MINUTES=exports.FIVE_MINUTES=exports.ONE_MINUTE=exports.SIXTY_SECONDS=exports.THIRTY_SECONDS=exports.TEN_SECONDS=exports.FIVE_SECONDS=exports.ONE_SECOND=void 0,exports.ONE_SECOND=1,exports.FIVE_SECONDS=5,exports.TEN_SECONDS=10,exports.THIRTY_SECONDS=30,exports.SIXTY_SECONDS=60,exports.ONE_MINUTE=exports.SIXTY_SECONDS,exports.FIVE_MINUTES=5*exports.ONE_MINUTE,exports.TEN_MINUTES=10*exports.ONE_MINUTE,exports.THIRTY_MINUTES=30*exports.ONE_MINUTE,exports.SIXTY_MINUTES=60*exports.ONE_MINUTE,exports.ONE_HOUR=exports.SIXTY_MINUTES,exports.THREE_HOURS=3*exports.ONE_HOUR,exports.SIX_HOURS=6*exports.ONE_HOUR,exports.TWELVE_HOURS=12*exports.ONE_HOUR,exports.TWENTY_FOUR_HOURS=24*exports.ONE_HOUR,exports.ONE_DAY=exports.TWENTY_FOUR_HOURS,exports.THREE_DAYS=3*exports.ONE_DAY,exports.FIVE_DAYS=5*exports.ONE_DAY,exports.SEVEN_DAYS=7*exports.ONE_DAY,exports.THIRTY_DAYS=30*exports.ONE_DAY,exports.ONE_WEEK=exports.SEVEN_DAYS,exports.TWO_WEEKS=2*exports.ONE_WEEK,exports.THREE_WEEKS=3*exports.ONE_WEEK,exports.FOUR_WEEKS=4*exports.ONE_WEEK,exports.ONE_YEAR=365*exports.ONE_DAY},"./node_modules/@walletconnect/time/dist/cjs/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/@walletconnect/time/node_modules/tslib/tslib.es6.js");tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/utils/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/watch.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/types/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/constants/index.js"),exports)},"./node_modules/@walletconnect/time/dist/cjs/types/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__("./node_modules/@walletconnect/time/node_modules/tslib/tslib.es6.js").__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/types/watch.js"),exports)},"./node_modules/@walletconnect/time/dist/cjs/types/watch.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.IWatch=void 0;exports.IWatch=class IWatch{}},"./node_modules/@walletconnect/time/dist/cjs/utils/convert.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromMiliseconds=exports.toMiliseconds=void 0;const constants_1=__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/constants/index.js");exports.toMiliseconds=function toMiliseconds(seconds){return seconds*constants_1.ONE_THOUSAND},exports.fromMiliseconds=function fromMiliseconds(miliseconds){return Math.floor(miliseconds/constants_1.ONE_THOUSAND)}},"./node_modules/@walletconnect/time/dist/cjs/utils/delay.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.delay=void 0,exports.delay=function delay(timeout){return new Promise(resolve=>{setTimeout(()=>{resolve(!0)},timeout)})}},"./node_modules/@walletconnect/time/dist/cjs/utils/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/@walletconnect/time/node_modules/tslib/tslib.es6.js");tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/utils/delay.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/utils/convert.js"),exports)},"./node_modules/@walletconnect/time/dist/cjs/watch.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Watch=void 0;class Watch{constructor(){this.timestamps=new Map}start(label){if(this.timestamps.has(label))throw new Error(`Watch already started for label: ${label}`);this.timestamps.set(label,{started:Date.now()})}stop(label){const timestamp=this.get(label);if(void 0!==timestamp.elapsed)throw new Error(`Watch already stopped for label: ${label}`);const elapsed=Date.now()-timestamp.started;this.timestamps.set(label,{started:timestamp.started,elapsed})}get(label){const timestamp=this.timestamps.get(label);if(void 0===timestamp)throw new Error(`No timestamp found for label: ${label}`);return timestamp}elapsed(label){const timestamp=this.get(label);return timestamp.elapsed||Date.now()-timestamp.started}}exports.Watch=Watch,exports.default=Watch},"./node_modules/@walletconnect/time/node_modules/tslib/tslib.es6.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{__assign:()=>__assign,__asyncDelegator:()=>__asyncDelegator,__asyncGenerator:()=>__asyncGenerator,__asyncValues:()=>__asyncValues,__await:()=>__await,__awaiter:()=>__awaiter,__classPrivateFieldGet:()=>__classPrivateFieldGet,__classPrivateFieldSet:()=>__classPrivateFieldSet,__createBinding:()=>__createBinding,__decorate:()=>__decorate,__exportStar:()=>__exportStar,__extends:()=>__extends,__generator:()=>__generator,__importDefault:()=>__importDefault,__importStar:()=>__importStar,__makeTemplateObject:()=>__makeTemplateObject,__metadata:()=>__metadata,__param:()=>__param,__read:()=>__read,__rest:()=>__rest,__spread:()=>__spread,__spreadArrays:()=>__spreadArrays,__values:()=>__values});var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},extendStatics(d,b)};function __extends(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return __assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}function __decorate(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r}function __param(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}}function __metadata(metadataKey,metadataValue){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(metadataKey,metadataValue)}function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}function __generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}function __createBinding(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}function __exportStar(m,exports){for(var p in m)"default"===p||exports.hasOwnProperty(p)||(exports[p]=m[p])}function __values(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar}function __spreadArrays(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;var r=Array(s),k=0;for(i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r}function __await(v){return this instanceof __await?(this.v=v,this):new __await(v)}function __asyncGenerator(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,g=generator.apply(thisArg,_arguments||[]),q=[];return i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i;function verb(n){g[n]&&(i[n]=function(v){return new Promise(function(a,b){q.push([n,v,a,b])>1||resume(n,v)})})}function resume(n,v){try{!function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}(g[n](v))}catch(e){settle(q[0][3],e)}}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){f(v),q.shift(),q.length&&resume(q[0][0],q[0][1])}}function __asyncDelegator(o){var i,p;return i={},verb("next"),verb("throw",function(e){throw e}),verb("return"),i[Symbol.iterator]=function(){return this},i;function verb(n,f){i[n]=o[n]?function(v){return(p=!p)?{value:__await(o[n](v)),done:"return"===n}:f?f(v):v}:f}}function __asyncValues(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,m=o[Symbol.asyncIterator];return m?m.call(o):(o=__values(o),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise(function(resolve,reject){(function settle(resolve,reject,d,v){Promise.resolve(v).then(function(v){resolve({value:v,done:d})},reject)})(resolve,reject,(v=o[n](v)).done,v.value)})}}}function __makeTemplateObject(cooked,raw){return Object.defineProperty?Object.defineProperty(cooked,"raw",{value:raw}):cooked.raw=raw,cooked}function __importStar(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result}function __importDefault(mod){return mod&&mod.__esModule?mod:{default:mod}}function __classPrivateFieldGet(receiver,privateMap){if(!privateMap.has(receiver))throw new TypeError("attempted to get private field on non-instance");return privateMap.get(receiver)}function __classPrivateFieldSet(receiver,privateMap,value){if(!privateMap.has(receiver))throw new TypeError("attempted to set private field on non-instance");return privateMap.set(receiver,value),value}},"./node_modules/@walletconnect/window-getters/dist/cjs/index.js":(__unused_webpack_module,exports)=>{"use strict";function getFromWindow(name){let res;return"undefined"!=typeof window&&void 0!==window[name]&&(res=window[name]),res}function getFromWindowOrThrow(name){const res=getFromWindow(name);if(!res)throw new Error(`${name} is not defined in Window`);return res}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getLocalStorage=exports.getLocalStorageOrThrow=exports.getCrypto=exports.getCryptoOrThrow=exports.getLocation=exports.getLocationOrThrow=exports.getNavigator=exports.getNavigatorOrThrow=exports.getDocument=exports.getDocumentOrThrow=exports.getFromWindowOrThrow=exports.getFromWindow=void 0,exports.getFromWindow=getFromWindow,exports.getFromWindowOrThrow=getFromWindowOrThrow,exports.getDocumentOrThrow=function getDocumentOrThrow(){return getFromWindowOrThrow("document")},exports.getDocument=function getDocument(){return getFromWindow("document")},exports.getNavigatorOrThrow=function getNavigatorOrThrow(){return getFromWindowOrThrow("navigator")},exports.getNavigator=function getNavigator(){return getFromWindow("navigator")},exports.getLocationOrThrow=function getLocationOrThrow(){return getFromWindowOrThrow("location")},exports.getLocation=function getLocation(){return getFromWindow("location")},exports.getCryptoOrThrow=function getCryptoOrThrow(){return getFromWindowOrThrow("crypto")},exports.getCrypto=function getCrypto(){return getFromWindow("crypto")},exports.getLocalStorageOrThrow=function getLocalStorageOrThrow(){return getFromWindowOrThrow("localStorage")},exports.getLocalStorage=function getLocalStorage(){return getFromWindow("localStorage")}},"./node_modules/@walletconnect/window-metadata/dist/cjs/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";exports.g=void 0;const window_getters_1=__webpack_require__("./node_modules/@walletconnect/window-getters/dist/cjs/index.js");exports.g=function getWindowMetadata(){let doc,loc;try{doc=window_getters_1.getDocumentOrThrow(),loc=window_getters_1.getLocationOrThrow()}catch(e){return null}function getWindowMetadataOfAny(...args){const metaTags=doc.getElementsByTagName("meta");for(let i=0;i<metaTags.length;i++){const tag=metaTags[i],attributes=["itemprop","property","name"].map(target=>tag.getAttribute(target)).filter(attr=>!!attr&&args.includes(attr));if(attributes.length&&attributes){const content=tag.getAttribute("content");if(content)return content}}return""}const name=function getName(){let name=getWindowMetadataOfAny("name","og:site_name","og:title","twitter:title");return name||(name=doc.title),name}();return{description:function getDescription(){return getWindowMetadataOfAny("description","og:description","twitter:description","keywords")}(),url:loc.origin,icons:function getIcons(){const links=doc.getElementsByTagName("link"),icons=[];for(let i=0;i<links.length;i++){const link=links[i],rel=link.getAttribute("rel");if(rel&&rel.toLowerCase().indexOf("icon")>-1){const href=link.getAttribute("href");if(href)if(-1===href.toLowerCase().indexOf("https:")&&-1===href.toLowerCase().indexOf("http:")&&0!==href.indexOf("//")){let absoluteHref=loc.protocol+"//"+loc.host;if(0===href.indexOf("/"))absoluteHref+=href;else{const path=loc.pathname.split("/");path.pop();absoluteHref+=path.join("/")+"/"+href}icons.push(absoluteHref)}else if(0===href.indexOf("//")){const absoluteUrl=loc.protocol+href;icons.push(absoluteUrl)}else icons.push(href)}}return icons}(),name}}},"./node_modules/bs58/src/esm/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>src_esm});const esm=function base(ALPHABET){if(ALPHABET.length>=255)throw new TypeError("Alphabet too long");const BASE_MAP=new Uint8Array(256);for(let j=0;j<BASE_MAP.length;j++)BASE_MAP[j]=255;for(let i=0;i<ALPHABET.length;i++){const x=ALPHABET.charAt(i),xc=x.charCodeAt(0);if(255!==BASE_MAP[xc])throw new TypeError(x+" is ambiguous");BASE_MAP[xc]=i}const BASE=ALPHABET.length,LEADER=ALPHABET.charAt(0),FACTOR=Math.log(BASE)/Math.log(256),iFACTOR=Math.log(256)/Math.log(BASE);function decodeUnsafe(source){if("string"!=typeof source)throw new TypeError("Expected String");if(0===source.length)return new Uint8Array;let psz=0,zeroes=0,length=0;for(;source[psz]===LEADER;)zeroes++,psz++;const size=(source.length-psz)*FACTOR+1>>>0,b256=new Uint8Array(size);for(;psz<source.length;){const charCode=source.charCodeAt(psz);if(charCode>255)return;let carry=BASE_MAP[charCode];if(255===carry)return;let i=0;for(let it3=size-1;(0!==carry||i<length)&&-1!==it3;it3--,i++)carry+=BASE*b256[it3]>>>0,b256[it3]=carry%256>>>0,carry=carry/256>>>0;if(0!==carry)throw new Error("Non-zero carry");length=i,psz++}let it4=size-length;for(;it4!==size&&0===b256[it4];)it4++;const vch=new Uint8Array(zeroes+(size-it4));let j=zeroes;for(;it4!==size;)vch[j++]=b256[it4++];return vch}return{encode:function encode(source){if(source instanceof Uint8Array||(ArrayBuffer.isView(source)?source=new Uint8Array(source.buffer,source.byteOffset,source.byteLength):Array.isArray(source)&&(source=Uint8Array.from(source))),!(source instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===source.length)return"";let zeroes=0,length=0,pbegin=0;const pend=source.length;for(;pbegin!==pend&&0===source[pbegin];)pbegin++,zeroes++;const size=(pend-pbegin)*iFACTOR+1>>>0,b58=new Uint8Array(size);for(;pbegin!==pend;){let carry=source[pbegin],i=0;for(let it1=size-1;(0!==carry||i<length)&&-1!==it1;it1--,i++)carry+=256*b58[it1]>>>0,b58[it1]=carry%BASE>>>0,carry=carry/BASE>>>0;if(0!==carry)throw new Error("Non-zero carry");length=i,pbegin++}let it2=size-length;for(;it2!==size&&0===b58[it2];)it2++;let str=LEADER.repeat(zeroes);for(;it2<size;++it2)str+=ALPHABET.charAt(b58[it2]);return str},decodeUnsafe,decode:function decode(string){const buffer=decodeUnsafe(string);if(buffer)return buffer;throw new Error("Non-base"+BASE+" character")}}};const src_esm=esm("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},"./node_modules/detect-browser/es/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{o0:()=>detect});var process=__webpack_require__("./node_modules/process/browser.js"),__spreadArray=function(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))},BrowserInfo=function BrowserInfo(name,version,os){this.name=name,this.version=version,this.os=os,this.type="browser"},NodeInfo=function NodeInfo(version){this.version=version,this.type="node",this.name="node",this.os=process.platform},SearchBotDeviceInfo=function SearchBotDeviceInfo(name,version,os,bot){this.name=name,this.version=version,this.os=os,this.bot=bot,this.type="bot-device"},BotInfo=function BotInfo(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},ReactNativeInfo=function ReactNativeInfo(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,REQUIRED_VERSION_PARTS=3,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect(userAgent){return userAgent?parseUserAgent(userAgent):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new ReactNativeInfo:"undefined"!=typeof navigator?parseUserAgent(navigator.userAgent):function getNodeVersion(){return void 0!==process&&process.version?new NodeInfo(process.version.slice(1)):null}()}function matchUserAgent(ua){return""!==ua&&userAgentRules.reduce(function(matched,_a){var browser=_a[0],regex=_a[1];if(matched)return matched;var uaMatch=regex.exec(ua);return!!uaMatch&&[browser,uaMatch]},!1)}function parseUserAgent(ua){var matchedRule=matchUserAgent(ua);if(!matchedRule)return null;var name=matchedRule[0],match=matchedRule[1];if("searchbot"===name)return new BotInfo;var versionParts=match[1]&&match[1].split(".").join("_").split("_").slice(0,3);versionParts?versionParts.length<REQUIRED_VERSION_PARTS&&(versionParts=__spreadArray(__spreadArray([],versionParts,!0),function createVersionParts(count){for(var output=[],ii=0;ii<count;ii++)output.push("0");return output}(REQUIRED_VERSION_PARTS-versionParts.length),!0)):versionParts=[];var version=versionParts.join("."),os=function detectOS(ua){for(var ii=0,count=operatingSystemRules.length;ii<count;ii++){var _a=operatingSystemRules[ii],os=_a[0];if(_a[1].exec(ua))return os}return null}(ua),searchBotMatch=SEARCHBOT_OS_REGEX.exec(ua);return searchBotMatch&&searchBotMatch[1]?new SearchBotDeviceInfo(name,version,os,searchBotMatch[1]):new BrowserInfo(name,version,os)}},"./node_modules/pino/browser.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";const format=__webpack_require__("./node_modules/quick-format-unescaped/index.js");module.exports=pino;const _console=function pfGlobalThisOrFallback(){function defd(o){return void 0!==o&&o}try{return"undefined"!=typeof globalThis||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch(e){return defd(self)||defd(window)||defd(this)||{}}}().console||{},stdSerializers={mapHttpRequest:mock,mapHttpResponse:mock,wrapRequestSerializer:passthrough,wrapResponseSerializer:passthrough,wrapErrorSerializer:passthrough,req:mock,res:mock,err:function asErrValue(err){const obj={type:err.constructor.name,msg:err.message,stack:err.stack};for(const key in err)void 0===obj[key]&&(obj[key]=err[key]);return obj}};function pino(opts){(opts=opts||{}).browser=opts.browser||{};const transmit=opts.browser.transmit;if(transmit&&"function"!=typeof transmit.send)throw Error("pino: transmit option must have a send function");const proto=opts.browser.write||_console;opts.browser.write&&(opts.browser.asObject=!0);const serializers=opts.serializers||{},serialize=function shouldSerialize(serialize,serializers){if(Array.isArray(serialize))return serialize.filter(function(k){return"!stdSerializers.err"!==k});return!0===serialize&&Object.keys(serializers)}(opts.browser.serialize,serializers);let stdErrSerialize=opts.browser.serialize;Array.isArray(opts.browser.serialize)&&opts.browser.serialize.indexOf("!stdSerializers.err")>-1&&(stdErrSerialize=!1);"function"==typeof proto&&(proto.error=proto.fatal=proto.warn=proto.info=proto.debug=proto.trace=proto),!1===opts.enabled&&(opts.level="silent");const level=opts.level||"info",logger=Object.create(proto);logger.log||(logger.log=noop),Object.defineProperty(logger,"levelVal",{get:function getLevelVal(){return"silent"===this.level?1/0:this.levels.values[this.level]}}),Object.defineProperty(logger,"level",{get:function getLevel(){return this._level},set:function setLevel(level){if("silent"!==level&&!this.levels.values[level])throw Error("unknown level "+level);this._level=level,set(setOpts,logger,"error","log"),set(setOpts,logger,"fatal","error"),set(setOpts,logger,"warn","error"),set(setOpts,logger,"info","log"),set(setOpts,logger,"debug","log"),set(setOpts,logger,"trace","log")}});const setOpts={transmit,serialize,asObject:opts.browser.asObject,levels:["error","fatal","warn","info","debug","trace"],timestamp:getTimeFunction(opts)};return logger.levels=pino.levels,logger.level=level,logger.setMaxListeners=logger.getMaxListeners=logger.emit=logger.addListener=logger.on=logger.prependListener=logger.once=logger.prependOnceListener=logger.removeListener=logger.removeAllListeners=logger.listeners=logger.listenerCount=logger.eventNames=logger.write=logger.flush=noop,logger.serializers=serializers,logger._serialize=serialize,logger._stdErrSerialize=stdErrSerialize,logger.child=function child(bindings,childOptions){if(!bindings)throw new Error("missing bindings for child Pino");childOptions=childOptions||{},serialize&&bindings.serializers&&(childOptions.serializers=bindings.serializers);const childOptionsSerializers=childOptions.serializers;if(serialize&&childOptionsSerializers){var childSerializers=Object.assign({},serializers,childOptionsSerializers),childSerialize=!0===opts.browser.serialize?Object.keys(childSerializers):serialize;delete bindings.serializers,applySerializers([bindings],childSerialize,childSerializers,this._stdErrSerialize)}function Child(parent){this._childLevel=1+(0|parent._childLevel),this.error=bind(parent,bindings,"error"),this.fatal=bind(parent,bindings,"fatal"),this.warn=bind(parent,bindings,"warn"),this.info=bind(parent,bindings,"info"),this.debug=bind(parent,bindings,"debug"),this.trace=bind(parent,bindings,"trace"),childSerializers&&(this.serializers=childSerializers,this._serialize=childSerialize),transmit&&(this._logEvent=createLogEventShape([].concat(parent._logEvent.bindings,bindings)))}return Child.prototype=this,new Child(this)},transmit&&(logger._logEvent=createLogEventShape()),logger}function set(opts,logger,level,fallback){const proto=Object.getPrototypeOf(logger);logger[level]=logger.levelVal>logger.levels.values[level]?noop:proto[level]?proto[level]:_console[level]||_console[fallback]||noop,function wrap(opts,logger,level){if(!opts.transmit&&logger[level]===noop)return;logger[level]=(write=logger[level],function LOG(){const ts=opts.timestamp(),args=new Array(arguments.length),proto=Object.getPrototypeOf&&Object.getPrototypeOf(this)===_console?_console:this;for(var i=0;i<args.length;i++)args[i]=arguments[i];if(opts.serialize&&!opts.asObject&&applySerializers(args,this._serialize,this.serializers,this._stdErrSerialize),opts.asObject?write.call(proto,function asObject(logger,level,args,ts){logger._serialize&&applySerializers(args,logger._serialize,logger.serializers,logger._stdErrSerialize);const argsCloned=args.slice();let msg=argsCloned[0];const o={};ts&&(o.time=ts),o.level=pino.levels.values[level];let lvl=1+(0|logger._childLevel);if(lvl<1&&(lvl=1),null!==msg&&"object"==typeof msg){for(;lvl--&&"object"==typeof argsCloned[0];)Object.assign(o,argsCloned.shift());msg=argsCloned.length?format(argsCloned.shift(),argsCloned):void 0}else"string"==typeof msg&&(msg=format(argsCloned.shift(),argsCloned));return void 0!==msg&&(o.msg=msg),o}(this,level,args,ts)):write.apply(proto,args),opts.transmit){const transmitLevel=opts.transmit.level||logger.level,transmitValue=pino.levels.values[transmitLevel],methodValue=pino.levels.values[level];if(methodValue<transmitValue)return;!function transmit(logger,opts,args){const send=opts.send,ts=opts.ts,methodLevel=opts.methodLevel,methodValue=opts.methodValue,val=opts.val,bindings=logger._logEvent.bindings;applySerializers(args,logger._serialize||Object.keys(logger.serializers),logger.serializers,void 0===logger._stdErrSerialize||logger._stdErrSerialize),logger._logEvent.ts=ts,logger._logEvent.messages=args.filter(function(arg){return-1===bindings.indexOf(arg)}),logger._logEvent.level.label=methodLevel,logger._logEvent.level.value=methodValue,send(methodLevel,logger._logEvent,val),logger._logEvent=createLogEventShape(bindings)}(this,{ts,methodLevel:level,methodValue,transmitLevel,transmitValue:pino.levels.values[opts.transmit.level||logger.level],send:opts.transmit.send,val:logger.levelVal},args)}});var write}(opts,logger,level)}function applySerializers(args,serialize,serializers,stdErrSerialize){for(const i in args)if(stdErrSerialize&&args[i]instanceof Error)args[i]=pino.stdSerializers.err(args[i]);else if("object"==typeof args[i]&&!Array.isArray(args[i]))for(const k in args[i])serialize&&serialize.indexOf(k)>-1&&k in serializers&&(args[i][k]=serializers[k](args[i][k]))}function bind(parent,bindings,level){return function(){const args=new Array(1+arguments.length);args[0]=bindings;for(var i=1;i<args.length;i++)args[i]=arguments[i-1];return parent[level].apply(this,args)}}function createLogEventShape(bindings){return{ts:0,messages:[],bindings:bindings||[],level:{label:"",value:0}}}function getTimeFunction(opts){return"function"==typeof opts.timestamp?opts.timestamp:!1===opts.timestamp?nullTime:epochTime}function mock(){return{}}function passthrough(a){return a}function noop(){}function nullTime(){return!1}function epochTime(){return Date.now()}pino.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},pino.stdSerializers=stdSerializers,pino.stdTimeFunctions=Object.assign({},{nullTime,epochTime,unixTime:function unixTime(){return Math.round(Date.now()/1e3)},isoTime:function isoTime(){return new Date(Date.now()).toISOString()}})},"./node_modules/quick-format-unescaped/index.js":module=>{"use strict";function tryStringify(o){try{return JSON.stringify(o)}catch(e){return'"[Circular]"'}}module.exports=function format(f,args,opts){var ss=opts&&opts.stringify||tryStringify;if("object"==typeof f&&null!==f){var len=args.length+1;if(1===len)return f;var objects=new Array(len);objects[0]=ss(f);for(var index=1;index<len;index++)objects[index]=ss(args[index]);return objects.join(" ")}if("string"!=typeof f)return f;var argLen=args.length;if(0===argLen)return f;for(var str="",a=0,lastPos=-1,flen=f&&f.length||0,i=0;i<flen;){if(37===f.charCodeAt(i)&&i+1<flen){switch(lastPos=lastPos>-1?lastPos:0,f.charCodeAt(i+1)){case 100:case 102:if(a>=argLen)break;if(null==args[a])break;lastPos<i&&(str+=f.slice(lastPos,i)),str+=Number(args[a]),lastPos=i+2,i++;break;case 105:if(a>=argLen)break;if(null==args[a])break;lastPos<i&&(str+=f.slice(lastPos,i)),str+=Math.floor(Number(args[a])),lastPos=i+2,i++;break;case 79:case 111:case 106:if(a>=argLen)break;if(void 0===args[a])break;lastPos<i&&(str+=f.slice(lastPos,i));var type=typeof args[a];if("string"===type){str+="'"+args[a]+"'",lastPos=i+2,i++;break}if("function"===type){str+=args[a].name||"<anonymous>",lastPos=i+2,i++;break}str+=ss(args[a]),lastPos=i+2,i++;break;case 115:if(a>=argLen)break;lastPos<i&&(str+=f.slice(lastPos,i)),str+=String(args[a]),lastPos=i+2,i++;break;case 37:lastPos<i&&(str+=f.slice(lastPos,i)),str+="%",lastPos=i+2,i++,a--}++a}++i}if(-1===lastPos)return f;lastPos<flen&&(str+=f.slice(lastPos));return str}},"./node_modules/uint8arrays/esm/src/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{xW:()=>concat,sH:()=>from_string_fromString,dI:()=>to_string_toString});var identity_namespaceObject={};__webpack_require__.r(identity_namespaceObject),__webpack_require__.d(identity_namespaceObject,{identity:()=>identity});var base2_namespaceObject={};__webpack_require__.r(base2_namespaceObject),__webpack_require__.d(base2_namespaceObject,{base2:()=>base2});var base8_namespaceObject={};__webpack_require__.r(base8_namespaceObject),__webpack_require__.d(base8_namespaceObject,{base8:()=>base8});var base10_namespaceObject={};__webpack_require__.r(base10_namespaceObject),__webpack_require__.d(base10_namespaceObject,{base10:()=>base10});var base16_namespaceObject={};__webpack_require__.r(base16_namespaceObject),__webpack_require__.d(base16_namespaceObject,{base16:()=>base16,base16upper:()=>base16upper});var base32_namespaceObject={};__webpack_require__.r(base32_namespaceObject),__webpack_require__.d(base32_namespaceObject,{base32:()=>base32,base32hex:()=>base32hex,base32hexpad:()=>base32hexpad,base32hexpadupper:()=>base32hexpadupper,base32hexupper:()=>base32hexupper,base32pad:()=>base32pad,base32padupper:()=>base32padupper,base32upper:()=>base32upper,base32z:()=>base32z});var base36_namespaceObject={};__webpack_require__.r(base36_namespaceObject),__webpack_require__.d(base36_namespaceObject,{base36:()=>base36,base36upper:()=>base36upper});var base58_namespaceObject={};__webpack_require__.r(base58_namespaceObject),__webpack_require__.d(base58_namespaceObject,{base58btc:()=>base58btc,base58flickr:()=>base58flickr});var base64_namespaceObject={};__webpack_require__.r(base64_namespaceObject),__webpack_require__.d(base64_namespaceObject,{base64:()=>base64,base64pad:()=>base64pad,base64url:()=>base64url,base64urlpad:()=>base64urlpad});var base256emoji_namespaceObject={};__webpack_require__.r(base256emoji_namespaceObject),__webpack_require__.d(base256emoji_namespaceObject,{base256emoji:()=>base256emoji});var sha2_browser_namespaceObject={};__webpack_require__.r(sha2_browser_namespaceObject),__webpack_require__.d(sha2_browser_namespaceObject,{sha256:()=>sha256,sha512:()=>sha512});var hashes_identity_namespaceObject={};__webpack_require__.r(hashes_identity_namespaceObject),__webpack_require__.d(hashes_identity_namespaceObject,{identity:()=>identity_identity});var raw_namespaceObject={};__webpack_require__.r(raw_namespaceObject),__webpack_require__.d(raw_namespaceObject,{code:()=>raw_code,decode:()=>raw_decode,encode:()=>raw_encode,name:()=>raw_name});var json_namespaceObject={};function allocUnsafe(size=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(size):new Uint8Array(size)}function concat(arrays,length){length||(length=arrays.reduce((acc,curr)=>acc+curr.length,0));const output=allocUnsafe(length);let offset=0;for(const arr of arrays)output.set(arr,offset),offset+=arr.length;return output}__webpack_require__.r(json_namespaceObject),__webpack_require__.d(json_namespaceObject,{code:()=>json_code,decode:()=>json_decode,encode:()=>json_encode,name:()=>json_name});var src=function base(ALPHABET,name){if(ALPHABET.length>=255)throw new TypeError("Alphabet too long");for(var BASE_MAP=new Uint8Array(256),j=0;j<BASE_MAP.length;j++)BASE_MAP[j]=255;for(var i=0;i<ALPHABET.length;i++){var x=ALPHABET.charAt(i),xc=x.charCodeAt(0);if(255!==BASE_MAP[xc])throw new TypeError(x+" is ambiguous");BASE_MAP[xc]=i}var BASE=ALPHABET.length,LEADER=ALPHABET.charAt(0),FACTOR=Math.log(BASE)/Math.log(256),iFACTOR=Math.log(256)/Math.log(BASE);function decodeUnsafe(source){if("string"!=typeof source)throw new TypeError("Expected String");if(0===source.length)return new Uint8Array;var psz=0;if(" "!==source[psz]){for(var zeroes=0,length=0;source[psz]===LEADER;)zeroes++,psz++;for(var size=(source.length-psz)*FACTOR+1>>>0,b256=new Uint8Array(size);source[psz];){var carry=BASE_MAP[source.charCodeAt(psz)];if(255===carry)return;for(var i=0,it3=size-1;(0!==carry||i<length)&&-1!==it3;it3--,i++)carry+=BASE*b256[it3]>>>0,b256[it3]=carry%256>>>0,carry=carry/256>>>0;if(0!==carry)throw new Error("Non-zero carry");length=i,psz++}if(" "!==source[psz]){for(var it4=size-length;it4!==size&&0===b256[it4];)it4++;for(var vch=new Uint8Array(zeroes+(size-it4)),j=zeroes;it4!==size;)vch[j++]=b256[it4++];return vch}}}return{encode:function encode(source){if(source instanceof Uint8Array||(ArrayBuffer.isView(source)?source=new Uint8Array(source.buffer,source.byteOffset,source.byteLength):Array.isArray(source)&&(source=Uint8Array.from(source))),!(source instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===source.length)return"";for(var zeroes=0,length=0,pbegin=0,pend=source.length;pbegin!==pend&&0===source[pbegin];)pbegin++,zeroes++;for(var size=(pend-pbegin)*iFACTOR+1>>>0,b58=new Uint8Array(size);pbegin!==pend;){for(var carry=source[pbegin],i=0,it1=size-1;(0!==carry||i<length)&&-1!==it1;it1--,i++)carry+=256*b58[it1]>>>0,b58[it1]=carry%BASE>>>0,carry=carry/BASE>>>0;if(0!==carry)throw new Error("Non-zero carry");length=i,pbegin++}for(var it2=size-length;it2!==size&&0===b58[it2];)it2++;for(var str=LEADER.repeat(zeroes);it2<size;++it2)str+=ALPHABET.charAt(b58[it2]);return str},decodeUnsafe,decode:function decode(string){var buffer=decodeUnsafe(string);if(buffer)return buffer;throw new Error(`Non-${name} character`)}}};const base_x=src,coerce=(new Uint8Array(0),o=>{if(o instanceof Uint8Array&&"Uint8Array"===o.constructor.name)return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")});class Encoder{constructor(name,prefix,baseEncode){this.name=name,this.prefix=prefix,this.baseEncode=baseEncode}encode(bytes){if(bytes instanceof Uint8Array)return`${this.prefix}${this.baseEncode(bytes)}`;throw Error("Unknown type, must be binary type")}}class Decoder{constructor(name,prefix,baseDecode){if(this.name=name,this.prefix=prefix,void 0===prefix.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=prefix.codePointAt(0),this.baseDecode=baseDecode}decode(text){if("string"==typeof text){if(text.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(text)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(text.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(decoder){return or(this,decoder)}}class ComposedDecoder{constructor(decoders){this.decoders=decoders}or(decoder){return or(this,decoder)}decode(input){const prefix=input[0],decoder=this.decoders[prefix];if(decoder)return decoder.decode(input);throw RangeError(`Unable to decode multibase string ${JSON.stringify(input)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const or=(left,right)=>new ComposedDecoder({...left.decoders||{[left.prefix]:left},...right.decoders||{[right.prefix]:right}});class Codec{constructor(name,prefix,baseEncode,baseDecode){this.name=name,this.prefix=prefix,this.baseEncode=baseEncode,this.baseDecode=baseDecode,this.encoder=new Encoder(name,prefix,baseEncode),this.decoder=new Decoder(name,prefix,baseDecode)}encode(input){return this.encoder.encode(input)}decode(input){return this.decoder.decode(input)}}const from=({name,prefix,encode,decode})=>new Codec(name,prefix,encode,decode),baseX=({prefix,name,alphabet})=>{const{encode,decode}=base_x(alphabet,name);return from({prefix,name,encode,decode:text=>coerce(decode(text))})},rfc4648=({name,prefix,bitsPerChar,alphabet})=>from({prefix,name,encode:input=>((data,alphabet,bitsPerChar)=>{const pad="="===alphabet[alphabet.length-1],mask=(1<<bitsPerChar)-1;let out="",bits=0,buffer=0;for(let i=0;i<data.length;++i)for(buffer=buffer<<8|data[i],bits+=8;bits>bitsPerChar;)bits-=bitsPerChar,out+=alphabet[mask&buffer>>bits];if(bits&&(out+=alphabet[mask&buffer<<bitsPerChar-bits]),pad)for(;out.length*bitsPerChar&7;)out+="=";return out})(input,alphabet,bitsPerChar),decode:input=>((string,alphabet,bitsPerChar,name)=>{const codes={};for(let i=0;i<alphabet.length;++i)codes[alphabet[i]]=i;let end=string.length;for(;"="===string[end-1];)--end;const out=new Uint8Array(end*bitsPerChar/8|0);let bits=0,buffer=0,written=0;for(let i=0;i<end;++i){const value=codes[string[i]];if(void 0===value)throw new SyntaxError(`Non-${name} character`);buffer=buffer<<bitsPerChar|value,bits+=bitsPerChar,bits>=8&&(bits-=8,out[written++]=255&buffer>>bits)}if(bits>=bitsPerChar||255&buffer<<8-bits)throw new SyntaxError("Unexpected end of data");return out})(input,alphabet,bitsPerChar,name)}),identity=from({prefix:"\0",name:"identity",encode:buf=>{return b=buf,(new TextDecoder).decode(b);var b},decode:str=>(str=>(new TextEncoder).encode(str))(str)}),base2=rfc4648({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base8=rfc4648({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base10=baseX({prefix:"9",name:"base10",alphabet:"0123456789"}),base16=rfc4648({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base32=rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z=rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base36=baseX({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base58btc=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base64=rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url=rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),alphabet=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars=alphabet.reduce((p,c,i)=>(p[i]=c,p),[]),alphabetCharsToBytes=alphabet.reduce((p,c,i)=>(p[c.codePointAt(0)]=i,p),[]);const base256emoji=from({prefix:"🚀",name:"base256emoji",encode:function base256emoji_encode(data){return data.reduce((p,c)=>p+=alphabetBytesToChars[c],"")},decode:function base256emoji_decode(str){const byts=[];for(const char of str){const byt=alphabetCharsToBytes[char.codePointAt(0)];if(void 0===byt)throw new Error(`Non-base256emoji character: ${char}`);byts.push(byt)}return new Uint8Array(byts)}});var encode_1=function varint_encode(num,out,offset){out=out||[];var oldOffset=offset=offset||0;for(;num>=INT;)out[offset++]=255&num|MSB,num/=128;for(;num&MSBALL;)out[offset++]=255&num|MSB,num>>>=7;return out[offset]=0|num,varint_encode.bytes=offset-oldOffset+1,out},MSB=128,MSBALL=-128,INT=Math.pow(2,31);var varint_decode=function read(buf,offset){var b,res=0,shift=0,counter=offset=offset||0,l=buf.length;do{if(counter>=l)throw read.bytes=0,new RangeError("Could not decode varint");b=buf[counter++],res+=shift<28?(b&REST$1)<<shift:(b&REST$1)*Math.pow(2,shift),shift+=7}while(b>=MSB$1);return read.bytes=counter-offset,res},MSB$1=128,REST$1=127;var N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63);const vendor_varint={encode:encode_1,decode:varint_decode,encodingLength:function(value){return value<N1?1:value<N2?2:value<N3?3:value<N4?4:value<N5?5:value<N6?6:value<N7?7:value<N8?8:value<N9?9:10}},encodeTo=(int,target,offset=0)=>(vendor_varint.encode(int,target,offset),target),encodingLength=int=>vendor_varint.encodingLength(int),create=(code,digest)=>{const size=digest.byteLength,sizeOffset=encodingLength(code),digestOffset=sizeOffset+encodingLength(size),bytes=new Uint8Array(digestOffset+size);return encodeTo(code,bytes,0),encodeTo(size,bytes,sizeOffset),bytes.set(digest,digestOffset),new Digest(code,size,digest,bytes)};class Digest{constructor(code,size,digest,bytes){this.code=code,this.size=size,this.digest=digest,this.bytes=bytes}}const hasher_from=({name,code,encode})=>new Hasher(name,code,encode);class Hasher{constructor(name,code,encode){this.name=name,this.code=code,this.encode=encode}digest(input){if(input instanceof Uint8Array){const result=this.encode(input);return result instanceof Uint8Array?create(this.code,result):result.then(digest=>create(this.code,digest))}throw Error("Unknown type, must be binary type")}}const sha=name=>async data=>new Uint8Array(await crypto.subtle.digest(name,data)),sha256=hasher_from({name:"sha2-256",code:18,encode:sha("SHA-256")}),sha512=hasher_from({name:"sha2-512",code:19,encode:sha("SHA-512")}),identity_encode=coerce,identity_identity={code:0,name:"identity",encode:identity_encode,digest:input=>create(0,identity_encode(input))},raw_name="raw",raw_code=85,raw_encode=node=>coerce(node),raw_decode=data=>coerce(data),textEncoder=new TextEncoder,textDecoder=new TextDecoder,json_name="json",json_code=512,json_encode=node=>textEncoder.encode(JSON.stringify(node)),json_decode=data=>JSON.parse(textDecoder.decode(data));__webpack_require__("./node_modules/console-browserify/index.js");Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom");Symbol.for("@ipld/js-cid/CID");const bases={...identity_namespaceObject,...base2_namespaceObject,...base8_namespaceObject,...base10_namespaceObject,...base16_namespaceObject,...base32_namespaceObject,...base36_namespaceObject,...base58_namespaceObject,...base64_namespaceObject,...base256emoji_namespaceObject};function createCodec(name,prefix,encode,decode){return{name,prefix,encoder:{name,prefix,encode},decoder:{decode}}}const string=createCodec("utf8","u",buf=>"u"+new TextDecoder("utf8").decode(buf),str=>(new TextEncoder).encode(str.substring(1))),ascii=createCodec("ascii","a",buf=>{let string="a";for(let i=0;i<buf.length;i++)string+=String.fromCharCode(buf[i]);return string},str=>{const buf=allocUnsafe((str=str.substring(1)).length);for(let i=0;i<str.length;i++)buf[i]=str.charCodeAt(i);return buf}),util_bases={utf8:string,"utf-8":string,hex:bases.base16,latin1:ascii,ascii,binary:ascii,...bases};function from_string_fromString(string,encoding="utf8"){const base=util_bases[encoding];if(!base)throw new Error(`Unsupported encoding "${encoding}"`);return"utf8"!==encoding&&"utf-8"!==encoding||null==globalThis.Buffer||null==globalThis.Buffer.from?base.decoder.decode(`${base.prefix}${string}`):globalThis.Buffer.from(string,"utf8")}function to_string_toString(array,encoding="utf8"){const base=util_bases[encoding];if(!base)throw new Error(`Unsupported encoding "${encoding}"`);return"utf8"!==encoding&&"utf-8"!==encoding||null==globalThis.Buffer||null==globalThis.Buffer.from?base.encoder.encode(array).substring(1):globalThis.Buffer.from(array.buffer,array.byteOffset,array.byteLength).toString("utf8")}}}]);