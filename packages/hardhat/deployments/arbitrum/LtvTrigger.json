{
  "address": "0x0ef538d9EF4a070B3F3D0885Cc08B94eCfE4C58C",
  "abi": [
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "_viewRouter",
          "type": "address"
        }
      ],
      "stateMutability": "nonpayable",
      "type": "constructor"
    },
    {
      "inputs": [],
      "name": "InvalidTriggerParams",
      "type": "error"
    },
    {
      "inputs": [
        {
          "internalType": "bytes4",
          "name": "protocolId",
          "type": "bytes4"
        }
      ],
      "name": "UnsupportedProtocol",
      "type": "error"
    },
    {
      "inputs": [],
      "name": "AAVE_V3",
      "outputs": [
        {
          "internalType": "bytes4",
          "name": "",
          "type": "bytes4"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "COMPOUND_V3",
      "outputs": [
        {
          "internalType": "bytes4",
          "name": "",
          "type": "bytes4"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "EULER_V2",
      "outputs": [
        {
          "internalType": "bytes4",
          "name": "",
          "type": "bytes4"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "MORPHO_BLUE",
      "outputs": [
        {
          "internalType": "bytes4",
          "name": "",
          "type": "bytes4"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "VENUS",
      "outputs": [
        {
          "internalType": "bytes4",
          "name": "",
          "type": "bytes4"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "bytes",
          "name": "staticData",
          "type": "bytes"
        },
        {
          "internalType": "address",
          "name": "owner",
          "type": "address"
        }
      ],
      "name": "calculateExecution",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "sellAmount",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "minBuyAmount",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "bytes",
          "name": "staticData",
          "type": "bytes"
        }
      ],
      "name": "decodeTriggerParams",
      "outputs": [
        {
          "components": [
            {
              "internalType": "bytes4",
              "name": "protocolId",
              "type": "bytes4"
            },
            {
              "internalType": "bytes",
              "name": "protocolContext",
              "type": "bytes"
            },
            {
              "internalType": "uint256",
              "name": "triggerLtvBps",
              "type": "uint256"
            },
            {
              "internalType": "uint256",
              "name": "targetLtvBps",
              "type": "uint256"
            },
            {
              "internalType": "address",
              "name": "collateralToken",
              "type": "address"
            },
            {
              "internalType": "address",
              "name": "debtToken",
              "type": "address"
            },
            {
              "internalType": "uint8",
              "name": "collateralDecimals",
              "type": "uint8"
            },
            {
              "internalType": "uint8",
              "name": "debtDecimals",
              "type": "uint8"
            },
            {
              "internalType": "uint256",
              "name": "maxSlippageBps",
              "type": "uint256"
            },
            {
              "internalType": "uint8",
              "name": "numChunks",
              "type": "uint8"
            }
          ],
          "internalType": "struct LtvTrigger.TriggerParams",
          "name": "params",
          "type": "tuple"
        }
      ],
      "stateMutability": "pure",
      "type": "function"
    },
    {
      "inputs": [
        {
          "components": [
            {
              "internalType": "bytes4",
              "name": "protocolId",
              "type": "bytes4"
            },
            {
              "internalType": "bytes",
              "name": "protocolContext",
              "type": "bytes"
            },
            {
              "internalType": "uint256",
              "name": "triggerLtvBps",
              "type": "uint256"
            },
            {
              "internalType": "uint256",
              "name": "targetLtvBps",
              "type": "uint256"
            },
            {
              "internalType": "address",
              "name": "collateralToken",
              "type": "address"
            },
            {
              "internalType": "address",
              "name": "debtToken",
              "type": "address"
            },
            {
              "internalType": "uint8",
              "name": "collateralDecimals",
              "type": "uint8"
            },
            {
              "internalType": "uint8",
              "name": "debtDecimals",
              "type": "uint8"
            },
            {
              "internalType": "uint256",
              "name": "maxSlippageBps",
              "type": "uint256"
            },
            {
              "internalType": "uint8",
              "name": "numChunks",
              "type": "uint8"
            }
          ],
          "internalType": "struct LtvTrigger.TriggerParams",
          "name": "params",
          "type": "tuple"
        }
      ],
      "name": "encodeTriggerParams",
      "outputs": [
        {
          "internalType": "bytes",
          "name": "",
          "type": "bytes"
        }
      ],
      "stateMutability": "pure",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "bytes4",
          "name": "protocolId",
          "type": "bytes4"
        },
        {
          "internalType": "address",
          "name": "owner",
          "type": "address"
        },
        {
          "internalType": "bytes",
          "name": "context",
          "type": "bytes"
        }
      ],
      "name": "getCurrentLtv",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "ltvBps",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "bytes",
          "name": "",
          "type": "bytes"
        },
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "name": "isComplete",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "stateMutability": "pure",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "bytes",
          "name": "staticData",
          "type": "bytes"
        },
        {
          "internalType": "address",
          "name": "owner",
          "type": "address"
        }
      ],
      "name": "shouldExecute",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        },
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "triggerName",
      "outputs": [
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "stateMutability": "pure",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "viewRouter",
      "outputs": [
        {
          "internalType": "contract IKapanViewRouter",
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    }
  ],
  "transactionHash": "0x4cac45e19109c04aced5eb4594aeed96a3f5cd554327018eab721ea42c34c51e",
  "receipt": {
    "to": "0x4e59b44847b379578588920cA78FbF26c0B4956C",
    "from": "0x0BE61223F99E57b8b8B7033a77B54Adc7f7cF027",
    "contractAddress": null,
    "transactionIndex": 3,
    "gasUsed": "787966",
    "logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    "blockHash": "0x6122aa2cf8bca8d3fe963437f911ce7096a0932fd7503c3a2f493ffa1b379aeb",
    "transactionHash": "0x4cac45e19109c04aced5eb4594aeed96a3f5cd554327018eab721ea42c34c51e",
    "logs": [],
    "blockNumber": 426544404,
    "cumulativeGasUsed": "893827",
    "status": 1,
    "byzantium": true
  },
  "args": [
    "0x7b25A93c8a090C589030f3c3cDEec52Ffd5Ce9d1"
  ],
  "numDeployments": 9,
  "solcInputHash": "c5b2c93742f0dfa2027f1fc0a3472ec0",
  "metadata": "{\"compiler\":{\"version\":\"0.8.30+commit.73712a01\"},\"language\":\"Solidity\",\"output\":{\"abi\":[{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_viewRouter\",\"type\":\"address\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"inputs\":[],\"name\":\"InvalidTriggerParams\",\"type\":\"error\"},{\"inputs\":[{\"internalType\":\"bytes4\",\"name\":\"protocolId\",\"type\":\"bytes4\"}],\"name\":\"UnsupportedProtocol\",\"type\":\"error\"},{\"inputs\":[],\"name\":\"AAVE_V3\",\"outputs\":[{\"internalType\":\"bytes4\",\"name\":\"\",\"type\":\"bytes4\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"COMPOUND_V3\",\"outputs\":[{\"internalType\":\"bytes4\",\"name\":\"\",\"type\":\"bytes4\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"EULER_V2\",\"outputs\":[{\"internalType\":\"bytes4\",\"name\":\"\",\"type\":\"bytes4\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"MORPHO_BLUE\",\"outputs\":[{\"internalType\":\"bytes4\",\"name\":\"\",\"type\":\"bytes4\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"VENUS\",\"outputs\":[{\"internalType\":\"bytes4\",\"name\":\"\",\"type\":\"bytes4\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes\",\"name\":\"staticData\",\"type\":\"bytes\"},{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"}],\"name\":\"calculateExecution\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"sellAmount\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"minBuyAmount\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes\",\"name\":\"staticData\",\"type\":\"bytes\"}],\"name\":\"decodeTriggerParams\",\"outputs\":[{\"components\":[{\"internalType\":\"bytes4\",\"name\":\"protocolId\",\"type\":\"bytes4\"},{\"internalType\":\"bytes\",\"name\":\"protocolContext\",\"type\":\"bytes\"},{\"internalType\":\"uint256\",\"name\":\"triggerLtvBps\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"targetLtvBps\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"collateralToken\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"debtToken\",\"type\":\"address\"},{\"internalType\":\"uint8\",\"name\":\"collateralDecimals\",\"type\":\"uint8\"},{\"internalType\":\"uint8\",\"name\":\"debtDecimals\",\"type\":\"uint8\"},{\"internalType\":\"uint256\",\"name\":\"maxSlippageBps\",\"type\":\"uint256\"},{\"internalType\":\"uint8\",\"name\":\"numChunks\",\"type\":\"uint8\"}],\"internalType\":\"struct LtvTrigger.TriggerParams\",\"name\":\"params\",\"type\":\"tuple\"}],\"stateMutability\":\"pure\",\"type\":\"function\"},{\"inputs\":[{\"components\":[{\"internalType\":\"bytes4\",\"name\":\"protocolId\",\"type\":\"bytes4\"},{\"internalType\":\"bytes\",\"name\":\"protocolContext\",\"type\":\"bytes\"},{\"internalType\":\"uint256\",\"name\":\"triggerLtvBps\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"targetLtvBps\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"collateralToken\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"debtToken\",\"type\":\"address\"},{\"internalType\":\"uint8\",\"name\":\"collateralDecimals\",\"type\":\"uint8\"},{\"internalType\":\"uint8\",\"name\":\"debtDecimals\",\"type\":\"uint8\"},{\"internalType\":\"uint256\",\"name\":\"maxSlippageBps\",\"type\":\"uint256\"},{\"internalType\":\"uint8\",\"name\":\"numChunks\",\"type\":\"uint8\"}],\"internalType\":\"struct LtvTrigger.TriggerParams\",\"name\":\"params\",\"type\":\"tuple\"}],\"name\":\"encodeTriggerParams\",\"outputs\":[{\"internalType\":\"bytes\",\"name\":\"\",\"type\":\"bytes\"}],\"stateMutability\":\"pure\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes4\",\"name\":\"protocolId\",\"type\":\"bytes4\"},{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"internalType\":\"bytes\",\"name\":\"context\",\"type\":\"bytes\"}],\"name\":\"getCurrentLtv\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"ltvBps\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes\",\"name\":\"\",\"type\":\"bytes\"},{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"isComplete\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"pure\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes\",\"name\":\"staticData\",\"type\":\"bytes\"},{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"}],\"name\":\"shouldExecute\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"triggerName\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"pure\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"viewRouter\",\"outputs\":[{\"internalType\":\"contract IKapanViewRouter\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"}],\"devdoc\":{\"details\":\"Calculates deleverage amount to reach target LTV and minimum buy with slippage\",\"kind\":\"dev\",\"methods\":{\"calculateExecution(bytes,address)\":{\"details\":\"Only called when shouldExecute returns true\",\"params\":{\"owner\":\"The order owner\",\"staticData\":\"ABI-encoded trigger-specific parameters\"},\"returns\":{\"minBuyAmount\":\"Minimum amount to receive (includes slippage protection)\",\"sellAmount\":\"Amount of sell token to trade in this execution\"}},\"decodeTriggerParams(bytes)\":{\"params\":{\"staticData\":\"ABI-encoded TriggerParams\"},\"returns\":{\"params\":\"Decoded trigger parameters\"}},\"encodeTriggerParams((bytes4,bytes,uint256,uint256,address,address,uint8,uint8,uint256,uint8))\":{\"params\":{\"params\":\"Trigger parameters\"},\"returns\":{\"_0\":\"staticData ABI-encoded data\"}},\"getCurrentLtv(bytes4,address,bytes)\":{\"params\":{\"context\":\"Protocol-specific context\",\"owner\":\"User address\",\"protocolId\":\"Protocol identifier\"},\"returns\":{\"ltvBps\":\"Current LTV in basis points\"}},\"isComplete(bytes,address,uint256)\":{\"details\":\"ADL orders are continuous - they never auto-complete. The order remains active and will re-trigger whenever LTV rises above the trigger threshold, up to maxIterations or until user cancels. This provides ongoing liquidation protection rather than one-shot execution.\",\"params\":{\"iterationCount\":\"Number of executions completed so far\",\"owner\":\"The order owner\",\"staticData\":\"ABI-encoded trigger-specific parameters\"},\"returns\":{\"_0\":\"True if the order goal has been reached\"}},\"shouldExecute(bytes,address)\":{\"params\":{\"owner\":\"The order owner (user whose position is being monitored)\",\"staticData\":\"ABI-encoded trigger-specific parameters\"},\"returns\":{\"_0\":\"True if the trigger condition is met\",\"_1\":\"Human-readable reason for the result (for debugging/logging)\"}},\"triggerName()\":{\"returns\":{\"_0\":\"Trigger name (e.g., \\\"LTV\\\", \\\"Price\\\", \\\"HealthFactor\\\")\"}}},\"title\":\"LtvTrigger\",\"version\":1},\"userdoc\":{\"kind\":\"user\",\"methods\":{\"AAVE_V3()\":{\"notice\":\"Protocol identifiers\"},\"calculateExecution(bytes,address)\":{\"notice\":\"Calculate the execution amounts when the trigger fires\"},\"decodeTriggerParams(bytes)\":{\"notice\":\"Decode trigger params from static data\"},\"encodeTriggerParams((bytes4,bytes,uint256,uint256,address,address,uint8,uint8,uint256,uint8))\":{\"notice\":\"Encode trigger params to static data\"},\"getCurrentLtv(bytes4,address,bytes)\":{\"notice\":\"Get current LTV for a user position\"},\"isComplete(bytes,address,uint256)\":{\"notice\":\"Check if the order is complete and should stop executing\"},\"shouldExecute(bytes,address)\":{\"notice\":\"Check if the order should execute based on current conditions\"},\"triggerName()\":{\"notice\":\"Get human-readable name of the trigger type\"},\"viewRouter()\":{\"notice\":\"The KapanViewRouter for LTV and price queries\"}},\"notice\":\"Triggers order execution when position LTV exceeds a threshold (ADL)\",\"version\":1}},\"settings\":{\"compilationTarget\":{\"contracts/v2/triggers/LtvTrigger.sol\":\"LtvTrigger\"},\"evmVersion\":\"cancun\",\"libraries\":{},\"metadata\":{\"bytecodeHash\":\"ipfs\",\"useLiteralContent\":true},\"optimizer\":{\"enabled\":true,\"runs\":10},\"remappings\":[],\"viaIR\":true},\"sources\":{\"contracts/v2/interfaces/IOrderTrigger.sol\":{\"content\":\"// SPDX-License-Identifier: MIT\\npragma solidity ^0.8.30;\\n\\n/// @title IOrderTrigger\\n/// @notice Interface for pluggable order triggers in the Kapan conditional order system\\n/// @dev Triggers determine when an order should execute and how much to trade\\ninterface IOrderTrigger {\\n    /// @notice Check if the order should execute based on current conditions\\n    /// @param staticData ABI-encoded trigger-specific parameters\\n    /// @param owner The order owner (user whose position is being monitored)\\n    /// @return shouldExecute True if the trigger condition is met\\n    /// @return reason Human-readable reason for the result (for debugging/logging)\\n    function shouldExecute(\\n        bytes calldata staticData,\\n        address owner\\n    ) external view returns (bool shouldExecute, string memory reason);\\n\\n    /// @notice Calculate the execution amounts when the trigger fires\\n    /// @dev Only called when shouldExecute returns true\\n    /// @param staticData ABI-encoded trigger-specific parameters\\n    /// @param owner The order owner\\n    /// @return sellAmount Amount of sell token to trade in this execution\\n    /// @return minBuyAmount Minimum amount to receive (includes slippage protection)\\n    function calculateExecution(\\n        bytes calldata staticData,\\n        address owner\\n    ) external view returns (uint256 sellAmount, uint256 minBuyAmount);\\n\\n    /// @notice Check if the order is complete and should stop executing\\n    /// @dev Called after each execution to determine if order should be marked complete\\n    /// @param staticData ABI-encoded trigger-specific parameters\\n    /// @param owner The order owner\\n    /// @param iterationCount Number of executions completed so far\\n    /// @return complete True if the order goal has been reached\\n    function isComplete(\\n        bytes calldata staticData,\\n        address owner,\\n        uint256 iterationCount\\n    ) external view returns (bool complete);\\n\\n    /// @notice Get human-readable name of the trigger type\\n    /// @return name Trigger name (e.g., \\\"LTV\\\", \\\"Price\\\", \\\"HealthFactor\\\")\\n    function triggerName() external pure returns (string memory name);\\n}\\n\",\"keccak256\":\"0x0a4632796415a05e04d2d42eabc5691183c2c0b98088fd47e8a939d30c11a308\",\"license\":\"MIT\"},\"contracts/v2/triggers/LtvTrigger.sol\":{\"content\":\"// SPDX-License-Identifier: MIT\\npragma solidity ^0.8.30;\\n\\nimport { IOrderTrigger } from \\\"../interfaces/IOrderTrigger.sol\\\";\\n\\n/// @title KapanViewRouter Interface\\n/// @dev Minimal interface for LtvTrigger - uses unified functions with context\\ninterface IKapanViewRouter {\\n    /// @notice Get current LTV for any protocol\\n    /// @param protocolId Protocol identifier (AAVE_V3, COMPOUND_V3, etc.)\\n    /// @param user User address\\n    /// @param context Protocol-specific context (encoded)\\n    /// @return ltvBps Current LTV in basis points\\n    function getCurrentLtv(\\n        bytes4 protocolId,\\n        address user,\\n        bytes calldata context\\n    ) external view returns (uint256 ltvBps);\\n\\n    /// @notice Get position value for any protocol\\n    /// @param protocolId Protocol identifier\\n    /// @param user User address\\n    /// @param context Protocol-specific context (encoded)\\n    /// @return collateralValueUsd Total collateral in 8 decimals USD\\n    /// @return debtValueUsd Total debt in 8 decimals USD\\n    function getPositionValue(\\n        bytes4 protocolId,\\n        address user,\\n        bytes calldata context\\n    ) external view returns (uint256 collateralValueUsd, uint256 debtValueUsd);\\n\\n    /// @notice Get collateral price for any protocol\\n    /// @param protocolId Protocol identifier\\n    /// @param collateralToken Collateral token address\\n    /// @param context Protocol-specific context (encoded)\\n    /// @return price Price in 8 decimals USD\\n    function getCollateralPrice(\\n        bytes4 protocolId,\\n        address collateralToken,\\n        bytes calldata context\\n    ) external view returns (uint256 price);\\n\\n    /// @notice Get debt price for any protocol\\n    /// @param protocolId Protocol identifier\\n    /// @param debtToken Debt token address\\n    /// @param context Protocol-specific context (encoded)\\n    /// @return price Price in 8 decimals USD\\n    function getDebtPrice(\\n        bytes4 protocolId,\\n        address debtToken,\\n        bytes calldata context\\n    ) external view returns (uint256 price);\\n\\n    /// @notice Calculate minimum buy amount with slippage\\n    /// @param protocolId Protocol identifier\\n    /// @param sellAmount Amount to sell\\n    /// @param maxSlippageBps Maximum slippage in basis points\\n    /// @param collateralToken Collateral token\\n    /// @param debtToken Debt token\\n    /// @param collateralDecimals Collateral token decimals\\n    /// @param debtDecimals Debt token decimals\\n    /// @param context Protocol-specific context\\n    /// @return minBuyAmount Minimum acceptable buy amount\\n    function calculateMinBuy(\\n        bytes4 protocolId,\\n        uint256 sellAmount,\\n        uint256 maxSlippageBps,\\n        address collateralToken,\\n        address debtToken,\\n        uint8 collateralDecimals,\\n        uint8 debtDecimals,\\n        bytes calldata context\\n    ) external view returns (uint256 minBuyAmount);\\n}\\n\\n/// @title LtvTrigger\\n/// @notice Triggers order execution when position LTV exceeds a threshold (ADL)\\n/// @dev Calculates deleverage amount to reach target LTV and minimum buy with slippage\\ncontract LtvTrigger is IOrderTrigger {\\n    // ============ Errors ============\\n\\n    error UnsupportedProtocol(bytes4 protocolId);\\n    error InvalidTriggerParams();\\n\\n    // ============ Constants ============\\n\\n    /// @notice Protocol identifiers\\n    bytes4 public constant AAVE_V3 = bytes4(keccak256(\\\"aave-v3\\\"));\\n    bytes4 public constant COMPOUND_V3 = bytes4(keccak256(\\\"compound-v3\\\"));\\n    bytes4 public constant MORPHO_BLUE = bytes4(keccak256(\\\"morpho-blue\\\"));\\n    bytes4 public constant EULER_V2 = bytes4(keccak256(\\\"euler-v2\\\"));\\n    bytes4 public constant VENUS = bytes4(keccak256(\\\"venus\\\"));\\n\\n    // ============ Immutables ============\\n\\n    /// @notice The KapanViewRouter for LTV and price queries\\n    IKapanViewRouter public immutable viewRouter;\\n\\n    // ============ Structs ============\\n\\n    /// @notice Trigger parameters for LTV-based ADL\\n    struct TriggerParams {\\n        bytes4 protocolId; // Protocol identifier (AAVE_V3, COMPOUND_V3, etc.)\\n        bytes protocolContext; // Protocol-specific data (market params, sub-account, etc.)\\n        uint256 triggerLtvBps; // LTV threshold to trigger (e.g., 8000 = 80%)\\n        uint256 targetLtvBps; // Target LTV after deleverage (e.g., 6000 = 60%)\\n        address collateralToken; // Token to sell (withdraw from position)\\n        address debtToken; // Token to buy (repay debt)\\n        uint8 collateralDecimals; // Decimals of collateral token\\n        uint8 debtDecimals; // Decimals of debt token\\n        uint256 maxSlippageBps; // Maximum slippage tolerance\\n        uint8 numChunks; // Number of chunks to split deleverage (1 = full amount, 0 treated as 1)\\n    }\\n\\n    // ============ Constructor ============\\n\\n    constructor(address _viewRouter) {\\n        if (_viewRouter == address(0)) revert InvalidTriggerParams();\\n        viewRouter = IKapanViewRouter(_viewRouter);\\n    }\\n\\n    // ============ IOrderTrigger Implementation ============\\n\\n    /// @inheritdoc IOrderTrigger\\n    function shouldExecute(\\n        bytes calldata staticData,\\n        address owner\\n    ) external view override returns (bool, string memory) {\\n        TriggerParams memory params = abi.decode(staticData, (TriggerParams));\\n\\n        uint256 currentLtv = _getCurrentLtv(params.protocolId, owner, params.protocolContext);\\n\\n        if (currentLtv == 0) {\\n            return (false, \\\"No position\\\");\\n        }\\n\\n        if (currentLtv > params.triggerLtvBps) {\\n            return (true, \\\"LTV threshold exceeded\\\");\\n        }\\n\\n        return (false, \\\"LTV below threshold\\\");\\n    }\\n\\n    /// @inheritdoc IOrderTrigger\\n    function calculateExecution(\\n        bytes calldata staticData,\\n        address owner\\n    ) external view override returns (uint256 sellAmount, uint256 minBuyAmount) {\\n        TriggerParams memory params = abi.decode(staticData, (TriggerParams));\\n\\n        // 1. Get current position value in USD (or unit of account)\\n        (uint256 collateralValueUsd, uint256 debtValueUsd) = _getPositionValue(\\n            params.protocolId,\\n            owner,\\n            params.protocolContext,\\n            params.collateralToken,\\n            params.debtToken\\n        );\\n\\n        if (collateralValueUsd == 0 || debtValueUsd == 0) {\\n            return (0, 0);\\n        }\\n\\n        // 2. Calculate deleverage amount to reach target LTV\\n        // Formula: X = (debt - targetLtv * collateral) / (1 - targetLtv)\\n        // Where X is the amount in USD to sell and repay\\n        uint256 deleverageUsd = _calculateDeleverageAmount(collateralValueUsd, debtValueUsd, params.targetLtvBps);\\n\\n        if (deleverageUsd == 0) {\\n            return (0, 0);\\n        }\\n\\n        // 3. Convert USD to collateral token amount\\n        uint256 collateralPrice = _getCollateralPrice(\\n            params.protocolId,\\n            params.collateralToken,\\n            params.protocolContext\\n        );\\n\\n        if (collateralPrice == 0) {\\n            return (0, 0);\\n        }\\n\\n        // sellAmount in collateral token units\\n        // deleverageUsd is in 8 decimals (protocol oracle standard)\\n        // collateralPrice is in 8 decimals\\n        // sellAmount = deleverageUsd * 10^collateralDecimals / collateralPrice\\n        sellAmount = (deleverageUsd * (10 ** params.collateralDecimals)) / collateralPrice;\\n\\n        // 4. Apply chunking - divide by numChunks to spread deleverage across multiple executions\\n        // numChunks of 0 or 1 means full amount in single execution\\n        if (params.numChunks > 1) {\\n            sellAmount = sellAmount / params.numChunks;\\n        }\\n\\n        if (sellAmount == 0) {\\n            return (0, 0);\\n        }\\n\\n        // 5. Calculate minimum buy amount with slippage\\n        // ViewRouter.calculateMinBuy uses Aave/Chainlink prices for fair market rates\\n        minBuyAmount = _calculateMinBuy(\\n            params.protocolId,\\n            sellAmount,\\n            params.maxSlippageBps,\\n            params.collateralToken,\\n            params.debtToken,\\n            params.collateralDecimals,\\n            params.debtDecimals,\\n            params.protocolContext\\n        );\\n    }\\n\\n    /// @inheritdoc IOrderTrigger\\n    /// @dev ADL orders are continuous - they never auto-complete.\\n    /// The order remains active and will re-trigger whenever LTV rises above\\n    /// the trigger threshold, up to maxIterations or until user cancels.\\n    /// This provides ongoing liquidation protection rather than one-shot execution.\\n    function isComplete(\\n        bytes calldata /* staticData */,\\n        address /* owner */,\\n        uint256 /* iterationCount */\\n    ) external pure override returns (bool) {\\n        // Never auto-complete - rely on maxIterations for termination\\n        return false;\\n    }\\n\\n    /// @inheritdoc IOrderTrigger\\n    function triggerName() external pure override returns (string memory) {\\n        return \\\"LTV\\\";\\n    }\\n\\n    // ============ View Functions ============\\n\\n    /// @notice Get current LTV for a user position\\n    /// @param protocolId Protocol identifier\\n    /// @param owner User address\\n    /// @param context Protocol-specific context\\n    /// @return ltvBps Current LTV in basis points\\n    function getCurrentLtv(\\n        bytes4 protocolId,\\n        address owner,\\n        bytes memory context\\n    ) external view returns (uint256 ltvBps) {\\n        return _getCurrentLtv(protocolId, owner, context);\\n    }\\n\\n    /// @notice Decode trigger params from static data\\n    /// @param staticData ABI-encoded TriggerParams\\n    /// @return params Decoded trigger parameters\\n    function decodeTriggerParams(bytes calldata staticData) external pure returns (TriggerParams memory params) {\\n        return abi.decode(staticData, (TriggerParams));\\n    }\\n\\n    /// @notice Encode trigger params to static data\\n    /// @param params Trigger parameters\\n    /// @return staticData ABI-encoded data\\n    function encodeTriggerParams(TriggerParams calldata params) external pure returns (bytes memory) {\\n        return abi.encode(params);\\n    }\\n\\n    // ============ Internal Functions ============\\n\\n    /// @dev Get current LTV from the ViewRouter (protocol-agnostic)\\n    function _getCurrentLtv(bytes4 protocolId, address owner, bytes memory context) internal view returns (uint256) {\\n        return viewRouter.getCurrentLtv(protocolId, owner, context);\\n    }\\n\\n    /// @dev Get position value in USD (8 decimals) from the ViewRouter (protocol-agnostic)\\n    /// @param protocolId Protocol identifier\\n    /// @param owner User address\\n    /// @param context Protocol-specific context (market params, base token, etc.)\\n    /// @return collateralValueUsd Total collateral value in USD (8 decimals)\\n    /// @return debtValueUsd Total debt value in USD (8 decimals)\\n    function _getPositionValue(\\n        bytes4 protocolId,\\n        address owner,\\n        bytes memory context,\\n        address /* collateralToken */,\\n        address /* debtToken */\\n    ) internal view returns (uint256 collateralValueUsd, uint256 debtValueUsd) {\\n        return viewRouter.getPositionValue(protocolId, owner, context);\\n    }\\n\\n    /// @dev Calculate deleverage amount in USD\\n    /// Formula: X = (debt - targetLtv * collateral) / (1 - targetLtv)\\n    function _calculateDeleverageAmount(\\n        uint256 collateralValueUsd,\\n        uint256 debtValueUsd,\\n        uint256 targetLtvBps\\n    ) internal pure returns (uint256) {\\n        // Defensive checks\\n        if (collateralValueUsd == 0) {\\n            return 0; // No collateral, nothing to deleverage\\n        }\\n        if (targetLtvBps >= 10000) {\\n            return 0; // Invalid target (>= 100%)\\n        }\\n\\n        // Check if already at or below target\\n        uint256 currentLtvBps = (debtValueUsd * 10000) / collateralValueUsd;\\n        if (currentLtvBps <= targetLtvBps) {\\n            return 0;\\n        }\\n\\n        // X = (debt - targetLtv * collateral) / (1 - targetLtv)\\n        // All in 8 decimals, targetLtv in basis points\\n        uint256 targetDebt = (collateralValueUsd * targetLtvBps) / 10000;\\n        uint256 numerator = debtValueUsd - targetDebt;\\n        uint256 denominator = 10000 - targetLtvBps;\\n\\n        return (numerator * 10000) / denominator;\\n    }\\n\\n    /// @dev Get collateral price in USD (8 decimals) from the ViewRouter (protocol-agnostic)\\n    function _getCollateralPrice(\\n        bytes4 protocolId,\\n        address collateralToken,\\n        bytes memory context\\n    ) internal view returns (uint256) {\\n        return viewRouter.getCollateralPrice(protocolId, collateralToken, context);\\n    }\\n\\n    /// @dev Get debt price in USD (8 decimals) from the ViewRouter (protocol-agnostic)\\n    function _getDebtPrice(bytes4 protocolId, address debtToken, bytes memory context) internal view returns (uint256) {\\n        return viewRouter.getDebtPrice(protocolId, debtToken, context);\\n    }\\n\\n    /// @dev Calculate minimum buy amount with slippage from the ViewRouter (protocol-agnostic)\\n    function _calculateMinBuy(\\n        bytes4 protocolId,\\n        uint256 sellAmount,\\n        uint256 maxSlippageBps,\\n        address collateralToken,\\n        address debtToken,\\n        uint8 collateralDecimals,\\n        uint8 debtDecimals,\\n        bytes memory context\\n    ) internal view returns (uint256) {\\n        return\\n            viewRouter.calculateMinBuy(\\n                protocolId,\\n                sellAmount,\\n                maxSlippageBps,\\n                collateralToken,\\n                debtToken,\\n                collateralDecimals,\\n                debtDecimals,\\n                context\\n            );\\n    }\\n}\\n\",\"keccak256\":\"0x0148828ad8874d28499824407c76463be5859ef09f241dd98deb60260ae4d45e\",\"license\":\"MIT\"}},\"version\":1}",
  "bytecode": "0x60a03461008f57601f610dab38819003918201601f19168301916001600160401b038311848410176100935780849260209460405283398101031261008f57516001600160a01b0381169081900361008f57801561008057608052604051610d0390816100a882396080518181816104a1015281816108500152610c920152f35b63f77479dd60e01b5f5260045ffd5b5f80fd5b634e487b7160e01b5f52604160045260245ffdfe6080806040526004361015610012575f80fd5b5f3560e01c9081631a78ccc114610559575080633131489f14610537578063321394961461051557806343fc0865146104d05780634f1cb2911461048c57806356a914f614610467578063632224a714610431578063676e75511461030d57806390359bcc146102eb57806399fec7a0146102c95780639de7308514610267578063b030ddb3146100f85763dd90a891146100ab575f80fd5b346100f4575f3660031901126100f4576100f06040516100cc60408261067a565b6003815262262a2b60e91b6020820152604051918291602083526020830190610611565b0390f35b5f80fd5b346100f45760203660031901126100f4576004356001600160401b0381116100f4578036036101406003198201126100f457604051602080820152906001600160e01b031961014960048501610635565b166040830152602483013590602219018112156100f45782016004810135906024016001600160401b0382116100f45781360381136100f457828260ff6102346101246100f098610253976101a097610140606089015281610180890152888801375f86860188015260448101356080870152606481013560a08701526001600160a01b036101da608483016105bb565b1660c08701526001600160a01b036101f460a483016105bb565b1660e08701528361020760c483016106f2565b166101008701528361021b60e483016106f2565b16610120870152610104810135610140870152016106f2565b16610160830152601f801991011681010301601f19810183528261067a565b604051918291602083526020830190610611565b346100f45760603660031901126100f4576004356001600160e01b0319811681036100f4576102946105a5565b90604435906001600160401b0382116100f4576020926102bb6102c193369060040161069d565b91610c6c565b604051908152f35b346100f4575f3660031901126100f457604051633028125760e01b8152602090f35b346100f4575f3660031901126100f457604051633c724fef60e11b8152602090f35b346100f45760203660031901126100f4576004356001600160401b0381116100f45761034061038f913690600401610578565b5f6101206040516103508161064a565b828152606060208201528260408201528260608201528260808201528260a08201528260c08201528260e0820152826101008201520152810190610700565b60405180916020825263ffffffff60e01b815116602083015260ff6101206103c860208401516101406040870152610160860190610611565b92604081015160608601526060810151608086015260018060a01b0360808201511660a086015260018060a01b0360a08201511660c08601528260c08201511660e08601528260e082015116610100860152610100810151828601520151166101408301520390f35b346100f457610448610442366105cf565b91610ae5565b906100f060405192839215158352604060208401526040830190610611565b346100f457604061048061047a366105cf565b91610822565b82519182526020820152f35b346100f4575f3660031901126100f4576040517f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03168152602090f35b346100f45760603660031901126100f4576004356001600160401b0381116100f457610500903690600401610578565b505061050a6105a5565b5060206040515f8152f35b346100f4575f3660031901126100f45760405163bbbf88eb60e01b8152602090f35b346100f4575f3660031901126100f457604051633af167ff60e01b8152602090f35b346100f4575f3660031901126100f4576308ee5f0360e31b8152602090f35b9181601f840112156100f4578235916001600160401b0383116100f457602083818601950101116100f457565b602435906001600160a01b03821682036100f457565b35906001600160a01b03821682036100f457565b60406003198201126100f457600435906001600160401b0382116100f4576105f991600401610578565b90916024356001600160a01b03811681036100f45790565b805180835260209291819084018484015e5f828201840152601f01601f1916010190565b35906001600160e01b0319821682036100f457565b61014081019081106001600160401b0382111761066657604052565b634e487b7160e01b5f52604160045260245ffd5b601f909101601f19168101906001600160401b0382119082101761066657604052565b81601f820112156100f4578035906001600160401b03821161066657604051926106d1601f8401601f19166020018561067a565b828452602083830101116100f457815f926020809301838601378301015290565b359060ff821682036100f457565b6020818303126100f4578035906001600160401b0382116100f45701610140818303126100f457604051916107348361064a565b61073d82610635565b83526020820135916001600160401b0383116100f457610765610120926107d494830161069d565b6020850152604081013560408501526060810135606085015261078a608082016105bb565b608085015261079b60a082016105bb565b60a08501526107ac60c082016106f2565b60c08501526107bd60e082016106f2565b60e0850152610100810135610100850152016106f2565b61012082015290565b818102929181159184041417156107f057565b634e487b7160e01b5f52601160045260245ffd5b811561080e570490565b634e487b7160e01b5f52601260045260245ffd5b61083191939293810190610700565b8051602082018051604080516326a9d0f960e21b8152929660808601947f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03169493849283926108979291906001600160e01b03191660048501610bb5565b0381855afa8015610a3b575f915f91610aac575b5081158015610aa4575b610a4657906108c991606086015191610beb565b948515610a9857835183518251604051630794e50360e01b815298926020928a92839261090d926001600160a01b0316906001600160e01b03191660048501610bb5565b0381865afa968715610a3b575f97610a64575b508615610a465760c085019660ff885116604d81116107f05761094f9261094a91600a0a906107dd565b610804565b9560ff6101208601511660018111610a53575b508615610a465760209392916109f7889263ffffffff60e01b885116926101008901519660018060a01b039051169860ff60e08160018060a01b0360a085015116955116920151169151926040519a8b998a98899863755b0ea960e01b8a5260048a0152602489015260448801526064870152608486015260a485015260c484015261010060e4840152610104830190610611565b03915afa908115610a3b575f91610a0c575090565b90506020813d602011610a33575b81610a276020938361067a565b810103126100f4575190565b3d9150610a1a565b6040513d5f823e3d90fd5b505050505090505f905f90565b610a5d9197610804565b955f610962565b9096506020813d602011610a90575b81610a806020938361067a565b810103126100f45751955f610920565b3d9150610a73565b5050505090505f905f90565b5080156108b5565b9150506040813d604011610add575b81610ac86040938361067a565b810103126100f457602081519101515f6108ab565b3d9150610abb565b610af590610b0e92810190610700565b805160208201519193906001600160e01b031916610c6c565b908115610b88576040015110610b51575f90604051610b2e60408261067a565b60138152721315158818995b1bddc81d1a1c995cda1bdb19606a1b602082015290565b600190604051610b6260408261067a565b6016815275131515881d1a1c995cda1bdb1908195e18d95959195960521b602082015290565b50505f90604051610b9a60408261067a565b600b81526a2737903837b9b4ba34b7b760a91b602082015290565b6001600160e01b031990911681526001600160a01b039091166020820152606060408201819052610be892910190610611565b90565b8015610c6557612710831015610c6557612710820282810461271014831517156107f057610c1a828592610804565b1115610c6557610c2d83612710926107dd565b0490818103928184116107f057612710039161271083116107f057612710840293840461271014911417156107f057610be891610804565b5050505f90565b90602091610c8e6040519485938493639de7308560e01b855260048501610bb5565b03817f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03165afa908115610a3b575f91610a0c57509056fea2646970667358221220dc63f6c4cb1eabd2c2b6971983f481edf5c1a76fd646f4f57b7c410fe0e8232a64736f6c634300081e0033",
  "deployedBytecode": "0x6080806040526004361015610012575f80fd5b5f3560e01c9081631a78ccc114610559575080633131489f14610537578063321394961461051557806343fc0865146104d05780634f1cb2911461048c57806356a914f614610467578063632224a714610431578063676e75511461030d57806390359bcc146102eb57806399fec7a0146102c95780639de7308514610267578063b030ddb3146100f85763dd90a891146100ab575f80fd5b346100f4575f3660031901126100f4576100f06040516100cc60408261067a565b6003815262262a2b60e91b6020820152604051918291602083526020830190610611565b0390f35b5f80fd5b346100f45760203660031901126100f4576004356001600160401b0381116100f4578036036101406003198201126100f457604051602080820152906001600160e01b031961014960048501610635565b166040830152602483013590602219018112156100f45782016004810135906024016001600160401b0382116100f45781360381136100f457828260ff6102346101246100f098610253976101a097610140606089015281610180890152888801375f86860188015260448101356080870152606481013560a08701526001600160a01b036101da608483016105bb565b1660c08701526001600160a01b036101f460a483016105bb565b1660e08701528361020760c483016106f2565b166101008701528361021b60e483016106f2565b16610120870152610104810135610140870152016106f2565b16610160830152601f801991011681010301601f19810183528261067a565b604051918291602083526020830190610611565b346100f45760603660031901126100f4576004356001600160e01b0319811681036100f4576102946105a5565b90604435906001600160401b0382116100f4576020926102bb6102c193369060040161069d565b91610c6c565b604051908152f35b346100f4575f3660031901126100f457604051633028125760e01b8152602090f35b346100f4575f3660031901126100f457604051633c724fef60e11b8152602090f35b346100f45760203660031901126100f4576004356001600160401b0381116100f45761034061038f913690600401610578565b5f6101206040516103508161064a565b828152606060208201528260408201528260608201528260808201528260a08201528260c08201528260e0820152826101008201520152810190610700565b60405180916020825263ffffffff60e01b815116602083015260ff6101206103c860208401516101406040870152610160860190610611565b92604081015160608601526060810151608086015260018060a01b0360808201511660a086015260018060a01b0360a08201511660c08601528260c08201511660e08601528260e082015116610100860152610100810151828601520151166101408301520390f35b346100f457610448610442366105cf565b91610ae5565b906100f060405192839215158352604060208401526040830190610611565b346100f457604061048061047a366105cf565b91610822565b82519182526020820152f35b346100f4575f3660031901126100f4576040517f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03168152602090f35b346100f45760603660031901126100f4576004356001600160401b0381116100f457610500903690600401610578565b505061050a6105a5565b5060206040515f8152f35b346100f4575f3660031901126100f45760405163bbbf88eb60e01b8152602090f35b346100f4575f3660031901126100f457604051633af167ff60e01b8152602090f35b346100f4575f3660031901126100f4576308ee5f0360e31b8152602090f35b9181601f840112156100f4578235916001600160401b0383116100f457602083818601950101116100f457565b602435906001600160a01b03821682036100f457565b35906001600160a01b03821682036100f457565b60406003198201126100f457600435906001600160401b0382116100f4576105f991600401610578565b90916024356001600160a01b03811681036100f45790565b805180835260209291819084018484015e5f828201840152601f01601f1916010190565b35906001600160e01b0319821682036100f457565b61014081019081106001600160401b0382111761066657604052565b634e487b7160e01b5f52604160045260245ffd5b601f909101601f19168101906001600160401b0382119082101761066657604052565b81601f820112156100f4578035906001600160401b03821161066657604051926106d1601f8401601f19166020018561067a565b828452602083830101116100f457815f926020809301838601378301015290565b359060ff821682036100f457565b6020818303126100f4578035906001600160401b0382116100f45701610140818303126100f457604051916107348361064a565b61073d82610635565b83526020820135916001600160401b0383116100f457610765610120926107d494830161069d565b6020850152604081013560408501526060810135606085015261078a608082016105bb565b608085015261079b60a082016105bb565b60a08501526107ac60c082016106f2565b60c08501526107bd60e082016106f2565b60e0850152610100810135610100850152016106f2565b61012082015290565b818102929181159184041417156107f057565b634e487b7160e01b5f52601160045260245ffd5b811561080e570490565b634e487b7160e01b5f52601260045260245ffd5b61083191939293810190610700565b8051602082018051604080516326a9d0f960e21b8152929660808601947f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03169493849283926108979291906001600160e01b03191660048501610bb5565b0381855afa8015610a3b575f915f91610aac575b5081158015610aa4575b610a4657906108c991606086015191610beb565b948515610a9857835183518251604051630794e50360e01b815298926020928a92839261090d926001600160a01b0316906001600160e01b03191660048501610bb5565b0381865afa968715610a3b575f97610a64575b508615610a465760c085019660ff885116604d81116107f05761094f9261094a91600a0a906107dd565b610804565b9560ff6101208601511660018111610a53575b508615610a465760209392916109f7889263ffffffff60e01b885116926101008901519660018060a01b039051169860ff60e08160018060a01b0360a085015116955116920151169151926040519a8b998a98899863755b0ea960e01b8a5260048a0152602489015260448801526064870152608486015260a485015260c484015261010060e4840152610104830190610611565b03915afa908115610a3b575f91610a0c575090565b90506020813d602011610a33575b81610a276020938361067a565b810103126100f4575190565b3d9150610a1a565b6040513d5f823e3d90fd5b505050505090505f905f90565b610a5d9197610804565b955f610962565b9096506020813d602011610a90575b81610a806020938361067a565b810103126100f45751955f610920565b3d9150610a73565b5050505090505f905f90565b5080156108b5565b9150506040813d604011610add575b81610ac86040938361067a565b810103126100f457602081519101515f6108ab565b3d9150610abb565b610af590610b0e92810190610700565b805160208201519193906001600160e01b031916610c6c565b908115610b88576040015110610b51575f90604051610b2e60408261067a565b60138152721315158818995b1bddc81d1a1c995cda1bdb19606a1b602082015290565b600190604051610b6260408261067a565b6016815275131515881d1a1c995cda1bdb1908195e18d95959195960521b602082015290565b50505f90604051610b9a60408261067a565b600b81526a2737903837b9b4ba34b7b760a91b602082015290565b6001600160e01b031990911681526001600160a01b039091166020820152606060408201819052610be892910190610611565b90565b8015610c6557612710831015610c6557612710820282810461271014831517156107f057610c1a828592610804565b1115610c6557610c2d83612710926107dd565b0490818103928184116107f057612710039161271083116107f057612710840293840461271014911417156107f057610be891610804565b5050505f90565b90602091610c8e6040519485938493639de7308560e01b855260048501610bb5565b03817f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03165afa908115610a3b575f91610a0c57509056fea2646970667358221220dc63f6c4cb1eabd2c2b6971983f481edf5c1a76fd646f4f57b7c410fe0e8232a64736f6c634300081e0033",
  "devdoc": {
    "details": "Calculates deleverage amount to reach target LTV and minimum buy with slippage",
    "kind": "dev",
    "methods": {
      "calculateExecution(bytes,address)": {
        "details": "Only called when shouldExecute returns true",
        "params": {
          "owner": "The order owner",
          "staticData": "ABI-encoded trigger-specific parameters"
        },
        "returns": {
          "minBuyAmount": "Minimum amount to receive (includes slippage protection)",
          "sellAmount": "Amount of sell token to trade in this execution"
        }
      },
      "decodeTriggerParams(bytes)": {
        "params": {
          "staticData": "ABI-encoded TriggerParams"
        },
        "returns": {
          "params": "Decoded trigger parameters"
        }
      },
      "encodeTriggerParams((bytes4,bytes,uint256,uint256,address,address,uint8,uint8,uint256,uint8))": {
        "params": {
          "params": "Trigger parameters"
        },
        "returns": {
          "_0": "staticData ABI-encoded data"
        }
      },
      "getCurrentLtv(bytes4,address,bytes)": {
        "params": {
          "context": "Protocol-specific context",
          "owner": "User address",
          "protocolId": "Protocol identifier"
        },
        "returns": {
          "ltvBps": "Current LTV in basis points"
        }
      },
      "isComplete(bytes,address,uint256)": {
        "details": "ADL orders are continuous - they never auto-complete. The order remains active and will re-trigger whenever LTV rises above the trigger threshold, up to maxIterations or until user cancels. This provides ongoing liquidation protection rather than one-shot execution.",
        "params": {
          "iterationCount": "Number of executions completed so far",
          "owner": "The order owner",
          "staticData": "ABI-encoded trigger-specific parameters"
        },
        "returns": {
          "_0": "True if the order goal has been reached"
        }
      },
      "shouldExecute(bytes,address)": {
        "params": {
          "owner": "The order owner (user whose position is being monitored)",
          "staticData": "ABI-encoded trigger-specific parameters"
        },
        "returns": {
          "_0": "True if the trigger condition is met",
          "_1": "Human-readable reason for the result (for debugging/logging)"
        }
      },
      "triggerName()": {
        "returns": {
          "_0": "Trigger name (e.g., \"LTV\", \"Price\", \"HealthFactor\")"
        }
      }
    },
    "title": "LtvTrigger",
    "version": 1
  },
  "userdoc": {
    "kind": "user",
    "methods": {
      "AAVE_V3()": {
        "notice": "Protocol identifiers"
      },
      "calculateExecution(bytes,address)": {
        "notice": "Calculate the execution amounts when the trigger fires"
      },
      "decodeTriggerParams(bytes)": {
        "notice": "Decode trigger params from static data"
      },
      "encodeTriggerParams((bytes4,bytes,uint256,uint256,address,address,uint8,uint8,uint256,uint8))": {
        "notice": "Encode trigger params to static data"
      },
      "getCurrentLtv(bytes4,address,bytes)": {
        "notice": "Get current LTV for a user position"
      },
      "isComplete(bytes,address,uint256)": {
        "notice": "Check if the order is complete and should stop executing"
      },
      "shouldExecute(bytes,address)": {
        "notice": "Check if the order should execute based on current conditions"
      },
      "triggerName()": {
        "notice": "Get human-readable name of the trigger type"
      },
      "viewRouter()": {
        "notice": "The KapanViewRouter for LTV and price queries"
      }
    },
    "notice": "Triggers order execution when position LTV exceeds a threshold (ADL)",
    "version": 1
  },
  "storageLayout": {
    "storage": [],
    "types": null
  }
}