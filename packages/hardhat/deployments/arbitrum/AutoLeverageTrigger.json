{
  "address": "0x132230dD2e5dC7881823b4F6423c73e4fEA5D3a0",
  "abi": [
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "_viewRouter",
          "type": "address"
        }
      ],
      "stateMutability": "nonpayable",
      "type": "constructor"
    },
    {
      "inputs": [],
      "name": "InvalidTriggerParams",
      "type": "error"
    },
    {
      "inputs": [],
      "name": "AAVE_V3",
      "outputs": [
        {
          "internalType": "bytes4",
          "name": "",
          "type": "bytes4"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "COMPOUND_V3",
      "outputs": [
        {
          "internalType": "bytes4",
          "name": "",
          "type": "bytes4"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "EULER_V2",
      "outputs": [
        {
          "internalType": "bytes4",
          "name": "",
          "type": "bytes4"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "MORPHO_BLUE",
      "outputs": [
        {
          "internalType": "bytes4",
          "name": "",
          "type": "bytes4"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "bytes",
          "name": "staticData",
          "type": "bytes"
        },
        {
          "internalType": "address",
          "name": "owner",
          "type": "address"
        }
      ],
      "name": "calculateExecution",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "sellAmount",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "minBuyAmount",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "components": [
            {
              "internalType": "bytes4",
              "name": "protocolId",
              "type": "bytes4"
            },
            {
              "internalType": "bytes",
              "name": "protocolContext",
              "type": "bytes"
            },
            {
              "internalType": "uint256",
              "name": "triggerLtvBps",
              "type": "uint256"
            },
            {
              "internalType": "uint256",
              "name": "targetLtvBps",
              "type": "uint256"
            },
            {
              "internalType": "address",
              "name": "collateralToken",
              "type": "address"
            },
            {
              "internalType": "address",
              "name": "debtToken",
              "type": "address"
            },
            {
              "internalType": "uint8",
              "name": "collateralDecimals",
              "type": "uint8"
            },
            {
              "internalType": "uint8",
              "name": "debtDecimals",
              "type": "uint8"
            },
            {
              "internalType": "uint256",
              "name": "maxSlippageBps",
              "type": "uint256"
            },
            {
              "internalType": "uint8",
              "name": "numChunks",
              "type": "uint8"
            }
          ],
          "internalType": "struct AutoLeverageTrigger.TriggerParams",
          "name": "params",
          "type": "tuple"
        }
      ],
      "name": "encodeTriggerParams",
      "outputs": [
        {
          "internalType": "bytes",
          "name": "",
          "type": "bytes"
        }
      ],
      "stateMutability": "pure",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "bytes4",
          "name": "protocolId",
          "type": "bytes4"
        },
        {
          "internalType": "address",
          "name": "owner",
          "type": "address"
        },
        {
          "internalType": "bytes",
          "name": "context",
          "type": "bytes"
        }
      ],
      "name": "getCurrentLtv",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "bytes",
          "name": "staticData",
          "type": "bytes"
        },
        {
          "internalType": "address",
          "name": "owner",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "name": "isComplete",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "bytes",
          "name": "staticData",
          "type": "bytes"
        },
        {
          "internalType": "address",
          "name": "owner",
          "type": "address"
        }
      ],
      "name": "shouldExecute",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        },
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "triggerName",
      "outputs": [
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "stateMutability": "pure",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "viewRouter",
      "outputs": [
        {
          "internalType": "contract IKapanViewRouter",
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    }
  ],
  "transactionHash": "0x5ee8e1ad3627b7c66d44f571c9d56ffa7610526785c05896e3fd6a3470e1e8fc",
  "receipt": {
    "to": "0x4e59b44847b379578588920cA78FbF26c0B4956C",
    "from": "0x0BE61223F99E57b8b8B7033a77B54Adc7f7cF027",
    "contractAddress": null,
    "transactionIndex": 17,
    "gasUsed": "983801",
    "logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    "blockHash": "0xf383ad81dd9c75a1d9b3ef8f3c71518d95f838758d123690878d15c2a2ee5911",
    "transactionHash": "0x5ee8e1ad3627b7c66d44f571c9d56ffa7610526785c05896e3fd6a3470e1e8fc",
    "logs": [],
    "blockNumber": 426516877,
    "cumulativeGasUsed": "2925247",
    "status": 1,
    "byzantium": true
  },
  "args": [
    "0x7b25A93c8a090C589030f3c3cDEec52Ffd5Ce9d1"
  ],
  "numDeployments": 2,
  "solcInputHash": "a97ae27fafd2087cec95c2ee7fb1cd79",
  "metadata": "{\"compiler\":{\"version\":\"0.8.30+commit.73712a01\"},\"language\":\"Solidity\",\"output\":{\"abi\":[{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_viewRouter\",\"type\":\"address\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"inputs\":[],\"name\":\"InvalidTriggerParams\",\"type\":\"error\"},{\"inputs\":[],\"name\":\"AAVE_V3\",\"outputs\":[{\"internalType\":\"bytes4\",\"name\":\"\",\"type\":\"bytes4\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"COMPOUND_V3\",\"outputs\":[{\"internalType\":\"bytes4\",\"name\":\"\",\"type\":\"bytes4\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"EULER_V2\",\"outputs\":[{\"internalType\":\"bytes4\",\"name\":\"\",\"type\":\"bytes4\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"MORPHO_BLUE\",\"outputs\":[{\"internalType\":\"bytes4\",\"name\":\"\",\"type\":\"bytes4\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes\",\"name\":\"staticData\",\"type\":\"bytes\"},{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"}],\"name\":\"calculateExecution\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"sellAmount\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"minBuyAmount\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"components\":[{\"internalType\":\"bytes4\",\"name\":\"protocolId\",\"type\":\"bytes4\"},{\"internalType\":\"bytes\",\"name\":\"protocolContext\",\"type\":\"bytes\"},{\"internalType\":\"uint256\",\"name\":\"triggerLtvBps\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"targetLtvBps\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"collateralToken\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"debtToken\",\"type\":\"address\"},{\"internalType\":\"uint8\",\"name\":\"collateralDecimals\",\"type\":\"uint8\"},{\"internalType\":\"uint8\",\"name\":\"debtDecimals\",\"type\":\"uint8\"},{\"internalType\":\"uint256\",\"name\":\"maxSlippageBps\",\"type\":\"uint256\"},{\"internalType\":\"uint8\",\"name\":\"numChunks\",\"type\":\"uint8\"}],\"internalType\":\"struct AutoLeverageTrigger.TriggerParams\",\"name\":\"params\",\"type\":\"tuple\"}],\"name\":\"encodeTriggerParams\",\"outputs\":[{\"internalType\":\"bytes\",\"name\":\"\",\"type\":\"bytes\"}],\"stateMutability\":\"pure\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes4\",\"name\":\"protocolId\",\"type\":\"bytes4\"},{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"internalType\":\"bytes\",\"name\":\"context\",\"type\":\"bytes\"}],\"name\":\"getCurrentLtv\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes\",\"name\":\"staticData\",\"type\":\"bytes\"},{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"isComplete\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes\",\"name\":\"staticData\",\"type\":\"bytes\"},{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"}],\"name\":\"shouldExecute\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"triggerName\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"pure\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"viewRouter\",\"outputs\":[{\"internalType\":\"contract IKapanViewRouter\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"}],\"devdoc\":{\"details\":\"Opposite of LtvTrigger - increases leverage when under-leveraged Flow: 1. Pre-hook: Flash loan collateral \\u2192 Deposit \\u2192 Borrow debt \\u2192 Push to OrderManager 2. CoW Swap: Debt \\u2192 Collateral 3. Post-hook: Repay flash loan with received collateral Order params:   - sellToken = debtToken (we're selling borrowed debt)   - buyToken = collateralToken (we're buying collateral to repay flash loan)\",\"kind\":\"dev\",\"methods\":{\"calculateExecution(bytes,address)\":{\"details\":\"Returns:   - sellAmount: debt tokens to borrow and swap   - minBuyAmount: collateral tokens expected (must cover flash loan + fee)\",\"params\":{\"owner\":\"The order owner\",\"staticData\":\"ABI-encoded trigger-specific parameters\"},\"returns\":{\"minBuyAmount\":\"Minimum amount to receive (includes slippage protection)\",\"sellAmount\":\"Amount of sell token to trade in this execution\"}},\"isComplete(bytes,address,uint256)\":{\"details\":\"Called after each execution to determine if order should be marked complete\",\"params\":{\"iterationCount\":\"Number of executions completed so far\",\"owner\":\"The order owner\",\"staticData\":\"ABI-encoded trigger-specific parameters\"},\"returns\":{\"_0\":\"True if the order goal has been reached\"}},\"shouldExecute(bytes,address)\":{\"params\":{\"owner\":\"The order owner (user whose position is being monitored)\",\"staticData\":\"ABI-encoded trigger-specific parameters\"},\"returns\":{\"_0\":\"True if the trigger condition is met\",\"_1\":\"Human-readable reason for the result (for debugging/logging)\"}},\"triggerName()\":{\"returns\":{\"_0\":\"Trigger name (e.g., \\\"LTV\\\", \\\"Price\\\", \\\"HealthFactor\\\")\"}}},\"title\":\"AutoLeverageTrigger\",\"version\":1},\"userdoc\":{\"kind\":\"user\",\"methods\":{\"calculateExecution(bytes,address)\":{\"notice\":\"Calculate the execution amounts when the trigger fires\"},\"encodeTriggerParams((bytes4,bytes,uint256,uint256,address,address,uint8,uint8,uint256,uint8))\":{\"notice\":\"Encode trigger params for order creation\"},\"getCurrentLtv(bytes4,address,bytes)\":{\"notice\":\"Get current LTV for a user\"},\"isComplete(bytes,address,uint256)\":{\"notice\":\"Check if the order is complete and should stop executing\"},\"shouldExecute(bytes,address)\":{\"notice\":\"Check if the order should execute based on current conditions\"},\"triggerName()\":{\"notice\":\"Get human-readable name of the trigger type\"}},\"notice\":\"Triggers order execution when position LTV drops BELOW a threshold (auto-leverage)\",\"version\":1}},\"settings\":{\"compilationTarget\":{\"contracts/v2/triggers/AutoLeverageTrigger.sol\":\"AutoLeverageTrigger\"},\"evmVersion\":\"cancun\",\"libraries\":{},\"metadata\":{\"bytecodeHash\":\"ipfs\",\"useLiteralContent\":true},\"optimizer\":{\"enabled\":true,\"runs\":10},\"remappings\":[],\"viaIR\":true},\"sources\":{\"contracts/v2/interfaces/IOrderTrigger.sol\":{\"content\":\"// SPDX-License-Identifier: MIT\\npragma solidity ^0.8.30;\\n\\n/// @title IOrderTrigger\\n/// @notice Interface for pluggable order triggers in the Kapan conditional order system\\n/// @dev Triggers determine when an order should execute and how much to trade\\ninterface IOrderTrigger {\\n    /// @notice Check if the order should execute based on current conditions\\n    /// @param staticData ABI-encoded trigger-specific parameters\\n    /// @param owner The order owner (user whose position is being monitored)\\n    /// @return shouldExecute True if the trigger condition is met\\n    /// @return reason Human-readable reason for the result (for debugging/logging)\\n    function shouldExecute(\\n        bytes calldata staticData,\\n        address owner\\n    ) external view returns (bool shouldExecute, string memory reason);\\n\\n    /// @notice Calculate the execution amounts when the trigger fires\\n    /// @dev Only called when shouldExecute returns true\\n    /// @param staticData ABI-encoded trigger-specific parameters\\n    /// @param owner The order owner\\n    /// @return sellAmount Amount of sell token to trade in this execution\\n    /// @return minBuyAmount Minimum amount to receive (includes slippage protection)\\n    function calculateExecution(\\n        bytes calldata staticData,\\n        address owner\\n    ) external view returns (uint256 sellAmount, uint256 minBuyAmount);\\n\\n    /// @notice Check if the order is complete and should stop executing\\n    /// @dev Called after each execution to determine if order should be marked complete\\n    /// @param staticData ABI-encoded trigger-specific parameters\\n    /// @param owner The order owner\\n    /// @param iterationCount Number of executions completed so far\\n    /// @return complete True if the order goal has been reached\\n    function isComplete(\\n        bytes calldata staticData,\\n        address owner,\\n        uint256 iterationCount\\n    ) external view returns (bool complete);\\n\\n    /// @notice Get human-readable name of the trigger type\\n    /// @return name Trigger name (e.g., \\\"LTV\\\", \\\"Price\\\", \\\"HealthFactor\\\")\\n    function triggerName() external pure returns (string memory name);\\n}\\n\",\"keccak256\":\"0x0a4632796415a05e04d2d42eabc5691183c2c0b98088fd47e8a939d30c11a308\",\"license\":\"MIT\"},\"contracts/v2/triggers/AutoLeverageTrigger.sol\":{\"content\":\"// SPDX-License-Identifier: MIT\\npragma solidity ^0.8.30;\\n\\nimport { IOrderTrigger } from \\\"../interfaces/IOrderTrigger.sol\\\";\\n\\n/// @notice Morpho Blue MarketParams structure\\nstruct MarketParams {\\n    address loanToken;\\n    address collateralToken;\\n    address oracle;\\n    address irm;\\n    uint256 lltv;\\n}\\n\\n/// @title KapanViewRouter Interface (same as LtvTrigger)\\ninterface IKapanViewRouter {\\n    function getCurrentLtv(bytes4 protocolId, address user, bytes calldata context) external view returns (uint256 ltvBps);\\n    function getPositionValue(bytes4 protocolId, address user, bytes calldata context) external view returns (uint256 collateralValueUsd, uint256 debtValueUsd);\\n    function getCollateralPrice(bytes4 protocolId, address collateralToken, bytes calldata context) external view returns (uint256 price);\\n    function getDebtPrice(bytes4 protocolId, address debtToken, bytes calldata context) external view returns (uint256 price);\\n    function getMorphoOraclePrice(MarketParams calldata params) external view returns (uint256 price);\\n}\\n\\n/// @title AutoLeverageTrigger\\n/// @notice Triggers order execution when position LTV drops BELOW a threshold (auto-leverage)\\n/// @dev Opposite of LtvTrigger - increases leverage when under-leveraged\\n///\\n/// Flow:\\n/// 1. Pre-hook: Flash loan collateral \\u2192 Deposit \\u2192 Borrow debt \\u2192 Push to OrderManager\\n/// 2. CoW Swap: Debt \\u2192 Collateral\\n/// 3. Post-hook: Repay flash loan with received collateral\\n///\\n/// Order params:\\n///   - sellToken = debtToken (we're selling borrowed debt)\\n///   - buyToken = collateralToken (we're buying collateral to repay flash loan)\\ncontract AutoLeverageTrigger is IOrderTrigger {\\n    // ============ Errors ============\\n    error InvalidTriggerParams();\\n\\n    // ============ Constants ============\\n    bytes4 public constant AAVE_V3 = bytes4(keccak256(\\\"aave-v3\\\"));\\n    bytes4 public constant COMPOUND_V3 = bytes4(keccak256(\\\"compound-v3\\\"));\\n    bytes4 public constant MORPHO_BLUE = bytes4(keccak256(\\\"morpho-blue\\\"));\\n    bytes4 public constant EULER_V2 = bytes4(keccak256(\\\"euler-v2\\\"));\\n\\n    // ============ Immutables ============\\n    IKapanViewRouter public immutable viewRouter;\\n\\n    // ============ Structs ============\\n\\n    /// @notice Trigger parameters for LTV-based auto-leverage\\n    struct TriggerParams {\\n        bytes4 protocolId;          // Protocol identifier\\n        bytes protocolContext;       // Protocol-specific data\\n        uint256 triggerLtvBps;       // LTV threshold BELOW which to trigger (e.g., 5000 = 50%)\\n        uint256 targetLtvBps;        // Target LTV after leverage (e.g., 7000 = 70%)\\n        address collateralToken;     // Token to BUY (receive from swap, repay flash loan)\\n        address debtToken;           // Token to SELL (borrow and swap)\\n        uint8 collateralDecimals;\\n        uint8 debtDecimals;\\n        uint256 maxSlippageBps;      // Maximum slippage tolerance\\n        uint8 numChunks;             // Number of chunks (1 = full amount)\\n    }\\n\\n    // ============ Constructor ============\\n\\n    constructor(address _viewRouter) {\\n        if (_viewRouter == address(0)) revert InvalidTriggerParams();\\n        viewRouter = IKapanViewRouter(_viewRouter);\\n    }\\n\\n    // ============ IOrderTrigger Implementation ============\\n\\n    /// @inheritdoc IOrderTrigger\\n    function shouldExecute(\\n        bytes calldata staticData,\\n        address owner\\n    ) external view override returns (bool, string memory) {\\n        TriggerParams memory params = abi.decode(staticData, (TriggerParams));\\n\\n        uint256 currentLtv = viewRouter.getCurrentLtv(params.protocolId, owner, params.protocolContext);\\n\\n        if (currentLtv == 0) {\\n            return (false, \\\"No position\\\");\\n        }\\n\\n        // Trigger when UNDER-leveraged (LTV too low)\\n        if (currentLtv < params.triggerLtvBps) {\\n            return (true, \\\"LTV below threshold - under-leveraged\\\");\\n        }\\n\\n        return (false, \\\"LTV above threshold\\\");\\n    }\\n\\n    /// @inheritdoc IOrderTrigger\\n    /// @dev Returns:\\n    ///   - sellAmount: debt tokens to borrow and swap\\n    ///   - minBuyAmount: collateral tokens expected (must cover flash loan + fee)\\n    function calculateExecution(\\n        bytes calldata staticData,\\n        address owner\\n    ) external view override returns (uint256 sellAmount, uint256 minBuyAmount) {\\n        TriggerParams memory params = abi.decode(staticData, (TriggerParams));\\n\\n        // Get current position value in USD (8 decimals)\\n        (uint256 collateralValueUsd, uint256 debtValueUsd) = viewRouter.getPositionValue(\\n            params.protocolId,\\n            owner,\\n            params.protocolContext\\n        );\\n\\n        if (collateralValueUsd == 0) return (0, 0);\\n\\n        uint256 currentLtv = (debtValueUsd * 10000) / collateralValueUsd;\\n        if (currentLtv >= params.targetLtvBps) return (0, 0); // Already at or above target\\n\\n        // Calculate how much additional debt (in USD) to reach target LTV\\n        //\\n        // After leverage:\\n        //   newDebt / newCollateral = targetLTV\\n        //   (D + \\u0394D) / (C + \\u0394C) = targetLTV\\n        //\\n        // Where \\u0394C \\u2248 \\u0394D (collateral received from swapping debt, roughly 1:1 in USD value)\\n        //\\n        // Solving for \\u0394D:\\n        //   D + \\u0394D = targetLTV \\u00d7 (C + \\u0394D)\\n        //   D + \\u0394D = targetLTV \\u00d7 C + targetLTV \\u00d7 \\u0394D\\n        //   \\u0394D \\u00d7 (1 - targetLTV) = targetLTV \\u00d7 C - D\\n        //   \\u0394D = (targetLTV \\u00d7 C - D) / (1 - targetLTV)\\n        //\\n        // This is the inverse of the ADL formula (which reduces both C and D)\\n        uint256 targetDebtUsd = (params.targetLtvBps * collateralValueUsd) / 10000;\\n        if (targetDebtUsd <= debtValueUsd) return (0, 0); // Already at or above target\\n\\n        uint256 numerator = targetDebtUsd - debtValueUsd;\\n        uint256 denominator = 10000 - params.targetLtvBps;\\n        if (denominator == 0) return (0, 0); // Prevent division by zero at 100% LTV\\n\\n        uint256 deltaDebtUsd = (numerator * 10000) / denominator;\\n\\n        // Convert USD to debt token amount\\n        uint256 debtPrice = viewRouter.getDebtPrice(params.protocolId, params.debtToken, params.protocolContext);\\n        sellAmount = (deltaDebtUsd * (10 ** params.debtDecimals)) / debtPrice;\\n\\n        // Apply chunking\\n        uint8 chunks = params.numChunks > 0 ? params.numChunks : 1;\\n        if (chunks > 1) {\\n            sellAmount = sellAmount / chunks;\\n        }\\n\\n        // Calculate minBuyAmount (collateral) with slippage\\n        // This must cover the flash loan repayment\\n        uint256 expectedCollateral;\\n\\n        if (params.protocolId == MORPHO_BLUE) {\\n            // Morpho uses a special oracle that returns collateral/debt exchange rate at 36 decimals\\n            // Formula: collateralAmount = debtAmount * 1e36 / oraclePrice\\n            // The oracle accounts for decimal differences between tokens\\n            MarketParams memory marketParams = abi.decode(params.protocolContext, (MarketParams));\\n            uint256 morphoOraclePrice = viewRouter.getMorphoOraclePrice(marketParams);\\n            if (morphoOraclePrice > 0) {\\n                // sellAmount is in debt token decimals, result is in collateral token decimals\\n                expectedCollateral = (sellAmount * 1e36) / morphoOraclePrice;\\n            }\\n        } else {\\n            // Standard price-based calculation for other protocols\\n            uint256 collateralPrice = viewRouter.getCollateralPrice(\\n                params.protocolId,\\n                params.collateralToken,\\n                params.protocolContext\\n            );\\n\\n            if (collateralPrice > 0) {\\n                // Expected collateral = sellAmount(debt) \\u00d7 debtPrice / collateralPrice\\n                expectedCollateral = (sellAmount * debtPrice) / collateralPrice;\\n                // Adjust for decimals\\n                expectedCollateral = (expectedCollateral * (10 ** params.collateralDecimals)) / (10 ** params.debtDecimals);\\n            }\\n        }\\n\\n        // Apply slippage\\n        minBuyAmount = (expectedCollateral * (10000 - params.maxSlippageBps)) / 10000;\\n    }\\n\\n    /// @inheritdoc IOrderTrigger\\n    function isComplete(\\n        bytes calldata staticData,\\n        address owner,\\n        uint256 /* iterationCount */\\n    ) external view override returns (bool) {\\n        TriggerParams memory params = abi.decode(staticData, (TriggerParams));\\n\\n        uint256 currentLtv = viewRouter.getCurrentLtv(params.protocolId, owner, params.protocolContext);\\n\\n        // Complete when LTV reaches or exceeds target\\n        return currentLtv >= params.targetLtvBps;\\n    }\\n\\n    /// @inheritdoc IOrderTrigger\\n    function triggerName() external pure override returns (string memory) {\\n        return \\\"AutoLeverage\\\";\\n    }\\n\\n    // ============ View Helpers ============\\n\\n    /// @notice Get current LTV for a user\\n    function getCurrentLtv(bytes4 protocolId, address owner, bytes calldata context) external view returns (uint256) {\\n        return viewRouter.getCurrentLtv(protocolId, owner, context);\\n    }\\n\\n    /// @notice Encode trigger params for order creation\\n    function encodeTriggerParams(TriggerParams memory params) external pure returns (bytes memory) {\\n        return abi.encode(params);\\n    }\\n}\\n\",\"keccak256\":\"0xc148905c4be638364ee1543d97e8c8016f35abb6dc2da0ceedfc7f51bd614b37\",\"license\":\"MIT\"}},\"version\":1}",
  "bytecode": "0x60a03461009d57601f61103038819003918201601f19168301916001600160401b038311848410176100a15780849260209460405283398101031261009d57516001600160a01b0381169081900361009d57801561008e57608052604051610f7a90816100b68239608051818181610374015281816104a8015281816105520152818161093e0152610e1c0152f35b63f77479dd60e01b5f5260045ffd5b5f80fd5b634e487b7160e01b5f52604160045260245ffdfe6080806040526004361015610012575f80fd5b5f3560e01c9081633131489f146105f35750806332139496146105d157806343fc0865146104d75780634f1cb2911461049357806356a914f61461046e578063632224a71461043857806390359bcc1461041657806399fec7a0146103f45780639de73085146102d1578063b030ddb3146100eb5763dd90a89114610095575f80fd5b346100e7575f3660031901126100e7576100e36040516100b6604082610714565b600c81526b4175746f4c6576657261676560a01b60208201526040519182916020835260208301906106ab565b0390f35b5f80fd5b346100e75760203660031901126100e7576004356001600160401b0381116100e75761014060031982360301126100e757604051610128816106e4565b610134826004016106cf565b815260248201356001600160401b0381116100e757820191366023840112156100e757600483013561016581610737565b936101736040519586610714565b81855236602482840101116100e7576024829101602086013783016020015f905260208201928352604082019060448101358252606083019060648101358252608481016101c090610655565b608085019081526101d360a48301610655565b60a086019081526101e660c48401610752565b60c08701908152906101fa60e48501610752565b9260e0880193845261010088019461010481013586526101240161021d90610752565b956101208901968752604051998a9960208b016020905263ffffffff60e01b90511660408b01525160608a0161014090526101808a0161025c916106ab565b975160808a01525160a0890152516001600160a01b0390811660c089015290511660e08701525160ff90811661010087015290518116610120860152905161014085015290511661016083015203601f19810182526102bb9082610714565b604051809160208252602082016100e3916106ab565b346100e75760603660031901126100e75760043563ffffffff60e01b81168091036100e7576102fe61063f565b604435906001600160401b0382116100e75760846103226020933690600401610612565b604051639de7308560e01b815260048101969096526001600160a01b0390931660248601526060604486015260648501839052849283918190848401375f828201840152601f01601f191681010301817f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03165afa80156103e9575f906103b6575b602090604051908152f35b506020813d6020116103e1575b816103d060209383610714565b810103126100e757602090516103ab565b3d91506103c3565b6040513d5f823e3d90fd5b346100e7575f3660031901126100e757604051633028125760e01b8152602090f35b346100e7575f3660031901126100e757604051633c724fef60e11b8152602090f35b346100e75761044f61044936610669565b91610ddb565b906100e3604051928392151583526040602084015260408301906106ab565b346100e757604061048761048136610669565b91610917565b82519182526020820152f35b346100e7575f3660031901126100e7576040517f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03168152602090f35b346100e75760603660031901126100e7576004356001600160401b0381116100e75761050a61051d913690600401610612565b919061051461063f565b92810190610760565b602063ffffffff60e01b82511692818301519361054e6040519586938493639de7308560e01b855260048501610877565b03817f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03165afa9182156103e9575f9261059c575b60208360608401511115604051908152f35b91506020823d6020116105c9575b816105b760209383610714565b810103126100e757905190606061058a565b3d91506105aa565b346100e7575f3660031901126100e75760405163bbbf88eb60e01b8152602090f35b346100e7575f3660031901126100e757633af167ff60e01b8152602090f35b9181601f840112156100e7578235916001600160401b0383116100e757602083818601950101116100e757565b602435906001600160a01b03821682036100e757565b35906001600160a01b03821682036100e757565b60406003198201126100e757600435906001600160401b0382116100e75761069391600401610612565b90916024356001600160a01b03811681036100e75790565b805180835260209291819084018484015e5f828201840152601f01601f1916010190565b35906001600160e01b0319821682036100e757565b61014081019081106001600160401b0382111761070057604052565b634e487b7160e01b5f52604160045260245ffd5b601f909101601f19168101906001600160401b0382119082101761070057604052565b6001600160401b03811161070057601f01601f191660200190565b359060ff821682036100e757565b6020818303126100e7578035906001600160401b0382116100e7570190610140828203126100e75760405191610795836106e4565b61079e816106cf565b835260208101356001600160401b0381116100e75781019082601f830112156100e7578135926107cd84610737565b906107db6040519283610714565b848252602085850101116100e7575f60208561086e9682610120970183860137830101526020850152604081013560408501526060810135606085015261082460808201610655565b608085015261083560a08201610655565b60a085015261084660c08201610752565b60c085015261085760e08201610752565b60e085015261010081013561010085015201610752565b61012082015290565b6001600160e01b031990911681526001600160a01b0390911660208201526060604082018190526108aa929101906106ab565b90565b818102929181159184041417156108c057565b634e487b7160e01b5f52601160045260245ffd5b81156108de570490565b634e487b7160e01b5f52601260045260245ffd5b60ff16604d81116108c057600a0a90565b51906001600160a01b03821682036100e757565b61092691939293810190610760565b8051602082018051604080516326a9d0f960e21b81527f00000000000000000000000000000000000000000000000000000000000000006001600160a01b031697939594909391928492839261098b9291906001600160e01b03191660048501610877565b0381885afa80156103e9575f915f91610da2575b508115610d9657612710810281810461271014821517156108c057826109c4916108d4565b916060840192835180911015610d7b57612710916109e1916108ad565b0481811115610d8957818103928184116108c057519182612710039261271084116108c05761271014610d7b57612710840293840461271014911417156108c057610a2b916108d4565b815160a08301518451604051630ee9078360e01b8152939793959260209287928392610a6e926001600160a01b0316906001600160e01b03191660048501610877565b0381855afa9384156103e9575f94610d47575b50610aa684610aa160e0860198610a9b60ff8b51166108f2565b906108ad565b6108d4565b61012084015190969060ff168015610d3d5760ff905b1660018111610d2c575b5083515f95906001600160e01b031916633028125760e01b8103610c5757505050519060a0828051810103126100e7576040519060a082016001600160401b038111838210176107005760209260a491604052610b24848601610903565b8152610b3260408601610903565b92848201938452610b4560608701610903565b956040830196875260a0610b5b60808301610903565b606085019081529101516080840190815260405163168be4db60e01b815293516001600160a01b03908116600486015295518616602485015296518516604484015251909316606482015293516084850152839182905afa9081156103e9575f91610c25575b5080610bef575b50610100905b0151612710039061271082116108c05761271091610beb916108ad565b0490565b9091506a0c097ce7bc90715b34b9f160241b8481029085820414851517156108c05761010091610c1e916108d4565b9190610bc8565b90506020813d602011610c4f575b81610c4060209383610714565b810103126100e757515f610bc1565b3d9150610c33565b6020919294610c8d9460018060a01b0360808901511690519260405196879485938493630794e50360e01b855260048501610877565b03915afa9182156103e9575f92610cf8575b5081610cb2575b50505061010090610bce565b61010093945060ff610ce1610cd2610cef9594610aa1610ce9958c6108ad565b610a9b8360c08a0151166108f2565b9251166108f2565b906108d4565b91905f80610ca6565b9091506020813d602011610d24575b81610d1460209383610714565b810103126100e75751905f610c9f565b3d9150610d07565b610d3691976108d4565b955f610ac6565b5060ff6001610abc565b9093506020813d602011610d73575b81610d6360209383610714565b810103126100e75751925f610a81565b3d9150610d56565b50505050505090505f905f90565b505050505090505f905f90565b5050505090505f905f90565b9150506040813d604011610dd3575b81610dbe60409383610714565b810103126100e757602081519101515f61099f565b3d9150610db1565b610de791810190610760565b602063ffffffff60e01b825116928183015193610e186040519586938493639de7308560e01b855260048501610877565b03817f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03165afa9182156103e9575f92610f10575b508115610ee3576040015111610e97575f90604051610e74604082610714565b60138152721315158818589bdd99481d1a1c995cda1bdb19606a1b602082015290565b600190604051610ea8606082610714565b602581527f4c54562062656c6f77207468726573686f6c64202d20756e6465722d6c6576656020820152641c9859d95960da1b604082015290565b50505f90604051610ef5604082610714565b600b81526a2737903837b9b4ba34b7b760a91b602082015290565b9091506020813d602011610f3c575b81610f2c60209383610714565b810103126100e75751905f610e54565b3d9150610f1f56fea2646970667358221220b472a45e855418f88a1cb99d1abaa0d894d3ba41fd032ce6ab695bbdb45446cd64736f6c634300081e0033",
  "deployedBytecode": "0x6080806040526004361015610012575f80fd5b5f3560e01c9081633131489f146105f35750806332139496146105d157806343fc0865146104d75780634f1cb2911461049357806356a914f61461046e578063632224a71461043857806390359bcc1461041657806399fec7a0146103f45780639de73085146102d1578063b030ddb3146100eb5763dd90a89114610095575f80fd5b346100e7575f3660031901126100e7576100e36040516100b6604082610714565b600c81526b4175746f4c6576657261676560a01b60208201526040519182916020835260208301906106ab565b0390f35b5f80fd5b346100e75760203660031901126100e7576004356001600160401b0381116100e75761014060031982360301126100e757604051610128816106e4565b610134826004016106cf565b815260248201356001600160401b0381116100e757820191366023840112156100e757600483013561016581610737565b936101736040519586610714565b81855236602482840101116100e7576024829101602086013783016020015f905260208201928352604082019060448101358252606083019060648101358252608481016101c090610655565b608085019081526101d360a48301610655565b60a086019081526101e660c48401610752565b60c08701908152906101fa60e48501610752565b9260e0880193845261010088019461010481013586526101240161021d90610752565b956101208901968752604051998a9960208b016020905263ffffffff60e01b90511660408b01525160608a0161014090526101808a0161025c916106ab565b975160808a01525160a0890152516001600160a01b0390811660c089015290511660e08701525160ff90811661010087015290518116610120860152905161014085015290511661016083015203601f19810182526102bb9082610714565b604051809160208252602082016100e3916106ab565b346100e75760603660031901126100e75760043563ffffffff60e01b81168091036100e7576102fe61063f565b604435906001600160401b0382116100e75760846103226020933690600401610612565b604051639de7308560e01b815260048101969096526001600160a01b0390931660248601526060604486015260648501839052849283918190848401375f828201840152601f01601f191681010301817f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03165afa80156103e9575f906103b6575b602090604051908152f35b506020813d6020116103e1575b816103d060209383610714565b810103126100e757602090516103ab565b3d91506103c3565b6040513d5f823e3d90fd5b346100e7575f3660031901126100e757604051633028125760e01b8152602090f35b346100e7575f3660031901126100e757604051633c724fef60e11b8152602090f35b346100e75761044f61044936610669565b91610ddb565b906100e3604051928392151583526040602084015260408301906106ab565b346100e757604061048761048136610669565b91610917565b82519182526020820152f35b346100e7575f3660031901126100e7576040517f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03168152602090f35b346100e75760603660031901126100e7576004356001600160401b0381116100e75761050a61051d913690600401610612565b919061051461063f565b92810190610760565b602063ffffffff60e01b82511692818301519361054e6040519586938493639de7308560e01b855260048501610877565b03817f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03165afa9182156103e9575f9261059c575b60208360608401511115604051908152f35b91506020823d6020116105c9575b816105b760209383610714565b810103126100e757905190606061058a565b3d91506105aa565b346100e7575f3660031901126100e75760405163bbbf88eb60e01b8152602090f35b346100e7575f3660031901126100e757633af167ff60e01b8152602090f35b9181601f840112156100e7578235916001600160401b0383116100e757602083818601950101116100e757565b602435906001600160a01b03821682036100e757565b35906001600160a01b03821682036100e757565b60406003198201126100e757600435906001600160401b0382116100e75761069391600401610612565b90916024356001600160a01b03811681036100e75790565b805180835260209291819084018484015e5f828201840152601f01601f1916010190565b35906001600160e01b0319821682036100e757565b61014081019081106001600160401b0382111761070057604052565b634e487b7160e01b5f52604160045260245ffd5b601f909101601f19168101906001600160401b0382119082101761070057604052565b6001600160401b03811161070057601f01601f191660200190565b359060ff821682036100e757565b6020818303126100e7578035906001600160401b0382116100e7570190610140828203126100e75760405191610795836106e4565b61079e816106cf565b835260208101356001600160401b0381116100e75781019082601f830112156100e7578135926107cd84610737565b906107db6040519283610714565b848252602085850101116100e7575f60208561086e9682610120970183860137830101526020850152604081013560408501526060810135606085015261082460808201610655565b608085015261083560a08201610655565b60a085015261084660c08201610752565b60c085015261085760e08201610752565b60e085015261010081013561010085015201610752565b61012082015290565b6001600160e01b031990911681526001600160a01b0390911660208201526060604082018190526108aa929101906106ab565b90565b818102929181159184041417156108c057565b634e487b7160e01b5f52601160045260245ffd5b81156108de570490565b634e487b7160e01b5f52601260045260245ffd5b60ff16604d81116108c057600a0a90565b51906001600160a01b03821682036100e757565b61092691939293810190610760565b8051602082018051604080516326a9d0f960e21b81527f00000000000000000000000000000000000000000000000000000000000000006001600160a01b031697939594909391928492839261098b9291906001600160e01b03191660048501610877565b0381885afa80156103e9575f915f91610da2575b508115610d9657612710810281810461271014821517156108c057826109c4916108d4565b916060840192835180911015610d7b57612710916109e1916108ad565b0481811115610d8957818103928184116108c057519182612710039261271084116108c05761271014610d7b57612710840293840461271014911417156108c057610a2b916108d4565b815160a08301518451604051630ee9078360e01b8152939793959260209287928392610a6e926001600160a01b0316906001600160e01b03191660048501610877565b0381855afa9384156103e9575f94610d47575b50610aa684610aa160e0860198610a9b60ff8b51166108f2565b906108ad565b6108d4565b61012084015190969060ff168015610d3d5760ff905b1660018111610d2c575b5083515f95906001600160e01b031916633028125760e01b8103610c5757505050519060a0828051810103126100e7576040519060a082016001600160401b038111838210176107005760209260a491604052610b24848601610903565b8152610b3260408601610903565b92848201938452610b4560608701610903565b956040830196875260a0610b5b60808301610903565b606085019081529101516080840190815260405163168be4db60e01b815293516001600160a01b03908116600486015295518616602485015296518516604484015251909316606482015293516084850152839182905afa9081156103e9575f91610c25575b5080610bef575b50610100905b0151612710039061271082116108c05761271091610beb916108ad565b0490565b9091506a0c097ce7bc90715b34b9f160241b8481029085820414851517156108c05761010091610c1e916108d4565b9190610bc8565b90506020813d602011610c4f575b81610c4060209383610714565b810103126100e757515f610bc1565b3d9150610c33565b6020919294610c8d9460018060a01b0360808901511690519260405196879485938493630794e50360e01b855260048501610877565b03915afa9182156103e9575f92610cf8575b5081610cb2575b50505061010090610bce565b61010093945060ff610ce1610cd2610cef9594610aa1610ce9958c6108ad565b610a9b8360c08a0151166108f2565b9251166108f2565b906108d4565b91905f80610ca6565b9091506020813d602011610d24575b81610d1460209383610714565b810103126100e75751905f610c9f565b3d9150610d07565b610d3691976108d4565b955f610ac6565b5060ff6001610abc565b9093506020813d602011610d73575b81610d6360209383610714565b810103126100e75751925f610a81565b3d9150610d56565b50505050505090505f905f90565b505050505090505f905f90565b5050505090505f905f90565b9150506040813d604011610dd3575b81610dbe60409383610714565b810103126100e757602081519101515f61099f565b3d9150610db1565b610de791810190610760565b602063ffffffff60e01b825116928183015193610e186040519586938493639de7308560e01b855260048501610877565b03817f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03165afa9182156103e9575f92610f10575b508115610ee3576040015111610e97575f90604051610e74604082610714565b60138152721315158818589bdd99481d1a1c995cda1bdb19606a1b602082015290565b600190604051610ea8606082610714565b602581527f4c54562062656c6f77207468726573686f6c64202d20756e6465722d6c6576656020820152641c9859d95960da1b604082015290565b50505f90604051610ef5604082610714565b600b81526a2737903837b9b4ba34b7b760a91b602082015290565b9091506020813d602011610f3c575b81610f2c60209383610714565b810103126100e75751905f610e54565b3d9150610f1f56fea2646970667358221220b472a45e855418f88a1cb99d1abaa0d894d3ba41fd032ce6ab695bbdb45446cd64736f6c634300081e0033",
  "devdoc": {
    "details": "Opposite of LtvTrigger - increases leverage when under-leveraged Flow: 1. Pre-hook: Flash loan collateral → Deposit → Borrow debt → Push to OrderManager 2. CoW Swap: Debt → Collateral 3. Post-hook: Repay flash loan with received collateral Order params:   - sellToken = debtToken (we're selling borrowed debt)   - buyToken = collateralToken (we're buying collateral to repay flash loan)",
    "kind": "dev",
    "methods": {
      "calculateExecution(bytes,address)": {
        "details": "Returns:   - sellAmount: debt tokens to borrow and swap   - minBuyAmount: collateral tokens expected (must cover flash loan + fee)",
        "params": {
          "owner": "The order owner",
          "staticData": "ABI-encoded trigger-specific parameters"
        },
        "returns": {
          "minBuyAmount": "Minimum amount to receive (includes slippage protection)",
          "sellAmount": "Amount of sell token to trade in this execution"
        }
      },
      "isComplete(bytes,address,uint256)": {
        "details": "Called after each execution to determine if order should be marked complete",
        "params": {
          "iterationCount": "Number of executions completed so far",
          "owner": "The order owner",
          "staticData": "ABI-encoded trigger-specific parameters"
        },
        "returns": {
          "_0": "True if the order goal has been reached"
        }
      },
      "shouldExecute(bytes,address)": {
        "params": {
          "owner": "The order owner (user whose position is being monitored)",
          "staticData": "ABI-encoded trigger-specific parameters"
        },
        "returns": {
          "_0": "True if the trigger condition is met",
          "_1": "Human-readable reason for the result (for debugging/logging)"
        }
      },
      "triggerName()": {
        "returns": {
          "_0": "Trigger name (e.g., \"LTV\", \"Price\", \"HealthFactor\")"
        }
      }
    },
    "title": "AutoLeverageTrigger",
    "version": 1
  },
  "userdoc": {
    "kind": "user",
    "methods": {
      "calculateExecution(bytes,address)": {
        "notice": "Calculate the execution amounts when the trigger fires"
      },
      "encodeTriggerParams((bytes4,bytes,uint256,uint256,address,address,uint8,uint8,uint256,uint8))": {
        "notice": "Encode trigger params for order creation"
      },
      "getCurrentLtv(bytes4,address,bytes)": {
        "notice": "Get current LTV for a user"
      },
      "isComplete(bytes,address,uint256)": {
        "notice": "Check if the order is complete and should stop executing"
      },
      "shouldExecute(bytes,address)": {
        "notice": "Check if the order should execute based on current conditions"
      },
      "triggerName()": {
        "notice": "Get human-readable name of the trigger type"
      }
    },
    "notice": "Triggers order execution when position LTV drops BELOW a threshold (auto-leverage)",
    "version": 1
  },
  "storageLayout": {
    "storage": [],
    "types": null
  }
}